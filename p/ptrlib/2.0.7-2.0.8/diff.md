# Comparing `tmp/ptrlib-2.0.7-py3-none-any.whl.zip` & `tmp/ptrlib-2.0.8-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,9 +1,9 @@
-Zip file size: 123294 bytes, number of entries: 161
--rw-rw-r--  2.0 unx      422 b- defN 23-Jan-21 06:41 ptrlib/__init__.py
+Zip file size: 124129 bytes, number of entries: 161
+-rw-rw-r--  2.0 unx      423 b- defN 23-May-20 15:23 ptrlib/__init__.py
 -rw-rw-r--  2.0 unx       28 b- defN 23-Jan-21 06:41 ptrlib/algorithm/__init__.py
 -rw-rw-r--  2.0 unx      116 b- defN 23-Jan-21 06:41 ptrlib/algorithm/shortestpath/__init__.py
 -rw-rw-r--  2.0 unx      287 b- defN 23-Jan-21 06:41 ptrlib/algorithm/shortestpath/base.py
 -rw-rw-r--  2.0 unx     1360 b- defN 23-Jan-21 06:41 ptrlib/algorithm/shortestpath/shortestpath.py
 -rw-rw-r--  2.0 unx      941 b- defN 23-Jan-21 06:41 ptrlib/algorithm/shortestpath/types.py
 -rw-rw-r--  2.0 unx      102 b- defN 23-Jan-21 06:41 ptrlib/algorithm/shortestpath/algorithms/__init__.py
 -rw-rw-r--  2.0 unx     3367 b- defN 23-Jan-21 06:41 ptrlib/algorithm/shortestpath/algorithms/astar.py
@@ -31,35 +31,35 @@
 -rw-rw-r--  2.0 unx    14542 b- defN 23-Jan-21 06:41 ptrlib/arch/intel/syscall.py
 -rw-rw-r--  2.0 unx       45 b- defN 23-Jan-21 06:41 ptrlib/arch/linux/__init__.py
 -rw-rw-r--  2.0 unx      465 b- defN 23-Mar-12 14:56 ptrlib/arch/linux/ospath.py
 -rw-rw-r--  2.0 unx      723 b- defN 23-Jan-21 06:41 ptrlib/arch/linux/syscall.py
 -rw-rw-r--  2.0 unx       98 b- defN 23-Jan-21 06:41 ptrlib/binary/__init__.py
 -rw-rw-r--  2.0 unx       90 b- defN 23-May-09 11:53 ptrlib/binary/encoding/__init__.py
 -rw-rw-r--  2.0 unx      220 b- defN 23-May-09 11:55 ptrlib/binary/encoding/bitconv.py
--rw-rw-r--  2.0 unx      524 b- defN 23-Jan-21 06:41 ptrlib/binary/encoding/byteconv.py
+-rw-rw-r--  2.0 unx     2678 b- defN 23-May-20 15:44 ptrlib/binary/encoding/byteconv.py
 -rw-rw-r--  2.0 unx     1552 b- defN 23-Jan-21 06:41 ptrlib/binary/encoding/locale.py
 -rw-rw-r--  2.0 unx      520 b- defN 23-Jan-21 06:41 ptrlib/binary/encoding/table.py
 -rw-rw-r--  2.0 unx       41 b- defN 23-Jan-21 06:41 ptrlib/binary/operation/__init__.py
 -rw-rw-r--  2.0 unx     1374 b- defN 23-Jan-21 06:41 ptrlib/binary/operation/rotate.py
 -rw-rw-r--  2.0 unx     1048 b- defN 23-Jan-21 06:41 ptrlib/binary/operation/xor.py
 -rw-rw-r--  2.0 unx       84 b- defN 23-Jan-21 06:41 ptrlib/binary/packing/__init__.py
 -rw-rw-r--  2.0 unx     1006 b- defN 23-Jan-21 06:41 ptrlib/binary/packing/chunks.py
 -rw-rw-r--  2.0 unx      821 b- defN 23-Jan-21 06:41 ptrlib/binary/packing/flat.py
 -rw-rw-r--  2.0 unx     1437 b- defN 23-Jan-21 06:41 ptrlib/binary/packing/pack.py
 -rw-rw-r--  2.0 unx     3547 b- defN 23-Feb-02 14:11 ptrlib/binary/packing/unpack.py
 -rw-rw-r--  2.0 unx       26 b- defN 23-Jan-21 06:41 ptrlib/binary/statistics/__init__.py
 -rw-rw-r--  2.0 unx     1584 b- defN 23-Jan-21 06:41 ptrlib/binary/statistics/statistics.py
 -rw-rw-r--  2.0 unx       82 b- defN 23-Jan-21 06:41 ptrlib/connection/__init__.py
--rw-rw-r--  2.0 unx     7336 b- defN 23-Jan-21 06:41 ptrlib/connection/proc.py
--rw-rw-r--  2.0 unx     4862 b- defN 23-Jan-21 06:41 ptrlib/connection/sock.py
+-rw-rw-r--  2.0 unx     6623 b- defN 23-May-20 15:12 ptrlib/connection/proc.py
+-rw-rw-r--  2.0 unx     4671 b- defN 23-May-20 15:05 ptrlib/connection/sock.py
 -rw-rw-r--  2.0 unx     1919 b- defN 23-Jan-21 06:41 ptrlib/connection/ssh.py
--rw-rw-r--  2.0 unx    10760 b- defN 23-Feb-27 11:33 ptrlib/connection/tube.py
+-rw-rw-r--  2.0 unx    11649 b- defN 23-May-20 15:41 ptrlib/connection/tube.py
 -rw-rw-r--  2.0 unx     7271 b- defN 23-Feb-16 07:43 ptrlib/connection/winproc.py
 -rw-rw-r--  2.0 unx       21 b- defN 23-Jan-21 06:41 ptrlib/console/__init__.py
--rw-rw-r--  2.0 unx     1435 b- defN 23-Jan-21 06:41 ptrlib/console/color.py
+-rw-rw-r--  2.0 unx     1461 b- defN 23-May-20 15:24 ptrlib/console/color.py
 -rw-rw-r--  2.0 unx      112 b- defN 23-Jan-21 06:41 ptrlib/crypto/__init__.py
 -rw-rw-r--  2.0 unx       64 b- defN 23-Jan-21 06:41 ptrlib/crypto/blockcipher/__init__.py
 -rw-rw-r--  2.0 unx     1396 b- defN 23-Jan-21 06:41 ptrlib/crypto/blockcipher/ecb.py
 -rw-rw-r--  2.0 unx     3829 b- defN 23-Jan-21 06:41 ptrlib/crypto/blockcipher/padcbc.py
 -rw-rw-r--  2.0 unx     2006 b- defN 23-Jan-21 06:41 ptrlib/crypto/blockcipher/padding.py
 -rw-rw-r--  2.0 unx      102 b- defN 23-Jan-21 06:41 ptrlib/crypto/hash/__init__.py
 -rw-rw-r--  2.0 unx      444 b- defN 23-Jan-21 06:41 ptrlib/crypto/hash/crc.py
@@ -103,34 +103,34 @@
 -rw-rw-r--  2.0 unx     3389 b- defN 23-Jan-21 06:41 tests/algorithm/shortestpath/test_shortestpath.py
 -rw-rw-r--  2.0 unx        0 b- defN 23-Jan-21 06:41 tests/arch/__init__.py
 -rw-rw-r--  2.0 unx     1252 b- defN 23-May-09 12:16 tests/arch/test_cpu.py
 -rw-rw-r--  2.0 unx      988 b- defN 23-May-09 08:25 tests/arch/test_simd.py
 -rw-rw-r--  2.0 unx     1120 b- defN 23-May-09 08:02 tests/arch/test_syscall.py
 -rw-rw-r--  2.0 unx        0 b- defN 23-Jan-21 06:41 tests/binary/__init__.py
 -rw-rw-r--  2.0 unx        0 b- defN 23-Jan-21 06:41 tests/binary/encoding/__init__.py
--rw-rw-r--  2.0 unx      596 b- defN 23-Jan-21 06:41 tests/binary/encoding/test_byteconv.py
+-rw-rw-r--  2.0 unx     1470 b- defN 23-May-20 15:36 tests/binary/encoding/test_byteconv.py
 -rw-rw-r--  2.0 unx     2787 b- defN 23-Jan-21 06:41 tests/binary/encoding/test_locale.py
 -rw-rw-r--  2.0 unx        0 b- defN 23-Jan-21 06:41 tests/binary/operation/__init__.py
 -rw-rw-r--  2.0 unx     1273 b- defN 23-Jan-21 06:41 tests/binary/operation/test_rotate.py
 -rw-rw-r--  2.0 unx      654 b- defN 23-Jan-21 06:41 tests/binary/operation/test_xor.py
 -rw-rw-r--  2.0 unx        0 b- defN 23-Jan-21 06:41 tests/binary/packing/__init__.py
 -rw-rw-r--  2.0 unx      847 b- defN 23-Jan-21 06:41 tests/binary/packing/test_chunks.py
 -rw-rw-r--  2.0 unx      580 b- defN 23-Jan-21 06:41 tests/binary/packing/test_flat.py
 -rw-rw-r--  2.0 unx     1648 b- defN 23-Jan-21 06:41 tests/binary/packing/test_pack.py
 -rw-rw-r--  2.0 unx     1682 b- defN 23-Jan-21 06:41 tests/binary/packing/test_unpack.py
 -rw-rw-r--  2.0 unx        0 b- defN 23-Jan-21 06:41 tests/binary/statistics/__init__.py
 -rw-rw-r--  2.0 unx     1074 b- defN 23-Jan-21 06:41 tests/binary/statistics/test_statistics.py
 -rw-rw-r--  2.0 unx        0 b- defN 23-Jan-21 06:41 tests/connection/__init__.py
--rw-rw-r--  2.0 unx     1414 b- defN 23-Jan-21 06:41 tests/connection/test_proc.py
+-rw-rw-r--  2.0 unx     1414 b- defN 23-May-20 15:38 tests/connection/test_proc.py
 -rw-rw-r--  2.0 unx      943 b- defN 23-Jan-21 06:41 tests/connection/test_sock.py
 -rw-rw-r--  2.0 unx     1586 b- defN 23-Feb-16 07:43 tests/connection/test_windows_proc.py
 -rw-rw-r--  2.0 unx        0 b- defN 23-Jan-21 06:41 tests/crypto/__init__.py
 -rw-rw-r--  2.0 unx        0 b- defN 23-Jan-21 06:41 tests/crypto/blockcipher/__init__.py
 -rw-rw-r--  2.0 unx      731 b- defN 23-Jan-21 06:41 tests/crypto/blockcipher/test_ecb.py
--rw-rw-r--  2.0 unx     1809 b- defN 23-May-09 08:15 tests/crypto/blockcipher/test_padcbc.py
+-rw-rw-r--  2.0 unx     1971 b- defN 23-May-20 15:49 tests/crypto/blockcipher/test_padcbc.py
 -rw-rw-r--  2.0 unx     1811 b- defN 23-Jan-21 06:41 tests/crypto/blockcipher/test_padding.py
 -rw-rw-r--  2.0 unx        0 b- defN 23-Jan-21 06:41 tests/crypto/hash/__init__.py
 -rw-rw-r--  2.0 unx      589 b- defN 23-Jan-21 06:41 tests/crypto/hash/test_crc.py
 -rw-rw-r--  2.0 unx     1862 b- defN 23-Jan-21 06:41 tests/crypto/hash/test_hash.py
 -rw-rw-r--  2.0 unx        0 b- defN 23-Jan-21 06:41 tests/crypto/number/__init__.py
 -rw-rw-r--  2.0 unx      696 b- defN 23-Jan-21 06:41 tests/crypto/number/test_crt.py
 -rw-rw-r--  2.0 unx      768 b- defN 23-Jan-21 06:41 tests/crypto/number/test_gcd.py
@@ -150,14 +150,14 @@
 -rw-rw-r--  2.0 unx     1613 b- defN 23-Jan-21 06:41 tests/filestruct/elf/test_elf_5.py
 -rw-rw-r--  2.0 unx     1124 b- defN 23-Jan-21 06:41 tests/filestruct/elf/test_elf_6.py
 -rw-rw-r--  2.0 unx     1108 b- defN 23-Jan-21 06:41 tests/filestruct/elf/test_elf_7.py
 -rw-rw-r--  2.0 unx      574 b- defN 23-Jan-21 06:41 tests/filestruct/elf/test_elf_8.py
 -rw-rw-r--  2.0 unx        0 b- defN 23-Jan-21 06:41 tests/pwn/__init__.py
 -rw-rw-r--  2.0 unx     1877 b- defN 23-Jan-21 06:41 tests/pwn/test_fsb.py
 -rw-rw-r--  2.0 unx     1988 b- defN 23-Jan-21 06:41 tests/pwn/test_fuzz.py
--rw-rw-r--  2.0 unx     1069 b- defN 23-May-09 12:18 ptrlib-2.0.7.dist-info/LICENSE.txt
--rw-rw-r--  2.0 unx     3535 b- defN 23-May-09 12:18 ptrlib-2.0.7.dist-info/METADATA
--rw-rw-r--  2.0 unx       92 b- defN 23-May-09 12:18 ptrlib-2.0.7.dist-info/WHEEL
--rw-rw-r--  2.0 unx       48 b- defN 23-May-09 12:18 ptrlib-2.0.7.dist-info/entry_points.txt
--rw-rw-r--  2.0 unx       13 b- defN 23-May-09 12:18 ptrlib-2.0.7.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx    14071 b- defN 23-May-09 12:18 ptrlib-2.0.7.dist-info/RECORD
-161 files, 326615 bytes uncompressed, 100858 bytes compressed:  69.1%
+-rw-rw-r--  2.0 unx     1069 b- defN 23-May-20 15:52 ptrlib-2.0.8.dist-info/LICENSE.txt
+-rw-rw-r--  2.0 unx     3535 b- defN 23-May-20 15:52 ptrlib-2.0.8.dist-info/METADATA
+-rw-rw-r--  2.0 unx       92 b- defN 23-May-20 15:52 ptrlib-2.0.8.dist-info/WHEEL
+-rw-rw-r--  2.0 unx       48 b- defN 23-May-20 15:52 ptrlib-2.0.8.dist-info/entry_points.txt
+-rw-rw-r--  2.0 unx       13 b- defN 23-May-20 15:52 ptrlib-2.0.8.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx    14073 b- defN 23-May-20 15:52 ptrlib-2.0.8.dist-info/RECORD
+161 files, 329819 bytes uncompressed, 101693 bytes compressed:  69.2%
```

## zipnote {}

```diff
@@ -459,26 +459,26 @@
 
 Filename: tests/pwn/test_fsb.py
 Comment: 
 
 Filename: tests/pwn/test_fuzz.py
 Comment: 
 
-Filename: ptrlib-2.0.7.dist-info/LICENSE.txt
+Filename: ptrlib-2.0.8.dist-info/LICENSE.txt
 Comment: 
 
-Filename: ptrlib-2.0.7.dist-info/METADATA
+Filename: ptrlib-2.0.8.dist-info/METADATA
 Comment: 
 
-Filename: ptrlib-2.0.7.dist-info/WHEEL
+Filename: ptrlib-2.0.8.dist-info/WHEEL
 Comment: 
 
-Filename: ptrlib-2.0.7.dist-info/entry_points.txt
+Filename: ptrlib-2.0.8.dist-info/entry_points.txt
 Comment: 
 
-Filename: ptrlib-2.0.7.dist-info/top_level.txt
+Filename: ptrlib-2.0.8.dist-info/top_level.txt
 Comment: 
 
-Filename: ptrlib-2.0.7.dist-info/RECORD
+Filename: ptrlib-2.0.8.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## ptrlib/__init__.py

```diff
@@ -10,7 +10,8 @@
 
 # ptrlib root logger
 handler = StreamHandler()
 handler.setFormatter(ColoredFormatter("%(funcName)s: %(message)s"))
 logger = getLogger(__name__)
 logger.setLevel(INFO)
 logger.addHandler(handler)
+
```

## ptrlib/binary/encoding/byteconv.py

```diff
@@ -1,7 +1,8 @@
+from typing import Tuple
 from logging import getLogger
 
 logger = getLogger(__name__)
 
 
 def bytes2str(data: bytes) -> str:
     """Convert bytes to str
@@ -11,11 +12,81 @@
     else:
         raise ValueError("{} given ('bytes' expected)".format(type(data)))
 
 def str2bytes(data: str) -> bytes:
     """Convert str to bytes
     """
     if isinstance(data, str):
-        return bytes(list(map(ord, data)))
+        try:
+            return bytes(list(map(ord, data)))
+        except ValueError:
+            return data.encode('utf-8')
     else:
         raise ValueError("{} given ('str' expected)".format(type(data)))
 
+def bytes2utf8(data: bytes) -> Tuple[str, bytes]:
+    """Convert bytes to UTF-8
+
+    Convert byte array into UTF-8 string.
+    This function also returns the leftover bytes that cannot not
+    be interpreted as UTF-8.
+    If it encounters an invalid character, the byte will be directly
+    converted into a character just like `bytes2str` do.
+
+    Args:
+        data: Byte array to convert into UTF-8 (bytes)
+
+    Returns:
+        tuple(str, bytes): UTF-8 string and leftover bytes
+    """
+    output = ''
+    leftover = b''
+    i = 0
+    while i < len(data):
+        c1 = data[i]
+        if (c1 >> 5) & 0b111 == 0b110: # 2 bytes
+            if i + 1 >= len(data):
+                leftover = data[i:]
+                break
+            c2 = data[i+1]
+            if (c2 >> 6) & 0b11 == 0b10:
+                char = bytes([c1, c2]).decode('utf-8')
+                i += 2
+            else:
+                char = chr(c1)
+                i += 1
+            output += char
+
+        elif (c1 >> 4) & 0b1111 == 0b1110: # 3 bytes
+            if i + 2 >= len(data):
+                leftover = data[i:]
+                break
+            c2, c3 = data[i+1], data[i+2]
+            if (c2 >> 6) & 0b11 == 0b10 and \
+               (c3 >> 6) & 0b11 == 0b10:
+                char = bytes([c1, c2, c3]).decode('utf-8')
+                i += 3
+            else:
+                char = chr(c1)
+                i += 1
+            output += char
+
+        elif (c1 >> 3) & 0b11111 == 0b11110: # 4 bytes
+            if i + 3 >= len(data):
+                leftover = data[i:]
+                break
+            c2, c3, c4 = data[i+1:i+4]
+            if (c2 >> 6) & 0b11 == 0b10 and \
+               (c3 >> 6) & 0b11 == 0b10 and \
+               (c4 >> 6) & 0b11 == 0b10:
+                char = bytes([c1, c2, c3, c4]).decode('utf-8')
+                i += 4
+            else:
+                char = chr(c1)
+                i += 1
+            output += char
+
+        else: # 1 byte or invalid
+            output += chr(c1)
+            i += 1
+
+    return output, leftover
```

## ptrlib/connection/proc.py

```diff
@@ -52,15 +52,14 @@
             self.filepath = args[0]
         else:
             self.args = [args]
             self.filepath = args
         self.env = env
         self.default_timeout = timeout
         self.timeout = self.default_timeout
-        self.reservoir = b''
         self.proc = None
         self.returncode = None
 
         # Open pty on Unix
         master, self.slave = pty.openpty()
         tty.setraw(master)
         tty.setraw(self.slave)
@@ -136,60 +135,38 @@
         except TimeoutError as e:
             raise e from None
         except select.error as v:
             if v[0] == errno.EINTR:
                 return False
         assert False, "unreachable"
 
-    def _recv(self, size: int=4096, timeout: Optional[Union[int, float]]=None) -> Optional[bytes]:
+    def _recv(self, size: int=4096, timeout: Optional[Union[int, float]]=None) -> bytes:
         """Receive raw data
 
         Receive raw data of maximum `size` bytes length through the pipe.
 
         Args:
             size    (int): The data size to receive
             timeout (int): Timeout (in second)
 
         Returns:
             bytes: The received data
         """
         self._settimeout(timeout)
-        if size <= 0:
-            logger.error("`size` must be larger than 0")
-            return b''
-
-        if size <= len(self.reservoir):
-            # Use the buffer
-            data = self.reservoir[:size]
-            self.reservoir = self.reservoir[size:]
-            return data
 
         if not self._can_recv():
             return b''
 
         try:
             data = self.proc.stdout.read(size)
-            self.reservoir += data
         except subprocess.TimeoutExpired:
-            logger.error("Timeout")
-            return None
+            # TODO: Unreachable?
+            raise TimeoutError("Receive timeout") from None
 
         self._poll() # poll after received all data
-
-        if len(self.reservoir) == 0:
-            # No data received
-            data = None
-        elif len(self.reservoir) >= size:
-            # Too much data received
-            data = self.reservoir[:size]
-            self.reservoir = self.reservoir[size:]
-        else:
-            # Too little data received
-            data = self.reservoir
-            self.reservoir = b''
         return data
 
     def send(self, data: Union[str, bytes]):
         """Send raw data
 
         Send raw data through the socket
```

## ptrlib/connection/sock.py

```diff
@@ -59,42 +59,36 @@
             self.sock.settimeout(self.timeout)
         elif timeout > 0:
             self.sock.settimeout(timeout)
 
     def _socket(self) -> Optional[socket.socket]:
         return self.sock
 
-    def _recv(self, size: int=4096, timeout: Optional[Union[int, float]]=None) -> Optional[bytes]:
+    def _recv(self, size: int=4096, timeout: Optional[Union[int, float]]=None) -> bytes:
         """Receive raw data
 
         Receive raw data of maximum `size` bytes length through the socket.
 
         Args:
             size    (int): The data size to receive
             timeout (int): Timeout (in second)
 
         Returns:
             bytes: The received data
         """
         self._settimeout(timeout)
-        if size <= 0:
-            logger.error("`size` must be larger than 0")
-            return None
 
         try:
             data = self.sock.recv(size)
         except socket.timeout:
             raise TimeoutError("Receive timeout") from None
         except ConnectionAbortedError as e:
             logger.warning("Connection aborted by the host")
             raise e from None
 
-        # No data received
-        if len(data) == 0:
-            data = None
         return data
 
     def send(self, data: Union[str, bytes]):
         """Send raw data
 
         Send raw data through the socket
```

## ptrlib/connection/tube.py

```diff
@@ -19,14 +19,19 @@
 
 class Tube(metaclass=ABCMeta):
     def __init__(self):
         self.buf = b''
 
     @abstractmethod
     def _settimeout(self, timeout: Optional[Union[int, float]]):
+        """Set timeout
+
+        Args:
+            timeout (float): Timeout (None: Set to default / -1: No change / x>0: Set timeout to x seconds)
+        """
         pass
 
     @abstractmethod
     def _recv(self, size: int, timeout: Union[int, float]) -> Optional[bytes]:
         """Receive raw data
 
         Receive raw data of maximum `size` bytes length through the socket.
@@ -47,26 +52,30 @@
 
     def recv(self, size: int=4096, timeout: Optional[Union[int, float]]=None) -> bytes:
         """Receive raw data with buffering
 
         Receive raw data of maximum `size` bytes length through the socket.
 
         Args:
-            size    (int): The data size to receive
+            size    (int): The data size to receive (Use `recvonce`
+                           if you want to read exactly `size` bytes)
             timeout (int): Timeout (in second)
 
         Returns:
             bytes: The received data
         """
-        self._settimeout(timeout)
-        if not self.buf:
+        if size <= 0:
+            raise ValueError("`size` must be larger than 0")
+
+        elif len(self.buf) == 0:
+            self._settimeout(timeout)
             data = self._recv(size, timeout=-1)
-            if data is not None:
-                self.buf += data
+            self.buf += data
 
+        # We don't check size > len(self.buf) because Python handles it
         data, self.buf = self.buf[:size], self.buf[size:]
         return data
 
     def recvonce(self, size: int, timeout: Optional[Union[int, float]]=None) -> bytes:
         """Receive raw data with buffering
 
         Receive raw data of size `size` bytes length through the socket.
@@ -76,16 +85,22 @@
             timeout (int): Timeout (in second)
 
         Returns:
             bytes: The received data
         """
         self._settimeout(timeout)
         data = b''
+        timer_start = time.time()
+
         while len(data) < size:
-            data += self.recv(size - len(data))
+            if timeout is not None and time.time() - timer_start > timeout:
+                raise TimeoutError("`recvonce` timeout")
+
+            data += self.recv(size - len(data), timeout=-1)
+            time.sleep(0.01)
 
         if len(data) > size:
             self.unget(data[size:])
         return data[:size]
 
 
     def recvuntil(self,
@@ -104,19 +119,25 @@
             lookahead (bool): Unget deliminator to buffer or not
 
         Returns:
             bytes: Received data
         """
         if isinstance(delim, str):
             delim = str2bytes(delim)
-        data = b''
 
         self._settimeout(timeout)
+        data = b''
+        timer_start = time.time()
+
         while data.find(delim) == -1:
-            data += self.recv(size, -1)
+            if timeout is not None and time.time() - timer_start > timeout:
+                raise TimeoutError("`recvuntil` timeout")
+
+            data += self.recv(size, timeout=-1)
+            time.sleep(0.01)
 
         found_pos = data.find(delim)
         result_len = found_pos if drop else found_pos + len(delim)
         consumed_len = found_pos if lookahead else found_pos + len(delim)
         self.unget(data[consumed_len:])
         return data[:result_len]
 
@@ -293,16 +314,18 @@
         """Interactive mode
         """
         def thread_recv():
             while not flag.isSet():
                 try:
                     data = self.recv(size=4096, timeout=0.1)
                     if data is not None:
-                        sys.stdout.write(bytes2str(data))
+                        utf8str, leftover = bytes2utf8(data)
+                        sys.stdout.write(utf8str)
                         sys.stdout.flush()
+                        self.unget(leftover)
                 except TimeoutError:
                     pass
                 except EOFError:
                     logger.error("Receiver EOF")
                     break
                 except ConnectionAbortedError:
                     logger.error("Receiver EOF")
```

## ptrlib/console/color.py

```diff
@@ -1,7 +1,8 @@
+from ptrlib import logger
 from logging import Formatter, DEBUG, INFO, WARNING, ERROR, LogRecord
 
 
 class Color:
     BLACK     = '\033[30m'
     RED       = '\033[31m'
     GREEN     = '\033[32m'
```

## tests/binary/encoding/test_byteconv.py

```diff
@@ -1,9 +1,9 @@
 import unittest
-from ptrlib import str2bytes, bytes2str
+from ptrlib import str2bytes, bytes2str, bytes2utf8
 from logging import getLogger, FATAL
 
 
 class TestBytes(unittest.TestCase):
     def setUp(self):
         getLogger("ptrlib").setLevel(FATAL)
 
@@ -12,7 +12,27 @@
         self.assertEqual(str2bytes("\x01\x80\n\xfe\x7f\x00"),
                          b"\x01\x80\n\xfe\x7f\x00")
 
     def test_bytes2str(self):
         self.assertEqual(bytes2str(b"Hello"), "Hello")
         self.assertEqual(bytes2str(b"\x01\x80\n\xfe\x7f\x00"),
                          "\x01\x80\n\xfe\x7f\x00")
+
+    def test_bytes2utf8(self):
+        b1 = b'\xe3\x81\xab\xe3\x82\x83\xe3\x83\xbc\xe3\x82\x93\xf0\x9f\x98\xba\xf0\x9f\x90\xb6\xe3\x82\x8f\xe3\x82\x93\xe3\x82\x8f\xe3\x82\x93\xe3\x81\x8a'
+        b2 = b'\xd0\xba\xd0\xbe\xd1\x82\xea\xb3\xa0\xec\x96\x91\xec\x9d\xb4\xd9\x82\xd8\xb7\xd8\xa9'
+
+        s, leftover = bytes2utf8(b1)
+        self.assertEqual(s.encode('utf-8'), b1)
+        self.assertEqual(len(leftover), 0)
+
+        s, leftover = bytes2utf8(b2)
+        self.assertEqual(s.encode('utf-8'), b2)
+        self.assertEqual(len(leftover), 0)
+
+        s, leftover = bytes2utf8(b1[:len(b1)//2])
+        self.assertEqual(s.encode('utf-8'), b1[:3+3+3+3+4])
+        self.assertEqual(leftover, b1[3+3+3+3+4:len(b1)//2])
+
+        s, leftover = bytes2utf8(b1[len(b1)//2:])
+        self.assertEqual(s[:3], '\x9f\x90\xb6')
+        self.assertEqual(len(leftover), 0)
```

## tests/crypto/blockcipher/test_padcbc.py

```diff
@@ -24,16 +24,19 @@
                 try:
                     aes = AES.new(key, AES.MODE_CBC, iv=c[:AES.block_size])
                     unpad(aes.decrypt(c[AES.block_size:]), AES.block_size)
                     return True
                 except:
                     return False
 
-            if m == padding_oracle(try_decrypt, c, iv=iv, bs=AES.block_size):
-                ok_count += 1
+            try:
+                if m == padding_oracle(try_decrypt, c, iv=iv, bs=AES.block_size):
+                    ok_count += 1
+            except ValueError:
+                pass
 
         self.assertTrue(ok_count > 7)
 
     def test_padding_oracle_attack(self):
         ok_count = 0
         for _ in range(10):
             key = os.urandom(AES.block_size)
@@ -43,13 +46,16 @@
                     aes = AES.new(key, AES.MODE_CBC, iv=c[:AES.block_size])
                     unpad(aes.decrypt(c[AES.block_size:]), AES.block_size)
                     return True
                 except:
                     return False
 
             m = pad(os.urandom(50), AES.block_size)
-            iv, c = padding_oracle_encrypt(try_decrypt, m, bs=AES.block_size)
-            aes = AES.new(key, AES.MODE_CBC, iv=iv)
-            if m == aes.decrypt(c):
-                ok_count += 1
+            try:
+                iv, c = padding_oracle_encrypt(try_decrypt, m, bs=AES.block_size)
+                aes = AES.new(key, AES.MODE_CBC, iv=iv)
+                if m == aes.decrypt(c):
+                    ok_count += 1
+            except ValueError:
+                pass
 
         self.assertTrue(ok_count > 7)
```

## Comparing `ptrlib-2.0.7.dist-info/LICENSE.txt` & `ptrlib-2.0.8.dist-info/LICENSE.txt`

 * *Files identical despite different names*

## Comparing `ptrlib-2.0.7.dist-info/METADATA` & `ptrlib-2.0.8.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: ptrlib
-Version: 2.0.7
+Version: 2.0.8
 Summary: CTF library
 Home-page: https://github.com/ptr-yudai/ptrlib/
 Author: ptr-yudai
 Author-email: ptr.yudai+dev@gmail.com
 Keywords: pwn crypto algorithm
 Classifier: License :: OSI Approved :: MIT License
 Classifier: Programming Language :: Python :: 3.5
```

## Comparing `ptrlib-2.0.7.dist-info/RECORD` & `ptrlib-2.0.8.dist-info/RECORD`

 * *Files 3% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-ptrlib/__init__.py,sha256=WcludFzDbAniYMZeTca_x_yTVSHXTnZbPA_D3t5WPN8,422
+ptrlib/__init__.py,sha256=x4yEItJtAUNQMERWAZHdohJ0YlgnE6dZmYvslvDn8Qw,423
 ptrlib/algorithm/__init__.py,sha256=hx2aSxD0xkyN6JIAkcq2lDQwEHew2D0S-h3wgzfNoTk,28
 ptrlib/algorithm/shortestpath/__init__.py,sha256=xMNBTUNmD9aTaWtTNH3sM5qB09aB0333vJb_ih6Sr_o,116
 ptrlib/algorithm/shortestpath/base.py,sha256=w9WABfwOnfsSjh6x8qnrGI90bSF_Awz6mss4oJnbE5M,287
 ptrlib/algorithm/shortestpath/shortestpath.py,sha256=e7XSSE7hVWIrU2RLLUc1u_vp0JobNAP015z1EBtxc-Y,1360
 ptrlib/algorithm/shortestpath/types.py,sha256=Ugd7DXgjburZZfTj-6ovUz5GAyZ5GddVIIxBfNYYH6s,941
 ptrlib/algorithm/shortestpath/algorithms/__init__.py,sha256=-WGB-FYQD5BP3x5nx9o22iGL195w16CyC0phxv-C6zM,102
 ptrlib/algorithm/shortestpath/algorithms/astar.py,sha256=OQBy7G2AjItRq_3r2Rpl7ZCWy1xY7z_RoOnQuQMVtP8,3367
@@ -30,35 +30,35 @@
 ptrlib/arch/intel/syscall.py,sha256=kgAoR1WAhqsfeJ4BGchrCqZb_nrsnnJ_g3u5loehatY,14542
 ptrlib/arch/linux/__init__.py,sha256=MxDaHplYTwY16ma16lsigtP2a433xLPZe5QdmSdTZMo,45
 ptrlib/arch/linux/ospath.py,sha256=MekrAU-UCw7HDEmMAe4rTPGI-H6nbQTgmXFUIxMuGIw,465
 ptrlib/arch/linux/syscall.py,sha256=g-_eE5xc98rRL1NluKgI00sDUTBdQ2Qb7_dukkONL3M,723
 ptrlib/binary/__init__.py,sha256=Yq7lZzjQbkGObgBhkc4EyxUQNqoSzq8Upy8aAzcqMmY,98
 ptrlib/binary/encoding/__init__.py,sha256=fQgp0SEFRN-2KBUKUH5AxqsXV3hgxYcT1o7eqT548Rc,90
 ptrlib/binary/encoding/bitconv.py,sha256=Y9p95RbBi4lDqnbeuC0N0MeTkSuVowjtX95-Dnqu2OU,220
-ptrlib/binary/encoding/byteconv.py,sha256=-kkf6GF4dXm7P3VC3iXXahT0e05xNDOW7wVT1KAXRKQ,524
+ptrlib/binary/encoding/byteconv.py,sha256=uPfIJGlH3XUswXk4prfMLfCoXDAlxKH5vzzgMgIMDLU,2678
 ptrlib/binary/encoding/locale.py,sha256=JZALRWQWLDHYkPuYAf8llAGAFmhgR1mDGcCTfz9-Ebc,1552
 ptrlib/binary/encoding/table.py,sha256=0G3-e_GQnHIilV5N9QbyCOelVxnwfE5uVvVXr5h3gMc,520
 ptrlib/binary/operation/__init__.py,sha256=A7OOwayygfMwVev-HJoazt4ryq15xqSXjni1RK5Q7cM,41
 ptrlib/binary/operation/rotate.py,sha256=1K4Z1rtoaqJ-Q7uJkp5LzAoqFbg07IzgKDrN5Rx1XEI,1374
 ptrlib/binary/operation/xor.py,sha256=wa99k4etfCzZHIjkaf5vdLiPxFPEQuIvAkL6GdO_51o,1048
 ptrlib/binary/packing/__init__.py,sha256=2wYJJGaQ_9vEMvdGeSvex4dRsxVziEuwl416yh8w2-o,84
 ptrlib/binary/packing/chunks.py,sha256=_S43yHtbZhKkfURzk8V-Ytw5sXu9uSMiawZiN_GYgTY,1006
 ptrlib/binary/packing/flat.py,sha256=lauRS6KqOz0OXD85rDhlaXbbDHlDmzo4g6M8xerqCrQ,821
 ptrlib/binary/packing/pack.py,sha256=na0-iHIsE4hbnKiBW-b1d-DAG1xd9VkB3Xcb4G7HNlI,1437
 ptrlib/binary/packing/unpack.py,sha256=jmtjKAALZKBPokJRNQubBUT1O6wnF4LMwCJzg6lcBYA,3547
 ptrlib/binary/statistics/__init__.py,sha256=eJAibn0JE1DGzk4G6yPsrQ5KbjcsSYsx2ZfXHt83XYk,26
 ptrlib/binary/statistics/statistics.py,sha256=e7omLfl46nwJwZ842PWWGeJd__KMn7MzAm9Bq9CReLU,1584
 ptrlib/connection/__init__.py,sha256=5_8CIWwIuGTXoWrf1G93E9EFKS2LhA3BvpaSKDaQGGk,82
-ptrlib/connection/proc.py,sha256=P2HIORfabIf73nWz6uO0_HBza6lHhnCg2xjEKgMlKNE,7336
-ptrlib/connection/sock.py,sha256=1z_AL8KrO7J3wTj2Eg0g1h849jGi19N2tUGMHiMqpio,4862
+ptrlib/connection/proc.py,sha256=BnH7j-JTENYA5Hpnc-h14OK41bmrxAvIcNw6a3rvbR8,6623
+ptrlib/connection/sock.py,sha256=rDU4EtHOl9mRqu7OIeWmtW1FW24qBGts3AcA5SaDOPM,4671
 ptrlib/connection/ssh.py,sha256=0-qwj7GaGmaLSTbMuskmMljaBZ61Juqon_eMmezNxII,1919
-ptrlib/connection/tube.py,sha256=yn0nZvQ978vyTdJrtkx0zkQrqlPEfEjm3541LeC1N9g,10760
+ptrlib/connection/tube.py,sha256=6CAs-xUPUf8WFN3WtwQbL62fZeQiFCfe2q6cu_RY-PM,11649
 ptrlib/connection/winproc.py,sha256=X2FDM3Km_QuXpndabHbd2CdUiGIYxxIr3-58KgJCqyQ,7271
 ptrlib/console/__init__.py,sha256=9F_lzTGOwixQ_lOXmw8jgX5IW5OY1es4_cWJQ3BZmDY,21
-ptrlib/console/color.py,sha256=Z_nOr_g6rIpjpKwRyiDKeG07SGD5ruvmWrxC-wMKpXE,1435
+ptrlib/console/color.py,sha256=hmCshy6zwB59hGKPI0NpuL2nkk7_1Siz2xDxzwnu5-s,1461
 ptrlib/crypto/__init__.py,sha256=MKfosClfAhL6UHSHie4ADqYjtzkUQeAgOSgyKw9vR5g,112
 ptrlib/crypto/blockcipher/__init__.py,sha256=advd_ktJAtS4JRmViru8yXNjmFUkiHKpb0tgPeYSbZ0,64
 ptrlib/crypto/blockcipher/ecb.py,sha256=-VF-_eOQ-cGiZFFFmFnKVXQWOnpMGSBf4Tlf6_ni3js,1396
 ptrlib/crypto/blockcipher/padcbc.py,sha256=ZmesLDdzGmYASoiLx3psiqqDuFRh29nrlXXK5YXMK7k,3829
 ptrlib/crypto/blockcipher/padding.py,sha256=kmWul19I4YXhymdrIyaNhxvEkvLloiUJhJBXKcEktw8,2006
 ptrlib/crypto/hash/__init__.py,sha256=S3BUTcGUck_5Ra_QWfeOYy5d3fNi4z6sgmUl_KQqylY,102
 ptrlib/crypto/hash/crc.py,sha256=Y8Ddenj789_0NMrIcWZ6n6HJmrZdRmbkGa4Ar6FLYrs,444
@@ -102,15 +102,15 @@
 tests/algorithm/shortestpath/test_shortestpath.py,sha256=uYKYhsE3K_1FYzuRdhmFFKJulV5qPmIDWN9qVX3fHAk,3389
 tests/arch/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 tests/arch/test_cpu.py,sha256=VnZ03jKE64Oi2X-0asnfR9uCrt4UtCxUe-W9yvzWN6Y,1252
 tests/arch/test_simd.py,sha256=kEWsAkxsY6R3Nq_9lDM_clsgucsC8aabw3IcQ5V4POM,988
 tests/arch/test_syscall.py,sha256=9D-rplpqv80u80zjDRseufnvjP2vyRDerggoOe1NpmM,1120
 tests/binary/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 tests/binary/encoding/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-tests/binary/encoding/test_byteconv.py,sha256=7EeO-3l1mMGr2lpE2y6VHoFFo49peQT-xRX6R138uTY,596
+tests/binary/encoding/test_byteconv.py,sha256=oBgcwBGy54d40OCAy40OhUqjomhcaCjmC6Xr-hvtWaM,1470
 tests/binary/encoding/test_locale.py,sha256=ipVE8agDaOABSUBdXhGIRDrKg2SOmVEF8ntaDHYFy84,2787
 tests/binary/operation/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 tests/binary/operation/test_rotate.py,sha256=ppoWXsBskZsvmNtT7MlLU65roOq9NKhvzfHAUApD7yU,1273
 tests/binary/operation/test_xor.py,sha256=lw8-DCfeIM9zSZwjM6lTuRrcQiL7qsBKzv2w10O1MyA,654
 tests/binary/packing/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 tests/binary/packing/test_chunks.py,sha256=Ric7fk05PbObslpeQop3O-5W8M_iMZqLmevicdltJgw,847
 tests/binary/packing/test_flat.py,sha256=P2PXQYOYquqSbyYiUg3xJyXKhzeNbXgNW1PhfmNTL7A,580
@@ -121,15 +121,15 @@
 tests/connection/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 tests/connection/test_proc.py,sha256=Zql-0PJXcfWGA6A-VKGnYL2LRHV47PCORvnRfa6U5Qc,1414
 tests/connection/test_sock.py,sha256=YHfBIPRuHdMJWxditwTPV7HNE6gWMBjPAvNej9wCgQQ,943
 tests/connection/test_windows_proc.py,sha256=40pG5-yiteGYkHv3INGQBb_4TCGmfnELoTbp6K7sCMM,1586
 tests/crypto/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 tests/crypto/blockcipher/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 tests/crypto/blockcipher/test_ecb.py,sha256=t90btTdrOX7yjHnfFOp-NDU6znYm__1ETU36j49WLcc,731
-tests/crypto/blockcipher/test_padcbc.py,sha256=JRglGsedIlyS7BNQyvGCRTVQr0N5noKfuWgpL1N8ITE,1809
+tests/crypto/blockcipher/test_padcbc.py,sha256=fNXXjO5yxzKgZJYprbLTrchAfhNqP9QJS1m-P1dH2Ws,1971
 tests/crypto/blockcipher/test_padding.py,sha256=lvPadMx39yHiX7u2sFp1_ORzedUNa8Axy7v9TygQj28,1811
 tests/crypto/hash/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 tests/crypto/hash/test_crc.py,sha256=OBXpnxL8GJGFVHUy81oIXFxa8umexQMk953mc1ZZlxQ,589
 tests/crypto/hash/test_hash.py,sha256=ef3F93cf2mVFYcgZmRxBCsmWRS4MfYxKeOSNN6iyNXg,1862
 tests/crypto/number/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 tests/crypto/number/test_crt.py,sha256=laSTFs325tBslOKuGvCGOZ30NFwjvogAZczhixkWq5c,696
 tests/crypto/number/test_gcd.py,sha256=o3Bpj6WCmKT7_z0dMUbGkKHx3HeEVDcmSGfke625ipA,768
@@ -149,13 +149,13 @@
 tests/filestruct/elf/test_elf_5.py,sha256=LEi8_R6uog7U3LLkrYAdfrdJH3JJXH8Olv77xPFBIgQ,1613
 tests/filestruct/elf/test_elf_6.py,sha256=XJ7pRu9whJq4wdgfk8ere4q4QbcgONtV-e2ZBo4S544,1124
 tests/filestruct/elf/test_elf_7.py,sha256=uwkPsovbAdZFUJNWZ5XySf0kYtaaPJNs1YDzjYce0-Q,1108
 tests/filestruct/elf/test_elf_8.py,sha256=C1Gnylu5lOqPFo8NfJBo5YyUULe026uKL-hvwWprON0,574
 tests/pwn/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 tests/pwn/test_fsb.py,sha256=VC_0csTXIS1_PIGUBJmy2uN7hllr4kXJ0mibNYN5d_A,1877
 tests/pwn/test_fuzz.py,sha256=ARnTx48YnuV-awKeFhjsPAyCYJDn9M80q4DyVj5pvOA,1988
-ptrlib-2.0.7.dist-info/LICENSE.txt,sha256=ACwmltkrXIz5VsEQcrqljq-fat6ZXAMepjXGoe40KtE,1069
-ptrlib-2.0.7.dist-info/METADATA,sha256=z0uTxn_iHK9g8BKHqMc3N2beiu0mcgDvaM_JGb6cLb0,3535
-ptrlib-2.0.7.dist-info/WHEEL,sha256=2wepM1nk4DS4eFpYrW1TTqPcoGNfHhhO_i5m4cOimbo,92
-ptrlib-2.0.7.dist-info/entry_points.txt,sha256=xJ7v7w7uhxUeAzagSodmQhexYh_8GjCTPDCKMFse9T0,48
-ptrlib-2.0.7.dist-info/top_level.txt,sha256=A_zqZPqp9QidhyWj2_hpnC7wz0tTQ2nbR8D6vOnhzYk,13
-ptrlib-2.0.7.dist-info/RECORD,,
+ptrlib-2.0.8.dist-info/LICENSE.txt,sha256=ACwmltkrXIz5VsEQcrqljq-fat6ZXAMepjXGoe40KtE,1069
+ptrlib-2.0.8.dist-info/METADATA,sha256=DRGyh0roxSIdPGUz9WQYD_6gDkVpH6z8FCSESUEsad8,3535
+ptrlib-2.0.8.dist-info/WHEEL,sha256=2wepM1nk4DS4eFpYrW1TTqPcoGNfHhhO_i5m4cOimbo,92
+ptrlib-2.0.8.dist-info/entry_points.txt,sha256=xJ7v7w7uhxUeAzagSodmQhexYh_8GjCTPDCKMFse9T0,48
+ptrlib-2.0.8.dist-info/top_level.txt,sha256=A_zqZPqp9QidhyWj2_hpnC7wz0tTQ2nbR8D6vOnhzYk,13
+ptrlib-2.0.8.dist-info/RECORD,,
```

