# Comparing `tmp/musicpy-6.65.tar.gz` & `tmp/musicpy-6.67.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "dist\musicpy-6.65.tar", last modified: Thu May 18 14:28:46 2023, max compression
+gzip compressed data, was "dist\musicpy-6.67.tar", last modified: Sat May 20 10:31:21 2023, max compression
```

## Comparing `musicpy-6.65.tar` & `musicpy-6.67.tar`

### file list

```diff
@@ -1,23 +1,23 @@
-drwxrwxrwx   0        0        0        0 2023-05-18 14:28:46.000000 musicpy-6.65/
--rw-rw-rw-   0        0        0    27030 2021-09-24 07:05:14.000000 musicpy-6.65/LICENSE
--rw-rw-rw-   0        0        0       40 2021-10-04 19:46:56.000000 musicpy-6.65/MANIFEST.in
--rw-rw-rw-   0        0        0    16335 2023-05-18 14:28:48.000000 musicpy-6.65/PKG-INFO
--rw-rw-rw-   0        0        0    14214 2023-04-18 07:20:38.000000 musicpy-6.65/README.md
-drwxrwxrwx   0        0        0        0 2023-05-18 14:28:46.000000 musicpy-6.65/musicpy/
--rw-rw-rw-   0        0        0       90 2022-05-24 06:43:42.000000 musicpy-6.65/musicpy/__init__.py
--rw-rw-rw-   0        0        0   112637 2023-03-17 16:11:10.000000 musicpy-6.65/musicpy/algorithms.py
--rw-rw-rw-   0        0        0    10087 2023-05-15 13:49:00.000000 musicpy-6.65/musicpy/control.py
--rw-rw-rw-   0        0        0    21720 2023-03-06 07:58:48.000000 musicpy-6.65/musicpy/database.py
--rw-rw-rw-   0        0        0    59875 2023-05-04 08:43:22.000000 musicpy-6.65/musicpy/daw.py
--rw-rw-rw-   0        0        0    79317 2023-05-15 13:09:00.000000 musicpy-6.65/musicpy/musicpy.py
--rw-rw-rw-   0        0        0       38 2023-03-06 07:58:48.000000 musicpy-6.65/musicpy/requirements for musicpy daw.txt
--rw-rw-rw-   0        0        0       18 2022-10-11 02:50:12.000000 musicpy-6.65/musicpy/requirements.txt
--rw-rw-rw-   0        0        0   254795 2023-05-17 13:15:10.000000 musicpy-6.65/musicpy/structures.py
-drwxrwxrwx   0        0        0        0 2023-05-18 14:28:46.000000 musicpy-6.65/musicpy.egg-info/
--rw-rw-rw-   0        0        0    16335 2023-05-18 14:28:48.000000 musicpy-6.65/musicpy.egg-info/PKG-INFO
--rw-rw-rw-   0        0        0      405 2023-05-18 14:28:48.000000 musicpy-6.65/musicpy.egg-info/SOURCES.txt
--rw-rw-rw-   0        0        0        1 2023-05-18 14:28:48.000000 musicpy-6.65/musicpy.egg-info/dependency_links.txt
--rw-rw-rw-   0        0        0       28 2023-05-18 14:28:48.000000 musicpy-6.65/musicpy.egg-info/requires.txt
--rw-rw-rw-   0        0        0        8 2023-05-18 14:28:48.000000 musicpy-6.65/musicpy.egg-info/top_level.txt
--rw-rw-rw-   0        0        0       86 2023-05-18 14:28:48.000000 musicpy-6.65/setup.cfg
--rw-rw-rw-   0        0        0     1402 2023-05-18 12:36:28.000000 musicpy-6.65/setup.py
+drwxrwxrwx   0        0        0        0 2023-05-20 10:31:21.000000 musicpy-6.67/
+-rw-rw-rw-   0        0        0    27030 2021-09-24 07:05:14.000000 musicpy-6.67/LICENSE
+-rw-rw-rw-   0        0        0       40 2021-10-04 19:46:56.000000 musicpy-6.67/MANIFEST.in
+-rw-rw-rw-   0        0        0    16335 2023-05-20 10:31:22.000000 musicpy-6.67/PKG-INFO
+-rw-rw-rw-   0        0        0    14214 2023-04-18 07:20:38.000000 musicpy-6.67/README.md
+drwxrwxrwx   0        0        0        0 2023-05-20 10:31:21.000000 musicpy-6.67/musicpy/
+-rw-rw-rw-   0        0        0       90 2022-05-24 06:43:42.000000 musicpy-6.67/musicpy/__init__.py
+-rw-rw-rw-   0        0        0   112637 2023-03-17 16:11:10.000000 musicpy-6.67/musicpy/algorithms.py
+-rw-rw-rw-   0        0        0    10087 2023-05-15 13:49:00.000000 musicpy-6.67/musicpy/control.py
+-rw-rw-rw-   0        0        0    21720 2023-03-06 07:58:48.000000 musicpy-6.67/musicpy/database.py
+-rw-rw-rw-   0        0        0    59875 2023-05-04 08:43:22.000000 musicpy-6.67/musicpy/daw.py
+-rw-rw-rw-   0        0        0    79887 2023-05-20 09:50:58.000000 musicpy-6.67/musicpy/musicpy.py
+-rw-rw-rw-   0        0        0       38 2023-03-06 07:58:48.000000 musicpy-6.67/musicpy/requirements for musicpy daw.txt
+-rw-rw-rw-   0        0        0       18 2022-10-11 02:50:12.000000 musicpy-6.67/musicpy/requirements.txt
+-rw-rw-rw-   0        0        0   256265 2023-05-20 10:15:42.000000 musicpy-6.67/musicpy/structures.py
+drwxrwxrwx   0        0        0        0 2023-05-20 10:31:21.000000 musicpy-6.67/musicpy.egg-info/
+-rw-rw-rw-   0        0        0    16335 2023-05-20 10:31:22.000000 musicpy-6.67/musicpy.egg-info/PKG-INFO
+-rw-rw-rw-   0        0        0      405 2023-05-20 10:31:22.000000 musicpy-6.67/musicpy.egg-info/SOURCES.txt
+-rw-rw-rw-   0        0        0        1 2023-05-20 10:31:22.000000 musicpy-6.67/musicpy.egg-info/dependency_links.txt
+-rw-rw-rw-   0        0        0       28 2023-05-20 10:31:22.000000 musicpy-6.67/musicpy.egg-info/requires.txt
+-rw-rw-rw-   0        0        0        8 2023-05-20 10:31:22.000000 musicpy-6.67/musicpy.egg-info/top_level.txt
+-rw-rw-rw-   0        0        0       86 2023-05-20 10:31:22.000000 musicpy-6.67/setup.cfg
+-rw-rw-rw-   0        0        0     1402 2023-05-20 03:57:24.000000 musicpy-6.67/setup.py
```

### Comparing `musicpy-6.65/LICENSE` & `musicpy-6.67/LICENSE`

 * *Files identical despite different names*

### Comparing `musicpy-6.65/PKG-INFO` & `musicpy-6.67/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,16 +1,16 @@
 Metadata-Version: 2.1
 Name: musicpy
-Version: 6.65
+Version: 6.67
 Summary: Musicpy is a music programming language in Python designed to write music in very handy syntax through music theory and algorithms.
 Home-page: https://github.com/Rainbow-Dreamer/musicpy.git
 Author: Rainbow-Dreamer
 Author-email: 1036889495@qq.com
 License: LGPLv2.1
-Download-URL: https://github.com/Rainbow-Dreamer/musicpy/archive/6.65.tar.gz
+Download-URL: https://github.com/Rainbow-Dreamer/musicpy/archive/6.67.tar.gz
 Description: musicpy
         =======
         [中文](https://github.com/Rainbow-Dreamer/musicpy/blob/master/README_cn.md)
         
         Have you ever thought about writing music with codes in a very concise, human-readable syntax?
         
         Musicpy is a music programming language in Python designed to write music in very handy syntax through music theory and algorithms. It is easy to learn and write, easy to read, and incorporates a fully computerized music theory system.
```

### Comparing `musicpy-6.65/README.md` & `musicpy-6.67/README.md`

 * *Files identical despite different names*

### Comparing `musicpy-6.65/musicpy/algorithms.py` & `musicpy-6.67/musicpy/algorithms.py`

 * *Files identical despite different names*

### Comparing `musicpy-6.65/musicpy/control.py` & `musicpy-6.67/musicpy/control.py`

 * *Files identical despite different names*

### Comparing `musicpy-6.65/musicpy/database.py` & `musicpy-6.67/musicpy/database.py`

 * *Files identical despite different names*

### Comparing `musicpy-6.65/musicpy/daw.py` & `musicpy-6.67/musicpy/daw.py`

 * *Files identical despite different names*

### Comparing `musicpy-6.65/musicpy/musicpy.py` & `musicpy-6.67/musicpy/musicpy.py`

 * *Files 0% similar despite different names*

```diff
@@ -1014,3945 +1014,3980 @@
 00003f50: 7472 6163 6b5f 6e6f 7465 732c 2074 656d  track_notes, tem
 00003f60: 706f 732c 2066 6972 7374 5f74 7261 636b  pos, first_track
 00003f70: 5f73 7461 7274 5f74 696d 6520 3d20 6669  _start_time = fi
 00003f80: 7273 745f 7472 6163 6b0d 0a20 2020 2020  rst_track..     
 00003f90: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
 00003fa0: 616c 6c5f 7472 6163 6b73 5b31 3a5d 3a0d  all_tracks[1:]:.
 00003fb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003fc0: 2061 6c6c 5f74 7261 636b 5f6e 6f74 6573   all_track_notes
-00003fd0: 2026 3d20 2869 5b30 5d2c 2069 5b32 5d20   &= (i[0], i[2] 
-00003fe0: 2d20 6669 7273 745f 7472 6163 6b5f 7374  - first_track_st
-00003ff0: 6172 745f 7469 6d65 290d 0a20 2020 2020  art_time)..     
-00004000: 2020 2020 2020 2061 6c6c 5f74 7261 636b         all_track
-00004010: 5f6e 6f74 6573 2e6f 7468 6572 5f6d 6573  _notes.other_mes
-00004020: 7361 6765 7320 3d20 636f 6e63 6174 280d  sages = concat(.
-00004030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004040: 205b 6561 6368 5b30 5d2e 6f74 6865 725f   [each[0].other_
-00004050: 6d65 7373 6167 6573 2066 6f72 2065 6163  messages for eac
-00004060: 6820 696e 2061 6c6c 5f74 7261 636b 735d  h in all_tracks]
-00004070: 290d 0a20 2020 2020 2020 2020 2020 2061  )..            a
-00004080: 6c6c 5f74 7261 636b 5f6e 6f74 6573 2e70  ll_track_notes.p
-00004090: 616e 5f6c 6973 7420 3d20 636f 6e63 6174  an_list = concat
-000040a0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-000040b0: 2020 205b 6b5b 305d 2e70 616e 5f6c 6973     [k[0].pan_lis
-000040c0: 7420 666f 7220 6b20 696e 2061 6c6c 5f74  t for k in all_t
-000040d0: 7261 636b 735d 290d 0a20 2020 2020 2020  racks])..       
-000040e0: 2020 2020 2061 6c6c 5f74 7261 636b 5f6e       all_track_n
-000040f0: 6f74 6573 2e76 6f6c 756d 655f 6c69 7374  otes.volume_list
-00004100: 203d 2063 6f6e 6361 7428 0d0a 2020 2020   = concat(..    
-00004110: 2020 2020 2020 2020 2020 2020 5b6b 5b30              [k[0
-00004120: 5d2e 766f 6c75 6d65 5f6c 6973 7420 666f  ].volume_list fo
-00004130: 7220 6b20 696e 2061 6c6c 5f74 7261 636b  r k in all_track
-00004140: 735d 290d 0a20 2020 2020 2020 2020 2020  s])..           
-00004150: 2061 6c6c 5f74 7261 636b 7320 3d20 5b61   all_tracks = [a
-00004160: 6c6c 5f74 7261 636b 5f6e 6f74 6573 2c20  ll_track_notes, 
-00004170: 7465 6d70 6f73 2c20 6669 7273 745f 7472  tempos, first_tr
-00004180: 6163 6b5f 7374 6172 745f 7469 6d65 5d0d  ack_start_time].
-00004190: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-000041a0: 2020 2020 2020 2020 2020 2020 6176 6169              avai
-000041b0: 6c61 626c 655f 7472 6163 6b73 203d 2061  lable_tracks = a
-000041c0: 7661 696c 6162 6c65 5f74 7261 636b 735b  vailable_tracks[
-000041d0: 305d 0d0a 2020 2020 2020 2020 2020 2020  0]..            
-000041e0: 616c 6c5f 7472 6163 6b73 203d 2061 6c6c  all_tracks = all
-000041f0: 5f74 7261 636b 735b 305d 0d0a 2020 2020  _tracks[0]..    
-00004200: 2020 2020 7061 6e5f 6c69 7374 203d 2061      pan_list = a
-00004210: 6c6c 5f74 7261 636b 735b 305d 2e70 616e  ll_tracks[0].pan
-00004220: 5f6c 6973 740d 0a20 2020 2020 2020 2076  _list..        v
-00004230: 6f6c 756d 655f 6c69 7374 203d 2061 6c6c  olume_list = all
-00004240: 5f74 7261 636b 735b 305d 2e76 6f6c 756d  _tracks[0].volum
-00004250: 655f 6c69 7374 0d0a 2020 2020 2020 2020  e_list..        
-00004260: 696e 7374 7275 6d65 6e74 7320 3d20 5b5d  instruments = []
-00004270: 0d0a 2020 2020 2020 2020 7072 6f67 7261  ..        progra
-00004280: 6d5f 6368 616e 6765 5f65 7665 6e74 7320  m_change_events 
-00004290: 3d20 5b0d 0a20 2020 2020 2020 2020 2020  = [..           
-000042a0: 2069 2066 6f72 2069 2069 6e20 6176 6169   i for i in avai
-000042b0: 6c61 626c 655f 7472 6163 6b73 2069 6620  lable_tracks if 
-000042c0: 692e 7479 7065 203d 3d20 2770 726f 6772  i.type == 'progr
-000042d0: 616d 5f63 6861 6e67 6527 0d0a 2020 2020  am_change'..    
-000042e0: 2020 2020 5d0d 0a20 2020 2020 2020 2066      ]..        f
-000042f0: 6f72 2069 2c20 6561 6368 2069 6e20 656e  or i, each in en
-00004300: 756d 6572 6174 6528 6368 616e 6e65 6c73  umerate(channels
-00004310: 5f6c 6973 7429 3a0d 0a20 2020 2020 2020  _list):..       
-00004320: 2020 2020 2063 7572 7265 6e74 5f70 726f       current_pro
-00004330: 6772 616d 203d 204e 6f6e 650d 0a20 2020  gram = None..   
-00004340: 2020 2020 2020 2020 2066 6f72 206a 2069           for j i
-00004350: 6e20 7072 6f67 7261 6d5f 6368 616e 6765  n program_change
-00004360: 5f65 7665 6e74 733a 0d0a 2020 2020 2020  _events:..      
-00004370: 2020 2020 2020 2020 2020 6966 206a 2e63            if j.c
-00004380: 6861 6e6e 656c 203d 3d20 6561 6368 3a0d  hannel == each:.
-00004390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000043a0: 2020 2020 2063 7572 7265 6e74 5f70 726f       current_pro
-000043b0: 6772 616d 203d 206a 2e70 726f 6772 616d  gram = j.program
-000043c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000043d0: 2020 2020 2020 696e 7374 7275 6d65 6e74        instrument
-000043e0: 732e 6170 7065 6e64 2863 7572 7265 6e74  s.append(current
-000043f0: 5f70 726f 6772 616d 202b 2031 290d 0a20  _program + 1).. 
-00004400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004410: 2020 2062 7265 616b 0d0a 2020 2020 2020     break..      
-00004420: 2020 2020 2020 6966 2063 7572 7265 6e74        if current
-00004430: 5f70 726f 6772 616d 2069 7320 4e6f 6e65  _program is None
-00004440: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00004450: 2020 2069 6e73 7472 756d 656e 7473 2e61     instruments.a
-00004460: 7070 656e 6428 3129 0d0a 2020 2020 2020  ppend(1)..      
-00004470: 2020 7472 6163 6b73 5f6e 616d 6573 5f6c    tracks_names_l
-00004480: 6973 7420 3d20 5b0d 0a20 2020 2020 2020  ist = [..       
-00004490: 2020 2020 2069 2e6e 616d 6520 666f 7220       i.name for 
-000044a0: 6920 696e 2061 7661 696c 6162 6c65 5f74  i in available_t
-000044b0: 7261 636b 7320 6966 2069 2e74 7970 6520  racks if i.type 
-000044c0: 3d3d 2027 7472 6163 6b5f 6e61 6d65 270d  == 'track_name'.
-000044d0: 0a20 2020 2020 2020 205d 0d0a 2020 2020  .        ]..    
-000044e0: 2020 2020 7265 6e61 6d65 5f74 7261 636b      rename_track
-000044f0: 5f6e 616d 6573 203d 2046 616c 7365 0d0a  _names = False..
-00004500: 2020 2020 2020 2020 6966 2028 6e6f 7420          if (not 
-00004510: 7472 6163 6b73 5f6e 616d 6573 5f6c 6973  tracks_names_lis
-00004520: 7429 206f 7220 286c 656e 2874 7261 636b  t) or (len(track
-00004530: 735f 6e61 6d65 735f 6c69 7374 2920 213d  s_names_list) !=
-00004540: 2063 6861 6e6e 656c 735f 6e75 6d29 3a0d   channels_num):.
-00004550: 0a20 2020 2020 2020 2020 2020 2074 7261  .            tra
-00004560: 636b 735f 6e61 6d65 735f 6c69 7374 203d  cks_names_list =
-00004570: 205b 6627 4368 616e 6e65 6c20 7b69 2b31   [f'Channel {i+1
-00004580: 7d27 2066 6f72 2069 2069 6e20 6368 616e  }' for i in chan
-00004590: 6e65 6c73 5f6c 6973 745d 0d0a 2020 2020  nels_list]..    
-000045a0: 2020 2020 2020 2020 7265 6e61 6d65 5f74          rename_t
-000045b0: 7261 636b 5f6e 616d 6573 203d 2054 7275  rack_names = Tru
-000045c0: 650d 0a20 2020 2020 2020 2072 6573 756c  e..        resul
-000045d0: 745f 6d65 7267 655f 7472 6163 6b20 3d20  t_merge_track = 
-000045e0: 616c 6c5f 7472 6163 6b73 5b30 5d0d 0a20  all_tracks[0].. 
-000045f0: 2020 2020 2020 2072 6573 756c 745f 7069         result_pi
-00004600: 6563 6520 3d20 7069 6563 6528 7472 6163  ece = piece(trac
-00004610: 6b73 3d5b 6368 6f72 6428 5b5d 2920 666f  ks=[chord([]) fo
-00004620: 7220 6920 696e 2072 616e 6765 2863 6861  r i in range(cha
-00004630: 6e6e 656c 735f 6e75 6d29 5d2c 0d0a 2020  nnels_num)],..  
-00004640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004650: 2020 2020 2020 2020 2020 2069 6e73 7472             instr
-00004660: 756d 656e 7473 3d69 6e73 7472 756d 656e  uments=instrumen
-00004670: 7473 2c0d 0a20 2020 2020 2020 2020 2020  ts,..           
-00004680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004690: 2020 6270 6d3d 7768 6f6c 655f 6270 6d2c    bpm=whole_bpm,
-000046a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000046b0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-000046c0: 7261 636b 5f6e 616d 6573 3d74 7261 636b  rack_names=track
-000046d0: 735f 6e61 6d65 735f 6c69 7374 2c0d 0a20  s_names_list,.. 
-000046e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000046f0: 2020 2020 2020 2020 2020 2020 6368 616e              chan
-00004700: 6e65 6c73 3d63 6861 6e6e 656c 735f 6c69  nels=channels_li
-00004710: 7374 2c0d 0a20 2020 2020 2020 2020 2020  st,..           
-00004720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004730: 2020 6e61 6d65 3d6f 732e 7061 7468 2e73    name=os.path.s
-00004740: 706c 6974 6578 7428 6f73 2e70 6174 682e  plitext(os.path.
-00004750: 6261 7365 6e61 6d65 286e 616d 6529 295b  basename(name))[
-00004760: 305d 2c0d 0a20 2020 2020 2020 2020 2020  0],..           
-00004770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004780: 2020 7061 6e3d 5b5b 5d20 666f 7220 6920    pan=[[] for i 
-00004790: 696e 2072 616e 6765 2863 6861 6e6e 656c  in range(channel
-000047a0: 735f 6e75 6d29 5d2c 0d0a 2020 2020 2020  s_num)],..      
-000047b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000047c0: 2020 2020 2020 2076 6f6c 756d 653d 5b5b         volume=[[
-000047d0: 5d20 666f 7220 6920 696e 2072 616e 6765  ] for i in range
-000047e0: 2863 6861 6e6e 656c 735f 6e75 6d29 5d29  (channels_num)])
-000047f0: 0d0a 2020 2020 2020 2020 7265 7375 6c74  ..        result
-00004800: 5f70 6965 6365 2e72 6563 6f6e 7374 7275  _piece.reconstru
-00004810: 6374 2874 7261 636b 3d72 6573 756c 745f  ct(track=result_
-00004820: 6d65 7267 655f 7472 6163 6b2c 0d0a 2020  merge_track,..  
-00004830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004840: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00004850: 7461 7274 5f74 696d 653d 7265 7375 6c74  tart_time=result
-00004860: 5f6d 6572 6765 5f74 7261 636b 2e73 7461  _merge_track.sta
-00004870: 7274 5f74 696d 652c 0d0a 2020 2020 2020  rt_time,..      
-00004880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004890: 2020 2020 2020 2020 2020 2069 6e63 6c75             inclu
-000048a0: 6465 5f65 6d70 7479 5f74 7261 636b 3d54  de_empty_track=T
-000048b0: 7275 6529 0d0a 2020 2020 2020 2020 6966  rue)..        if
-000048c0: 206c 656e 2872 6573 756c 745f 7069 6563   len(result_piec
-000048d0: 652e 6368 616e 6e65 6c73 2920 213d 2063  e.channels) != c
-000048e0: 6861 6e6e 656c 735f 6e75 6d3a 0d0a 2020  hannels_num:..  
-000048f0: 2020 2020 2020 2020 2020 7061 6e5f 6c69            pan_li
-00004900: 7374 203d 205b 0d0a 2020 2020 2020 2020  st = [..        
-00004910: 2020 2020 2020 2020 6920 666f 7220 6920          i for i 
-00004920: 696e 2070 616e 5f6c 6973 7420 6966 2069  in pan_list if i
-00004930: 2e63 6861 6e6e 656c 2069 6e20 7265 7375  .channel in resu
-00004940: 6c74 5f70 6965 6365 2e63 6861 6e6e 656c  lt_piece.channel
-00004950: 730d 0a20 2020 2020 2020 2020 2020 205d  s..            ]
-00004960: 0d0a 2020 2020 2020 2020 2020 2020 766f  ..            vo
-00004970: 6c75 6d65 5f6c 6973 7420 3d20 5b0d 0a20  lume_list = [.. 
-00004980: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00004990: 2066 6f72 2069 2069 6e20 766f 6c75 6d65   for i in volume
-000049a0: 5f6c 6973 7420 6966 2069 2e63 6861 6e6e  _list if i.chann
-000049b0: 656c 2069 6e20 7265 7375 6c74 5f70 6965  el in result_pie
-000049c0: 6365 2e63 6861 6e6e 656c 730d 0a20 2020  ce.channels..   
-000049d0: 2020 2020 2020 2020 205d 0d0a 2020 2020           ]..    
-000049e0: 2020 2020 2020 2020 666f 7220 6561 6368          for each
-000049f0: 2069 6e20 7061 6e5f 6c69 7374 3a0d 0a20   in pan_list:.. 
-00004a00: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00004a10: 6163 682e 7472 6163 6b20 3d20 7265 7375  ach.track = resu
-00004a20: 6c74 5f70 6965 6365 2e63 6861 6e6e 656c  lt_piece.channel
-00004a30: 732e 696e 6465 7828 6561 6368 2e63 6861  s.index(each.cha
-00004a40: 6e6e 656c 290d 0a20 2020 2020 2020 2020  nnel)..         
-00004a50: 2020 2066 6f72 2065 6163 6820 696e 2076     for each in v
-00004a60: 6f6c 756d 655f 6c69 7374 3a0d 0a20 2020  olume_list:..   
-00004a70: 2020 2020 2020 2020 2020 2020 2065 6163               eac
-00004a80: 682e 7472 6163 6b20 3d20 7265 7375 6c74  h.track = result
-00004a90: 5f70 6965 6365 2e63 6861 6e6e 656c 732e  _piece.channels.
-00004aa0: 696e 6465 7828 6561 6368 2e63 6861 6e6e  index(each.chann
-00004ab0: 656c 290d 0a20 2020 2020 2020 2020 2020  el)..           
-00004ac0: 2066 6f72 206b 2069 6e20 7261 6e67 6528   for k in range(
-00004ad0: 6c65 6e28 7265 7375 6c74 5f70 6965 6365  len(result_piece
-00004ae0: 2e74 7261 636b 7329 293a 0d0a 2020 2020  .tracks)):..    
-00004af0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00004b00: 6561 6368 2069 6e20 7265 7375 6c74 5f70  each in result_p
-00004b10: 6965 6365 2e74 7261 636b 735b 6b5d 2e70  iece.tracks[k].p
-00004b20: 6974 6368 5f62 656e 6473 3a0d 0a20 2020  itch_bends:..   
-00004b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004b40: 2065 6163 682e 7472 6163 6b20 3d20 6b0d   each.track = k.
-00004b50: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00004b60: 756c 745f 6d65 7267 655f 7472 6163 6b2e  ult_merge_track.
-00004b70: 6f74 6865 725f 6d65 7373 6167 6573 203d  other_messages =
-00004b80: 205b 0d0a 2020 2020 2020 2020 2020 2020   [..            
-00004b90: 2020 2020 6920 666f 7220 6920 696e 2072      i for i in r
-00004ba0: 6573 756c 745f 6d65 7267 655f 7472 6163  esult_merge_trac
-00004bb0: 6b2e 6f74 6865 725f 6d65 7373 6167 6573  k.other_messages
-00004bc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00004bd0: 2020 6966 206e 6f74 2028 6861 7361 7474    if not (hasatt
-00004be0: 7228 692c 2027 6368 616e 6e65 6c27 290d  r(i, 'channel').
-00004bf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004c00: 2020 2020 2020 2020 2061 6e64 2069 2e63           and i.c
-00004c10: 6861 6e6e 656c 206e 6f74 2069 6e20 7265  hannel not in re
-00004c20: 7375 6c74 5f70 6965 6365 2e63 6861 6e6e  sult_piece.chann
-00004c30: 656c 7329 0d0a 2020 2020 2020 2020 2020  els)..          
-00004c40: 2020 5d0d 0a20 2020 2020 2020 2020 2020    ]..           
-00004c50: 2066 6f72 2065 6163 6820 696e 2072 6573   for each in res
-00004c60: 756c 745f 6d65 7267 655f 7472 6163 6b2e  ult_merge_track.
-00004c70: 6f74 6865 725f 6d65 7373 6167 6573 3a0d  other_messages:.
-00004c80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004c90: 2069 6620 6861 7361 7474 7228 6561 6368   if hasattr(each
-00004ca0: 2c20 2763 6861 6e6e 656c 2729 3a0d 0a20  , 'channel'):.. 
-00004cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004cc0: 2020 2065 6163 682e 7472 6163 6b20 3d20     each.track = 
-00004cd0: 7265 7375 6c74 5f70 6965 6365 2e63 6861  result_piece.cha
-00004ce0: 6e6e 656c 732e 696e 6465 7828 6561 6368  nnels.index(each
-00004cf0: 2e63 6861 6e6e 656c 290d 0a20 2020 2020  .channel)..     
-00004d00: 2020 2072 6573 756c 745f 7069 6563 652e     result_piece.
-00004d10: 6f74 6865 725f 6d65 7373 6167 6573 203d  other_messages =
-00004d20: 2072 6573 756c 745f 6d65 7267 655f 7472   result_merge_tr
-00004d30: 6163 6b2e 6f74 6865 725f 6d65 7373 6167  ack.other_messag
-00004d40: 6573 0d0a 2020 2020 2020 2020 666f 7220  es..        for 
-00004d50: 6b20 696e 2072 616e 6765 286c 656e 2872  k in range(len(r
-00004d60: 6573 756c 745f 7069 6563 6529 293a 0d0a  esult_piece)):..
-00004d70: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-00004d80: 656e 745f 6f74 6865 725f 6d65 7373 6167  ent_other_messag
-00004d90: 6573 203d 205b 0d0a 2020 2020 2020 2020  es = [..        
-00004da0: 2020 2020 2020 2020 6920 666f 7220 6920          i for i 
-00004db0: 696e 2072 6573 756c 745f 7069 6563 652e  in result_piece.
-00004dc0: 6f74 6865 725f 6d65 7373 6167 6573 2069  other_messages i
-00004dd0: 6620 692e 7472 6163 6b20 3d3d 206b 0d0a  f i.track == k..
-00004de0: 2020 2020 2020 2020 2020 2020 5d0d 0a20              ].. 
-00004df0: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-00004e00: 745f 7069 6563 652e 7472 6163 6b73 5b6b  t_piece.tracks[k
-00004e10: 5d2e 6f74 6865 725f 6d65 7373 6167 6573  ].other_messages
-00004e20: 203d 2063 7572 7265 6e74 5f6f 7468 6572   = current_other
-00004e30: 5f6d 6573 7361 6765 730d 0a20 2020 2020  _messages..     
-00004e40: 2020 2020 2020 2063 7572 7265 6e74 5f70         current_p
-00004e50: 616e 203d 205b 6920 666f 7220 6920 696e  an = [i for i in
-00004e60: 2070 616e 5f6c 6973 7420 6966 2069 2e74   pan_list if i.t
-00004e70: 7261 636b 203d 3d20 6b5d 0d0a 2020 2020  rack == k]..    
-00004e80: 2020 2020 2020 2020 7265 7375 6c74 5f70          result_p
-00004e90: 6965 6365 2e70 616e 5b6b 5d20 3d20 6375  iece.pan[k] = cu
-00004ea0: 7272 656e 745f 7061 6e0d 0a20 2020 2020  rrent_pan..     
-00004eb0: 2020 2020 2020 2063 7572 7265 6e74 5f76         current_v
-00004ec0: 6f6c 756d 6520 3d20 5b69 2066 6f72 2069  olume = [i for i
-00004ed0: 2069 6e20 766f 6c75 6d65 5f6c 6973 7420   in volume_list 
-00004ee0: 6966 2069 2e74 7261 636b 203d 3d20 6b5d  if i.track == k]
-00004ef0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00004f00: 7375 6c74 5f70 6965 6365 2e76 6f6c 756d  sult_piece.volum
-00004f10: 655b 6b5d 203d 2063 7572 7265 6e74 5f76  e[k] = current_v
-00004f20: 6f6c 756d 650d 0a20 2020 2020 2020 2069  olume..        i
-00004f30: 6620 6e6f 7420 7265 6e61 6d65 5f74 7261  f not rename_tra
-00004f40: 636b 5f6e 616d 6573 3a0d 0a20 2020 2020  ck_names:..     
-00004f50: 2020 2020 2020 2063 7572 7265 6e74 5f74         current_t
-00004f60: 7261 636b 5f6e 616d 6573 203d 2072 6573  rack_names = res
-00004f70: 756c 745f 7069 6563 652e 6765 745f 6d73  ult_piece.get_ms
-00004f80: 6728 2774 7261 636b 5f6e 616d 6527 290d  g('track_name').
-00004f90: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00004fa0: 2069 2069 6e20 7261 6e67 6528 6c65 6e28   i in range(len(
-00004fb0: 6375 7272 656e 745f 7472 6163 6b5f 6e61  current_track_na
-00004fc0: 6d65 7329 293a 0d0a 2020 2020 2020 2020  mes)):..        
-00004fd0: 2020 2020 2020 2020 7265 7375 6c74 5f70          result_p
-00004fe0: 6965 6365 2e74 7261 636b 735b 695d 2e6f  iece.tracks[i].o
-00004ff0: 7468 6572 5f6d 6573 7361 6765 732e 6170  ther_messages.ap
-00005000: 7065 6e64 280d 0a20 2020 2020 2020 2020  pend(..         
-00005010: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-00005020: 6e74 5f74 7261 636b 5f6e 616d 6573 5b69  nt_track_names[i
-00005030: 5d29 0d0a 2020 2020 6966 2063 7572 7265  ])..    if curre
-00005040: 6e74 5f74 7970 6520 3d3d 2031 2061 6e64  nt_type == 1 and
-00005050: 206e 6f74 2063 6861 6e67 6573 2e69 735f   not changes.is_
-00005060: 656d 7074 7928 293a 0d0a 2020 2020 2020  empty():..      
-00005070: 2020 6966 2072 6573 756c 745f 7069 6563    if result_piec
-00005080: 652e 7472 6163 6b73 3a0d 0a20 2020 2020  e.tracks:..     
-00005090: 2020 2020 2020 2066 6972 7374 5f74 7261         first_tra
-000050a0: 636b 203d 2072 6573 756c 745f 7069 6563  ck = result_piec
-000050b0: 652e 7472 6163 6b73 5b30 5d0d 0a20 2020  e.tracks[0]..   
-000050c0: 2020 2020 2020 2020 2066 6972 7374 5f74           first_t
-000050d0: 7261 636b 2e6e 6f74 6573 2e65 7874 656e  rack.notes.exten
-000050e0: 6428 6368 616e 6765 732e 6e6f 7465 7329  d(changes.notes)
-000050f0: 0d0a 2020 2020 2020 2020 2020 2020 6669  ..            fi
-00005100: 7273 745f 7472 6163 6b2e 696e 7465 7276  rst_track.interv
-00005110: 616c 2e65 7874 656e 6428 6368 616e 6765  al.extend(change
-00005120: 732e 696e 7465 7276 616c 290d 0a20 2020  s.interval)..   
-00005130: 2020 2020 2020 2020 2066 6972 7374 5f74           first_t
-00005140: 7261 636b 2e74 656d 706f 732e 6578 7465  rack.tempos.exte
-00005150: 6e64 2863 6861 6e67 6573 2e74 656d 706f  nd(changes.tempo
-00005160: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
-00005170: 6669 7273 745f 7472 6163 6b2e 7069 7463  first_track.pitc
-00005180: 685f 6265 6e64 732e 6578 7465 6e64 2863  h_bends.extend(c
-00005190: 6861 6e67 6573 2e70 6974 6368 5f62 656e  hanges.pitch_ben
-000051a0: 6473 290d 0a20 2020 2020 2020 2020 2020  ds)..           
-000051b0: 2066 6972 7374 5f74 7261 636b 2e6f 7468   first_track.oth
-000051c0: 6572 5f6d 6573 7361 6765 735b 303a 305d  er_messages[0:0]
-000051d0: 203d 2063 6861 6e67 6573 2e6f 7468 6572   = changes.other
-000051e0: 5f6d 6573 7361 6765 730d 0a20 2020 2020  _messages..     
-000051f0: 2020 2072 6573 756c 745f 7069 6563 652e     result_piece.
-00005200: 6f74 6865 725f 6d65 7373 6167 6573 5b30  other_messages[0
-00005210: 3a30 5d20 3d20 6368 616e 6765 732e 6f74  :0] = changes.ot
-00005220: 6865 725f 6d65 7373 6167 6573 0d0a 0d0a  her_messages....
-00005230: 2020 2020 6966 2063 6c65 6172 5f6f 7468      if clear_oth
-00005240: 6572 5f63 6861 6e6e 656c 5f6d 7367 3a0d  er_channel_msg:.
-00005250: 0a20 2020 2020 2020 2072 6573 756c 745f  .        result_
-00005260: 7069 6563 652e 6f74 6865 725f 6d65 7373  piece.other_mess
-00005270: 6167 6573 203d 205b 0d0a 2020 2020 2020  ages = [..      
-00005280: 2020 2020 2020 6920 666f 7220 6920 696e        i for i in
-00005290: 2072 6573 756c 745f 7069 6563 652e 6f74   result_piece.ot
-000052a0: 6865 725f 6d65 7373 6167 6573 0d0a 2020  her_messages..  
-000052b0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-000052c0: 2028 6861 7361 7474 7228 692c 2027 6368   (hasattr(i, 'ch
-000052d0: 616e 6e65 6c27 290d 0a20 2020 2020 2020  annel')..       
-000052e0: 2020 2020 2020 2020 2020 2020 2061 6e64               and
-000052f0: 2069 2e63 6861 6e6e 656c 206e 6f74 2069   i.channel not i
-00005300: 6e20 7265 7375 6c74 5f70 6965 6365 2e63  n result_piece.c
-00005310: 6861 6e6e 656c 7329 0d0a 2020 2020 2020  hannels)..      
-00005320: 2020 5d0d 0a20 2020 2069 6620 6765 745f    ]..    if get_
-00005330: 6f66 665f 6472 756d 733a 0d0a 2020 2020  off_drums:..    
-00005340: 2020 2020 7265 7375 6c74 5f70 6965 6365      result_piece
-00005350: 2e67 6574 5f6f 6666 5f64 7275 6d73 2829  .get_off_drums()
-00005360: 0d0a 2020 2020 666f 7220 6920 696e 2072  ..    for i in r
-00005370: 6573 756c 745f 7069 6563 652e 7472 6163  esult_piece.trac
-00005380: 6b73 3a0d 0a20 2020 2020 2020 2069 6620  ks:..        if 
-00005390: 6861 7361 7474 7228 692c 2027 7061 6e5f  hasattr(i, 'pan_
-000053a0: 6c69 7374 2729 3a0d 0a20 2020 2020 2020  list'):..       
-000053b0: 2020 2020 2064 656c 2069 2e70 616e 5f6c       del i.pan_l
-000053c0: 6973 740d 0a20 2020 2020 2020 2069 6620  ist..        if 
-000053d0: 6861 7361 7474 7228 692c 2027 766f 6c75  hasattr(i, 'volu
-000053e0: 6d65 5f6c 6973 7427 293a 0d0a 2020 2020  me_list'):..    
-000053f0: 2020 2020 2020 2020 6465 6c20 692e 766f          del i.vo
-00005400: 6c75 6d65 5f6c 6973 740d 0a20 2020 2072  lume_list..    r
-00005410: 6573 756c 745f 7069 6563 652e 7469 636b  esult_piece.tick
-00005420: 735f 7065 725f 6265 6174 203d 2063 7572  s_per_beat = cur
-00005430: 7265 6e74 5f74 6963 6b73 5f70 6572 5f62  rent_ticks_per_b
-00005440: 6561 740d 0a20 2020 2072 6574 7572 6e20  eat..    return 
-00005450: 7265 7375 6c74 5f70 6965 6365 0d0a 0d0a  result_piece....
-00005460: 0d0a 6465 6620 5f6d 6964 695f 746f 5f63  ..def _midi_to_c
-00005470: 686f 7264 2863 7572 7265 6e74 5f74 7261  hord(current_tra
-00005480: 636b 2c0d 0a20 2020 2020 2020 2020 2020  ck,..           
-00005490: 2020 2020 2020 2020 696e 7465 7276 616c          interval
-000054a0: 5f75 6e69 742c 0d0a 2020 2020 2020 2020  _unit,..        
-000054b0: 2020 2020 2020 2020 2020 2062 706d 3d4e             bpm=N
-000054c0: 6f6e 652c 0d0a 2020 2020 2020 2020 2020  one,..          
-000054d0: 2020 2020 2020 2020 2061 6464 5f74 7261           add_tra
-000054e0: 636b 5f6e 756d 3d46 616c 7365 2c0d 0a20  ck_num=False,.. 
-000054f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005500: 2020 636c 6561 725f 656d 7074 795f 6e6f    clear_empty_no
-00005510: 7465 733d 4661 6c73 652c 0d0a 2020 2020  tes=False,..    
-00005520: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00005530: 7261 636b 5f69 6e64 3d30 2c0d 0a20 2020  rack_ind=0,..   
-00005540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005550: 7472 6163 6b5f 6368 616e 6e65 6c73 3d4e  track_channels=N
-00005560: 6f6e 6529 3a0d 0a20 2020 2069 6e74 6572  one):..    inter
-00005570: 7661 6c73 203d 205b 5d0d 0a20 2020 206e  vals = []..    n
-00005580: 6f74 656c 6973 7420 3d20 5b5d 0d0a 2020  otelist = []..  
-00005590: 2020 7465 6d70 6f5f 6c69 7374 203d 205b    tempo_list = [
-000055a0: 5d0d 0a20 2020 2070 6974 6368 5f62 656e  ]..    pitch_ben
-000055b0: 645f 6c69 7374 203d 205b 5d0d 0a20 2020  d_list = []..   
-000055c0: 206e 6f74 6573 5f6c 656e 203d 206c 656e   notes_len = len
-000055d0: 2863 7572 7265 6e74 5f74 7261 636b 290d  (current_track).
-000055e0: 0a20 2020 2066 696e 645f 6669 7273 745f  .    find_first_
-000055f0: 6e6f 7465 203d 2046 616c 7365 0d0a 2020  note = False..  
-00005600: 2020 7374 6172 745f 7469 6d65 203d 2030    start_time = 0
-00005610: 0d0a 2020 2020 6375 7272 656e 745f 7469  ..    current_ti
-00005620: 6d65 203d 2030 0d0a 2020 2020 7061 6e5f  me = 0..    pan_
-00005630: 6c69 7374 203d 205b 5d0d 0a20 2020 2076  list = []..    v
-00005640: 6f6c 756d 655f 6c69 7374 203d 205b 5d0d  olume_list = [].
-00005650: 0a20 2020 206f 7468 6572 5f6d 6573 7361  .    other_messa
-00005660: 6765 7320 3d20 5b5d 0d0a 0d0a 2020 2020  ges = []....    
-00005670: 666f 7220 6920 696e 2072 616e 6765 286e  for i in range(n
-00005680: 6f74 6573 5f6c 656e 293a 0d0a 2020 2020  otes_len):..    
-00005690: 2020 2020 6375 7272 656e 745f 6d73 6720      current_msg 
-000056a0: 3d20 6375 7272 656e 745f 7472 6163 6b5b  = current_track[
-000056b0: 695d 0d0a 2020 2020 2020 2020 6375 7272  i]..        curr
-000056c0: 656e 745f 7469 6d65 202b 3d20 6375 7272  ent_time += curr
-000056d0: 656e 745f 6d73 672e 7469 6d65 0d0a 2020  ent_msg.time..  
-000056e0: 2020 2020 2020 6966 2063 7572 7265 6e74        if current
-000056f0: 5f6d 7367 2e74 7970 6520 3d3d 2027 6e6f  _msg.type == 'no
-00005700: 7465 5f6f 6e27 2061 6e64 2063 7572 7265  te_on' and curre
-00005710: 6e74 5f6d 7367 2e76 656c 6f63 6974 7920  nt_msg.velocity 
-00005720: 213d 2030 3a0d 0a20 2020 2020 2020 2020  != 0:..         
-00005730: 2020 2063 7572 7265 6e74 5f6d 7367 5f76     current_msg_v
-00005740: 656c 6f63 6974 7920 3d20 6375 7272 656e  elocity = curren
-00005750: 745f 6d73 672e 7665 6c6f 6369 7479 0d0a  t_msg.velocity..
-00005760: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-00005770: 656e 745f 6d73 675f 6e6f 7465 203d 2063  ent_msg_note = c
-00005780: 7572 7265 6e74 5f6d 7367 2e6e 6f74 650d  urrent_msg.note.
-00005790: 0a20 2020 2020 2020 2020 2020 2063 7572  .            cur
-000057a0: 7265 6e74 5f6d 7367 5f63 6861 6e6e 656c  rent_msg_channel
-000057b0: 203d 2063 7572 7265 6e74 5f6d 7367 2e63   = current_msg.c
-000057c0: 6861 6e6e 656c 0d0a 2020 2020 2020 2020  hannel..        
-000057d0: 2020 2020 6966 206e 6f74 2066 696e 645f      if not find_
-000057e0: 6669 7273 745f 6e6f 7465 3a0d 0a20 2020  first_note:..   
-000057f0: 2020 2020 2020 2020 2020 2020 2066 696e               fin
-00005800: 645f 6669 7273 745f 6e6f 7465 203d 2054  d_first_note = T
-00005810: 7275 650d 0a20 2020 2020 2020 2020 2020  rue..           
-00005820: 2020 2020 2073 7461 7274 5f74 696d 6520       start_time 
-00005830: 3d20 7375 6d28 6375 7272 656e 745f 7472  = sum(current_tr
-00005840: 6163 6b5b 6a5d 2e74 696d 650d 0a20 2020  ack[j].time..   
-00005850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005860: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00005870: 7220 6a20 696e 2072 616e 6765 2869 202b  r j in range(i +
-00005880: 2031 2929 202f 2069 6e74 6572 7661 6c5f   1)) / interval_
-00005890: 756e 6974 0d0a 2020 2020 2020 2020 2020  unit..          
-000058a0: 2020 2020 2020 6966 2073 7461 7274 5f74        if start_t
-000058b0: 696d 652e 6973 5f69 6e74 6567 6572 2829  ime.is_integer()
-000058c0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000058d0: 2020 2020 2020 2073 7461 7274 5f74 696d         start_tim
-000058e0: 6520 3d20 696e 7428 7374 6172 745f 7469  e = int(start_ti
-000058f0: 6d65 290d 0a20 2020 2020 2020 2020 2020  me)..           
-00005900: 2063 7572 7265 6e74 5f69 6e74 6572 7661   current_interva
-00005910: 6c20 3d20 300d 0a20 2020 2020 2020 2020  l = 0..         
-00005920: 2020 2063 7572 7265 6e74 5f64 7572 6174     current_durat
-00005930: 696f 6e20 3d20 300d 0a20 2020 2020 2020  ion = 0..       
-00005940: 2020 2020 2063 7572 7265 6e74 5f6e 6f74       current_not
-00005950: 655f 696e 7465 7276 616c 203d 2030 0d0a  e_interval = 0..
-00005960: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-00005970: 656e 745f 6e6f 7465 5f64 7572 6174 696f  ent_note_duratio
-00005980: 6e20 3d20 300d 0a20 2020 2020 2020 2020  n = 0..         
-00005990: 2020 2066 696e 645f 696e 7465 7276 616c     find_interval
-000059a0: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
-000059b0: 2020 2020 2020 6669 6e64 5f64 7572 6174        find_durat
-000059c0: 696f 6e20 3d20 4661 6c73 650d 0a20 2020  ion = False..   
-000059d0: 2020 2020 2020 2020 2066 6f72 206b 2069           for k i
-000059e0: 6e20 7261 6e67 6528 6920 2b20 312c 206e  n range(i + 1, n
-000059f0: 6f74 6573 5f6c 656e 293a 0d0a 2020 2020  otes_len):..    
-00005a00: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00005a10: 6d73 6720 3d20 6375 7272 656e 745f 7472  msg = current_tr
-00005a20: 6163 6b5b 6b5d 0d0a 2020 2020 2020 2020  ack[k]..        
-00005a30: 2020 2020 2020 2020 6e65 775f 6d73 675f          new_msg_
-00005a40: 7479 7065 203d 206e 6577 5f6d 7367 2e74  type = new_msg.t
-00005a50: 7970 650d 0a20 2020 2020 2020 2020 2020  ype..           
-00005a60: 2020 2020 2063 7572 7265 6e74 5f69 6e74       current_int
-00005a70: 6572 7661 6c20 2b3d 206e 6577 5f6d 7367  erval += new_msg
-00005a80: 2e74 696d 650d 0a20 2020 2020 2020 2020  .time..         
-00005a90: 2020 2020 2020 2063 7572 7265 6e74 5f64         current_d
-00005aa0: 7572 6174 696f 6e20 2b3d 206e 6577 5f6d  uration += new_m
-00005ab0: 7367 2e74 696d 650d 0a20 2020 2020 2020  sg.time..       
-00005ac0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00005ad0: 6669 6e64 5f69 6e74 6572 7661 6c3a 0d0a  find_interval:..
-00005ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005af0: 2020 2020 6966 206e 6577 5f6d 7367 5f74      if new_msg_t
-00005b00: 7970 6520 3d3d 2027 6e6f 7465 5f6f 6e27  ype == 'note_on'
-00005b10: 2061 6e64 206e 6577 5f6d 7367 2e76 656c   and new_msg.vel
-00005b20: 6f63 6974 7920 213d 2030 3a0d 0a20 2020  ocity != 0:..   
-00005b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005b40: 2020 2020 2066 696e 645f 696e 7465 7276       find_interv
-00005b50: 616c 203d 2054 7275 650d 0a20 2020 2020  al = True..     
-00005b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005b70: 2020 2063 7572 7265 6e74 5f69 6e74 6572     current_inter
-00005b80: 7661 6c20 2f3d 2069 6e74 6572 7661 6c5f  val /= interval_
-00005b90: 756e 6974 0d0a 2020 2020 2020 2020 2020  unit..          
-00005ba0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00005bb0: 2063 7572 7265 6e74 5f69 6e74 6572 7661   current_interva
-00005bc0: 6c2e 6973 5f69 6e74 6567 6572 2829 3a0d  l.is_integer():.
-00005bd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005be0: 2020 2020 2020 2020 2020 2020 2063 7572               cur
-00005bf0: 7265 6e74 5f69 6e74 6572 7661 6c20 3d20  rent_interval = 
-00005c00: 696e 7428 6375 7272 656e 745f 696e 7465  int(current_inte
-00005c10: 7276 616c 290d 0a20 2020 2020 2020 2020  rval)..         
-00005c20: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00005c30: 7572 7265 6e74 5f6e 6f74 655f 696e 7465  urrent_note_inte
-00005c40: 7276 616c 203d 2063 7572 7265 6e74 5f69  rval = current_i
-00005c50: 6e74 6572 7661 6c0d 0a20 2020 2020 2020  nterval..       
-00005c60: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00005c70: 6669 6e64 5f64 7572 6174 696f 6e3a 0d0a  find_duration:..
-00005c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005c90: 2020 2020 6966 2028 0d0a 2020 2020 2020      if (..      
+00003fc0: 2063 7572 7265 6e74 5f74 7261 636b 203d   current_track =
+00003fd0: 2069 5b30 5d0d 0a20 2020 2020 2020 2020   i[0]..         
+00003fe0: 2020 2020 2020 2063 7572 7265 6e74 5f73         current_s
+00003ff0: 7461 7274 5f74 696d 6520 3d20 695b 325d  tart_time = i[2]
+00004000: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004010: 2020 6375 7272 656e 745f 7368 6966 7420    current_shift 
+00004020: 3d20 6375 7272 656e 745f 7374 6172 745f  = current_start_
+00004030: 7469 6d65 202d 2066 6972 7374 5f74 7261  time - first_tra
+00004040: 636b 5f73 7461 7274 5f74 696d 650d 0a20  ck_start_time.. 
+00004050: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00004060: 6c6c 5f74 7261 636b 5f6e 6f74 6573 203d  ll_track_notes =
+00004070: 2061 6c6c 5f74 7261 636b 5f6e 6f74 6573   all_track_notes
+00004080: 2e61 6464 2863 7572 7265 6e74 5f74 7261  .add(current_tra
+00004090: 636b 2c0d 0a20 2020 2020 2020 2020 2020  ck,..           
+000040a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000040b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000040c0: 2020 2020 2020 2020 2020 2073 7461 7274             start
+000040d0: 3d63 7572 7265 6e74 5f73 6869 6674 2c0d  =current_shift,.
+000040e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000040f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004110: 2020 2020 2020 206d 6f64 653d 2768 6561         mode='hea
+00004120: 6427 2c0d 0a20 2020 2020 2020 2020 2020  d',..           
+00004130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004150: 2020 2020 2020 2020 2020 2061 646a 7573             adjus
+00004160: 745f 6d73 673d 4661 6c73 6529 0d0a 2020  t_msg=False)..  
+00004170: 2020 2020 2020 2020 2020 616c 6c5f 7472            all_tr
+00004180: 6163 6b5f 6e6f 7465 732e 6f74 6865 725f  ack_notes.other_
+00004190: 6d65 7373 6167 6573 203d 2063 6f6e 6361  messages = conca
+000041a0: 7428 0d0a 2020 2020 2020 2020 2020 2020  t(..            
+000041b0: 2020 2020 5b65 6163 685b 305d 2e6f 7468      [each[0].oth
+000041c0: 6572 5f6d 6573 7361 6765 7320 666f 7220  er_messages for 
+000041d0: 6561 6368 2069 6e20 616c 6c5f 7472 6163  each in all_trac
+000041e0: 6b73 5d29 0d0a 2020 2020 2020 2020 2020  ks])..          
+000041f0: 2020 616c 6c5f 7472 6163 6b5f 6e6f 7465    all_track_note
+00004200: 732e 7061 6e5f 6c69 7374 203d 2063 6f6e  s.pan_list = con
+00004210: 6361 7428 0d0a 2020 2020 2020 2020 2020  cat(..          
+00004220: 2020 2020 2020 5b6b 5b30 5d2e 7061 6e5f        [k[0].pan_
+00004230: 6c69 7374 2066 6f72 206b 2069 6e20 616c  list for k in al
+00004240: 6c5f 7472 6163 6b73 5d29 0d0a 2020 2020  l_tracks])..    
+00004250: 2020 2020 2020 2020 616c 6c5f 7472 6163          all_trac
+00004260: 6b5f 6e6f 7465 732e 766f 6c75 6d65 5f6c  k_notes.volume_l
+00004270: 6973 7420 3d20 636f 6e63 6174 280d 0a20  ist = concat(.. 
+00004280: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+00004290: 6b5b 305d 2e76 6f6c 756d 655f 6c69 7374  k[0].volume_list
+000042a0: 2066 6f72 206b 2069 6e20 616c 6c5f 7472   for k in all_tr
+000042b0: 6163 6b73 5d29 0d0a 2020 2020 2020 2020  acks])..        
+000042c0: 2020 2020 616c 6c5f 7472 6163 6b73 203d      all_tracks =
+000042d0: 205b 616c 6c5f 7472 6163 6b5f 6e6f 7465   [all_track_note
+000042e0: 732c 2074 656d 706f 732c 2066 6972 7374  s, tempos, first
+000042f0: 5f74 7261 636b 5f73 7461 7274 5f74 696d  _track_start_tim
+00004300: 655d 0d0a 2020 2020 2020 2020 656c 7365  e]..        else
+00004310: 3a0d 0a20 2020 2020 2020 2020 2020 2061  :..            a
+00004320: 7661 696c 6162 6c65 5f74 7261 636b 7320  vailable_tracks 
+00004330: 3d20 6176 6169 6c61 626c 655f 7472 6163  = available_trac
+00004340: 6b73 5b30 5d0d 0a20 2020 2020 2020 2020  ks[0]..         
+00004350: 2020 2061 6c6c 5f74 7261 636b 7320 3d20     all_tracks = 
+00004360: 616c 6c5f 7472 6163 6b73 5b30 5d0d 0a20  all_tracks[0].. 
+00004370: 2020 2020 2020 2070 616e 5f6c 6973 7420         pan_list 
+00004380: 3d20 616c 6c5f 7472 6163 6b73 5b30 5d2e  = all_tracks[0].
+00004390: 7061 6e5f 6c69 7374 0d0a 2020 2020 2020  pan_list..      
+000043a0: 2020 766f 6c75 6d65 5f6c 6973 7420 3d20    volume_list = 
+000043b0: 616c 6c5f 7472 6163 6b73 5b30 5d2e 766f  all_tracks[0].vo
+000043c0: 6c75 6d65 5f6c 6973 740d 0a20 2020 2020  lume_list..     
+000043d0: 2020 2069 6e73 7472 756d 656e 7473 203d     instruments =
+000043e0: 205b 5d0d 0a20 2020 2020 2020 2070 726f   []..        pro
+000043f0: 6772 616d 5f63 6861 6e67 655f 6576 656e  gram_change_even
+00004400: 7473 203d 205b 0d0a 2020 2020 2020 2020  ts = [..        
+00004410: 2020 2020 6920 666f 7220 6920 696e 2061      i for i in a
+00004420: 7661 696c 6162 6c65 5f74 7261 636b 7320  vailable_tracks 
+00004430: 6966 2069 2e74 7970 6520 3d3d 2027 7072  if i.type == 'pr
+00004440: 6f67 7261 6d5f 6368 616e 6765 270d 0a20  ogram_change'.. 
+00004450: 2020 2020 2020 205d 0d0a 2020 2020 2020         ]..      
+00004460: 2020 666f 7220 692c 2065 6163 6820 696e    for i, each in
+00004470: 2065 6e75 6d65 7261 7465 2863 6861 6e6e   enumerate(chann
+00004480: 656c 735f 6c69 7374 293a 0d0a 2020 2020  els_list):..    
+00004490: 2020 2020 2020 2020 6375 7272 656e 745f          current_
+000044a0: 7072 6f67 7261 6d20 3d20 4e6f 6e65 0d0a  program = None..
+000044b0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000044c0: 6a20 696e 2070 726f 6772 616d 5f63 6861  j in program_cha
+000044d0: 6e67 655f 6576 656e 7473 3a0d 0a20 2020  nge_events:..   
+000044e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000044f0: 6a2e 6368 616e 6e65 6c20 3d3d 2065 6163  j.channel == eac
+00004500: 683a 0d0a 2020 2020 2020 2020 2020 2020  h:..            
+00004510: 2020 2020 2020 2020 6375 7272 656e 745f          current_
+00004520: 7072 6f67 7261 6d20 3d20 6a2e 7072 6f67  program = j.prog
+00004530: 7261 6d0d 0a20 2020 2020 2020 2020 2020  ram..           
+00004540: 2020 2020 2020 2020 2069 6e73 7472 756d           instrum
+00004550: 656e 7473 2e61 7070 656e 6428 6375 7272  ents.append(curr
+00004560: 656e 745f 7072 6f67 7261 6d20 2b20 3129  ent_program + 1)
+00004570: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004580: 2020 2020 2020 6272 6561 6b0d 0a20 2020        break..   
+00004590: 2020 2020 2020 2020 2069 6620 6375 7272           if curr
+000045a0: 656e 745f 7072 6f67 7261 6d20 6973 204e  ent_program is N
+000045b0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+000045c0: 2020 2020 2020 696e 7374 7275 6d65 6e74        instrument
+000045d0: 732e 6170 7065 6e64 2831 290d 0a20 2020  s.append(1)..   
+000045e0: 2020 2020 2074 7261 636b 735f 6e61 6d65       tracks_name
+000045f0: 735f 6c69 7374 203d 205b 0d0a 2020 2020  s_list = [..    
+00004600: 2020 2020 2020 2020 692e 6e61 6d65 2066          i.name f
+00004610: 6f72 2069 2069 6e20 6176 6169 6c61 626c  or i in availabl
+00004620: 655f 7472 6163 6b73 2069 6620 692e 7479  e_tracks if i.ty
+00004630: 7065 203d 3d20 2774 7261 636b 5f6e 616d  pe == 'track_nam
+00004640: 6527 0d0a 2020 2020 2020 2020 5d0d 0a20  e'..        ].. 
+00004650: 2020 2020 2020 2072 656e 616d 655f 7472         rename_tr
+00004660: 6163 6b5f 6e61 6d65 7320 3d20 4661 6c73  ack_names = Fals
+00004670: 650d 0a20 2020 2020 2020 2069 6620 286e  e..        if (n
+00004680: 6f74 2074 7261 636b 735f 6e61 6d65 735f  ot tracks_names_
+00004690: 6c69 7374 2920 6f72 2028 6c65 6e28 7472  list) or (len(tr
+000046a0: 6163 6b73 5f6e 616d 6573 5f6c 6973 7429  acks_names_list)
+000046b0: 2021 3d20 6368 616e 6e65 6c73 5f6e 756d   != channels_num
+000046c0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+000046d0: 7472 6163 6b73 5f6e 616d 6573 5f6c 6973  tracks_names_lis
+000046e0: 7420 3d20 5b66 2743 6861 6e6e 656c 207b  t = [f'Channel {
+000046f0: 692b 317d 2720 666f 7220 6920 696e 2063  i+1}' for i in c
+00004700: 6861 6e6e 656c 735f 6c69 7374 5d0d 0a20  hannels_list].. 
+00004710: 2020 2020 2020 2020 2020 2072 656e 616d             renam
+00004720: 655f 7472 6163 6b5f 6e61 6d65 7320 3d20  e_track_names = 
+00004730: 5472 7565 0d0a 2020 2020 2020 2020 7265  True..        re
+00004740: 7375 6c74 5f6d 6572 6765 5f74 7261 636b  sult_merge_track
+00004750: 203d 2061 6c6c 5f74 7261 636b 735b 305d   = all_tracks[0]
+00004760: 0d0a 2020 2020 2020 2020 7265 7375 6c74  ..        result
+00004770: 5f70 6965 6365 203d 2070 6965 6365 2874  _piece = piece(t
+00004780: 7261 636b 733d 5b63 686f 7264 285b 5d29  racks=[chord([])
+00004790: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+000047a0: 6368 616e 6e65 6c73 5f6e 756d 295d 2c0d  channels_num)],.
+000047b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000047c0: 2020 2020 2020 2020 2020 2020 2020 696e                in
+000047d0: 7374 7275 6d65 6e74 733d 696e 7374 7275  struments=instru
+000047e0: 6d65 6e74 732c 0d0a 2020 2020 2020 2020  ments,..        
+000047f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004800: 2020 2020 2062 706d 3d77 686f 6c65 5f62       bpm=whole_b
+00004810: 706d 2c0d 0a20 2020 2020 2020 2020 2020  pm,..           
+00004820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004830: 2020 7472 6163 6b5f 6e61 6d65 733d 7472    track_names=tr
+00004840: 6163 6b73 5f6e 616d 6573 5f6c 6973 742c  acks_names_list,
+00004850: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004860: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00004870: 6861 6e6e 656c 733d 6368 616e 6e65 6c73  hannels=channels
+00004880: 5f6c 6973 742c 0d0a 2020 2020 2020 2020  _list,..        
+00004890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000048a0: 2020 2020 206e 616d 653d 6f73 2e70 6174       name=os.pat
+000048b0: 682e 7370 6c69 7465 7874 286f 732e 7061  h.splitext(os.pa
+000048c0: 7468 2e62 6173 656e 616d 6528 6e61 6d65  th.basename(name
+000048d0: 2929 5b30 5d2c 0d0a 2020 2020 2020 2020  ))[0],..        
+000048e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000048f0: 2020 2020 2070 616e 3d5b 5b5d 2066 6f72       pan=[[] for
+00004900: 2069 2069 6e20 7261 6e67 6528 6368 616e   i in range(chan
+00004910: 6e65 6c73 5f6e 756d 295d 2c0d 0a20 2020  nels_num)],..   
+00004920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004930: 2020 2020 2020 2020 2020 766f 6c75 6d65            volume
+00004940: 3d5b 5b5d 2066 6f72 2069 2069 6e20 7261  =[[] for i in ra
+00004950: 6e67 6528 6368 616e 6e65 6c73 5f6e 756d  nge(channels_num
+00004960: 295d 290d 0a20 2020 2020 2020 2072 6573  )])..        res
+00004970: 756c 745f 7069 6563 652e 7265 636f 6e73  ult_piece.recons
+00004980: 7472 7563 7428 7472 6163 6b3d 7265 7375  truct(track=resu
+00004990: 6c74 5f6d 6572 6765 5f74 7261 636b 2c0d  lt_merge_track,.
+000049a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000049b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000049c0: 2020 7374 6172 745f 7469 6d65 3d72 6573    start_time=res
+000049d0: 756c 745f 6d65 7267 655f 7472 6163 6b2e  ult_merge_track.
+000049e0: 7374 6172 745f 7469 6d65 2c0d 0a20 2020  start_time,..   
+000049f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004a00: 2020 2020 2020 2020 2020 2020 2020 696e                in
+00004a10: 636c 7564 655f 656d 7074 795f 7472 6163  clude_empty_trac
+00004a20: 6b3d 5472 7565 290d 0a20 2020 2020 2020  k=True)..       
+00004a30: 2069 6620 6c65 6e28 7265 7375 6c74 5f70   if len(result_p
+00004a40: 6965 6365 2e63 6861 6e6e 656c 7329 2021  iece.channels) !
+00004a50: 3d20 6368 616e 6e65 6c73 5f6e 756d 3a0d  = channels_num:.
+00004a60: 0a20 2020 2020 2020 2020 2020 2070 616e  .            pan
+00004a70: 5f6c 6973 7420 3d20 5b0d 0a20 2020 2020  _list = [..     
+00004a80: 2020 2020 2020 2020 2020 2069 2066 6f72             i for
+00004a90: 2069 2069 6e20 7061 6e5f 6c69 7374 2069   i in pan_list i
+00004aa0: 6620 692e 6368 616e 6e65 6c20 696e 2072  f i.channel in r
+00004ab0: 6573 756c 745f 7069 6563 652e 6368 616e  esult_piece.chan
+00004ac0: 6e65 6c73 0d0a 2020 2020 2020 2020 2020  nels..          
+00004ad0: 2020 5d0d 0a20 2020 2020 2020 2020 2020    ]..           
+00004ae0: 2076 6f6c 756d 655f 6c69 7374 203d 205b   volume_list = [
+00004af0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004b00: 2020 6920 666f 7220 6920 696e 2076 6f6c    i for i in vol
+00004b10: 756d 655f 6c69 7374 2069 6620 692e 6368  ume_list if i.ch
+00004b20: 616e 6e65 6c20 696e 2072 6573 756c 745f  annel in result_
+00004b30: 7069 6563 652e 6368 616e 6e65 6c73 0d0a  piece.channels..
+00004b40: 2020 2020 2020 2020 2020 2020 5d0d 0a20              ].. 
+00004b50: 2020 2020 2020 2020 2020 2066 6f72 2065             for e
+00004b60: 6163 6820 696e 2070 616e 5f6c 6973 743a  ach in pan_list:
+00004b70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004b80: 2020 6561 6368 2e74 7261 636b 203d 2072    each.track = r
+00004b90: 6573 756c 745f 7069 6563 652e 6368 616e  esult_piece.chan
+00004ba0: 6e65 6c73 2e69 6e64 6578 2865 6163 682e  nels.index(each.
+00004bb0: 6368 616e 6e65 6c29 0d0a 2020 2020 2020  channel)..      
+00004bc0: 2020 2020 2020 666f 7220 6561 6368 2069        for each i
+00004bd0: 6e20 766f 6c75 6d65 5f6c 6973 743a 0d0a  n volume_list:..
+00004be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004bf0: 6561 6368 2e74 7261 636b 203d 2072 6573  each.track = res
+00004c00: 756c 745f 7069 6563 652e 6368 616e 6e65  ult_piece.channe
+00004c10: 6c73 2e69 6e64 6578 2865 6163 682e 6368  ls.index(each.ch
+00004c20: 616e 6e65 6c29 0d0a 2020 2020 2020 2020  annel)..        
+00004c30: 2020 2020 666f 7220 6b20 696e 2072 616e      for k in ran
+00004c40: 6765 286c 656e 2872 6573 756c 745f 7069  ge(len(result_pi
+00004c50: 6563 652e 7472 6163 6b73 2929 3a0d 0a20  ece.tracks)):.. 
+00004c60: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00004c70: 6f72 2065 6163 6820 696e 2072 6573 756c  or each in resul
+00004c80: 745f 7069 6563 652e 7472 6163 6b73 5b6b  t_piece.tracks[k
+00004c90: 5d2e 7069 7463 685f 6265 6e64 733a 0d0a  ].pitch_bends:..
+00004ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004cb0: 2020 2020 6561 6368 2e74 7261 636b 203d      each.track =
+00004cc0: 206b 0d0a 2020 2020 2020 2020 2020 2020   k..            
+00004cd0: 7265 7375 6c74 5f6d 6572 6765 5f74 7261  result_merge_tra
+00004ce0: 636b 2e6f 7468 6572 5f6d 6573 7361 6765  ck.other_message
+00004cf0: 7320 3d20 5b0d 0a20 2020 2020 2020 2020  s = [..         
+00004d00: 2020 2020 2020 2069 2066 6f72 2069 2069         i for i i
+00004d10: 6e20 7265 7375 6c74 5f6d 6572 6765 5f74  n result_merge_t
+00004d20: 7261 636b 2e6f 7468 6572 5f6d 6573 7361  rack.other_messa
+00004d30: 6765 730d 0a20 2020 2020 2020 2020 2020  ges..           
+00004d40: 2020 2020 2069 6620 6e6f 7420 2868 6173       if not (has
+00004d50: 6174 7472 2869 2c20 2763 6861 6e6e 656c  attr(i, 'channel
+00004d60: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
+00004d70: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+00004d80: 692e 6368 616e 6e65 6c20 6e6f 7420 696e  i.channel not in
+00004d90: 2072 6573 756c 745f 7069 6563 652e 6368   result_piece.ch
+00004da0: 616e 6e65 6c73 290d 0a20 2020 2020 2020  annels)..       
+00004db0: 2020 2020 205d 0d0a 2020 2020 2020 2020       ]..        
+00004dc0: 2020 2020 666f 7220 6561 6368 2069 6e20      for each in 
+00004dd0: 7265 7375 6c74 5f6d 6572 6765 5f74 7261  result_merge_tra
+00004de0: 636b 2e6f 7468 6572 5f6d 6573 7361 6765  ck.other_message
+00004df0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00004e00: 2020 2020 6966 2068 6173 6174 7472 2865      if hasattr(e
+00004e10: 6163 682c 2027 6368 616e 6e65 6c27 293a  ach, 'channel'):
+00004e20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004e30: 2020 2020 2020 6561 6368 2e74 7261 636b        each.track
+00004e40: 203d 2072 6573 756c 745f 7069 6563 652e   = result_piece.
+00004e50: 6368 616e 6e65 6c73 2e69 6e64 6578 2865  channels.index(e
+00004e60: 6163 682e 6368 616e 6e65 6c29 0d0a 2020  ach.channel)..  
+00004e70: 2020 2020 2020 7265 7375 6c74 5f70 6965        result_pie
+00004e80: 6365 2e6f 7468 6572 5f6d 6573 7361 6765  ce.other_message
+00004e90: 7320 3d20 7265 7375 6c74 5f6d 6572 6765  s = result_merge
+00004ea0: 5f74 7261 636b 2e6f 7468 6572 5f6d 6573  _track.other_mes
+00004eb0: 7361 6765 730d 0a20 2020 2020 2020 2066  sages..        f
+00004ec0: 6f72 206b 2069 6e20 7261 6e67 6528 6c65  or k in range(le
+00004ed0: 6e28 7265 7375 6c74 5f70 6965 6365 2929  n(result_piece))
+00004ee0: 3a0d 0a20 2020 2020 2020 2020 2020 2063  :..            c
+00004ef0: 7572 7265 6e74 5f6f 7468 6572 5f6d 6573  urrent_other_mes
+00004f00: 7361 6765 7320 3d20 5b0d 0a20 2020 2020  sages = [..     
+00004f10: 2020 2020 2020 2020 2020 2069 2066 6f72             i for
+00004f20: 2069 2069 6e20 7265 7375 6c74 5f70 6965   i in result_pie
+00004f30: 6365 2e6f 7468 6572 5f6d 6573 7361 6765  ce.other_message
+00004f40: 7320 6966 2069 2e74 7261 636b 203d 3d20  s if i.track == 
+00004f50: 6b0d 0a20 2020 2020 2020 2020 2020 205d  k..            ]
+00004f60: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00004f70: 7375 6c74 5f70 6965 6365 2e74 7261 636b  sult_piece.track
+00004f80: 735b 6b5d 2e6f 7468 6572 5f6d 6573 7361  s[k].other_messa
+00004f90: 6765 7320 3d20 6375 7272 656e 745f 6f74  ges = current_ot
+00004fa0: 6865 725f 6d65 7373 6167 6573 0d0a 2020  her_messages..  
+00004fb0: 2020 2020 2020 2020 2020 6375 7272 656e            curren
+00004fc0: 745f 7061 6e20 3d20 5b69 2066 6f72 2069  t_pan = [i for i
+00004fd0: 2069 6e20 7061 6e5f 6c69 7374 2069 6620   in pan_list if 
+00004fe0: 692e 7472 6163 6b20 3d3d 206b 5d0d 0a20  i.track == k].. 
+00004ff0: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+00005000: 745f 7069 6563 652e 7061 6e5b 6b5d 203d  t_piece.pan[k] =
+00005010: 2063 7572 7265 6e74 5f70 616e 0d0a 2020   current_pan..  
+00005020: 2020 2020 2020 2020 2020 6375 7272 656e            curren
+00005030: 745f 766f 6c75 6d65 203d 205b 6920 666f  t_volume = [i fo
+00005040: 7220 6920 696e 2076 6f6c 756d 655f 6c69  r i in volume_li
+00005050: 7374 2069 6620 692e 7472 6163 6b20 3d3d  st if i.track ==
+00005060: 206b 5d0d 0a20 2020 2020 2020 2020 2020   k]..           
+00005070: 2072 6573 756c 745f 7069 6563 652e 766f   result_piece.vo
+00005080: 6c75 6d65 5b6b 5d20 3d20 6375 7272 656e  lume[k] = curren
+00005090: 745f 766f 6c75 6d65 0d0a 2020 2020 2020  t_volume..      
+000050a0: 2020 6966 206e 6f74 2072 656e 616d 655f    if not rename_
+000050b0: 7472 6163 6b5f 6e61 6d65 733a 0d0a 2020  track_names:..  
+000050c0: 2020 2020 2020 2020 2020 6375 7272 656e            curren
+000050d0: 745f 7472 6163 6b5f 6e61 6d65 7320 3d20  t_track_names = 
+000050e0: 7265 7375 6c74 5f70 6965 6365 2e67 6574  result_piece.get
+000050f0: 5f6d 7367 2827 7472 6163 6b5f 6e61 6d65  _msg('track_name
+00005100: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
+00005110: 666f 7220 6920 696e 2072 616e 6765 286c  for i in range(l
+00005120: 656e 2863 7572 7265 6e74 5f74 7261 636b  en(current_track
+00005130: 5f6e 616d 6573 2929 3a0d 0a20 2020 2020  _names)):..     
+00005140: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+00005150: 745f 7069 6563 652e 7472 6163 6b73 5b69  t_piece.tracks[i
+00005160: 5d2e 6f74 6865 725f 6d65 7373 6167 6573  ].other_messages
+00005170: 2e61 7070 656e 6428 0d0a 2020 2020 2020  .append(..      
+00005180: 2020 2020 2020 2020 2020 2020 2020 6375                cu
+00005190: 7272 656e 745f 7472 6163 6b5f 6e61 6d65  rrent_track_name
+000051a0: 735b 695d 290d 0a20 2020 2069 6620 6375  s[i])..    if cu
+000051b0: 7272 656e 745f 7479 7065 203d 3d20 3120  rrent_type == 1 
+000051c0: 616e 6420 6e6f 7420 6368 616e 6765 732e  and not changes.
+000051d0: 6973 5f65 6d70 7479 2829 3a0d 0a20 2020  is_empty():..   
+000051e0: 2020 2020 2069 6620 7265 7375 6c74 5f70       if result_p
+000051f0: 6965 6365 2e74 7261 636b 733a 0d0a 2020  iece.tracks:..  
+00005200: 2020 2020 2020 2020 2020 6669 7273 745f            first_
+00005210: 7472 6163 6b20 3d20 7265 7375 6c74 5f70  track = result_p
+00005220: 6965 6365 2e74 7261 636b 735b 305d 0d0a  iece.tracks[0]..
+00005230: 2020 2020 2020 2020 2020 2020 6669 7273              firs
+00005240: 745f 7472 6163 6b2e 6e6f 7465 732e 6578  t_track.notes.ex
+00005250: 7465 6e64 2863 6861 6e67 6573 2e6e 6f74  tend(changes.not
+00005260: 6573 290d 0a20 2020 2020 2020 2020 2020  es)..           
+00005270: 2066 6972 7374 5f74 7261 636b 2e69 6e74   first_track.int
+00005280: 6572 7661 6c2e 6578 7465 6e64 2863 6861  erval.extend(cha
+00005290: 6e67 6573 2e69 6e74 6572 7661 6c29 0d0a  nges.interval)..
+000052a0: 2020 2020 2020 2020 2020 2020 6669 7273              firs
+000052b0: 745f 7472 6163 6b2e 7465 6d70 6f73 2e65  t_track.tempos.e
+000052c0: 7874 656e 6428 6368 616e 6765 732e 7465  xtend(changes.te
+000052d0: 6d70 6f73 290d 0a20 2020 2020 2020 2020  mpos)..         
+000052e0: 2020 2066 6972 7374 5f74 7261 636b 2e70     first_track.p
+000052f0: 6974 6368 5f62 656e 6473 2e65 7874 656e  itch_bends.exten
+00005300: 6428 6368 616e 6765 732e 7069 7463 685f  d(changes.pitch_
+00005310: 6265 6e64 7329 0d0a 2020 2020 2020 2020  bends)..        
+00005320: 2020 2020 6669 7273 745f 7472 6163 6b2e      first_track.
+00005330: 6f74 6865 725f 6d65 7373 6167 6573 5b30  other_messages[0
+00005340: 3a30 5d20 3d20 6368 616e 6765 732e 6f74  :0] = changes.ot
+00005350: 6865 725f 6d65 7373 6167 6573 0d0a 2020  her_messages..  
+00005360: 2020 2020 2020 7265 7375 6c74 5f70 6965        result_pie
+00005370: 6365 2e6f 7468 6572 5f6d 6573 7361 6765  ce.other_message
+00005380: 735b 303a 305d 203d 2063 6861 6e67 6573  s[0:0] = changes
+00005390: 2e6f 7468 6572 5f6d 6573 7361 6765 730d  .other_messages.
+000053a0: 0a0d 0a20 2020 2069 6620 636c 6561 725f  ...    if clear_
+000053b0: 6f74 6865 725f 6368 616e 6e65 6c5f 6d73  other_channel_ms
+000053c0: 673a 0d0a 2020 2020 2020 2020 7265 7375  g:..        resu
+000053d0: 6c74 5f70 6965 6365 2e6f 7468 6572 5f6d  lt_piece.other_m
+000053e0: 6573 7361 6765 7320 3d20 5b0d 0a20 2020  essages = [..   
+000053f0: 2020 2020 2020 2020 2069 2066 6f72 2069           i for i
+00005400: 2069 6e20 7265 7375 6c74 5f70 6965 6365   in result_piece
+00005410: 2e6f 7468 6572 5f6d 6573 7361 6765 730d  .other_messages.
+00005420: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00005430: 6e6f 7420 2868 6173 6174 7472 2869 2c20  not (hasattr(i, 
+00005440: 2763 6861 6e6e 656c 2729 0d0a 2020 2020  'channel')..    
+00005450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005460: 616e 6420 692e 6368 616e 6e65 6c20 6e6f  and i.channel no
+00005470: 7420 696e 2072 6573 756c 745f 7069 6563  t in result_piec
+00005480: 652e 6368 616e 6e65 6c73 290d 0a20 2020  e.channels)..   
+00005490: 2020 2020 205d 0d0a 2020 2020 6966 2067       ]..    if g
+000054a0: 6574 5f6f 6666 5f64 7275 6d73 3a0d 0a20  et_off_drums:.. 
+000054b0: 2020 2020 2020 2072 6573 756c 745f 7069         result_pi
+000054c0: 6563 652e 6765 745f 6f66 665f 6472 756d  ece.get_off_drum
+000054d0: 7328 290d 0a20 2020 2066 6f72 2069 2069  s()..    for i i
+000054e0: 6e20 7265 7375 6c74 5f70 6965 6365 2e74  n result_piece.t
+000054f0: 7261 636b 733a 0d0a 2020 2020 2020 2020  racks:..        
+00005500: 6966 2068 6173 6174 7472 2869 2c20 2770  if hasattr(i, 'p
+00005510: 616e 5f6c 6973 7427 293a 0d0a 2020 2020  an_list'):..    
+00005520: 2020 2020 2020 2020 6465 6c20 692e 7061          del i.pa
+00005530: 6e5f 6c69 7374 0d0a 2020 2020 2020 2020  n_list..        
+00005540: 6966 2068 6173 6174 7472 2869 2c20 2776  if hasattr(i, 'v
+00005550: 6f6c 756d 655f 6c69 7374 2729 3a0d 0a20  olume_list'):.. 
+00005560: 2020 2020 2020 2020 2020 2064 656c 2069             del i
+00005570: 2e76 6f6c 756d 655f 6c69 7374 0d0a 2020  .volume_list..  
+00005580: 2020 7265 7375 6c74 5f70 6965 6365 2e74    result_piece.t
+00005590: 6963 6b73 5f70 6572 5f62 6561 7420 3d20  icks_per_beat = 
+000055a0: 6375 7272 656e 745f 7469 636b 735f 7065  current_ticks_pe
+000055b0: 725f 6265 6174 0d0a 2020 2020 7265 7475  r_beat..    retu
+000055c0: 726e 2072 6573 756c 745f 7069 6563 650d  rn result_piece.
+000055d0: 0a0d 0a0d 0a64 6566 205f 6d69 6469 5f74  .....def _midi_t
+000055e0: 6f5f 6368 6f72 6428 6375 7272 656e 745f  o_chord(current_
+000055f0: 7472 6163 6b2c 0d0a 2020 2020 2020 2020  track,..        
+00005600: 2020 2020 2020 2020 2020 2069 6e74 6572             inter
+00005610: 7661 6c5f 756e 6974 2c0d 0a20 2020 2020  val_unit,..     
+00005620: 2020 2020 2020 2020 2020 2020 2020 6270                bp
+00005630: 6d3d 4e6f 6e65 2c0d 0a20 2020 2020 2020  m=None,..       
+00005640: 2020 2020 2020 2020 2020 2020 6164 645f              add_
+00005650: 7472 6163 6b5f 6e75 6d3d 4661 6c73 652c  track_num=False,
+00005660: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00005670: 2020 2020 2063 6c65 6172 5f65 6d70 7479       clear_empty
+00005680: 5f6e 6f74 6573 3d46 616c 7365 2c0d 0a20  _notes=False,.. 
+00005690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000056a0: 2020 7472 6163 6b5f 696e 643d 302c 0d0a    track_ind=0,..
+000056b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000056c0: 2020 2074 7261 636b 5f63 6861 6e6e 656c     track_channel
+000056d0: 733d 4e6f 6e65 293a 0d0a 2020 2020 696e  s=None):..    in
+000056e0: 7465 7276 616c 7320 3d20 5b5d 0d0a 2020  tervals = []..  
+000056f0: 2020 6e6f 7465 6c69 7374 203d 205b 5d0d    notelist = [].
+00005700: 0a20 2020 2074 656d 706f 5f6c 6973 7420  .    tempo_list 
+00005710: 3d20 5b5d 0d0a 2020 2020 7069 7463 685f  = []..    pitch_
+00005720: 6265 6e64 5f6c 6973 7420 3d20 5b5d 0d0a  bend_list = []..
+00005730: 2020 2020 6e6f 7465 735f 6c65 6e20 3d20      notes_len = 
+00005740: 6c65 6e28 6375 7272 656e 745f 7472 6163  len(current_trac
+00005750: 6b29 0d0a 2020 2020 6669 6e64 5f66 6972  k)..    find_fir
+00005760: 7374 5f6e 6f74 6520 3d20 4661 6c73 650d  st_note = False.
+00005770: 0a20 2020 2073 7461 7274 5f74 696d 6520  .    start_time 
+00005780: 3d20 300d 0a20 2020 2063 7572 7265 6e74  = 0..    current
+00005790: 5f74 696d 6520 3d20 300d 0a20 2020 2070  _time = 0..    p
+000057a0: 616e 5f6c 6973 7420 3d20 5b5d 0d0a 2020  an_list = []..  
+000057b0: 2020 766f 6c75 6d65 5f6c 6973 7420 3d20    volume_list = 
+000057c0: 5b5d 0d0a 2020 2020 6f74 6865 725f 6d65  []..    other_me
+000057d0: 7373 6167 6573 203d 205b 5d0d 0a0d 0a20  ssages = [].... 
+000057e0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+000057f0: 6528 6e6f 7465 735f 6c65 6e29 3a0d 0a20  e(notes_len):.. 
+00005800: 2020 2020 2020 2063 7572 7265 6e74 5f6d         current_m
+00005810: 7367 203d 2063 7572 7265 6e74 5f74 7261  sg = current_tra
+00005820: 636b 5b69 5d0d 0a20 2020 2020 2020 2063  ck[i]..        c
+00005830: 7572 7265 6e74 5f74 696d 6520 2b3d 2063  urrent_time += c
+00005840: 7572 7265 6e74 5f6d 7367 2e74 696d 650d  urrent_msg.time.
+00005850: 0a20 2020 2020 2020 2069 6620 6375 7272  .        if curr
+00005860: 656e 745f 6d73 672e 7479 7065 203d 3d20  ent_msg.type == 
+00005870: 276e 6f74 655f 6f6e 2720 616e 6420 6375  'note_on' and cu
+00005880: 7272 656e 745f 6d73 672e 7665 6c6f 6369  rrent_msg.veloci
+00005890: 7479 2021 3d20 303a 0d0a 2020 2020 2020  ty != 0:..      
+000058a0: 2020 2020 2020 6375 7272 656e 745f 6d73        current_ms
+000058b0: 675f 7665 6c6f 6369 7479 203d 2063 7572  g_velocity = cur
+000058c0: 7265 6e74 5f6d 7367 2e76 656c 6f63 6974  rent_msg.velocit
+000058d0: 790d 0a20 2020 2020 2020 2020 2020 2063  y..            c
+000058e0: 7572 7265 6e74 5f6d 7367 5f6e 6f74 6520  urrent_msg_note 
+000058f0: 3d20 6375 7272 656e 745f 6d73 672e 6e6f  = current_msg.no
+00005900: 7465 0d0a 2020 2020 2020 2020 2020 2020  te..            
+00005910: 6375 7272 656e 745f 6d73 675f 6368 616e  current_msg_chan
+00005920: 6e65 6c20 3d20 6375 7272 656e 745f 6d73  nel = current_ms
+00005930: 672e 6368 616e 6e65 6c0d 0a20 2020 2020  g.channel..     
+00005940: 2020 2020 2020 2069 6620 6e6f 7420 6669         if not fi
+00005950: 6e64 5f66 6972 7374 5f6e 6f74 653a 0d0a  nd_first_note:..
+00005960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005970: 6669 6e64 5f66 6972 7374 5f6e 6f74 6520  find_first_note 
+00005980: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
+00005990: 2020 2020 2020 2020 7374 6172 745f 7469          start_ti
+000059a0: 6d65 203d 2073 756d 2863 7572 7265 6e74  me = sum(current
+000059b0: 5f74 7261 636b 5b6a 5d2e 7469 6d65 0d0a  _track[j].time..
+000059c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000059d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000059e0: 2066 6f72 206a 2069 6e20 7261 6e67 6528   for j in range(
+000059f0: 6920 2b20 3129 2920 2f20 696e 7465 7276  i + 1)) / interv
+00005a00: 616c 5f75 6e69 740d 0a20 2020 2020 2020  al_unit..       
+00005a10: 2020 2020 2020 2020 2069 6620 7374 6172           if star
+00005a20: 745f 7469 6d65 2e69 735f 696e 7465 6765  t_time.is_intege
+00005a30: 7228 293a 0d0a 2020 2020 2020 2020 2020  r():..          
+00005a40: 2020 2020 2020 2020 2020 7374 6172 745f            start_
+00005a50: 7469 6d65 203d 2069 6e74 2873 7461 7274  time = int(start
+00005a60: 5f74 696d 6529 0d0a 2020 2020 2020 2020  _time)..        
+00005a70: 2020 2020 6375 7272 656e 745f 696e 7465      current_inte
+00005a80: 7276 616c 203d 2030 0d0a 2020 2020 2020  rval = 0..      
+00005a90: 2020 2020 2020 6375 7272 656e 745f 6475        current_du
+00005aa0: 7261 7469 6f6e 203d 2030 0d0a 2020 2020  ration = 0..    
+00005ab0: 2020 2020 2020 2020 6375 7272 656e 745f          current_
+00005ac0: 6e6f 7465 5f69 6e74 6572 7661 6c20 3d20  note_interval = 
+00005ad0: 300d 0a20 2020 2020 2020 2020 2020 2063  0..            c
+00005ae0: 7572 7265 6e74 5f6e 6f74 655f 6475 7261  urrent_note_dura
+00005af0: 7469 6f6e 203d 2030 0d0a 2020 2020 2020  tion = 0..      
+00005b00: 2020 2020 2020 6669 6e64 5f69 6e74 6572        find_inter
+00005b10: 7661 6c20 3d20 4661 6c73 650d 0a20 2020  val = False..   
+00005b20: 2020 2020 2020 2020 2066 696e 645f 6475           find_du
+00005b30: 7261 7469 6f6e 203d 2046 616c 7365 0d0a  ration = False..
+00005b40: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00005b50: 6b20 696e 2072 616e 6765 2869 202b 2031  k in range(i + 1
+00005b60: 2c20 6e6f 7465 735f 6c65 6e29 3a0d 0a20  , notes_len):.. 
+00005b70: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00005b80: 6577 5f6d 7367 203d 2063 7572 7265 6e74  ew_msg = current
+00005b90: 5f74 7261 636b 5b6b 5d0d 0a20 2020 2020  _track[k]..     
+00005ba0: 2020 2020 2020 2020 2020 206e 6577 5f6d             new_m
+00005bb0: 7367 5f74 7970 6520 3d20 6e65 775f 6d73  sg_type = new_ms
+00005bc0: 672e 7479 7065 0d0a 2020 2020 2020 2020  g.type..        
+00005bd0: 2020 2020 2020 2020 6375 7272 656e 745f          current_
+00005be0: 696e 7465 7276 616c 202b 3d20 6e65 775f  interval += new_
+00005bf0: 6d73 672e 7469 6d65 0d0a 2020 2020 2020  msg.time..      
+00005c00: 2020 2020 2020 2020 2020 6375 7272 656e            curren
+00005c10: 745f 6475 7261 7469 6f6e 202b 3d20 6e65  t_duration += ne
+00005c20: 775f 6d73 672e 7469 6d65 0d0a 2020 2020  w_msg.time..    
+00005c30: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00005c40: 6f74 2066 696e 645f 696e 7465 7276 616c  ot find_interval
+00005c50: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00005c60: 2020 2020 2020 2069 6620 6e65 775f 6d73         if new_ms
+00005c70: 675f 7479 7065 203d 3d20 276e 6f74 655f  g_type == 'note_
+00005c80: 6f6e 2720 616e 6420 6e65 775f 6d73 672e  on' and new_msg.
+00005c90: 7665 6c6f 6369 7479 2021 3d20 303a 0d0a  velocity != 0:..
 00005ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005cb0: 2020 2020 2020 6e65 775f 6d73 675f 7479        new_msg_ty
-00005cc0: 7065 203d 3d20 276e 6f74 655f 6f66 6627  pe == 'note_off'
-00005cd0: 206f 720d 0a20 2020 2020 2020 2020 2020   or..           
-00005ce0: 2020 2020 2020 2020 2020 2020 2028 6e65               (ne
-00005cf0: 775f 6d73 675f 7479 7065 203d 3d20 276e  w_msg_type == 'n
-00005d00: 6f74 655f 6f6e 2720 616e 6420 6e65 775f  ote_on' and new_
-00005d10: 6d73 672e 7665 6c6f 6369 7479 203d 3d20  msg.velocity == 
-00005d20: 3029 0d0a 2020 2020 2020 2020 2020 2020  0)..            
-00005d30: 2020 2020 2020 2020 2920 616e 6420 6e65          ) and ne
-00005d40: 775f 6d73 672e 6e6f 7465 203d 3d20 6375  w_msg.note == cu
-00005d50: 7272 656e 745f 6d73 675f 6e6f 7465 2061  rrent_msg_note a
-00005d60: 6e64 206e 6577 5f6d 7367 2e63 6861 6e6e  nd new_msg.chann
-00005d70: 656c 203d 3d20 6375 7272 656e 745f 6d73  el == current_ms
-00005d80: 675f 6368 616e 6e65 6c3a 0d0a 2020 2020  g_channel:..    
+00005cb0: 2020 2020 2020 2020 6669 6e64 5f69 6e74          find_int
+00005cc0: 6572 7661 6c20 3d20 5472 7565 0d0a 2020  erval = True..  
+00005cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005ce0: 2020 2020 2020 6375 7272 656e 745f 696e        current_in
+00005cf0: 7465 7276 616c 202f 3d20 696e 7465 7276  terval /= interv
+00005d00: 616c 5f75 6e69 740d 0a20 2020 2020 2020  al_unit..       
+00005d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005d20: 2069 6620 6375 7272 656e 745f 696e 7465   if current_inte
+00005d30: 7276 616c 2e69 735f 696e 7465 6765 7228  rval.is_integer(
+00005d40: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00005d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005d60: 6375 7272 656e 745f 696e 7465 7276 616c  current_interval
+00005d70: 203d 2069 6e74 2863 7572 7265 6e74 5f69   = int(current_i
+00005d80: 6e74 6572 7661 6c29 0d0a 2020 2020 2020  nterval)..      
 00005d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005da0: 2020 2020 6669 6e64 5f64 7572 6174 696f      find_duratio
-00005db0: 6e20 3d20 5472 7565 0d0a 2020 2020 2020  n = True..      
-00005dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005dd0: 2020 6375 7272 656e 745f 6475 7261 7469    current_durati
-00005de0: 6f6e 202f 3d20 696e 7465 7276 616c 5f75  on /= interval_u
-00005df0: 6e69 740d 0a20 2020 2020 2020 2020 2020  nit..           
-00005e00: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00005e10: 6375 7272 656e 745f 6475 7261 7469 6f6e  current_duration
-00005e20: 2e69 735f 696e 7465 6765 7228 293a 0d0a  .is_integer():..
-00005e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005e40: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-00005e50: 656e 745f 6475 7261 7469 6f6e 203d 2069  ent_duration = i
-00005e60: 6e74 2863 7572 7265 6e74 5f64 7572 6174  nt(current_durat
-00005e70: 696f 6e29 0d0a 2020 2020 2020 2020 2020  ion)..          
-00005e80: 2020 2020 2020 2020 2020 2020 2020 6375                cu
-00005e90: 7272 656e 745f 6e6f 7465 5f64 7572 6174  rrent_note_durat
-00005ea0: 696f 6e20 3d20 6375 7272 656e 745f 6475  ion = current_du
-00005eb0: 7261 7469 6f6e 0d0a 2020 2020 2020 2020  ration..        
-00005ec0: 2020 2020 2020 2020 6966 2066 696e 645f          if find_
-00005ed0: 696e 7465 7276 616c 2061 6e64 2066 696e  interval and fin
-00005ee0: 645f 6475 7261 7469 6f6e 3a0d 0a20 2020  d_duration:..   
-00005ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005f00: 2062 7265 616b 0d0a 2020 2020 2020 2020   break..        
-00005f10: 2020 2020 6966 206e 6f74 2066 696e 645f      if not find_
-00005f20: 696e 7465 7276 616c 3a0d 0a20 2020 2020  interval:..     
-00005f30: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-00005f40: 6e74 5f6e 6f74 655f 696e 7465 7276 616c  nt_note_interval
-00005f50: 203d 2063 7572 7265 6e74 5f6e 6f74 655f   = current_note_
-00005f60: 6475 7261 7469 6f6e 0d0a 2020 2020 2020  duration..      
-00005f70: 2020 2020 2020 6375 7272 656e 745f 6170        current_ap
-00005f80: 7065 6e64 5f6e 6f74 6520 3d20 6465 6772  pend_note = degr
-00005f90: 6565 5f74 6f5f 6e6f 7465 280d 0a20 2020  ee_to_note(..   
-00005fa0: 2020 2020 2020 2020 2020 2020 2063 7572               cur
-00005fb0: 7265 6e74 5f6d 7367 5f6e 6f74 652c 0d0a  rent_msg_note,..
-00005fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005fd0: 6475 7261 7469 6f6e 3d63 7572 7265 6e74  duration=current
-00005fe0: 5f6e 6f74 655f 6475 7261 7469 6f6e 2c0d  _note_duration,.
-00005ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006000: 2076 6f6c 756d 653d 6375 7272 656e 745f   volume=current_
-00006010: 6d73 675f 7665 6c6f 6369 7479 290d 0a20  msg_velocity).. 
-00006020: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-00006030: 6e74 5f61 7070 656e 645f 6e6f 7465 2e63  nt_append_note.c
-00006040: 6861 6e6e 656c 203d 2063 7572 7265 6e74  hannel = current
-00006050: 5f6d 7367 5f63 6861 6e6e 656c 0d0a 2020  _msg_channel..  
-00006060: 2020 2020 2020 2020 2020 696e 7465 7276            interv
-00006070: 616c 732e 6170 7065 6e64 2863 7572 7265  als.append(curre
-00006080: 6e74 5f6e 6f74 655f 696e 7465 7276 616c  nt_note_interval
-00006090: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-000060a0: 6620 6164 645f 7472 6163 6b5f 6e75 6d3a  f add_track_num:
-000060b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000060c0: 2020 6966 2074 7261 636b 5f63 6861 6e6e    if track_chann
-000060d0: 656c 733a 0d0a 2020 2020 2020 2020 2020  els:..          
-000060e0: 2020 2020 2020 2020 2020 6375 7272 656e            curren
-000060f0: 745f 6170 7065 6e64 5f6e 6f74 652e 7472  t_append_note.tr
-00006100: 6163 6b5f 6e75 6d20 3d20 7472 6163 6b5f  ack_num = track_
-00006110: 6368 616e 6e65 6c73 2e69 6e64 6578 280d  channels.index(.
-00006120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006130: 2020 2020 2020 2020 2063 7572 7265 6e74           current
-00006140: 5f6d 7367 5f63 6861 6e6e 656c 290d 0a20  _msg_channel).. 
-00006150: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00006160: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00006170: 2020 2020 2020 2020 2020 6375 7272 656e            curren
-00006180: 745f 6170 7065 6e64 5f6e 6f74 652e 7472  t_append_note.tr
-00006190: 6163 6b5f 6e75 6d20 3d20 7472 6163 6b5f  ack_num = track_
-000061a0: 696e 640d 0a20 2020 2020 2020 2020 2020  ind..           
-000061b0: 206e 6f74 656c 6973 742e 6170 7065 6e64   notelist.append
-000061c0: 2863 7572 7265 6e74 5f61 7070 656e 645f  (current_append_
-000061d0: 6e6f 7465 290d 0a20 2020 2020 2020 2065  note)..        e
-000061e0: 6c69 6620 6375 7272 656e 745f 6d73 672e  lif current_msg.
-000061f0: 7479 7065 203d 3d20 2773 6574 5f74 656d  type == 'set_tem
-00006200: 706f 273a 0d0a 2020 2020 2020 2020 2020  po':..          
-00006210: 2020 6375 7272 656e 745f 7465 6d70 6f20    current_tempo 
-00006220: 3d20 7465 6d70 6f28 6d69 646f 2e74 656d  = tempo(mido.tem
-00006230: 706f 3262 706d 2863 7572 7265 6e74 5f6d  po2bpm(current_m
-00006240: 7367 2e74 656d 706f 292c 0d0a 2020 2020  sg.tempo),..    
-00006250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006260: 2020 2020 2020 2020 2020 2020 2020 6375                cu
-00006270: 7272 656e 745f 7469 6d65 202f 2069 6e74  rrent_time / int
-00006280: 6572 7661 6c5f 756e 6974 2c0d 0a20 2020  erval_unit,..   
-00006290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000062a0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-000062b0: 7261 636b 3d74 7261 636b 5f69 6e64 290d  rack=track_ind).
-000062c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000062d0: 6164 645f 7472 6163 6b5f 6e75 6d3a 0d0a  add_track_num:..
-000062e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000062f0: 6375 7272 656e 745f 7465 6d70 6f2e 7472  current_tempo.tr
-00006300: 6163 6b5f 6e75 6d20 3d20 7472 6163 6b5f  ack_num = track_
-00006310: 696e 640d 0a20 2020 2020 2020 2020 2020  ind..           
-00006320: 2074 656d 706f 5f6c 6973 742e 6170 7065   tempo_list.appe
-00006330: 6e64 2863 7572 7265 6e74 5f74 656d 706f  nd(current_tempo
-00006340: 290d 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
-00006350: 6375 7272 656e 745f 6d73 672e 7479 7065  current_msg.type
-00006360: 203d 3d20 2770 6974 6368 7768 6565 6c27   == 'pitchwheel'
-00006370: 3a0d 0a20 2020 2020 2020 2020 2020 2063  :..            c
-00006380: 7572 7265 6e74 5f6d 7367 5f63 6861 6e6e  urrent_msg_chann
-00006390: 656c 203d 2063 7572 7265 6e74 5f6d 7367  el = current_msg
-000063a0: 2e63 6861 6e6e 656c 0d0a 2020 2020 2020  .channel..      
-000063b0: 2020 2020 2020 6966 2074 7261 636b 5f63        if track_c
-000063c0: 6861 6e6e 656c 733a 0d0a 2020 2020 2020  hannels:..      
-000063d0: 2020 2020 2020 2020 2020 6375 7272 656e            curren
-000063e0: 745f 7472 6163 6b5f 696e 6420 3d20 7472  t_track_ind = tr
-000063f0: 6163 6b5f 6368 616e 6e65 6c73 2e69 6e64  ack_channels.ind
-00006400: 6578 2863 7572 7265 6e74 5f6d 7367 5f63  ex(current_msg_c
-00006410: 6861 6e6e 656c 290d 0a20 2020 2020 2020  hannel)..       
-00006420: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00006430: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-00006440: 656e 745f 7472 6163 6b5f 696e 6420 3d20  ent_track_ind = 
-00006450: 7472 6163 6b5f 696e 640d 0a20 2020 2020  track_ind..     
-00006460: 2020 2020 2020 2063 7572 7265 6e74 5f70         current_p
-00006470: 6974 6368 5f62 656e 6420 3d20 7069 7463  itch_bend = pitc
-00006480: 685f 6265 6e64 2876 616c 7565 3d63 7572  h_bend(value=cur
-00006490: 7265 6e74 5f6d 7367 2e70 6974 6368 2c0d  rent_msg.pitch,.
-000064a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000064b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000064c0: 2020 2020 2020 2020 2020 2020 2073 7461               sta
-000064d0: 7274 5f74 696d 653d 6375 7272 656e 745f  rt_time=current_
-000064e0: 7469 6d65 202f 0d0a 2020 2020 2020 2020  time /..        
-000064f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006510: 2020 2020 696e 7465 7276 616c 5f75 6e69      interval_uni
-00006520: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
-00006530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006550: 6d6f 6465 3d27 7661 6c75 6573 272c 0d0a  mode='values',..
-00006560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006580: 2020 2020 2020 2020 2020 2020 6368 616e              chan
-00006590: 6e65 6c3d 6375 7272 656e 745f 6d73 675f  nel=current_msg_
-000065a0: 6368 616e 6e65 6c2c 0d0a 2020 2020 2020  channel,..      
-000065b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000065c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000065d0: 2020 2020 2020 7472 6163 6b3d 6375 7272        track=curr
-000065e0: 656e 745f 7472 6163 6b5f 696e 6429 0d0a  ent_track_ind)..
-000065f0: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-00006600: 6464 5f74 7261 636b 5f6e 756d 3a0d 0a20  dd_track_num:.. 
-00006610: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00006620: 7572 7265 6e74 5f70 6974 6368 5f62 656e  urrent_pitch_ben
-00006630: 642e 7472 6163 6b5f 6e75 6d20 3d20 6375  d.track_num = cu
-00006640: 7272 656e 745f 7472 6163 6b5f 696e 640d  rrent_track_ind.
-00006650: 0a20 2020 2020 2020 2020 2020 2070 6974  .            pit
-00006660: 6368 5f62 656e 645f 6c69 7374 2e61 7070  ch_bend_list.app
-00006670: 656e 6428 6375 7272 656e 745f 7069 7463  end(current_pitc
-00006680: 685f 6265 6e64 290d 0a20 2020 2020 2020  h_bend)..       
-00006690: 2065 6c69 6620 6375 7272 656e 745f 6d73   elif current_ms
-000066a0: 672e 7479 7065 203d 3d20 2763 6f6e 7472  g.type == 'contr
-000066b0: 6f6c 5f63 6861 6e67 6527 3a0d 0a20 2020  ol_change':..   
-000066c0: 2020 2020 2020 2020 2063 7572 7265 6e74           current
-000066d0: 5f6d 7367 5f63 6861 6e6e 656c 203d 2063  _msg_channel = c
-000066e0: 7572 7265 6e74 5f6d 7367 2e63 6861 6e6e  urrent_msg.chann
-000066f0: 656c 0d0a 2020 2020 2020 2020 2020 2020  el..            
-00006700: 6966 2074 7261 636b 5f63 6861 6e6e 656c  if track_channel
-00006710: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-00006720: 2020 2020 6375 7272 656e 745f 7472 6163      current_trac
-00006730: 6b5f 696e 6420 3d20 7472 6163 6b5f 6368  k_ind = track_ch
-00006740: 616e 6e65 6c73 2e69 6e64 6578 2863 7572  annels.index(cur
-00006750: 7265 6e74 5f6d 7367 5f63 6861 6e6e 656c  rent_msg_channel
-00006760: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-00006770: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00006780: 2020 2020 2020 6375 7272 656e 745f 7472        current_tr
-00006790: 6163 6b5f 696e 6420 3d20 7472 6163 6b5f  ack_ind = track_
-000067a0: 696e 640d 0a20 2020 2020 2020 2020 2020  ind..           
-000067b0: 2069 6620 6375 7272 656e 745f 6d73 672e   if current_msg.
-000067c0: 636f 6e74 726f 6c20 3d3d 2031 303a 0d0a  control == 10:..
-000067d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000067e0: 6375 7272 656e 745f 7061 6e5f 6d73 6720  current_pan_msg 
-000067f0: 3d20 7061 6e28 6375 7272 656e 745f 6d73  = pan(current_ms
-00006800: 672e 7661 6c75 652c 0d0a 2020 2020 2020  g.value,..      
-00006810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006830: 6375 7272 656e 745f 7469 6d65 202f 2069  current_time / i
-00006840: 6e74 6572 7661 6c5f 756e 6974 2c0d 0a20  nterval_unit,.. 
-00006850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006870: 2020 2020 2027 7661 6c75 6527 2c0d 0a20       'value',.. 
-00006880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000068a0: 2020 2020 2063 6861 6e6e 656c 3d63 7572       channel=cur
-000068b0: 7265 6e74 5f6d 7367 5f63 6861 6e6e 656c  rent_msg_channel
-000068c0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000068d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000068e0: 2020 2020 2020 2020 2074 7261 636b 3d63           track=c
-000068f0: 7572 7265 6e74 5f74 7261 636b 5f69 6e64  urrent_track_ind
-00006900: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00006910: 2020 2070 616e 5f6c 6973 742e 6170 7065     pan_list.appe
-00006920: 6e64 2863 7572 7265 6e74 5f70 616e 5f6d  nd(current_pan_m
-00006930: 7367 290d 0a20 2020 2020 2020 2020 2020  sg)..           
-00006940: 2065 6c69 6620 6375 7272 656e 745f 6d73   elif current_ms
-00006950: 672e 636f 6e74 726f 6c20 3d3d 2037 3a0d  g.control == 7:.
-00006960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006970: 2063 7572 7265 6e74 5f76 6f6c 756d 655f   current_volume_
-00006980: 6d73 6720 3d20 766f 6c75 6d65 2863 7572  msg = volume(cur
-00006990: 7265 6e74 5f6d 7367 2e76 616c 7565 2c0d  rent_msg.value,.
-000069a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000069b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000069c0: 2020 2020 2020 2020 2020 2020 2063 7572               cur
-000069d0: 7265 6e74 5f74 696d 6520 2f20 696e 7465  rent_time / inte
-000069e0: 7276 616c 5f75 6e69 742c 0d0a 2020 2020  rval_unit,..    
-000069f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005da0: 2020 6375 7272 656e 745f 6e6f 7465 5f69    current_note_i
+00005db0: 6e74 6572 7661 6c20 3d20 6375 7272 656e  nterval = curren
+00005dc0: 745f 696e 7465 7276 616c 0d0a 2020 2020  t_interval..    
+00005dd0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00005de0: 6f74 2066 696e 645f 6475 7261 7469 6f6e  ot find_duration
+00005df0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00005e00: 2020 2020 2020 2069 6620 280d 0a20 2020         if (..   
+00005e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005e20: 2020 2020 2020 2020 206e 6577 5f6d 7367           new_msg
+00005e30: 5f74 7970 6520 3d3d 2027 6e6f 7465 5f6f  _type == 'note_o
+00005e40: 6666 2720 6f72 0d0a 2020 2020 2020 2020  ff' or..        
+00005e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005e60: 286e 6577 5f6d 7367 5f74 7970 6520 3d3d  (new_msg_type ==
+00005e70: 2027 6e6f 7465 5f6f 6e27 2061 6e64 206e   'note_on' and n
+00005e80: 6577 5f6d 7367 2e76 656c 6f63 6974 7920  ew_msg.velocity 
+00005e90: 3d3d 2030 290d 0a20 2020 2020 2020 2020  == 0)..         
+00005ea0: 2020 2020 2020 2020 2020 2029 2061 6e64             ) and
+00005eb0: 206e 6577 5f6d 7367 2e6e 6f74 6520 3d3d   new_msg.note ==
+00005ec0: 2063 7572 7265 6e74 5f6d 7367 5f6e 6f74   current_msg_not
+00005ed0: 6520 616e 6420 6e65 775f 6d73 672e 6368  e and new_msg.ch
+00005ee0: 616e 6e65 6c20 3d3d 2063 7572 7265 6e74  annel == current
+00005ef0: 5f6d 7367 5f63 6861 6e6e 656c 3a0d 0a20  _msg_channel:.. 
+00005f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005f10: 2020 2020 2020 2066 696e 645f 6475 7261         find_dura
+00005f20: 7469 6f6e 203d 2054 7275 650d 0a20 2020  tion = True..   
+00005f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005f40: 2020 2020 2063 7572 7265 6e74 5f64 7572       current_dur
+00005f50: 6174 696f 6e20 2f3d 2069 6e74 6572 7661  ation /= interva
+00005f60: 6c5f 756e 6974 0d0a 2020 2020 2020 2020  l_unit..        
+00005f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005f80: 6966 2063 7572 7265 6e74 5f64 7572 6174  if current_durat
+00005f90: 696f 6e2e 6973 5f69 6e74 6567 6572 2829  ion.is_integer()
+00005fa0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00005fb0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00005fc0: 7572 7265 6e74 5f64 7572 6174 696f 6e20  urrent_duration 
+00005fd0: 3d20 696e 7428 6375 7272 656e 745f 6475  = int(current_du
+00005fe0: 7261 7469 6f6e 290d 0a20 2020 2020 2020  ration)..       
+00005ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006000: 2063 7572 7265 6e74 5f6e 6f74 655f 6475   current_note_du
+00006010: 7261 7469 6f6e 203d 2063 7572 7265 6e74  ration = current
+00006020: 5f64 7572 6174 696f 6e0d 0a20 2020 2020  _duration..     
+00006030: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
+00006040: 6e64 5f69 6e74 6572 7661 6c20 616e 6420  nd_interval and 
+00006050: 6669 6e64 5f64 7572 6174 696f 6e3a 0d0a  find_duration:..
+00006060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006070: 2020 2020 6272 6561 6b0d 0a20 2020 2020      break..     
+00006080: 2020 2020 2020 2069 6620 6e6f 7420 6669         if not fi
+00006090: 6e64 5f69 6e74 6572 7661 6c3a 0d0a 2020  nd_interval:..  
+000060a0: 2020 2020 2020 2020 2020 2020 2020 6375                cu
+000060b0: 7272 656e 745f 6e6f 7465 5f69 6e74 6572  rrent_note_inter
+000060c0: 7661 6c20 3d20 6375 7272 656e 745f 6e6f  val = current_no
+000060d0: 7465 5f64 7572 6174 696f 6e0d 0a20 2020  te_duration..   
+000060e0: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+000060f0: 5f61 7070 656e 645f 6e6f 7465 203d 2064  _append_note = d
+00006100: 6567 7265 655f 746f 5f6e 6f74 6528 0d0a  egree_to_note(..
+00006110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006120: 6375 7272 656e 745f 6d73 675f 6e6f 7465  current_msg_note
+00006130: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00006140: 2020 2064 7572 6174 696f 6e3d 6375 7272     duration=curr
+00006150: 656e 745f 6e6f 7465 5f64 7572 6174 696f  ent_note_duratio
+00006160: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
+00006170: 2020 2020 766f 6c75 6d65 3d63 7572 7265      volume=curre
+00006180: 6e74 5f6d 7367 5f76 656c 6f63 6974 7929  nt_msg_velocity)
+00006190: 0d0a 2020 2020 2020 2020 2020 2020 6375  ..            cu
+000061a0: 7272 656e 745f 6170 7065 6e64 5f6e 6f74  rrent_append_not
+000061b0: 652e 6368 616e 6e65 6c20 3d20 6375 7272  e.channel = curr
+000061c0: 656e 745f 6d73 675f 6368 616e 6e65 6c0d  ent_msg_channel.
+000061d0: 0a20 2020 2020 2020 2020 2020 2069 6e74  .            int
+000061e0: 6572 7661 6c73 2e61 7070 656e 6428 6375  ervals.append(cu
+000061f0: 7272 656e 745f 6e6f 7465 5f69 6e74 6572  rrent_note_inter
+00006200: 7661 6c29 0d0a 2020 2020 2020 2020 2020  val)..          
+00006210: 2020 6966 2061 6464 5f74 7261 636b 5f6e    if add_track_n
+00006220: 756d 3a0d 0a20 2020 2020 2020 2020 2020  um:..           
+00006230: 2020 2020 2069 6620 7472 6163 6b5f 6368       if track_ch
+00006240: 616e 6e65 6c73 3a0d 0a20 2020 2020 2020  annels:..       
+00006250: 2020 2020 2020 2020 2020 2020 2063 7572               cur
+00006260: 7265 6e74 5f61 7070 656e 645f 6e6f 7465  rent_append_note
+00006270: 2e74 7261 636b 5f6e 756d 203d 2074 7261  .track_num = tra
+00006280: 636b 5f63 6861 6e6e 656c 732e 696e 6465  ck_channels.inde
+00006290: 7828 0d0a 2020 2020 2020 2020 2020 2020  x(..            
+000062a0: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+000062b0: 656e 745f 6d73 675f 6368 616e 6e65 6c29  ent_msg_channel)
+000062c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000062d0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+000062e0: 2020 2020 2020 2020 2020 2020 2063 7572               cur
+000062f0: 7265 6e74 5f61 7070 656e 645f 6e6f 7465  rent_append_note
+00006300: 2e74 7261 636b 5f6e 756d 203d 2074 7261  .track_num = tra
+00006310: 636b 5f69 6e64 0d0a 2020 2020 2020 2020  ck_ind..        
+00006320: 2020 2020 6e6f 7465 6c69 7374 2e61 7070      notelist.app
+00006330: 656e 6428 6375 7272 656e 745f 6170 7065  end(current_appe
+00006340: 6e64 5f6e 6f74 6529 0d0a 2020 2020 2020  nd_note)..      
+00006350: 2020 656c 6966 2063 7572 7265 6e74 5f6d    elif current_m
+00006360: 7367 2e74 7970 6520 3d3d 2027 7365 745f  sg.type == 'set_
+00006370: 7465 6d70 6f27 3a0d 0a20 2020 2020 2020  tempo':..       
+00006380: 2020 2020 2063 7572 7265 6e74 5f74 656d       current_tem
+00006390: 706f 203d 2074 656d 706f 286d 6964 6f2e  po = tempo(mido.
+000063a0: 7465 6d70 6f32 6270 6d28 6375 7272 656e  tempo2bpm(curren
+000063b0: 745f 6d73 672e 7465 6d70 6f29 2c0d 0a20  t_msg.tempo),.. 
+000063c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000063d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000063e0: 2063 7572 7265 6e74 5f74 696d 6520 2f20   current_time / 
+000063f0: 696e 7465 7276 616c 5f75 6e69 742c 0d0a  interval_unit,..
+00006400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006420: 2020 7472 6163 6b3d 7472 6163 6b5f 696e    track=track_in
+00006430: 6429 0d0a 2020 2020 2020 2020 2020 2020  d)..            
+00006440: 6966 2061 6464 5f74 7261 636b 5f6e 756d  if add_track_num
+00006450: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00006460: 2020 2063 7572 7265 6e74 5f74 656d 706f     current_tempo
+00006470: 2e74 7261 636b 5f6e 756d 203d 2074 7261  .track_num = tra
+00006480: 636b 5f69 6e64 0d0a 2020 2020 2020 2020  ck_ind..        
+00006490: 2020 2020 7465 6d70 6f5f 6c69 7374 2e61      tempo_list.a
+000064a0: 7070 656e 6428 6375 7272 656e 745f 7465  ppend(current_te
+000064b0: 6d70 6f29 0d0a 2020 2020 2020 2020 656c  mpo)..        el
+000064c0: 6966 2063 7572 7265 6e74 5f6d 7367 2e74  if current_msg.t
+000064d0: 7970 6520 3d3d 2027 7069 7463 6877 6865  ype == 'pitchwhe
+000064e0: 656c 273a 0d0a 2020 2020 2020 2020 2020  el':..          
+000064f0: 2020 6375 7272 656e 745f 6d73 675f 6368    current_msg_ch
+00006500: 616e 6e65 6c20 3d20 6375 7272 656e 745f  annel = current_
+00006510: 6d73 672e 6368 616e 6e65 6c0d 0a20 2020  msg.channel..   
+00006520: 2020 2020 2020 2020 2069 6620 7472 6163           if trac
+00006530: 6b5f 6368 616e 6e65 6c73 3a0d 0a20 2020  k_channels:..   
+00006540: 2020 2020 2020 2020 2020 2020 2063 7572               cur
+00006550: 7265 6e74 5f74 7261 636b 5f69 6e64 203d  rent_track_ind =
+00006560: 2074 7261 636b 5f63 6861 6e6e 656c 732e   track_channels.
+00006570: 696e 6465 7828 6375 7272 656e 745f 6d73  index(current_ms
+00006580: 675f 6368 616e 6e65 6c29 0d0a 2020 2020  g_channel)..    
+00006590: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+000065a0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000065b0: 7572 7265 6e74 5f74 7261 636b 5f69 6e64  urrent_track_ind
+000065c0: 203d 2074 7261 636b 5f69 6e64 0d0a 2020   = track_ind..  
+000065d0: 2020 2020 2020 2020 2020 6375 7272 656e            curren
+000065e0: 745f 7069 7463 685f 6265 6e64 203d 2070  t_pitch_bend = p
+000065f0: 6974 6368 5f62 656e 6428 7661 6c75 653d  itch_bend(value=
+00006600: 6375 7272 656e 745f 6d73 672e 7069 7463  current_msg.pitc
+00006610: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
+00006620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006640: 7374 6172 745f 7469 6d65 3d63 7572 7265  start_time=curre
+00006650: 6e74 5f74 696d 6520 2f0d 0a20 2020 2020  nt_time /..     
+00006660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006680: 2020 2020 2020 2069 6e74 6572 7661 6c5f         interval_
+00006690: 756e 6974 2c0d 0a20 2020 2020 2020 2020  unit,..         
+000066a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000066b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000066c0: 2020 206d 6f64 653d 2776 616c 7565 7327     mode='values'
+000066d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000066e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000066f0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00006700: 6861 6e6e 656c 3d63 7572 7265 6e74 5f6d  hannel=current_m
+00006710: 7367 5f63 6861 6e6e 656c 2c0d 0a20 2020  sg_channel,..   
+00006720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006740: 2020 2020 2020 2020 2074 7261 636b 3d63           track=c
+00006750: 7572 7265 6e74 5f74 7261 636b 5f69 6e64  urrent_track_ind
+00006760: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+00006770: 6620 6164 645f 7472 6163 6b5f 6e75 6d3a  f add_track_num:
+00006780: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00006790: 2020 6375 7272 656e 745f 7069 7463 685f    current_pitch_
+000067a0: 6265 6e64 2e74 7261 636b 5f6e 756d 203d  bend.track_num =
+000067b0: 2063 7572 7265 6e74 5f74 7261 636b 5f69   current_track_i
+000067c0: 6e64 0d0a 2020 2020 2020 2020 2020 2020  nd..            
+000067d0: 7069 7463 685f 6265 6e64 5f6c 6973 742e  pitch_bend_list.
+000067e0: 6170 7065 6e64 2863 7572 7265 6e74 5f70  append(current_p
+000067f0: 6974 6368 5f62 656e 6429 0d0a 2020 2020  itch_bend)..    
+00006800: 2020 2020 656c 6966 2063 7572 7265 6e74      elif current
+00006810: 5f6d 7367 2e74 7970 6520 3d3d 2027 636f  _msg.type == 'co
+00006820: 6e74 726f 6c5f 6368 616e 6765 273a 0d0a  ntrol_change':..
+00006830: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+00006840: 656e 745f 6d73 675f 6368 616e 6e65 6c20  ent_msg_channel 
+00006850: 3d20 6375 7272 656e 745f 6d73 672e 6368  = current_msg.ch
+00006860: 616e 6e65 6c0d 0a20 2020 2020 2020 2020  annel..         
+00006870: 2020 2069 6620 7472 6163 6b5f 6368 616e     if track_chan
+00006880: 6e65 6c73 3a0d 0a20 2020 2020 2020 2020  nels:..         
+00006890: 2020 2020 2020 2063 7572 7265 6e74 5f74         current_t
+000068a0: 7261 636b 5f69 6e64 203d 2074 7261 636b  rack_ind = track
+000068b0: 5f63 6861 6e6e 656c 732e 696e 6465 7828  _channels.index(
+000068c0: 6375 7272 656e 745f 6d73 675f 6368 616e  current_msg_chan
+000068d0: 6e65 6c29 0d0a 2020 2020 2020 2020 2020  nel)..          
+000068e0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+000068f0: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+00006900: 5f74 7261 636b 5f69 6e64 203d 2074 7261  _track_ind = tra
+00006910: 636b 5f69 6e64 0d0a 2020 2020 2020 2020  ck_ind..        
+00006920: 2020 2020 6966 2063 7572 7265 6e74 5f6d      if current_m
+00006930: 7367 2e63 6f6e 7472 6f6c 203d 3d20 3130  sg.control == 10
+00006940: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00006950: 2020 2063 7572 7265 6e74 5f70 616e 5f6d     current_pan_m
+00006960: 7367 203d 2070 616e 2863 7572 7265 6e74  sg = pan(current
+00006970: 5f6d 7367 2e76 616c 7565 2c0d 0a20 2020  _msg.value,..   
+00006980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000069a0: 2020 2063 7572 7265 6e74 5f74 696d 6520     current_time 
+000069b0: 2f20 696e 7465 7276 616c 5f75 6e69 742c  / interval_unit,
+000069c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000069d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000069e0: 2020 2020 2020 2020 2776 616c 7565 272c          'value',
+000069f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
 00006a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006a10: 2020 2020 2020 2020 2776 616c 7565 272c          'value',
-00006a20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00006a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006a40: 2020 2020 2020 2020 2020 2020 2020 6368                ch
-00006a50: 616e 6e65 6c3d 6375 7272 656e 745f 6d73  annel=current_ms
-00006a60: 675f 6368 616e 6e65 6c2c 0d0a 2020 2020  g_channel,..    
-00006a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006a90: 2020 2020 2020 2020 7472 6163 6b3d 6375          track=cu
-00006aa0: 7272 656e 745f 7472 6163 6b5f 696e 6429  rrent_track_ind)
-00006ab0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00006ac0: 2020 766f 6c75 6d65 5f6c 6973 742e 6170    volume_list.ap
-00006ad0: 7065 6e64 2863 7572 7265 6e74 5f76 6f6c  pend(current_vol
-00006ae0: 756d 655f 6d73 6729 0d0a 2020 2020 2020  ume_msg)..      
-00006af0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00006b00: 2020 2020 2020 2020 2020 2020 205f 7265               _re
-00006b10: 6164 5f6f 7468 6572 5f6d 6573 7361 6765  ad_other_message
-00006b20: 7328 6375 7272 656e 745f 6d73 672c 206f  s(current_msg, o
-00006b30: 7468 6572 5f6d 6573 7361 6765 732c 0d0a  ther_messages,..
-00006b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006b60: 2020 2020 2063 7572 7265 6e74 5f74 696d       current_tim
-00006b70: 6520 2f20 696e 7465 7276 616c 5f75 6e69  e / interval_uni
-00006b80: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
-00006b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ba0: 2020 2020 2020 2020 2063 7572 7265 6e74           current
-00006bb0: 5f74 7261 636b 5f69 6e64 290d 0a20 2020  _track_ind)..   
-00006bc0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00006bd0: 2020 2020 2020 2020 6966 2074 7261 636b          if track
-00006be0: 5f63 6861 6e6e 656c 7320 616e 6420 6861  _channels and ha
-00006bf0: 7361 7474 7228 6375 7272 656e 745f 6d73  sattr(current_ms
-00006c00: 672c 2027 6368 616e 6e65 6c27 293a 0d0a  g, 'channel'):..
-00006c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006c20: 6375 7272 656e 745f 6d73 675f 6368 616e  current_msg_chan
-00006c30: 6e65 6c20 3d20 6375 7272 656e 745f 6d73  nel = current_ms
-00006c40: 672e 6368 616e 6e65 6c0d 0a20 2020 2020  g.channel..     
-00006c50: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-00006c60: 6e74 5f74 7261 636b 5f69 6e64 203d 2074  nt_track_ind = t
-00006c70: 7261 636b 5f63 6861 6e6e 656c 732e 696e  rack_channels.in
-00006c80: 6465 7828 6375 7272 656e 745f 6d73 675f  dex(current_msg_
-00006c90: 6368 616e 6e65 6c29 0d0a 2020 2020 2020  channel)..      
-00006ca0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00006cb0: 2020 2020 2020 2020 2020 2020 2063 7572               cur
-00006cc0: 7265 6e74 5f74 7261 636b 5f69 6e64 203d  rent_track_ind =
-00006cd0: 2074 7261 636b 5f69 6e64 0d0a 2020 2020   track_ind..    
-00006ce0: 2020 2020 2020 2020 5f72 6561 645f 6f74          _read_ot
-00006cf0: 6865 725f 6d65 7373 6167 6573 2863 7572  her_messages(cur
-00006d00: 7265 6e74 5f6d 7367 2c20 6f74 6865 725f  rent_msg, other_
-00006d10: 6d65 7373 6167 6573 2c0d 0a20 2020 2020  messages,..     
-00006d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006d30: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-00006d40: 656e 745f 7469 6d65 202f 2069 6e74 6572  ent_time / inter
-00006d50: 7661 6c5f 756e 6974 2c0d 0a20 2020 2020  val_unit,..     
-00006d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006d70: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-00006d80: 656e 745f 7472 6163 6b5f 696e 6429 0d0a  ent_track_ind)..
-00006d90: 2020 2020 7265 7375 6c74 203d 2063 686f      result = cho
-00006da0: 7264 286e 6f74 656c 6973 742c 2069 6e74  rd(notelist, int
-00006db0: 6572 7661 6c3d 696e 7465 7276 616c 7329  erval=intervals)
-00006dc0: 0d0a 2020 2020 6966 2063 6c65 6172 5f65  ..    if clear_e
-00006dd0: 6d70 7479 5f6e 6f74 6573 3a0d 0a20 2020  mpty_notes:..   
-00006de0: 2020 2020 2069 6e64 7320 3d20 5b69 2066       inds = [i f
-00006df0: 6f72 2069 2c20 6561 6368 2069 6e20 656e  or i, each in en
-00006e00: 756d 6572 6174 6528 7265 7375 6c74 2e6e  umerate(result.n
-00006e10: 6f74 6573 2920 6966 2065 6163 682e 6475  otes) if each.du
-00006e20: 7261 7469 6f6e 203e 2030 5d0d 0a20 2020  ration > 0]..   
-00006e30: 2020 2020 2072 6573 756c 742e 6e6f 7465       result.note
-00006e40: 7320 3d20 5b72 6573 756c 742e 6e6f 7465  s = [result.note
-00006e50: 735b 695d 2066 6f72 2069 2069 6e20 696e  s[i] for i in in
-00006e60: 6473 5d0d 0a20 2020 2020 2020 2072 6573  ds]..        res
-00006e70: 756c 742e 696e 7465 7276 616c 203d 205b  ult.interval = [
-00006e80: 7265 7375 6c74 2e69 6e74 6572 7661 6c5b  result.interval[
-00006e90: 695d 2066 6f72 2069 2069 6e20 696e 6473  i] for i in inds
-00006ea0: 5d0d 0a20 2020 2072 6573 756c 742e 7465  ]..    result.te
-00006eb0: 6d70 6f73 203d 2074 656d 706f 5f6c 6973  mpos = tempo_lis
-00006ec0: 740d 0a20 2020 2072 6573 756c 742e 7069  t..    result.pi
-00006ed0: 7463 685f 6265 6e64 7320 3d20 7069 7463  tch_bends = pitc
-00006ee0: 685f 6265 6e64 5f6c 6973 740d 0a20 2020  h_bend_list..   
-00006ef0: 2072 6573 756c 742e 7061 6e5f 6c69 7374   result.pan_list
-00006f00: 203d 2070 616e 5f6c 6973 740d 0a20 2020   = pan_list..   
-00006f10: 2072 6573 756c 742e 766f 6c75 6d65 5f6c   result.volume_l
-00006f20: 6973 7420 3d20 766f 6c75 6d65 5f6c 6973  ist = volume_lis
-00006f30: 740d 0a20 2020 2072 6573 756c 742e 6f74  t..    result.ot
-00006f40: 6865 725f 6d65 7373 6167 6573 203d 206f  her_messages = o
-00006f50: 7468 6572 5f6d 6573 7361 6765 730d 0a20  ther_messages.. 
-00006f60: 2020 2069 6620 6270 6d20 6973 206e 6f74     if bpm is not
-00006f70: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00006f80: 7265 7475 726e 205b 7265 7375 6c74 2c20  return [result, 
-00006f90: 6270 6d2c 2073 7461 7274 5f74 696d 655d  bpm, start_time]
-00006fa0: 0d0a 2020 2020 656c 7365 3a0d 0a20 2020  ..    else:..   
-00006fb0: 2020 2020 2072 6574 7572 6e20 5b72 6573       return [res
-00006fc0: 756c 742c 2073 7461 7274 5f74 696d 655d  ult, start_time]
-00006fd0: 0d0a 0d0a 0d0a 6465 6620 5f72 6561 645f  ......def _read_
-00006fe0: 6f74 6865 725f 6d65 7373 6167 6573 286d  other_messages(m
-00006ff0: 6573 7361 6765 2c20 6f74 6865 725f 6d65  essage, other_me
-00007000: 7373 6167 6573 2c20 7469 6d65 2c20 7472  ssages, time, tr
-00007010: 6163 6b5f 696e 6429 3a0d 0a20 2020 2069  ack_ind):..    i
-00007020: 6620 6d65 7373 6167 652e 7479 7065 206e  f message.type n
-00007030: 6f74 2069 6e20 5b27 6e6f 7465 5f6f 6e27  ot in ['note_on'
-00007040: 2c20 276e 6f74 655f 6f66 6627 5d3a 0d0a  , 'note_off']:..
-00007050: 2020 2020 2020 2020 6375 7272 656e 745f          current_
-00007060: 6174 7472 6962 7574 6573 203d 207b 0d0a  attributes = {..
-00007070: 2020 2020 2020 2020 2020 2020 693a 206a              i: j
-00007080: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-00007090: 7220 692c 206a 2069 6e20 7661 7273 286d  r i, j in vars(m
-000070a0: 6573 7361 6765 292e 6974 656d 7328 2920  essage).items() 
-000070b0: 6966 2069 2021 3d20 2774 696d 6527 0d0a  if i != 'time'..
-000070c0: 2020 2020 2020 2020 7d0d 0a20 2020 2020          }..     
-000070d0: 2020 2063 7572 7265 6e74 5f6d 6573 7361     current_messa
-000070e0: 6765 203d 2065 7665 6e74 2874 7261 636b  ge = event(track
-000070f0: 3d74 7261 636b 5f69 6e64 2c0d 0a20 2020  =track_ind,..   
-00007100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007110: 2020 2020 2020 2020 2020 2020 2073 7461               sta
-00007120: 7274 5f74 696d 653d 7469 6d65 2c0d 0a20  rt_time=time,.. 
-00007130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007140: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-00007150: 2a63 7572 7265 6e74 5f61 7474 7269 6275  *current_attribu
-00007160: 7465 7329 0d0a 2020 2020 2020 2020 6375  tes)..        cu
-00007170: 7272 656e 745f 6d65 7373 6167 652e 6973  rrent_message.is
-00007180: 5f6d 6574 6120 3d20 6d65 7373 6167 652e  _meta = message.
-00007190: 6973 5f6d 6574 610d 0a20 2020 2020 2020  is_meta..       
-000071a0: 206f 7468 6572 5f6d 6573 7361 6765 732e   other_messages.
-000071b0: 6170 7065 6e64 2863 7572 7265 6e74 5f6d  append(current_m
-000071c0: 6573 7361 6765 290d 0a0d 0a0d 0a64 6566  essage)......def
-000071d0: 2077 7269 7465 2863 7572 7265 6e74 5f63   write(current_c
-000071e0: 686f 7264 2c0d 0a20 2020 2020 2020 2020  hord,..         
-000071f0: 2062 706d 3d31 3230 2c0d 0a20 2020 2020   bpm=120,..     
-00007200: 2020 2020 2063 6861 6e6e 656c 3d30 2c0d       channel=0,.
-00007210: 0a20 2020 2020 2020 2020 2073 7461 7274  .          start
-00007220: 5f74 696d 653d 4e6f 6e65 2c0d 0a20 2020  _time=None,..   
-00007230: 2020 2020 2020 206e 616d 653d 2774 656d         name='tem
-00007240: 702e 6d69 6427 2c0d 0a20 2020 2020 2020  p.mid',..       
-00007250: 2020 2069 6e73 7472 756d 656e 743d 4e6f     instrument=No
-00007260: 6e65 2c0d 0a20 2020 2020 2020 2020 2069  ne,..          i
-00007270: 3d4e 6f6e 652c 0d0a 2020 2020 2020 2020  =None,..        
-00007280: 2020 7361 7665 5f61 735f 6669 6c65 3d54    save_as_file=T
-00007290: 7275 652c 0d0a 2020 2020 2020 2020 2020  rue,..          
-000072a0: 6d73 673d 4e6f 6e65 2c0d 0a20 2020 2020  msg=None,..     
-000072b0: 2020 2020 206e 6f6d 7367 3d46 616c 7365       nomsg=False
-000072c0: 2c0d 0a20 2020 2020 2020 2020 2074 6963  ,..          tic
-000072d0: 6b73 5f70 6572 5f62 6561 743d 4e6f 6e65  ks_per_beat=None
-000072e0: 2c0d 0a20 2020 2020 2020 2020 2069 676e  ,..          ign
-000072f0: 6f72 655f 696e 7374 7275 6d65 6e74 3d46  ore_instrument=F
-00007300: 616c 7365 2c0d 0a20 2020 2020 2020 2020  alse,..         
-00007310: 2069 676e 6f72 655f 6270 6d3d 4661 6c73   ignore_bpm=Fals
-00007320: 652c 0d0a 2020 2020 2020 2020 2020 6967  e,..          ig
-00007330: 6e6f 7265 5f74 7261 636b 5f6e 616d 6573  nore_track_names
-00007340: 3d46 616c 7365 2c0d 0a20 2020 2020 2020  =False,..       
-00007350: 2020 202a 2a6d 6964 695f 6172 6773 293a     **midi_args):
-00007360: 0d0a 2020 2020 6966 2069 2069 7320 6e6f  ..    if i is no
-00007370: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-00007380: 2069 6e73 7472 756d 656e 7420 3d20 690d   instrument = i.
-00007390: 0a20 2020 2069 735f 7472 6163 6b5f 7479  .    is_track_ty
-000073a0: 7065 203d 2046 616c 7365 0d0a 2020 2020  pe = False..    
-000073b0: 6973 5f70 6965 6365 5f6c 696b 655f 7479  is_piece_like_ty
-000073c0: 7065 203d 2054 7275 650d 0a20 2020 2069  pe = True..    i
-000073d0: 6620 6973 696e 7374 616e 6365 2863 7572  f isinstance(cur
-000073e0: 7265 6e74 5f63 686f 7264 2c20 6e6f 7465  rent_chord, note
-000073f0: 293a 0d0a 2020 2020 2020 2020 6375 7272  ):..        curr
-00007400: 656e 745f 6368 6f72 6420 3d20 6368 6f72  ent_chord = chor
-00007410: 6428 5b63 7572 7265 6e74 5f63 686f 7264  d([current_chord
-00007420: 5d29 0d0a 2020 2020 656c 6966 2069 7369  ])..    elif isi
-00007430: 6e73 7461 6e63 6528 6375 7272 656e 745f  nstance(current_
-00007440: 6368 6f72 642c 206c 6973 7429 3a0d 0a20  chord, list):.. 
-00007450: 2020 2020 2020 2063 7572 7265 6e74 5f63         current_c
-00007460: 686f 7264 203d 2063 6f6e 6361 7428 6375  hord = concat(cu
-00007470: 7272 656e 745f 6368 6f72 642c 2027 7c27  rrent_chord, '|'
-00007480: 290d 0a20 2020 2069 6620 6973 696e 7374  )..    if isinst
-00007490: 616e 6365 2863 7572 7265 6e74 5f63 686f  ance(current_cho
-000074a0: 7264 2c20 6368 6f72 6429 3a0d 0a20 2020  rd, chord):..   
-000074b0: 2020 2020 2069 735f 7472 6163 6b5f 7479       is_track_ty
-000074c0: 7065 203d 2054 7275 650d 0a20 2020 2020  pe = True..     
-000074d0: 2020 2069 735f 7069 6563 655f 6c69 6b65     is_piece_like
-000074e0: 5f74 7970 6520 3d20 4661 6c73 650d 0a20  _type = False.. 
-000074f0: 2020 2020 2020 2069 6620 696e 7374 7275         if instru
-00007500: 6d65 6e74 2069 7320 4e6f 6e65 3a0d 0a20  ment is None:.. 
-00007510: 2020 2020 2020 2020 2020 2069 6e73 7472             instr
-00007520: 756d 656e 7420 3d20 310d 0a20 2020 2020  ument = 1..     
-00007530: 2020 2063 7572 7265 6e74 5f63 686f 7264     current_chord
-00007540: 203d 2050 280d 0a20 2020 2020 2020 2020   = P(..         
-00007550: 2020 2074 7261 636b 733d 5b63 7572 7265     tracks=[curre
-00007560: 6e74 5f63 686f 7264 5d2c 0d0a 2020 2020  nt_chord],..    
-00007570: 2020 2020 2020 2020 696e 7374 7275 6d65          instrume
-00007580: 6e74 733d 5b69 6e73 7472 756d 656e 745d  nts=[instrument]
-00007590: 2c0d 0a20 2020 2020 2020 2020 2020 2062  ,..            b
-000075a0: 706d 3d62 706d 2c0d 0a20 2020 2020 2020  pm=bpm,..       
-000075b0: 2020 2020 2063 6861 6e6e 656c 733d 5b63       channels=[c
-000075c0: 6861 6e6e 656c 5d2c 0d0a 2020 2020 2020  hannel],..      
-000075d0: 2020 2020 2020 7374 6172 745f 7469 6d65        start_time
-000075e0: 733d 5b0d 0a20 2020 2020 2020 2020 2020  s=[..           
-000075f0: 2020 2020 2063 7572 7265 6e74 5f63 686f       current_cho
-00007600: 7264 2e73 7461 7274 5f74 696d 6520 6966  rd.start_time if
-00007610: 2073 7461 7274 5f74 696d 6520 6973 204e   start_time is N
-00007620: 6f6e 6520 656c 7365 2073 7461 7274 5f74  one else start_t
-00007630: 696d 650d 0a20 2020 2020 2020 2020 2020  ime..           
-00007640: 205d 2c0d 0a20 2020 2020 2020 2020 2020   ],..           
-00007650: 206f 7468 6572 5f6d 6573 7361 6765 733d   other_messages=
-00007660: 6375 7272 656e 745f 6368 6f72 642e 6f74  current_chord.ot
-00007670: 6865 725f 6d65 7373 6167 6573 290d 0a20  her_messages).. 
-00007680: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
-00007690: 6365 2863 7572 7265 6e74 5f63 686f 7264  ce(current_chord
-000076a0: 2c20 7472 6163 6b29 3a0d 0a20 2020 2020  , track):..     
-000076b0: 2020 2069 735f 7472 6163 6b5f 7479 7065     is_track_type
-000076c0: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
-000076d0: 2069 6620 6861 7361 7474 7228 6375 7272   if hasattr(curr
-000076e0: 656e 745f 6368 6f72 642c 2027 6f74 6865  ent_chord, 'othe
-000076f0: 725f 6d65 7373 6167 6573 2729 3a0d 0a20  r_messages'):.. 
-00007700: 2020 2020 2020 2020 2020 206d 7367 203d             msg =
-00007710: 2063 7572 7265 6e74 5f63 686f 7264 2e6f   current_chord.o
-00007720: 7468 6572 5f6d 6573 7361 6765 730d 0a20  ther_messages.. 
-00007730: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00007740: 2020 2020 2020 2020 2020 6d73 6720 3d20            msg = 
-00007750: 6375 7272 656e 745f 6368 6f72 642e 636f  current_chord.co
-00007760: 6e74 656e 742e 6f74 6865 725f 6d65 7373  ntent.other_mess
-00007770: 6167 6573 0d0a 2020 2020 2020 2020 6375  ages..        cu
-00007780: 7272 656e 745f 6368 6f72 6420 3d20 6275  rrent_chord = bu
-00007790: 696c 6428 6375 7272 656e 745f 6368 6f72  ild(current_chor
-000077a0: 642c 2062 706d 3d63 7572 7265 6e74 5f63  d, bpm=current_c
-000077b0: 686f 7264 2e62 706d 290d 0a20 2020 2065  hord.bpm)..    e
-000077c0: 6c69 6620 6973 696e 7374 616e 6365 2863  lif isinstance(c
-000077d0: 7572 7265 6e74 5f63 686f 7264 2c20 6472  urrent_chord, dr
-000077e0: 756d 293a 0d0a 2020 2020 2020 2020 6973  um):..        is
-000077f0: 5f74 7261 636b 5f74 7970 6520 3d20 5472  _track_type = Tr
-00007800: 7565 0d0a 2020 2020 2020 2020 6973 5f70  ue..        is_p
-00007810: 6965 6365 5f6c 696b 655f 7479 7065 203d  iece_like_type =
-00007820: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-00007830: 6966 2068 6173 6174 7472 2863 7572 7265  if hasattr(curre
-00007840: 6e74 5f63 686f 7264 2c20 276f 7468 6572  nt_chord, 'other
-00007850: 5f6d 6573 7361 6765 7327 293a 0d0a 2020  _messages'):..  
-00007860: 2020 2020 2020 2020 2020 6d73 6720 3d20            msg = 
-00007870: 6375 7272 656e 745f 6368 6f72 642e 6f74  current_chord.ot
-00007880: 6865 725f 6d65 7373 6167 6573 0d0a 2020  her_messages..  
-00007890: 2020 2020 2020 6375 7272 656e 745f 6368        current_ch
-000078a0: 6f72 6420 3d20 5028 7472 6163 6b73 3d5b  ord = P(tracks=[
-000078b0: 6375 7272 656e 745f 6368 6f72 642e 6e6f  current_chord.no
-000078c0: 7465 735d 2c0d 0a20 2020 2020 2020 2020  tes],..         
-000078d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000078e0: 2069 6e73 7472 756d 656e 7473 3d5b 6375   instruments=[cu
-000078f0: 7272 656e 745f 6368 6f72 642e 696e 7374  rrent_chord.inst
-00007900: 7275 6d65 6e74 5d2c 0d0a 2020 2020 2020  rument],..      
-00007910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007920: 2020 2020 6270 6d3d 6270 6d2c 0d0a 2020      bpm=bpm,..  
-00007930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007940: 2020 2020 2020 2020 7374 6172 745f 7469          start_ti
-00007950: 6d65 733d 5b0d 0a20 2020 2020 2020 2020  mes=[..         
-00007960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007970: 2020 2020 2063 7572 7265 6e74 5f63 686f       current_cho
-00007980: 7264 2e6e 6f74 6573 2e73 7461 7274 5f74  rd.notes.start_t
-00007990: 696d 650d 0a20 2020 2020 2020 2020 2020  ime..           
-000079a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000079b0: 2020 2069 6620 7374 6172 745f 7469 6d65     if start_time
-000079c0: 2069 7320 4e6f 6e65 2065 6c73 6520 7374   is None else st
-000079d0: 6172 745f 7469 6d65 0d0a 2020 2020 2020  art_time..      
-000079e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000079f0: 2020 2020 5d2c 0d0a 2020 2020 2020 2020      ],..        
-00007a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007a10: 2020 6368 616e 6e65 6c73 3d5b 395d 290d    channels=[9]).
-00007a20: 0a20 2020 2074 7261 636b 5f6e 756d 6265  .    track_numbe
-00007a30: 722c 2073 7461 7274 5f74 696d 6573 2c20  r, start_times, 
-00007a40: 696e 7374 7275 6d65 6e74 732c 2062 706d  instruments, bpm
-00007a50: 2c20 7472 6163 6b73 5f63 6f6e 7465 6e74  , tracks_content
-00007a60: 732c 2074 7261 636b 5f6e 616d 6573 2c20  s, track_names, 
-00007a70: 6368 616e 6e65 6c73 2c20 7061 6e5f 6d73  channels, pan_ms
-00007a80: 672c 2076 6f6c 756d 655f 6d73 6720 3d20  g, volume_msg = 
-00007a90: 5c0d 0a20 2020 2063 7572 7265 6e74 5f63  \..    current_c
-00007aa0: 686f 7264 2e74 7261 636b 5f6e 756d 6265  hord.track_numbe
-00007ab0: 722c 2063 7572 7265 6e74 5f63 686f 7264  r, current_chord
-00007ac0: 2e73 7461 7274 5f74 696d 6573 2c20 6375  .start_times, cu
-00007ad0: 7272 656e 745f 6368 6f72 642e 696e 7374  rrent_chord.inst
-00007ae0: 7275 6d65 6e74 732c 2063 7572 7265 6e74  ruments, current
-00007af0: 5f63 686f 7264 2e62 706d 2c20 6375 7272  _chord.bpm, curr
-00007b00: 656e 745f 6368 6f72 642e 7472 6163 6b73  ent_chord.tracks
-00007b10: 2c20 6375 7272 656e 745f 6368 6f72 642e  , current_chord.
-00007b20: 7472 6163 6b5f 6e61 6d65 732c 2063 7572  track_names, cur
-00007b30: 7265 6e74 5f63 686f 7264 2e63 6861 6e6e  rent_chord.chann
-00007b40: 656c 732c 2063 7572 7265 6e74 5f63 686f  els, current_cho
-00007b50: 7264 2e70 616e 2c20 6375 7272 656e 745f  rd.pan, current_
-00007b60: 6368 6f72 642e 766f 6c75 6d65 0d0a 2020  chord.volume..  
-00007b70: 2020 696e 7374 7275 6d65 6e74 7320 3d20    instruments = 
-00007b80: 5b0d 0a20 2020 2020 2020 2069 2069 6620  [..        i if 
-00007b90: 6973 696e 7374 616e 6365 2869 2c20 696e  isinstance(i, in
-00007ba0: 7429 2065 6c73 6520 6461 7461 6261 7365  t) else database
-00007bb0: 2e49 4e53 5452 554d 454e 5453 5b69 5d0d  .INSTRUMENTS[i].
-00007bc0: 0a20 2020 2020 2020 2066 6f72 2069 2069  .        for i i
-00007bd0: 6e20 696e 7374 7275 6d65 6e74 730d 0a20  n instruments.. 
-00007be0: 2020 205d 0d0a 2020 2020 6966 2074 6963     ]..    if tic
-00007bf0: 6b73 5f70 6572 5f62 6561 7420 6973 204e  ks_per_beat is N
-00007c00: 6f6e 653a 0d0a 2020 2020 2020 2020 6966  one:..        if
-00007c10: 2063 7572 7265 6e74 5f63 686f 7264 2e74   current_chord.t
-00007c20: 6963 6b73 5f70 6572 5f62 6561 7420 6973  icks_per_beat is
-00007c30: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-00007c40: 2020 2020 2020 2020 7469 636b 735f 7065          ticks_pe
-00007c50: 725f 6265 6174 203d 2063 7572 7265 6e74  r_beat = current
-00007c60: 5f63 686f 7264 2e74 6963 6b73 5f70 6572  _chord.ticks_per
-00007c70: 5f62 6561 740d 0a20 2020 2020 2020 2065  _beat..        e
-00007c80: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00007c90: 2020 7469 636b 735f 7065 725f 6265 6174    ticks_per_beat
-00007ca0: 203d 2039 3630 0d0a 2020 2020 6375 7272   = 960..    curr
-00007cb0: 656e 745f 6d69 6469 203d 206d 6964 6f2e  ent_midi = mido.
-00007cc0: 4d69 6469 4669 6c65 2874 6963 6b73 5f70  MidiFile(ticks_p
-00007cd0: 6572 5f62 6561 743d 7469 636b 735f 7065  er_beat=ticks_pe
-00007ce0: 725f 6265 6174 2c20 2a2a 6d69 6469 5f61  r_beat, **midi_a
-00007cf0: 7267 7329 0d0a 2020 2020 6375 7272 656e  rgs)..    curren
-00007d00: 745f 6d69 6469 2e74 7261 636b 732e 6578  t_midi.tracks.ex
-00007d10: 7465 6e64 285b 6d69 646f 2e4d 6964 6954  tend([mido.MidiT
-00007d20: 7261 636b 2829 2066 6f72 2069 2069 6e20  rack() for i in 
-00007d30: 7261 6e67 6528 7472 6163 6b5f 6e75 6d62  range(track_numb
-00007d40: 6572 295d 290d 0a20 2020 2069 6620 6e6f  er)])..    if no
-00007d50: 7420 6967 6e6f 7265 5f62 706d 3a0d 0a20  t ignore_bpm:.. 
-00007d60: 2020 2020 2020 2063 7572 7265 6e74 5f6d         current_m
-00007d70: 6964 692e 7472 6163 6b73 5b30 5d2e 6170  idi.tracks[0].ap
-00007d80: 7065 6e64 280d 0a20 2020 2020 2020 2020  pend(..         
-00007d90: 2020 206d 6964 6f2e 4d65 7461 4d65 7373     mido.MetaMess
-00007da0: 6167 6528 2773 6574 5f74 656d 706f 272c  age('set_tempo',
-00007db0: 2074 656d 706f 3d6d 6964 6f2e 6270 6d32   tempo=mido.bpm2
-00007dc0: 7465 6d70 6f28 6270 6d29 2c20 7469 6d65  tempo(bpm), time
-00007dd0: 3d30 2929 0d0a 2020 2020 696e 7465 7276  =0))..    interv
-00007de0: 616c 5f75 6e69 7420 3d20 7469 636b 735f  al_unit = ticks_
-00007df0: 7065 725f 6265 6174 202a 2034 0d0a 2020  per_beat * 4..  
-00007e00: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
-00007e10: 2874 7261 636b 5f6e 756d 6265 7229 3a0d  (track_number):.
-00007e20: 0a20 2020 2020 2020 2069 6620 6368 616e  .        if chan
-00007e30: 6e65 6c73 3a0d 0a20 2020 2020 2020 2020  nels:..         
-00007e40: 2020 2063 7572 7265 6e74 5f63 6861 6e6e     current_chann
-00007e50: 656c 203d 2063 6861 6e6e 656c 735b 695d  el = channels[i]
-00007e60: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-00007e70: 0a20 2020 2020 2020 2020 2020 2063 7572  .            cur
-00007e80: 7265 6e74 5f63 6861 6e6e 656c 203d 2069  rent_channel = i
-00007e90: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-00007ea0: 2069 676e 6f72 655f 696e 7374 7275 6d65   ignore_instrume
-00007eb0: 6e74 3a0d 0a20 2020 2020 2020 2020 2020  nt:..           
-00007ec0: 2063 7572 7265 6e74 5f70 726f 6772 616d   current_program
-00007ed0: 5f63 6861 6e67 655f 6576 656e 7420 3d20  _change_event = 
-00007ee0: 6d69 646f 2e4d 6573 7361 6765 280d 0a20  mido.Message(.. 
-00007ef0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00007f00: 7072 6f67 7261 6d5f 6368 616e 6765 272c  program_change',
-00007f10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00007f20: 2020 6368 616e 6e65 6c3d 6375 7272 656e    channel=curren
-00007f30: 745f 6368 616e 6e65 6c2c 0d0a 2020 2020  t_channel,..    
-00007f40: 2020 2020 2020 2020 2020 2020 7469 6d65              time
-00007f50: 3d30 2c0d 0a20 2020 2020 2020 2020 2020  =0,..           
-00007f60: 2020 2020 2070 726f 6772 616d 3d69 6e73       program=ins
-00007f70: 7472 756d 656e 7473 5b69 5d20 2d20 3129  truments[i] - 1)
-00007f80: 0d0a 2020 2020 2020 2020 2020 2020 6375  ..            cu
-00007f90: 7272 656e 745f 6d69 6469 2e74 7261 636b  rrent_midi.track
-00007fa0: 735b 695d 2e61 7070 656e 6428 6375 7272  s[i].append(curr
-00007fb0: 656e 745f 7072 6f67 7261 6d5f 6368 616e  ent_program_chan
-00007fc0: 6765 5f65 7665 6e74 290d 0a20 2020 2020  ge_event)..     
-00007fd0: 2020 2069 6620 6e6f 7420 6967 6e6f 7265     if not ignore
-00007fe0: 5f74 7261 636b 5f6e 616d 6573 2061 6e64  _track_names and
-00007ff0: 2074 7261 636b 5f6e 616d 6573 3a0d 0a20   track_names:.. 
-00008000: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-00008010: 6e74 5f6d 6964 692e 7472 6163 6b73 5b69  nt_midi.tracks[i
-00008020: 5d2e 6170 7065 6e64 280d 0a20 2020 2020  ].append(..     
-00008030: 2020 2020 2020 2020 2020 206d 6964 6f2e             mido.
-00008040: 4d65 7461 4d65 7373 6167 6528 2774 7261  MetaMessage('tra
-00008050: 636b 5f6e 616d 6527 2c20 7469 6d65 3d30  ck_name', time=0
-00008060: 2c20 6e61 6d65 3d74 7261 636b 5f6e 616d  , name=track_nam
-00008070: 6573 5b69 5d29 290d 0a0d 0a20 2020 2020  es[i]))....     
-00008080: 2020 2063 7572 7265 6e74 5f70 616e 5f6d     current_pan_m
-00008090: 7367 203d 2070 616e 5f6d 7367 5b69 5d0d  sg = pan_msg[i].
-000080a0: 0a20 2020 2020 2020 2069 6620 6375 7272  .        if curr
-000080b0: 656e 745f 7061 6e5f 6d73 673a 0d0a 2020  ent_pan_msg:..  
-000080c0: 2020 2020 2020 2020 2020 666f 7220 6561            for ea
-000080d0: 6368 2069 6e20 6375 7272 656e 745f 7061  ch in current_pa
-000080e0: 6e5f 6d73 673a 0d0a 2020 2020 2020 2020  n_msg:..        
-000080f0: 2020 2020 2020 2020 6375 7272 656e 745f          current_
-00008100: 7061 6e5f 7472 6163 6b20 3d20 6920 6966  pan_track = i if
-00008110: 2065 6163 682e 7472 6163 6b20 6973 204e   each.track is N
-00008120: 6f6e 6520 656c 7365 2065 6163 682e 7472  one else each.tr
-00008130: 6163 6b0d 0a20 2020 2020 2020 2020 2020  ack..           
-00008140: 2020 2020 2063 7572 7265 6e74 5f70 616e       current_pan
-00008150: 5f63 6861 6e6e 656c 203d 2063 7572 7265  _channel = curre
-00008160: 6e74 5f63 6861 6e6e 656c 2069 6620 6561  nt_channel if ea
-00008170: 6368 2e63 6861 6e6e 656c 2069 7320 4e6f  ch.channel is No
-00008180: 6e65 2065 6c73 6520 6561 6368 2e63 6861  ne else each.cha
-00008190: 6e6e 656c 0d0a 2020 2020 2020 2020 2020  nnel..          
-000081a0: 2020 2020 2020 6375 7272 656e 745f 6d69        current_mi
-000081b0: 6469 2e74 7261 636b 735b 0d0a 2020 2020  di.tracks[..    
-000081c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000081d0: 6375 7272 656e 745f 7061 6e5f 7472 6163  current_pan_trac
-000081e0: 6b20 6966 206e 6f74 2069 735f 7472 6163  k if not is_trac
-000081f0: 6b5f 7479 7065 2065 6c73 6520 305d 2e61  k_type else 0].a
-00008200: 7070 656e 6428 0d0a 2020 2020 2020 2020  ppend(..        
-00008210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008220: 6d69 646f 2e4d 6573 7361 6765 2827 636f  mido.Message('co
-00008230: 6e74 726f 6c5f 6368 616e 6765 272c 0d0a  ntrol_change',..
-00008240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008260: 2020 2020 2063 6861 6e6e 656c 3d63 7572       channel=cur
-00008270: 7265 6e74 5f70 616e 5f63 6861 6e6e 656c  rent_pan_channel
-00008280: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00008290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000082a0: 2020 2020 2020 2020 7469 6d65 3d69 6e74          time=int
-000082b0: 2865 6163 682e 7374 6172 745f 7469 6d65  (each.start_time
-000082c0: 202a 2069 6e74 6572 7661 6c5f 756e 6974   * interval_unit
-000082d0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
-000082e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000082f0: 2020 2020 2020 2020 2063 6f6e 7472 6f6c           control
-00008300: 3d31 302c 0d0a 2020 2020 2020 2020 2020  =10,..          
-00008310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008320: 2020 2020 2020 2020 2020 2076 616c 7565             value
-00008330: 3d65 6163 682e 7661 6c75 6529 290d 0a20  =each.value)).. 
-00008340: 2020 2020 2020 2063 7572 7265 6e74 5f76         current_v
-00008350: 6f6c 756d 655f 6d73 6720 3d20 766f 6c75  olume_msg = volu
-00008360: 6d65 5f6d 7367 5b69 5d0d 0a20 2020 2020  me_msg[i]..     
-00008370: 2020 2069 6620 6375 7272 656e 745f 766f     if current_vo
-00008380: 6c75 6d65 5f6d 7367 3a0d 0a20 2020 2020  lume_msg:..     
-00008390: 2020 2020 2020 2066 6f72 2065 6163 6820         for each 
-000083a0: 696e 2063 7572 7265 6e74 5f76 6f6c 756d  in current_volum
-000083b0: 655f 6d73 673a 0d0a 2020 2020 2020 2020  e_msg:..        
-000083c0: 2020 2020 2020 2020 6375 7272 656e 745f          current_
-000083d0: 766f 6c75 6d65 5f63 6861 6e6e 656c 203d  volume_channel =
-000083e0: 2063 7572 7265 6e74 5f63 6861 6e6e 656c   current_channel
-000083f0: 2069 6620 6561 6368 2e63 6861 6e6e 656c   if each.channel
-00008400: 2069 7320 4e6f 6e65 2065 6c73 6520 6561   is None else ea
-00008410: 6368 2e63 6861 6e6e 656c 0d0a 2020 2020  ch.channel..    
-00008420: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-00008430: 656e 745f 766f 6c75 6d65 5f74 7261 636b  ent_volume_track
-00008440: 203d 2069 2069 6620 6561 6368 2e74 7261   = i if each.tra
-00008450: 636b 2069 7320 4e6f 6e65 2065 6c73 6520  ck is None else 
-00008460: 6561 6368 2e74 7261 636b 0d0a 2020 2020  each.track..    
-00008470: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-00008480: 656e 745f 6d69 6469 2e74 7261 636b 735b  ent_midi.tracks[
-00008490: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000084a0: 2020 2020 2020 6375 7272 656e 745f 766f        current_vo
-000084b0: 6c75 6d65 5f74 7261 636b 2069 6620 6e6f  lume_track if no
-000084c0: 7420 6973 5f74 7261 636b 5f74 7970 6520  t is_track_type 
-000084d0: 656c 7365 2030 5d2e 6170 7065 6e64 280d  else 0].append(.
-000084e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000084f0: 2020 2020 2020 2020 206d 6964 6f2e 4d65           mido.Me
-00008500: 7373 6167 6528 2763 6f6e 7472 6f6c 5f63  ssage('control_c
-00008510: 6861 6e67 6527 2c0d 0a20 2020 2020 2020  hange',..       
-00008520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008530: 2020 2020 2020 2020 2020 2020 2020 6368                ch
-00008540: 616e 6e65 6c3d 6375 7272 656e 745f 766f  annel=current_vo
-00008550: 6c75 6d65 5f63 6861 6e6e 656c 2c0d 0a20  lume_channel,.. 
-00008560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008580: 2020 2020 7469 6d65 3d69 6e74 2865 6163      time=int(eac
-00008590: 682e 7374 6172 745f 7469 6d65 202a 2069  h.start_time * i
-000085a0: 6e74 6572 7661 6c5f 756e 6974 292c 0d0a  nterval_unit),..
-000085b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000085c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000085d0: 2020 2020 2063 6f6e 7472 6f6c 3d37 2c0d       control=7,.
-000085e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000085f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008600: 2020 2020 2020 7661 6c75 653d 6561 6368        value=each
-00008610: 2e76 616c 7565 2929 0d0a 0d0a 2020 2020  .value))....    
-00008620: 2020 2020 636f 6e74 656e 7420 3d20 7472      content = tr
-00008630: 6163 6b73 5f63 6f6e 7465 6e74 735b 695d  acks_contents[i]
-00008640: 0d0a 2020 2020 2020 2020 636f 6e74 656e  ..        conten
-00008650: 745f 6e6f 7465 7320 3d20 636f 6e74 656e  t_notes = conten
-00008660: 742e 6e6f 7465 730d 0a20 2020 2020 2020  t.notes..       
-00008670: 2063 6f6e 7465 6e74 5f69 6e74 6572 7661   content_interva
-00008680: 6c73 203d 2063 6f6e 7465 6e74 2e69 6e74  ls = content.int
-00008690: 6572 7661 6c0d 0a20 2020 2020 2020 2063  erval..        c
-000086a0: 7572 7265 6e74 5f73 7461 7274 5f74 696d  urrent_start_tim
-000086b0: 6520 3d20 7374 6172 745f 7469 6d65 735b  e = start_times[
-000086c0: 695d 0d0a 2020 2020 2020 2020 6966 2069  i]..        if i
-000086d0: 735f 7069 6563 655f 6c69 6b65 5f74 7970  s_piece_like_typ
-000086e0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-000086f0: 6375 7272 656e 745f 7374 6172 745f 7469  current_start_ti
-00008700: 6d65 202b 3d20 636f 6e74 656e 742e 7374  me += content.st
-00008710: 6172 745f 7469 6d65 0d0a 2020 2020 2020  art_time..      
-00008720: 2020 6375 7272 656e 745f 7374 6172 745f    current_start_
-00008730: 7469 6d65 203d 2063 7572 7265 6e74 5f73  time = current_s
-00008740: 7461 7274 5f74 696d 6520 2a20 696e 7465  tart_time * inte
-00008750: 7276 616c 5f75 6e69 740d 0a20 2020 2020  rval_unit..     
-00008760: 2020 2066 6f72 206a 2069 6e20 7261 6e67     for j in rang
-00008770: 6528 6c65 6e28 636f 6e74 656e 7429 293a  e(len(content)):
-00008780: 0d0a 2020 2020 2020 2020 2020 2020 6375  ..            cu
-00008790: 7272 656e 745f 6e6f 7465 203d 2063 6f6e  rrent_note = con
-000087a0: 7465 6e74 5f6e 6f74 6573 5b6a 5d0d 0a20  tent_notes[j].. 
-000087b0: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-000087c0: 6e74 5f6e 6f74 655f 6f6e 5f6d 6573 7361  nt_note_on_messa
-000087d0: 6765 203d 206d 6964 6f2e 4d65 7373 6167  ge = mido.Messag
-000087e0: 6528 0d0a 2020 2020 2020 2020 2020 2020  e(..            
-000087f0: 2020 2020 276e 6f74 655f 6f6e 272c 0d0a      'note_on',..
-00008800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008810: 7469 6d65 3d69 6e74 2863 7572 7265 6e74  time=int(current
-00008820: 5f73 7461 7274 5f74 696d 6529 2c0d 0a20  _start_time),.. 
-00008830: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00008840: 6861 6e6e 656c 3d63 7572 7265 6e74 5f63  hannel=current_c
-00008850: 6861 6e6e 656c 0d0a 2020 2020 2020 2020  hannel..        
-00008860: 2020 2020 2020 2020 6966 2063 7572 7265          if curre
-00008870: 6e74 5f6e 6f74 652e 6368 616e 6e65 6c20  nt_note.channel 
-00008880: 6973 204e 6f6e 6520 656c 7365 2063 7572  is None else cur
-00008890: 7265 6e74 5f6e 6f74 652e 6368 616e 6e65  rent_note.channe
-000088a0: 6c2c 0d0a 2020 2020 2020 2020 2020 2020  l,..            
-000088b0: 2020 2020 6e6f 7465 3d63 7572 7265 6e74      note=current
-000088c0: 5f6e 6f74 652e 6465 6772 6565 2c0d 0a20  _note.degree,.. 
-000088d0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-000088e0: 656c 6f63 6974 793d 6375 7272 656e 745f  elocity=current_
-000088f0: 6e6f 7465 2e76 6f6c 756d 6529 0d0a 2020  note.volume)..  
-00008900: 2020 2020 2020 2020 2020 6375 7272 656e            curren
-00008910: 745f 6e6f 7465 5f6f 6666 5f6d 6573 7361  t_note_off_messa
-00008920: 6765 203d 206d 6964 6f2e 4d65 7373 6167  ge = mido.Messag
-00008930: 6528 0d0a 2020 2020 2020 2020 2020 2020  e(..            
-00008940: 2020 2020 276e 6f74 655f 6f66 6627 2c0d      'note_off',.
-00008950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008960: 2074 696d 653d 696e 7428 6375 7272 656e   time=int(curren
-00008970: 745f 7374 6172 745f 7469 6d65 202b 0d0a  t_start_time +..
-00008980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008990: 2020 2020 2020 2020 2063 7572 7265 6e74           current
-000089a0: 5f6e 6f74 652e 6475 7261 7469 6f6e 202a  _note.duration *
-000089b0: 2069 6e74 6572 7661 6c5f 756e 6974 292c   interval_unit),
-000089c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000089d0: 2020 6368 616e 6e65 6c3d 6375 7272 656e    channel=curren
-000089e0: 745f 6368 616e 6e65 6c0d 0a20 2020 2020  t_channel..     
-000089f0: 2020 2020 2020 2020 2020 2069 6620 6375             if cu
-00008a00: 7272 656e 745f 6e6f 7465 2e63 6861 6e6e  rrent_note.chann
-00008a10: 656c 2069 7320 4e6f 6e65 2065 6c73 6520  el is None else 
-00008a20: 6375 7272 656e 745f 6e6f 7465 2e63 6861  current_note.cha
-00008a30: 6e6e 656c 2c0d 0a20 2020 2020 2020 2020  nnel,..         
-00008a40: 2020 2020 2020 206e 6f74 653d 6375 7272         note=curr
-00008a50: 656e 745f 6e6f 7465 2e64 6567 7265 652c  ent_note.degree,
-00008a60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00008a70: 2020 7665 6c6f 6369 7479 3d63 7572 7265    velocity=curre
-00008a80: 6e74 5f6e 6f74 652e 766f 6c75 6d65 290d  nt_note.volume).
-00008a90: 0a20 2020 2020 2020 2020 2020 2063 7572  .            cur
-00008aa0: 7265 6e74 5f6d 6964 692e 7472 6163 6b73  rent_midi.tracks
-00008ab0: 5b69 5d2e 6170 7065 6e64 2863 7572 7265  [i].append(curre
-00008ac0: 6e74 5f6e 6f74 655f 6f6e 5f6d 6573 7361  nt_note_on_messa
-00008ad0: 6765 290d 0a20 2020 2020 2020 2020 2020  ge)..           
-00008ae0: 2063 7572 7265 6e74 5f6d 6964 692e 7472   current_midi.tr
-00008af0: 6163 6b73 5b69 5d2e 6170 7065 6e64 2863  acks[i].append(c
-00008b00: 7572 7265 6e74 5f6e 6f74 655f 6f66 665f  urrent_note_off_
-00008b10: 6d65 7373 6167 6529 0d0a 2020 2020 2020  message)..      
-00008b20: 2020 2020 2020 6375 7272 656e 745f 7374        current_st
-00008b30: 6172 745f 7469 6d65 202b 3d20 636f 6e74  art_time += cont
-00008b40: 656e 745f 696e 7465 7276 616c 735b 6a5d  ent_intervals[j]
-00008b50: 202a 2069 6e74 6572 7661 6c5f 756e 6974   * interval_unit
-00008b60: 0d0a 2020 2020 2020 2020 666f 7220 6561  ..        for ea
-00008b70: 6368 2069 6e20 636f 6e74 656e 742e 7465  ch in content.te
-00008b80: 6d70 6f73 3a0d 0a20 2020 2020 2020 2020  mpos:..         
-00008b90: 2020 2069 6620 6561 6368 2e73 7461 7274     if each.start
-00008ba0: 5f74 696d 6520 3c20 303a 0d0a 2020 2020  _time < 0:..    
-00008bb0: 2020 2020 2020 2020 2020 2020 7465 6d70              temp
-00008bc0: 6f5f 6368 616e 6765 5f74 696d 6520 3d20  o_change_time = 
-00008bd0: 300d 0a20 2020 2020 2020 2020 2020 2065  0..            e
-00008be0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00008bf0: 2020 2020 2020 7465 6d70 6f5f 6368 616e        tempo_chan
-00008c00: 6765 5f74 696d 6520 3d20 6561 6368 2e73  ge_time = each.s
-00008c10: 7461 7274 5f74 696d 6520 2a20 696e 7465  tart_time * inte
-00008c20: 7276 616c 5f75 6e69 740d 0a20 2020 2020  rval_unit..     
-00008c30: 2020 2020 2020 2063 7572 7265 6e74 5f6d         current_m
-00008c40: 6964 692e 7472 6163 6b73 5b30 5d2e 6170  idi.tracks[0].ap
-00008c50: 7065 6e64 280d 0a20 2020 2020 2020 2020  pend(..         
-00008c60: 2020 2020 2020 206d 6964 6f2e 4d65 7461         mido.Meta
-00008c70: 4d65 7373 6167 6528 2773 6574 5f74 656d  Message('set_tem
-00008c80: 706f 272c 0d0a 2020 2020 2020 2020 2020  po',..          
-00008c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ca0: 2020 2020 2020 2074 696d 653d 696e 7428         time=int(
-00008cb0: 7465 6d70 6f5f 6368 616e 6765 5f74 696d  tempo_change_tim
-00008cc0: 6529 2c0d 0a20 2020 2020 2020 2020 2020  e),..           
-00008cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ce0: 2020 2020 2020 7465 6d70 6f3d 6d69 646f        tempo=mido
-00008cf0: 2e62 706d 3274 656d 706f 2865 6163 682e  .bpm2tempo(each.
-00008d00: 6270 6d29 2929 0d0a 2020 2020 2020 2020  bpm)))..        
-00008d10: 666f 7220 6561 6368 2069 6e20 636f 6e74  for each in cont
-00008d20: 656e 742e 7069 7463 685f 6265 6e64 733a  ent.pitch_bends:
-00008d30: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00008d40: 2065 6163 682e 7374 6172 745f 7469 6d65   each.start_time
-00008d50: 203c 2030 3a0d 0a20 2020 2020 2020 2020   < 0:..         
-00008d60: 2020 2020 2020 2070 6974 6368 5f62 656e         pitch_ben
-00008d70: 645f 7469 6d65 203d 2030 0d0a 2020 2020  d_time = 0..    
-00008d80: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00008d90: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00008da0: 6974 6368 5f62 656e 645f 7469 6d65 203d  itch_bend_time =
-00008db0: 2065 6163 682e 7374 6172 745f 7469 6d65   each.start_time
-00008dc0: 202a 2069 6e74 6572 7661 6c5f 756e 6974   * interval_unit
-00008dd0: 0d0a 2020 2020 2020 2020 2020 2020 7069  ..            pi
-00008de0: 7463 685f 6265 6e64 5f74 7261 636b 203d  tch_bend_track =
-00008df0: 2069 2069 6620 6561 6368 2e74 7261 636b   i if each.track
-00008e00: 2069 7320 4e6f 6e65 2065 6c73 6520 6561   is None else ea
-00008e10: 6368 2e74 7261 636b 0d0a 2020 2020 2020  ch.track..      
-00008e20: 2020 2020 2020 7069 7463 685f 6265 6e64        pitch_bend
-00008e30: 5f63 6861 6e6e 656c 203d 2063 7572 7265  _channel = curre
-00008e40: 6e74 5f63 6861 6e6e 656c 2069 6620 6561  nt_channel if ea
-00008e50: 6368 2e63 6861 6e6e 656c 2069 7320 4e6f  ch.channel is No
-00008e60: 6e65 2065 6c73 6520 6561 6368 2e63 6861  ne else each.cha
-00008e70: 6e6e 656c 0d0a 2020 2020 2020 2020 2020  nnel..          
-00008e80: 2020 6375 7272 656e 745f 6d69 6469 2e74    current_midi.t
-00008e90: 7261 636b 735b 0d0a 2020 2020 2020 2020  racks[..        
-00008ea0: 2020 2020 2020 2020 7069 7463 685f 6265          pitch_be
-00008eb0: 6e64 5f74 7261 636b 2069 6620 6e6f 7420  nd_track if not 
-00008ec0: 6973 5f74 7261 636b 5f74 7970 6520 656c  is_track_type el
-00008ed0: 7365 2030 5d2e 6170 7065 6e64 280d 0a20  se 0].append(.. 
-00008ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ef0: 2020 206d 6964 6f2e 4d65 7373 6167 6528     mido.Message(
-00008f00: 2770 6974 6368 7768 6565 6c27 2c0d 0a20  'pitchwheel',.. 
-00008f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f30: 7469 6d65 3d69 6e74 2870 6974 6368 5f62  time=int(pitch_b
-00008f40: 656e 645f 7469 6d65 292c 0d0a 2020 2020  end_time),..    
-00008f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f60: 2020 2020 2020 2020 2020 2020 2063 6861               cha
-00008f70: 6e6e 656c 3d70 6974 6368 5f62 656e 645f  nnel=pitch_bend_
-00008f80: 6368 616e 6e65 6c2c 0d0a 2020 2020 2020  channel,..      
-00008f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008fa0: 2020 2020 2020 2020 2020 2070 6974 6368             pitch
-00008fb0: 3d65 6163 682e 7661 6c75 6529 290d 0a0d  =each.value))...
-00008fc0: 0a20 2020 2069 6620 6e6f 7420 6e6f 6d73  .    if not noms
-00008fd0: 673a 0d0a 2020 2020 2020 2020 6966 2063  g:..        if c
-00008fe0: 7572 7265 6e74 5f63 686f 7264 2e6f 7468  urrent_chord.oth
-00008ff0: 6572 5f6d 6573 7361 6765 733a 0d0a 2020  er_messages:..  
-00009000: 2020 2020 2020 2020 2020 5f61 6464 5f6f            _add_o
-00009010: 7468 6572 5f6d 6573 7361 6765 7328 0d0a  ther_messages(..
-00009020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009030: 6375 7272 656e 745f 6d69 6469 3d63 7572  current_midi=cur
-00009040: 7265 6e74 5f6d 6964 692c 0d0a 2020 2020  rent_midi,..    
-00009050: 2020 2020 2020 2020 2020 2020 6f74 6865              othe
-00009060: 725f 6d65 7373 6167 6573 3d63 7572 7265  r_messages=curre
-00009070: 6e74 5f63 686f 7264 2e6f 7468 6572 5f6d  nt_chord.other_m
-00009080: 6573 7361 6765 732c 0d0a 2020 2020 2020  essages,..      
-00009090: 2020 2020 2020 2020 2020 7772 6974 655f            write_
-000090a0: 7479 7065 3d27 7069 6563 6527 2069 6620  type='piece' if 
-000090b0: 6e6f 7420 6973 5f74 7261 636b 5f74 7970  not is_track_typ
-000090c0: 6520 656c 7365 2027 7472 6163 6b27 2c0d  e else 'track',.
-000090d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000090e0: 2069 6e74 6572 7661 6c5f 756e 6974 3d69   interval_unit=i
-000090f0: 6e74 6572 7661 6c5f 756e 6974 290d 0a20  nterval_unit).. 
-00009100: 2020 2020 2020 2065 6c69 6620 6d73 673a         elif msg:
-00009110: 0d0a 2020 2020 2020 2020 2020 2020 5f61  ..            _a
-00009120: 6464 5f6f 7468 6572 5f6d 6573 7361 6765  dd_other_message
-00009130: 7328 0d0a 2020 2020 2020 2020 2020 2020  s(..            
-00009140: 2020 2020 6375 7272 656e 745f 6d69 6469      current_midi
-00009150: 3d63 7572 7265 6e74 5f6d 6964 692c 0d0a  =current_midi,..
-00009160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009170: 6f74 6865 725f 6d65 7373 6167 6573 3d6d  other_messages=m
-00009180: 7367 2c0d 0a20 2020 2020 2020 2020 2020  sg,..           
-00009190: 2020 2020 2077 7269 7465 5f74 7970 653d       write_type=
-000091a0: 2770 6965 6365 2720 6966 206e 6f74 2069  'piece' if not i
-000091b0: 735f 7472 6163 6b5f 7479 7065 2065 6c73  s_track_type els
-000091c0: 6520 2774 7261 636b 272c 0d0a 2020 2020  e 'track',..    
-000091d0: 2020 2020 2020 2020 2020 2020 696e 7465              inte
-000091e0: 7276 616c 5f75 6e69 743d 696e 7465 7276  rval_unit=interv
-000091f0: 616c 5f75 6e69 7429 0d0a 2020 2020 666f  al_unit)..    fo
-00009200: 7220 692c 2065 6163 6820 696e 2065 6e75  r i, each in enu
-00009210: 6d65 7261 7465 2863 7572 7265 6e74 5f6d  merate(current_m
-00009220: 6964 692e 7472 6163 6b73 293a 0d0a 2020  idi.tracks):..  
-00009230: 2020 2020 2020 7265 7365 745f 636f 6e74        reset_cont
-00009240: 726f 6c5f 6368 616e 6765 5f6c 6973 7420  rol_change_list 
-00009250: 3d20 5b31 3230 2c20 3132 312c 2031 3233  = [120, 121, 123
-00009260: 5d0d 0a20 2020 2020 2020 2065 6163 682e  ]..        each.
-00009270: 736f 7274 286b 6579 3d6c 616d 6264 6120  sort(key=lambda 
-00009280: 733a 2028 732e 7469 6d65 2c20 6e6f 7420  s: (s.time, not 
-00009290: 2873 2e69 735f 6363 2829 2061 6e64 2073  (s.is_cc() and s
-000092a0: 2e63 6f6e 7472 6f6c 2069 6e0d 0a20 2020  .control in..   
-000092b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000092c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000092d0: 2020 2020 2020 2020 2020 2072 6573 6574             reset
-000092e0: 5f63 6f6e 7472 6f6c 5f63 6861 6e67 655f  _control_change_
-000092f0: 6c69 7374 2929 290d 0a20 2020 2020 2020  list)))..       
-00009300: 2063 7572 7265 6e74 5f72 656c 6174 6976   current_relativ
-00009310: 655f 7469 6d65 203d 205b 6561 6368 5b30  e_time = [each[0
-00009320: 5d2e 7469 6d65 5d20 2b20 5b0d 0a20 2020  ].time] + [..   
-00009330: 2020 2020 2020 2020 2065 6163 685b 6a5d           each[j]
-00009340: 2e74 696d 6520 2d20 6561 6368 5b6a 202d  .time - each[j -
-00009350: 2031 5d2e 7469 6d65 2066 6f72 206a 2069   1].time for j i
-00009360: 6e20 7261 6e67 6528 312c 206c 656e 2865  n range(1, len(e
-00009370: 6163 6829 290d 0a20 2020 2020 2020 205d  ach))..        ]
-00009380: 0d0a 2020 2020 2020 2020 666f 7220 6b2c  ..        for k,
-00009390: 2065 6163 685f 6d73 6720 696e 2065 6e75   each_msg in enu
-000093a0: 6d65 7261 7465 2865 6163 6829 3a0d 0a20  merate(each):.. 
-000093b0: 2020 2020 2020 2020 2020 2065 6163 685f             each_
-000093c0: 6d73 672e 7469 6d65 203d 2063 7572 7265  msg.time = curre
-000093d0: 6e74 5f72 656c 6174 6976 655f 7469 6d65  nt_relative_time
-000093e0: 5b6b 5d0d 0a20 2020 2069 6620 7361 7665  [k]..    if save
-000093f0: 5f61 735f 6669 6c65 3a0d 0a20 2020 2020  _as_file:..     
-00009400: 2020 2063 7572 7265 6e74 5f6d 6964 692e     current_midi.
-00009410: 7361 7665 286e 616d 6529 0d0a 2020 2020  save(name)..    
-00009420: 656c 7365 3a0d 0a20 2020 2020 2020 2063  else:..        c
-00009430: 7572 7265 6e74 5f69 6f20 3d20 4279 7465  urrent_io = Byte
-00009440: 7349 4f28 290d 0a20 2020 2020 2020 2063  sIO()..        c
-00009450: 7572 7265 6e74 5f6d 6964 692e 7361 7665  urrent_midi.save
-00009460: 2866 696c 653d 6375 7272 656e 745f 696f  (file=current_io
-00009470: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-00009480: 6e20 6375 7272 656e 745f 696f 0d0a 0d0a  n current_io....
-00009490: 0d0a 6465 6620 5f61 6464 5f6f 7468 6572  ..def _add_other
-000094a0: 5f6d 6573 7361 6765 7328 6375 7272 656e  _messages(curren
-000094b0: 745f 6d69 6469 2c0d 0a20 2020 2020 2020  t_midi,..       
-000094c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000094d0: 206f 7468 6572 5f6d 6573 7361 6765 732c   other_messages,
-000094e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000094f0: 2020 2020 2020 2020 2020 7772 6974 655f            write_
-00009500: 7479 7065 3d27 7069 6563 6527 2c0d 0a20  type='piece',.. 
-00009510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009520: 2020 2020 2020 2069 6e74 6572 7661 6c5f         interval_
-00009530: 756e 6974 3d4e 6f6e 6529 3a0d 0a20 2020  unit=None):..   
-00009540: 2066 6f72 2065 6163 6820 696e 206f 7468   for each in oth
-00009550: 6572 5f6d 6573 7361 6765 733a 0d0a 2020  er_messages:..  
-00009560: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
-00009570: 2020 2020 2020 2020 6375 7272 656e 745f          current_
-00009580: 7469 6d65 203d 2069 6e74 2865 6163 682e  time = int(each.
-00009590: 7374 6172 745f 7469 6d65 202a 2069 6e74  start_time * int
-000095a0: 6572 7661 6c5f 756e 6974 290d 0a20 2020  erval_unit)..   
-000095b0: 2020 2020 2020 2020 2063 7572 7265 6e74           current
-000095c0: 5f61 7474 7269 6275 7465 7320 3d20 7b0d  _attributes = {.
-000095d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000095e0: 2069 3a20 6a0d 0a20 2020 2020 2020 2020   i: j..         
-000095f0: 2020 2020 2020 2066 6f72 2069 2c20 6a20         for i, j 
-00009600: 696e 2076 6172 7328 6561 6368 292e 6974  in vars(each).it
-00009610: 656d 7328 290d 0a20 2020 2020 2020 2020  ems()..         
-00009620: 2020 2020 2020 2069 6620 6920 6e6f 7420         if i not 
-00009630: 696e 205b 2773 7461 7274 5f74 696d 6527  in ['start_time'
-00009640: 2c20 2774 7261 636b 272c 2027 6973 5f6d  , 'track', 'is_m
-00009650: 6574 6127 5d0d 0a20 2020 2020 2020 2020  eta']..         
-00009660: 2020 207d 0d0a 2020 2020 2020 2020 2020     }..          
-00009670: 2020 6966 206e 6f74 2065 6163 682e 6973    if not each.is
-00009680: 5f6d 6574 613a 0d0a 2020 2020 2020 2020  _meta:..        
-00009690: 2020 2020 2020 2020 6375 7272 656e 745f          current_
-000096a0: 6d65 7373 6167 6520 3d20 6d69 646f 2e4d  message = mido.M
-000096b0: 6573 7361 6765 2874 696d 653d 6375 7272  essage(time=curr
-000096c0: 656e 745f 7469 6d65 2c0d 0a20 2020 2020  ent_time,..     
-000096d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000096e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000096f0: 2020 2020 2020 2020 2020 2a2a 6375 7272            **curr
-00009700: 656e 745f 6174 7472 6962 7574 6573 290d  ent_attributes).
-00009710: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00009720: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00009730: 2020 2020 6375 7272 656e 745f 6d65 7373      current_mess
-00009740: 6167 6520 3d20 6d69 646f 2e4d 6574 614d  age = mido.MetaM
-00009750: 6573 7361 6765 2874 696d 653d 6375 7272  essage(time=curr
-00009760: 656e 745f 7469 6d65 2c0d 0a20 2020 2020  ent_time,..     
-00009770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009790: 2020 2020 2020 2020 2020 2020 2020 2a2a                **
-000097a0: 6375 7272 656e 745f 6174 7472 6962 7574  current_attribut
-000097b0: 6573 290d 0a20 2020 2020 2020 2065 7863  es)..        exc
-000097c0: 6570 743a 0d0a 2020 2020 2020 2020 2020  ept:..          
-000097d0: 2020 636f 6e74 696e 7565 0d0a 2020 2020    continue..    
-000097e0: 2020 2020 6375 7272 656e 745f 7472 6163      current_trac
-000097f0: 6b20 3d20 6561 6368 2e74 7261 636b 2069  k = each.track i
-00009800: 6620 7772 6974 655f 7479 7065 203d 3d20  f write_type == 
-00009810: 2770 6965 6365 2720 656c 7365 2030 0d0a  'piece' else 0..
-00009820: 2020 2020 2020 2020 6966 2063 7572 7265          if curre
-00009830: 6e74 5f74 7261 636b 203c 206c 656e 2863  nt_track < len(c
-00009840: 7572 7265 6e74 5f6d 6964 692e 7472 6163  urrent_midi.trac
-00009850: 6b73 293a 0d0a 2020 2020 2020 2020 2020  ks):..          
-00009860: 2020 6375 7272 656e 745f 6d69 6469 2e74    current_midi.t
-00009870: 7261 636b 735b 6375 7272 656e 745f 7472  racks[current_tr
-00009880: 6163 6b5d 2e61 7070 656e 6428 6375 7272  ack].append(curr
-00009890: 656e 745f 6d65 7373 6167 6529 0d0a 0d0a  ent_message)....
-000098a0: 0d0a 6465 6620 6669 6e64 5f66 6972 7374  ..def find_first
-000098b0: 5f74 656d 706f 2866 696c 652c 2069 735f  _tempo(file, is_
-000098c0: 6669 6c65 3d46 616c 7365 293a 0d0a 2020  file=False):..  
-000098d0: 2020 6966 2069 735f 6669 6c65 3a0d 0a20    if is_file:.. 
-000098e0: 2020 2020 2020 2066 696c 652e 7365 656b         file.seek
-000098f0: 2830 290d 0a20 2020 2020 2020 2074 7279  (0)..        try
-00009900: 3a0d 0a20 2020 2020 2020 2020 2020 2063  :..            c
-00009910: 7572 7265 6e74 5f6d 6964 6920 3d20 6d69  urrent_midi = mi
-00009920: 646f 2e4d 6964 6946 696c 6528 6669 6c65  do.MidiFile(file
-00009930: 3d66 696c 652c 2063 6c69 703d 5472 7565  =file, clip=True
-00009940: 290d 0a20 2020 2020 2020 2020 2020 2066  )..            f
-00009950: 696c 652e 636c 6f73 6528 290d 0a20 2020  ile.close()..   
-00009960: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-00009970: 7074 696f 6e20 6173 204f 5345 7272 6f72  ption as OSError
-00009980: 3a0d 0a20 2020 2020 2020 2020 2020 2066  :..            f
-00009990: 696c 652e 7365 656b 2830 290d 0a20 2020  ile.seek(0)..   
-000099a0: 2020 2020 2020 2020 2063 7572 7265 6e74           current
-000099b0: 5f6d 6964 6920 3d20 6d69 646f 2e4d 6964  _midi = mido.Mid
-000099c0: 6946 696c 6528 6669 6c65 3d72 6966 665f  iFile(file=riff_
-000099d0: 746f 5f6d 6964 6928 6669 6c65 292c 2063  to_midi(file), c
-000099e0: 6c69 703d 5472 7565 290d 0a20 2020 2020  lip=True)..     
-000099f0: 2020 2020 2020 2066 696c 652e 636c 6f73         file.clos
-00009a00: 6528 290d 0a20 2020 2065 6c73 653a 0d0a  e()..    else:..
-00009a10: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
-00009a20: 2020 2020 2020 2020 2020 6375 7272 656e            curren
-00009a30: 745f 6d69 6469 203d 206d 6964 6f2e 4d69  t_midi = mido.Mi
-00009a40: 6469 4669 6c65 2866 696c 652c 2063 6c69  diFile(file, cli
-00009a50: 703d 5472 7565 290d 0a20 2020 2020 2020  p=True)..       
-00009a60: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-00009a70: 6e20 6173 204f 5345 7272 6f72 3a0d 0a20  n as OSError:.. 
-00009a80: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-00009a90: 6e74 5f6d 6964 6920 3d20 6d69 646f 2e4d  nt_midi = mido.M
-00009aa0: 6964 6946 696c 6528 6669 6c65 3d72 6966  idiFile(file=rif
-00009ab0: 665f 746f 5f6d 6964 6928 6669 6c65 292c  f_to_midi(file),
-00009ac0: 2063 6c69 703d 5472 7565 290d 0a20 2020   clip=True)..   
-00009ad0: 2066 6f72 2074 7261 636b 2069 6e20 6375   for track in cu
-00009ae0: 7272 656e 745f 6d69 6469 2e74 7261 636b  rrent_midi.track
-00009af0: 733a 0d0a 2020 2020 2020 2020 666f 7220  s:..        for 
-00009b00: 6d73 6720 696e 2074 7261 636b 3a0d 0a20  msg in track:.. 
-00009b10: 2020 2020 2020 2020 2020 2069 6620 6d73             if ms
-00009b20: 672e 7479 7065 203d 3d20 2773 6574 5f74  g.type == 'set_t
-00009b30: 656d 706f 273a 0d0a 2020 2020 2020 2020  empo':..        
-00009b40: 2020 2020 2020 2020 7265 7475 726e 206d          return m
-00009b50: 6964 6f2e 7465 6d70 6f32 6270 6d28 6d73  ido.tempo2bpm(ms
-00009b60: 672e 7465 6d70 6f29 0d0a 2020 2020 7265  g.tempo)..    re
-00009b70: 7475 726e 2031 3230 0d0a 0d0a 0d0a 6465  turn 120......de
-00009b80: 6620 6765 745f 7469 636b 735f 7065 725f  f get_ticks_per_
-00009b90: 6265 6174 2866 696c 652c 2069 735f 6669  beat(file, is_fi
-00009ba0: 6c65 3d46 616c 7365 293a 0d0a 2020 2020  le=False):..    
-00009bb0: 6966 2069 735f 6669 6c65 3a0d 0a20 2020  if is_file:..   
-00009bc0: 2020 2020 2066 696c 652e 7365 656b 2830       file.seek(0
-00009bd0: 290d 0a20 2020 2020 2020 2074 7279 3a0d  )..        try:.
-00009be0: 0a20 2020 2020 2020 2020 2020 2063 7572  .            cur
-00009bf0: 7265 6e74 5f6d 6964 6920 3d20 6d69 646f  rent_midi = mido
-00009c00: 2e4d 6964 6946 696c 6528 6669 6c65 3d66  .MidiFile(file=f
-00009c10: 696c 652c 2063 6c69 703d 5472 7565 290d  ile, clip=True).
-00009c20: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
-00009c30: 652e 636c 6f73 6528 290d 0a20 2020 2020  e.close()..     
-00009c40: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-00009c50: 696f 6e20 6173 204f 5345 7272 6f72 3a0d  ion as OSError:.
-00009c60: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
-00009c70: 652e 7365 656b 2830 290d 0a20 2020 2020  e.seek(0)..     
-00009c80: 2020 2020 2020 2063 7572 7265 6e74 5f6d         current_m
-00009c90: 6964 6920 3d20 6d69 646f 2e4d 6964 6946  idi = mido.MidiF
-00009ca0: 696c 6528 6669 6c65 3d72 6966 665f 746f  ile(file=riff_to
-00009cb0: 5f6d 6964 6928 6669 6c65 292c 2063 6c69  _midi(file), cli
-00009cc0: 703d 5472 7565 290d 0a20 2020 2020 2020  p=True)..       
-00009cd0: 2020 2020 2066 696c 652e 636c 6f73 6528       file.close(
-00009ce0: 290d 0a20 2020 2065 6c73 653a 0d0a 2020  )..    else:..  
-00009cf0: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
-00009d00: 2020 2020 2020 2020 6375 7272 656e 745f          current_
-00009d10: 6d69 6469 203d 206d 6964 6f2e 4d69 6469  midi = mido.Midi
-00009d20: 4669 6c65 2866 696c 652c 2063 6c69 703d  File(file, clip=
-00009d30: 5472 7565 290d 0a20 2020 2020 2020 2065  True)..        e
-00009d40: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
-00009d50: 6173 204f 5345 7272 6f72 3a0d 0a20 2020  as OSError:..   
-00009d60: 2020 2020 2020 2020 2063 7572 7265 6e74           current
-00009d70: 5f6d 6964 6920 3d20 6d69 646f 2e4d 6964  _midi = mido.Mid
-00009d80: 6946 696c 6528 6669 6c65 3d72 6966 665f  iFile(file=riff_
-00009d90: 746f 5f6d 6964 6928 6669 6c65 292c 2063  to_midi(file), c
-00009da0: 6c69 703d 5472 7565 290d 0a20 2020 2072  lip=True)..    r
-00009db0: 6574 7572 6e20 6375 7272 656e 745f 6d69  eturn current_mi
-00009dc0: 6469 2e74 6963 6b73 5f70 6572 5f62 6561  di.ticks_per_bea
-00009dd0: 740d 0a0d 0a0d 0a64 6566 2063 686f 7264  t......def chord
-00009de0: 5f74 6f5f 7069 6563 6528 6375 7272 656e  _to_piece(curren
-00009df0: 745f 6368 6f72 642c 2062 706d 3d31 3230  t_chord, bpm=120
-00009e00: 2c20 7374 6172 745f 7469 6d65 3d30 2c20  , start_time=0, 
-00009e10: 6861 735f 7472 6163 6b5f 6e75 6d3d 4661  has_track_num=Fa
-00009e20: 6c73 6529 3a0d 0a20 2020 2063 6861 6e6e  lse):..    chann
-00009e30: 656c 735f 6e75 6d62 6572 7320 3d20 5b69  els_numbers = [i
-00009e40: 2e63 6861 6e6e 656c 2066 6f72 2069 2069  .channel for i i
-00009e50: 6e20 6375 7272 656e 745f 6368 6f72 645d  n current_chord]
-00009e60: 202b 205b 0d0a 2020 2020 2020 2020 692e   + [..        i.
-00009e70: 6368 616e 6e65 6c0d 0a20 2020 2020 2020  channel..       
-00009e80: 2066 6f72 2069 2069 6e20 6375 7272 656e   for i in curren
-00009e90: 745f 6368 6f72 642e 6f74 6865 725f 6d65  t_chord.other_me
-00009ea0: 7373 6167 6573 2069 6620 6861 7361 7474  ssages if hasatt
-00009eb0: 7228 692c 2027 6368 616e 6e65 6c27 290d  r(i, 'channel').
-00009ec0: 0a20 2020 205d 0d0a 2020 2020 6368 616e  .    ]..    chan
-00009ed0: 6e65 6c73 5f6c 6973 7420 3d20 6c69 7374  nels_list = list
-00009ee0: 2873 6574 2863 6861 6e6e 656c 735f 6e75  (set(channels_nu
-00009ef0: 6d62 6572 7329 290d 0a20 2020 2063 6861  mbers))..    cha
-00009f00: 6e6e 656c 735f 6c69 7374 203d 205b 6920  nnels_list = [i 
-00009f10: 666f 7220 6920 696e 2063 6861 6e6e 656c  for i in channel
-00009f20: 735f 6c69 7374 2069 6620 6920 6973 206e  s_list if i is n
-00009f30: 6f74 204e 6f6e 655d 0d0a 2020 2020 6368  ot None]..    ch
-00009f40: 616e 6e65 6c73 5f6c 6973 742e 736f 7274  annels_list.sort
-00009f50: 2829 0d0a 2020 2020 6966 206e 6f74 2063  ()..    if not c
-00009f60: 6861 6e6e 656c 735f 6c69 7374 3a0d 0a20  hannels_list:.. 
-00009f70: 2020 2020 2020 2063 6861 6e6e 656c 735f         channels_
-00009f80: 6c69 7374 203d 205b 305d 0d0a 2020 2020  list = [0]..    
-00009f90: 6368 616e 6e65 6c73 5f6e 756d 203d 206c  channels_num = l
-00009fa0: 656e 2863 6861 6e6e 656c 735f 6c69 7374  en(channels_list
-00009fb0: 290d 0a20 2020 2063 7572 7265 6e74 5f73  )..    current_s
-00009fc0: 7461 7274 5f74 696d 6520 3d20 7374 6172  tart_time = star
-00009fd0: 745f 7469 6d65 202b 2063 7572 7265 6e74  t_time + current
-00009fe0: 5f63 686f 7264 2e73 7461 7274 5f74 696d  _chord.start_tim
-00009ff0: 650d 0a20 2020 2070 616e 5f6c 6973 7420  e..    pan_list 
-0000a000: 3d20 5b0d 0a20 2020 2020 2020 2070 616e  = [..        pan
-0000a010: 2869 2e76 616c 7565 2c0d 0a20 2020 2020  (i.value,..     
-0000a020: 2020 2020 2020 206d 6f64 653d 2776 616c         mode='val
-0000a030: 7565 272c 0d0a 2020 2020 2020 2020 2020  ue',..          
-0000a040: 2020 7374 6172 745f 7469 6d65 3d69 2e73    start_time=i.s
-0000a050: 7461 7274 5f74 696d 652c 0d0a 2020 2020  tart_time,..    
-0000a060: 2020 2020 2020 2020 6368 616e 6e65 6c3d          channel=
-0000a070: 692e 6368 616e 6e65 6c2c 0d0a 2020 2020  i.channel,..    
-0000a080: 2020 2020 2020 2020 7472 6163 6b3d 692e          track=i.
-0000a090: 7472 6163 6b29 2066 6f72 2069 2069 6e20  track) for i in 
-0000a0a0: 6375 7272 656e 745f 6368 6f72 642e 6f74  current_chord.ot
-0000a0b0: 6865 725f 6d65 7373 6167 6573 0d0a 2020  her_messages..  
-0000a0c0: 2020 2020 2020 6966 2069 2e74 7970 6520        if i.type 
-0000a0d0: 3d3d 2027 636f 6e74 726f 6c5f 6368 616e  == 'control_chan
-0000a0e0: 6765 2720 616e 6420 692e 636f 6e74 726f  ge' and i.contro
-0000a0f0: 6c20 3d3d 2031 300d 0a20 2020 205d 0d0a  l == 10..    ]..
-0000a100: 2020 2020 766f 6c75 6d65 5f6c 6973 7420      volume_list 
-0000a110: 3d20 5b0d 0a20 2020 2020 2020 2076 6f6c  = [..        vol
-0000a120: 756d 6528 692e 7661 6c75 652c 0d0a 2020  ume(i.value,..  
-0000a130: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
-0000a140: 653d 2776 616c 7565 272c 0d0a 2020 2020  e='value',..    
-0000a150: 2020 2020 2020 2020 2020 2073 7461 7274             start
-0000a160: 5f74 696d 653d 692e 7374 6172 745f 7469  _time=i.start_ti
-0000a170: 6d65 2c0d 0a20 2020 2020 2020 2020 2020  me,..           
-0000a180: 2020 2020 6368 616e 6e65 6c3d 692e 6368      channel=i.ch
-0000a190: 616e 6e65 6c2c 0d0a 2020 2020 2020 2020  annel,..        
-0000a1a0: 2020 2020 2020 2074 7261 636b 3d69 2e74         track=i.t
-0000a1b0: 7261 636b 2920 666f 7220 6920 696e 2063  rack) for i in c
-0000a1c0: 7572 7265 6e74 5f63 686f 7264 2e6f 7468  urrent_chord.oth
-0000a1d0: 6572 5f6d 6573 7361 6765 730d 0a20 2020  er_messages..   
-0000a1e0: 2020 2020 2069 6620 692e 7479 7065 203d       if i.type =
-0000a1f0: 3d20 2763 6f6e 7472 6f6c 5f63 6861 6e67  = 'control_chang
-0000a200: 6527 2061 6e64 2069 2e63 6f6e 7472 6f6c  e' and i.control
-0000a210: 203d 3d20 370d 0a20 2020 205d 0d0a 2020   == 7..    ]..  
-0000a220: 2020 7472 6163 6b5f 6e61 6d65 735f 6d73    track_names_ms
-0000a230: 6720 3d20 5b5b 0d0a 2020 2020 2020 2020  g = [[..        
-0000a240: 6920 666f 7220 6920 696e 2063 7572 7265  i for i in curre
-0000a250: 6e74 5f63 686f 7264 2e6f 7468 6572 5f6d  nt_chord.other_m
-0000a260: 6573 7361 6765 730d 0a20 2020 2020 2020  essages..       
-0000a270: 2069 6620 692e 7479 7065 203d 3d20 2774   if i.type == 't
-0000a280: 7261 636b 5f6e 616d 6527 2061 6e64 2069  rack_name' and i
-0000a290: 2e74 7261 636b 203d 3d20 6a0d 0a20 2020  .track == j..   
-0000a2a0: 205d 2066 6f72 206a 2069 6e20 7261 6e67   ] for j in rang
-0000a2b0: 6528 6368 616e 6e65 6c73 5f6e 756d 295d  e(channels_num)]
-0000a2c0: 0d0a 2020 2020 7472 6163 6b5f 6e61 6d65  ..    track_name
-0000a2d0: 735f 6d73 6720 3d20 5b69 5b30 5d20 666f  s_msg = [i[0] fo
-0000a2e0: 7220 6920 696e 2074 7261 636b 5f6e 616d  r i in track_nam
-0000a2f0: 6573 5f6d 7367 2069 6620 695d 0d0a 2020  es_msg if i]..  
-0000a300: 2020 6966 206e 6f74 2074 7261 636b 5f6e    if not track_n
-0000a310: 616d 6573 5f6d 7367 3a0d 0a20 2020 2020  ames_msg:..     
-0000a320: 2020 2074 7261 636b 5f6e 616d 6573 5f6c     track_names_l
-0000a330: 6973 7420 3d20 5b5d 0d0a 2020 2020 656c  ist = []..    el
-0000a340: 7365 3a0d 0a20 2020 2020 2020 2069 6620  se:..        if 
-0000a350: 6e6f 7420 6861 735f 7472 6163 6b5f 6e75  not has_track_nu
-0000a360: 6d20 616e 6420 616c 6c28 0d0a 2020 2020  m and all(..    
-0000a370: 2020 2020 2020 2020 2020 2020 6861 7361              hasa
-0000a380: 7474 7228 692c 2027 6368 616e 6e65 6c27  ttr(i, 'channel'
-0000a390: 2920 666f 7220 6920 696e 2074 7261 636b  ) for i in track
-0000a3a0: 5f6e 616d 6573 5f6d 7367 293a 0d0a 2020  _names_msg):..  
-0000a3b0: 2020 2020 2020 2020 2020 7472 6163 6b5f            track_
-0000a3c0: 6e61 6d65 735f 6368 616e 6e65 6c73 203d  names_channels =
-0000a3d0: 205b 692e 6368 616e 6e65 6c20 666f 7220   [i.channel for 
-0000a3e0: 6920 696e 2074 7261 636b 5f6e 616d 6573  i in track_names
-0000a3f0: 5f6d 7367 5d0d 0a20 2020 2020 2020 2020  _msg]..         
-0000a400: 2020 2063 7572 7265 6e74 5f74 7261 636b     current_track
-0000a410: 5f6e 616d 6573 203d 205b 0d0a 2020 2020  _names = [..    
-0000a420: 2020 2020 2020 2020 2020 2020 7472 6163              trac
-0000a430: 6b5f 6e61 6d65 735f 6d73 675b 7472 6163  k_names_msg[trac
-0000a440: 6b5f 6e61 6d65 735f 6368 616e 6e65 6c73  k_names_channels
-0000a450: 2e69 6e64 6578 2869 295d 0d0a 2020 2020  .index(i)]..    
-0000a460: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0000a470: 6920 696e 2063 6861 6e6e 656c 735f 6c69  i in channels_li
-0000a480: 7374 0d0a 2020 2020 2020 2020 2020 2020  st..            
-0000a490: 5d0d 0a20 2020 2020 2020 2065 6c73 653a  ]..        else:
-0000a4a0: 0d0a 2020 2020 2020 2020 2020 2020 6375  ..            cu
-0000a4b0: 7272 656e 745f 7472 6163 6b5f 6e61 6d65  rrent_track_name
-0000a4c0: 7320 3d20 7472 6163 6b5f 6e61 6d65 735f  s = track_names_
-0000a4d0: 6d73 670d 0a20 2020 2020 2020 2074 7261  msg..        tra
-0000a4e0: 636b 5f6e 616d 6573 5f6c 6973 7420 3d20  ck_names_list = 
-0000a4f0: 5b69 2e6e 616d 6520 666f 7220 6920 696e  [i.name for i in
-0000a500: 2063 7572 7265 6e74 5f74 7261 636b 5f6e   current_track_n
-0000a510: 616d 6573 5d0d 0a20 2020 2069 6620 286e  ames]..    if (n
-0000a520: 6f74 2074 7261 636b 5f6e 616d 6573 5f6c  ot track_names_l
-0000a530: 6973 7429 206f 7220 286c 656e 2874 7261  ist) or (len(tra
-0000a540: 636b 5f6e 616d 6573 5f6c 6973 7429 2021  ck_names_list) !
-0000a550: 3d20 6368 616e 6e65 6c73 5f6e 756d 293a  = channels_num):
-0000a560: 0d0a 2020 2020 2020 2020 7472 6163 6b5f  ..        track_
-0000a570: 6e61 6d65 735f 6c69 7374 203d 205b 6627  names_list = [f'
-0000a580: 4368 616e 6e65 6c20 7b69 2b31 7d27 2066  Channel {i+1}' f
-0000a590: 6f72 2069 2069 6e20 7261 6e67 6528 6368  or i in range(ch
-0000a5a0: 616e 6e65 6c73 5f6e 756d 295d 0d0a 2020  annels_num)]..  
-0000a5b0: 2020 6966 206e 6f74 2068 6173 5f74 7261    if not has_tra
-0000a5c0: 636b 5f6e 756d 3a0d 0a20 2020 2020 2020  ck_num:..       
-0000a5d0: 2066 6f72 2065 6163 6820 696e 2063 7572   for each in cur
-0000a5e0: 7265 6e74 5f63 686f 7264 2e6e 6f74 6573  rent_chord.notes
-0000a5f0: 3a0d 0a20 2020 2020 2020 2020 2020 2065  :..            e
-0000a600: 6163 682e 7472 6163 6b5f 6e75 6d20 3d20  ach.track_num = 
-0000a610: 6368 616e 6e65 6c73 5f6c 6973 742e 696e  channels_list.in
-0000a620: 6465 7828 0d0a 2020 2020 2020 2020 2020  dex(..          
-0000a630: 2020 2020 2020 6561 6368 2e63 6861 6e6e        each.chann
-0000a640: 656c 2920 6966 2065 6163 682e 6368 616e  el) if each.chan
-0000a650: 6e65 6c20 6973 206e 6f74 204e 6f6e 6520  nel is not None 
-0000a660: 656c 7365 2030 0d0a 2020 2020 2020 2020  else 0..        
-0000a670: 666f 7220 6561 6368 2069 6e20 6375 7272  for each in curr
-0000a680: 656e 745f 6368 6f72 642e 7069 7463 685f  ent_chord.pitch_
-0000a690: 6265 6e64 733a 0d0a 2020 2020 2020 2020  bends:..        
-0000a6a0: 2020 2020 6966 2065 6163 682e 7472 6163      if each.trac
-0000a6b0: 6b20 213d 2065 6163 682e 7472 6163 6b5f  k != each.track_
-0000a6c0: 6e75 6d3a 0d0a 2020 2020 2020 2020 2020  num:..          
-0000a6d0: 2020 2020 2020 6561 6368 2e74 7261 636b        each.track
-0000a6e0: 203d 2065 6163 682e 7472 6163 6b5f 6e75   = each.track_nu
-0000a6f0: 6d0d 0a20 2020 2020 2020 2066 6f72 2065  m..        for e
-0000a700: 6163 6820 696e 2063 7572 7265 6e74 5f63  ach in current_c
-0000a710: 686f 7264 2e6f 7468 6572 5f6d 6573 7361  hord.other_messa
-0000a720: 6765 733a 0d0a 2020 2020 2020 2020 2020  ges:..          
-0000a730: 2020 6966 2068 6173 6174 7472 2865 6163    if hasattr(eac
-0000a740: 682c 2027 6368 616e 6e65 6c27 2920 616e  h, 'channel') an
-0000a750: 6420 6561 6368 2e63 6861 6e6e 656c 2069  d each.channel i
-0000a760: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-0000a770: 2020 2020 2020 2020 2020 2020 2065 6163               eac
-0000a780: 682e 7472 6163 6b20 3d20 6368 616e 6e65  h.track = channe
-0000a790: 6c73 5f6c 6973 742e 696e 6465 7828 6561  ls_list.index(ea
-0000a7a0: 6368 2e63 6861 6e6e 656c 290d 0a20 2020  ch.channel)..   
-0000a7b0: 2020 2020 2066 6f72 2065 6163 6820 696e       for each in
-0000a7c0: 2070 616e 5f6c 6973 743a 0d0a 2020 2020   pan_list:..    
-0000a7d0: 2020 2020 2020 2020 6966 2065 6163 682e          if each.
-0000a7e0: 6368 616e 6e65 6c20 6973 206e 6f74 204e  channel is not N
-0000a7f0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-0000a800: 2020 2020 2020 6561 6368 2e74 7261 636b        each.track
-0000a810: 203d 2063 6861 6e6e 656c 735f 6c69 7374   = channels_list
-0000a820: 2e69 6e64 6578 2865 6163 682e 6368 616e  .index(each.chan
-0000a830: 6e65 6c29 0d0a 2020 2020 2020 2020 666f  nel)..        fo
-0000a840: 7220 6561 6368 2069 6e20 766f 6c75 6d65  r each in volume
-0000a850: 5f6c 6973 743a 0d0a 2020 2020 2020 2020  _list:..        
-0000a860: 2020 2020 6966 2065 6163 682e 6368 616e      if each.chan
-0000a870: 6e65 6c20 6973 206e 6f74 204e 6f6e 653a  nel is not None:
-0000a880: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000a890: 2020 6561 6368 2e74 7261 636b 203d 2063    each.track = c
-0000a8a0: 6861 6e6e 656c 735f 6c69 7374 2e69 6e64  hannels_list.ind
-0000a8b0: 6578 2865 6163 682e 6368 616e 6e65 6c29  ex(each.channel)
-0000a8c0: 0d0a 2020 2020 7265 7375 6c74 5f70 6965  ..    result_pie
-0000a8d0: 6365 203d 2070 6965 6365 2874 7261 636b  ce = piece(track
-0000a8e0: 733d 5b63 686f 7264 285b 5d29 2066 6f72  s=[chord([]) for
-0000a8f0: 2069 2069 6e20 7261 6e67 6528 6368 616e   i in range(chan
-0000a900: 6e65 6c73 5f6e 756d 295d 2c0d 0a20 2020  nels_num)],..   
-0000a910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a920: 2020 2020 2020 6270 6d3d 6270 6d2c 0d0a        bpm=bpm,..
-0000a930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a940: 2020 2020 2020 2020 2070 616e 3d5b 5b5d           pan=[[]
-0000a950: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-0000a960: 6368 616e 6e65 6c73 5f6e 756d 295d 2c0d  channels_num)],.
-0000a970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a980: 2020 2020 2020 2020 2020 766f 6c75 6d65            volume
-0000a990: 3d5b 5b5d 2066 6f72 2069 2069 6e20 7261  =[[] for i in ra
-0000a9a0: 6e67 6528 6368 616e 6e65 6c73 5f6e 756d  nge(channels_num
-0000a9b0: 295d 290d 0a20 2020 2072 6573 756c 745f  )])..    result_
-0000a9c0: 7069 6563 652e 7265 636f 6e73 7472 7563  piece.reconstruc
-0000a9d0: 7428 6375 7272 656e 745f 6368 6f72 642c  t(current_chord,
-0000a9e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000a9f0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0000aa00: 7572 7265 6e74 5f73 7461 7274 5f74 696d  urrent_start_tim
-0000aa10: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-0000aa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aa30: 2069 6e63 6c75 6465 5f65 6d70 7479 5f74   include_empty_t
-0000aa40: 7261 636b 3d54 7275 6529 0d0a 2020 2020  rack=True)..    
-0000aa50: 6966 2072 6573 756c 745f 7069 6563 652e  if result_piece.
-0000aa60: 6368 616e 6e65 6c73 3a0d 0a20 2020 2020  channels:..     
-0000aa70: 2020 2069 6620 6c65 6e28 7265 7375 6c74     if len(result
-0000aa80: 5f70 6965 6365 2e63 6861 6e6e 656c 7329  _piece.channels)
-0000aa90: 2021 3d20 6368 616e 6e65 6c73 5f6e 756d   != channels_num
-0000aaa0: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
-0000aab0: 616e 5f6c 6973 7420 3d20 5b0d 0a20 2020  an_list = [..   
-0000aac0: 2020 2020 2020 2020 2020 2020 2069 2066               i f
-0000aad0: 6f72 2069 2069 6e20 7061 6e5f 6c69 7374  or i in pan_list
-0000aae0: 2069 6620 692e 6368 616e 6e65 6c20 696e   if i.channel in
-0000aaf0: 2072 6573 756c 745f 7069 6563 652e 6368   result_piece.ch
-0000ab00: 616e 6e65 6c73 0d0a 2020 2020 2020 2020  annels..        
-0000ab10: 2020 2020 5d0d 0a20 2020 2020 2020 2020      ]..         
-0000ab20: 2020 2076 6f6c 756d 655f 6c69 7374 203d     volume_list =
-0000ab30: 205b 0d0a 2020 2020 2020 2020 2020 2020   [..            
-0000ab40: 2020 2020 6920 666f 7220 6920 696e 2076      i for i in v
-0000ab50: 6f6c 756d 655f 6c69 7374 2069 6620 692e  olume_list if i.
-0000ab60: 6368 616e 6e65 6c20 696e 2072 6573 756c  channel in resul
-0000ab70: 745f 7069 6563 652e 6368 616e 6e65 6c73  t_piece.channels
-0000ab80: 0d0a 2020 2020 2020 2020 2020 2020 5d0d  ..            ].
-0000ab90: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0000aba0: 2065 6163 6820 696e 2070 616e 5f6c 6973   each in pan_lis
-0000abb0: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
-0000abc0: 2020 2020 6561 6368 2e74 7261 636b 203d      each.track =
-0000abd0: 2072 6573 756c 745f 7069 6563 652e 6368   result_piece.ch
-0000abe0: 616e 6e65 6c73 2e69 6e64 6578 2865 6163  annels.index(eac
-0000abf0: 682e 6368 616e 6e65 6c29 0d0a 2020 2020  h.channel)..    
-0000ac00: 2020 2020 2020 2020 666f 7220 6561 6368          for each
-0000ac10: 2069 6e20 766f 6c75 6d65 5f6c 6973 743a   in volume_list:
-0000ac20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000ac30: 2020 6561 6368 2e74 7261 636b 203d 2072    each.track = r
-0000ac40: 6573 756c 745f 7069 6563 652e 6368 616e  esult_piece.chan
-0000ac50: 6e65 6c73 2e69 6e64 6578 2865 6163 682e  nels.index(each.
-0000ac60: 6368 616e 6e65 6c29 0d0a 2020 2020 2020  channel)..      
-0000ac70: 2020 2020 2020 666f 7220 6b20 696e 2072        for k in r
-0000ac80: 616e 6765 286c 656e 2872 6573 756c 745f  ange(len(result_
-0000ac90: 7069 6563 652e 7472 6163 6b73 2929 3a0d  piece.tracks)):.
-0000aca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000acb0: 2066 6f72 2065 6163 6820 696e 2072 6573   for each in res
-0000acc0: 756c 745f 7069 6563 652e 7472 6163 6b73  ult_piece.tracks
-0000acd0: 5b6b 5d2e 7069 7463 685f 6265 6e64 733a  [k].pitch_bends:
-0000ace0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000acf0: 2020 2020 2020 6561 6368 2e74 7261 636b        each.track
-0000ad00: 203d 206b 0d0a 2020 2020 2020 2020 2020   = k..          
-0000ad10: 2020 6375 7272 656e 745f 6368 6f72 642e    current_chord.
-0000ad20: 6f74 6865 725f 6d65 7373 6167 6573 203d  other_messages =
-0000ad30: 205b 0d0a 2020 2020 2020 2020 2020 2020   [..            
-0000ad40: 2020 2020 6920 666f 7220 6920 696e 2063      i for i in c
-0000ad50: 7572 7265 6e74 5f63 686f 7264 2e6f 7468  urrent_chord.oth
-0000ad60: 6572 5f6d 6573 7361 6765 730d 0a20 2020  er_messages..   
-0000ad70: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000ad80: 6e6f 7420 2868 6173 6174 7472 2869 2c20  not (hasattr(i, 
-0000ad90: 2763 6861 6e6e 656c 2729 0d0a 2020 2020  'channel')..    
-0000ada0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000adb0: 2020 2020 616e 6420 692e 6368 616e 6e65      and i.channe
-0000adc0: 6c20 6e6f 7420 696e 2072 6573 756c 745f  l not in result_
-0000add0: 7069 6563 652e 6368 616e 6e65 6c73 290d  piece.channels).
-0000ade0: 0a20 2020 2020 2020 2020 2020 205d 0d0a  .            ]..
-0000adf0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0000ae00: 6561 6368 2069 6e20 6375 7272 656e 745f  each in current_
-0000ae10: 6368 6f72 642e 6f74 6865 725f 6d65 7373  chord.other_mess
-0000ae20: 6167 6573 3a0d 0a20 2020 2020 2020 2020  ages:..         
-0000ae30: 2020 2020 2020 2069 6620 6861 7361 7474         if hasatt
-0000ae40: 7228 6561 6368 2c20 2763 6861 6e6e 656c  r(each, 'channel
-0000ae50: 2729 3a0d 0a20 2020 2020 2020 2020 2020  '):..           
+00006a10: 2020 2020 2020 2020 6368 616e 6e65 6c3d          channel=
+00006a20: 6375 7272 656e 745f 6d73 675f 6368 616e  current_msg_chan
+00006a30: 6e65 6c2c 0d0a 2020 2020 2020 2020 2020  nel,..          
+00006a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006a50: 2020 2020 2020 2020 2020 2020 7472 6163              trac
+00006a60: 6b3d 6375 7272 656e 745f 7472 6163 6b5f  k=current_track_
+00006a70: 696e 6429 0d0a 2020 2020 2020 2020 2020  ind)..          
+00006a80: 2020 2020 2020 7061 6e5f 6c69 7374 2e61        pan_list.a
+00006a90: 7070 656e 6428 6375 7272 656e 745f 7061  ppend(current_pa
+00006aa0: 6e5f 6d73 6729 0d0a 2020 2020 2020 2020  n_msg)..        
+00006ab0: 2020 2020 656c 6966 2063 7572 7265 6e74      elif current
+00006ac0: 5f6d 7367 2e63 6f6e 7472 6f6c 203d 3d20  _msg.control == 
+00006ad0: 373a 0d0a 2020 2020 2020 2020 2020 2020  7:..            
+00006ae0: 2020 2020 6375 7272 656e 745f 766f 6c75      current_volu
+00006af0: 6d65 5f6d 7367 203d 2076 6f6c 756d 6528  me_msg = volume(
+00006b00: 6375 7272 656e 745f 6d73 672e 7661 6c75  current_msg.valu
+00006b10: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+00006b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006b40: 6375 7272 656e 745f 7469 6d65 202f 2069  current_time / i
+00006b50: 6e74 6572 7661 6c5f 756e 6974 2c0d 0a20  nterval_unit,.. 
+00006b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006b80: 2020 2020 2020 2020 2020 2027 7661 6c75             'valu
+00006b90: 6527 2c0d 0a20 2020 2020 2020 2020 2020  e',..           
+00006ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006bc0: 2063 6861 6e6e 656c 3d63 7572 7265 6e74   channel=current
+00006bd0: 5f6d 7367 5f63 6861 6e6e 656c 2c0d 0a20  _msg_channel,.. 
+00006be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006c00: 2020 2020 2020 2020 2020 2074 7261 636b             track
+00006c10: 3d63 7572 7265 6e74 5f74 7261 636b 5f69  =current_track_i
+00006c20: 6e64 290d 0a20 2020 2020 2020 2020 2020  nd)..           
+00006c30: 2020 2020 2076 6f6c 756d 655f 6c69 7374       volume_list
+00006c40: 2e61 7070 656e 6428 6375 7272 656e 745f  .append(current_
+00006c50: 766f 6c75 6d65 5f6d 7367 290d 0a20 2020  volume_msg)..   
+00006c60: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+00006c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006c80: 5f72 6561 645f 6f74 6865 725f 6d65 7373  _read_other_mess
+00006c90: 6167 6573 2863 7572 7265 6e74 5f6d 7367  ages(current_msg
+00006ca0: 2c20 6f74 6865 725f 6d65 7373 6167 6573  , other_messages
+00006cb0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00006cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006cd0: 2020 2020 2020 2020 6375 7272 656e 745f          current_
+00006ce0: 7469 6d65 202f 2069 6e74 6572 7661 6c5f  time / interval_
+00006cf0: 756e 6974 2c0d 0a20 2020 2020 2020 2020  unit,..         
+00006d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006d10: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+00006d20: 656e 745f 7472 6163 6b5f 696e 6429 0d0a  ent_track_ind)..
+00006d30: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00006d40: 2020 2020 2020 2020 2020 2069 6620 7472             if tr
+00006d50: 6163 6b5f 6368 616e 6e65 6c73 2061 6e64  ack_channels and
+00006d60: 2068 6173 6174 7472 2863 7572 7265 6e74   hasattr(current
+00006d70: 5f6d 7367 2c20 2763 6861 6e6e 656c 2729  _msg, 'channel')
+00006d80: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00006d90: 2020 2063 7572 7265 6e74 5f6d 7367 5f63     current_msg_c
+00006da0: 6861 6e6e 656c 203d 2063 7572 7265 6e74  hannel = current
+00006db0: 5f6d 7367 2e63 6861 6e6e 656c 0d0a 2020  _msg.channel..  
+00006dc0: 2020 2020 2020 2020 2020 2020 2020 6375                cu
+00006dd0: 7272 656e 745f 7472 6163 6b5f 696e 6420  rrent_track_ind 
+00006de0: 3d20 7472 6163 6b5f 6368 616e 6e65 6c73  = track_channels
+00006df0: 2e69 6e64 6578 2863 7572 7265 6e74 5f6d  .index(current_m
+00006e00: 7367 5f63 6861 6e6e 656c 290d 0a20 2020  sg_channel)..   
+00006e10: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+00006e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006e30: 6375 7272 656e 745f 7472 6163 6b5f 696e  current_track_in
+00006e40: 6420 3d20 7472 6163 6b5f 696e 640d 0a20  d = track_ind.. 
+00006e50: 2020 2020 2020 2020 2020 205f 7265 6164             _read
+00006e60: 5f6f 7468 6572 5f6d 6573 7361 6765 7328  _other_messages(
+00006e70: 6375 7272 656e 745f 6d73 672c 206f 7468  current_msg, oth
+00006e80: 6572 5f6d 6573 7361 6765 732c 0d0a 2020  er_messages,..  
+00006e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006ea0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00006eb0: 7572 7265 6e74 5f74 696d 6520 2f20 696e  urrent_time / in
+00006ec0: 7465 7276 616c 5f75 6e69 742c 0d0a 2020  terval_unit,..  
+00006ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006ee0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00006ef0: 7572 7265 6e74 5f74 7261 636b 5f69 6e64  urrent_track_ind
+00006f00: 290d 0a20 2020 2072 6573 756c 7420 3d20  )..    result = 
+00006f10: 6368 6f72 6428 6e6f 7465 6c69 7374 2c20  chord(notelist, 
+00006f20: 696e 7465 7276 616c 3d69 6e74 6572 7661  interval=interva
+00006f30: 6c73 290d 0a20 2020 2069 6620 636c 6561  ls)..    if clea
+00006f40: 725f 656d 7074 795f 6e6f 7465 733a 0d0a  r_empty_notes:..
+00006f50: 2020 2020 2020 2020 696e 6473 203d 205b          inds = [
+00006f60: 6920 666f 7220 692c 2065 6163 6820 696e  i for i, each in
+00006f70: 2065 6e75 6d65 7261 7465 2872 6573 756c   enumerate(resul
+00006f80: 742e 6e6f 7465 7329 2069 6620 6561 6368  t.notes) if each
+00006f90: 2e64 7572 6174 696f 6e20 3e20 305d 0d0a  .duration > 0]..
+00006fa0: 2020 2020 2020 2020 7265 7375 6c74 2e6e          result.n
+00006fb0: 6f74 6573 203d 205b 7265 7375 6c74 2e6e  otes = [result.n
+00006fc0: 6f74 6573 5b69 5d20 666f 7220 6920 696e  otes[i] for i in
+00006fd0: 2069 6e64 735d 0d0a 2020 2020 2020 2020   inds]..        
+00006fe0: 7265 7375 6c74 2e69 6e74 6572 7661 6c20  result.interval 
+00006ff0: 3d20 5b72 6573 756c 742e 696e 7465 7276  = [result.interv
+00007000: 616c 5b69 5d20 666f 7220 6920 696e 2069  al[i] for i in i
+00007010: 6e64 735d 0d0a 2020 2020 7265 7375 6c74  nds]..    result
+00007020: 2e74 656d 706f 7320 3d20 7465 6d70 6f5f  .tempos = tempo_
+00007030: 6c69 7374 0d0a 2020 2020 7265 7375 6c74  list..    result
+00007040: 2e70 6974 6368 5f62 656e 6473 203d 2070  .pitch_bends = p
+00007050: 6974 6368 5f62 656e 645f 6c69 7374 0d0a  itch_bend_list..
+00007060: 2020 2020 7265 7375 6c74 2e70 616e 5f6c      result.pan_l
+00007070: 6973 7420 3d20 7061 6e5f 6c69 7374 0d0a  ist = pan_list..
+00007080: 2020 2020 7265 7375 6c74 2e76 6f6c 756d      result.volum
+00007090: 655f 6c69 7374 203d 2076 6f6c 756d 655f  e_list = volume_
+000070a0: 6c69 7374 0d0a 2020 2020 7265 7375 6c74  list..    result
+000070b0: 2e6f 7468 6572 5f6d 6573 7361 6765 7320  .other_messages 
+000070c0: 3d20 6f74 6865 725f 6d65 7373 6167 6573  = other_messages
+000070d0: 0d0a 2020 2020 6966 2062 706d 2069 7320  ..    if bpm is 
+000070e0: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+000070f0: 2020 2072 6574 7572 6e20 5b72 6573 756c     return [resul
+00007100: 742c 2062 706d 2c20 7374 6172 745f 7469  t, bpm, start_ti
+00007110: 6d65 5d0d 0a20 2020 2065 6c73 653a 0d0a  me]..    else:..
+00007120: 2020 2020 2020 2020 7265 7475 726e 205b          return [
+00007130: 7265 7375 6c74 2c20 7374 6172 745f 7469  result, start_ti
+00007140: 6d65 5d0d 0a0d 0a0d 0a64 6566 205f 7265  me]......def _re
+00007150: 6164 5f6f 7468 6572 5f6d 6573 7361 6765  ad_other_message
+00007160: 7328 6d65 7373 6167 652c 206f 7468 6572  s(message, other
+00007170: 5f6d 6573 7361 6765 732c 2074 696d 652c  _messages, time,
+00007180: 2074 7261 636b 5f69 6e64 293a 0d0a 2020   track_ind):..  
+00007190: 2020 6966 206d 6573 7361 6765 2e74 7970    if message.typ
+000071a0: 6520 6e6f 7420 696e 205b 276e 6f74 655f  e not in ['note_
+000071b0: 6f6e 272c 2027 6e6f 7465 5f6f 6666 275d  on', 'note_off']
+000071c0: 3a0d 0a20 2020 2020 2020 2063 7572 7265  :..        curre
+000071d0: 6e74 5f61 7474 7269 6275 7465 7320 3d20  nt_attributes = 
+000071e0: 7b0d 0a20 2020 2020 2020 2020 2020 2069  {..            i
+000071f0: 3a20 6a0d 0a20 2020 2020 2020 2020 2020  : j..           
+00007200: 2066 6f72 2069 2c20 6a20 696e 2076 6172   for i, j in var
+00007210: 7328 6d65 7373 6167 6529 2e69 7465 6d73  s(message).items
+00007220: 2829 2069 6620 6920 213d 2027 7469 6d65  () if i != 'time
+00007230: 270d 0a20 2020 2020 2020 207d 0d0a 2020  '..        }..  
+00007240: 2020 2020 2020 6375 7272 656e 745f 6d65        current_me
+00007250: 7373 6167 6520 3d20 6576 656e 7428 7472  ssage = event(tr
+00007260: 6163 6b3d 7472 6163 6b5f 696e 642c 0d0a  ack=track_ind,..
+00007270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007290: 7374 6172 745f 7469 6d65 3d74 696d 652c  start_time=time,
+000072a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000072b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000072c0: 2020 2a2a 6375 7272 656e 745f 6174 7472    **current_attr
+000072d0: 6962 7574 6573 290d 0a20 2020 2020 2020  ibutes)..       
+000072e0: 2063 7572 7265 6e74 5f6d 6573 7361 6765   current_message
+000072f0: 2e69 735f 6d65 7461 203d 206d 6573 7361  .is_meta = messa
+00007300: 6765 2e69 735f 6d65 7461 0d0a 2020 2020  ge.is_meta..    
+00007310: 2020 2020 6f74 6865 725f 6d65 7373 6167      other_messag
+00007320: 6573 2e61 7070 656e 6428 6375 7272 656e  es.append(curren
+00007330: 745f 6d65 7373 6167 6529 0d0a 0d0a 0d0a  t_message)......
+00007340: 6465 6620 7772 6974 6528 6375 7272 656e  def write(curren
+00007350: 745f 6368 6f72 642c 0d0a 2020 2020 2020  t_chord,..      
+00007360: 2020 2020 6270 6d3d 3132 302c 0d0a 2020      bpm=120,..  
+00007370: 2020 2020 2020 2020 6368 616e 6e65 6c3d          channel=
+00007380: 302c 0d0a 2020 2020 2020 2020 2020 7374  0,..          st
+00007390: 6172 745f 7469 6d65 3d4e 6f6e 652c 0d0a  art_time=None,..
+000073a0: 2020 2020 2020 2020 2020 6e61 6d65 3d27            name='
+000073b0: 7465 6d70 2e6d 6964 272c 0d0a 2020 2020  temp.mid',..    
+000073c0: 2020 2020 2020 696e 7374 7275 6d65 6e74        instrument
+000073d0: 3d4e 6f6e 652c 0d0a 2020 2020 2020 2020  =None,..        
+000073e0: 2020 693d 4e6f 6e65 2c0d 0a20 2020 2020    i=None,..     
+000073f0: 2020 2020 2073 6176 655f 6173 5f66 696c       save_as_fil
+00007400: 653d 5472 7565 2c0d 0a20 2020 2020 2020  e=True,..       
+00007410: 2020 206d 7367 3d4e 6f6e 652c 0d0a 2020     msg=None,..  
+00007420: 2020 2020 2020 2020 6e6f 6d73 673d 4661          nomsg=Fa
+00007430: 6c73 652c 0d0a 2020 2020 2020 2020 2020  lse,..          
+00007440: 7469 636b 735f 7065 725f 6265 6174 3d4e  ticks_per_beat=N
+00007450: 6f6e 652c 0d0a 2020 2020 2020 2020 2020  one,..          
+00007460: 6967 6e6f 7265 5f69 6e73 7472 756d 656e  ignore_instrumen
+00007470: 743d 4661 6c73 652c 0d0a 2020 2020 2020  t=False,..      
+00007480: 2020 2020 6967 6e6f 7265 5f62 706d 3d46      ignore_bpm=F
+00007490: 616c 7365 2c0d 0a20 2020 2020 2020 2020  alse,..         
+000074a0: 2069 676e 6f72 655f 7472 6163 6b5f 6e61   ignore_track_na
+000074b0: 6d65 733d 4661 6c73 652c 0d0a 2020 2020  mes=False,..    
+000074c0: 2020 2020 2020 2a2a 6d69 6469 5f61 7267        **midi_arg
+000074d0: 7329 3a0d 0a20 2020 2069 6620 6920 6973  s):..    if i is
+000074e0: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
+000074f0: 2020 2020 696e 7374 7275 6d65 6e74 203d      instrument =
+00007500: 2069 0d0a 2020 2020 6973 5f74 7261 636b   i..    is_track
+00007510: 5f74 7970 6520 3d20 4661 6c73 650d 0a20  _type = False.. 
+00007520: 2020 2069 735f 7069 6563 655f 6c69 6b65     is_piece_like
+00007530: 5f74 7970 6520 3d20 5472 7565 0d0a 2020  _type = True..  
+00007540: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00007550: 6375 7272 656e 745f 6368 6f72 642c 206e  current_chord, n
+00007560: 6f74 6529 3a0d 0a20 2020 2020 2020 2063  ote):..        c
+00007570: 7572 7265 6e74 5f63 686f 7264 203d 2063  urrent_chord = c
+00007580: 686f 7264 285b 6375 7272 656e 745f 6368  hord([current_ch
+00007590: 6f72 645d 290d 0a20 2020 2065 6c69 6620  ord])..    elif 
+000075a0: 6973 696e 7374 616e 6365 2863 7572 7265  isinstance(curre
+000075b0: 6e74 5f63 686f 7264 2c20 6c69 7374 293a  nt_chord, list):
+000075c0: 0d0a 2020 2020 2020 2020 6375 7272 656e  ..        curren
+000075d0: 745f 6368 6f72 6420 3d20 636f 6e63 6174  t_chord = concat
+000075e0: 2863 7572 7265 6e74 5f63 686f 7264 2c20  (current_chord, 
+000075f0: 277c 2729 0d0a 2020 2020 6966 2069 7369  '|')..    if isi
+00007600: 6e73 7461 6e63 6528 6375 7272 656e 745f  nstance(current_
+00007610: 6368 6f72 642c 2063 686f 7264 293a 0d0a  chord, chord):..
+00007620: 2020 2020 2020 2020 6973 5f74 7261 636b          is_track
+00007630: 5f74 7970 6520 3d20 5472 7565 0d0a 2020  _type = True..  
+00007640: 2020 2020 2020 6973 5f70 6965 6365 5f6c        is_piece_l
+00007650: 696b 655f 7479 7065 203d 2046 616c 7365  ike_type = False
+00007660: 0d0a 2020 2020 2020 2020 6966 2069 6e73  ..        if ins
+00007670: 7472 756d 656e 7420 6973 204e 6f6e 653a  trument is None:
+00007680: 0d0a 2020 2020 2020 2020 2020 2020 696e  ..            in
+00007690: 7374 7275 6d65 6e74 203d 2031 0d0a 2020  strument = 1..  
+000076a0: 2020 2020 2020 6375 7272 656e 745f 6368        current_ch
+000076b0: 6f72 6420 3d20 5028 0d0a 2020 2020 2020  ord = P(..      
+000076c0: 2020 2020 2020 7472 6163 6b73 3d5b 6375        tracks=[cu
+000076d0: 7272 656e 745f 6368 6f72 645d 2c0d 0a20  rrent_chord],.. 
+000076e0: 2020 2020 2020 2020 2020 2069 6e73 7472             instr
+000076f0: 756d 656e 7473 3d5b 696e 7374 7275 6d65  uments=[instrume
+00007700: 6e74 5d2c 0d0a 2020 2020 2020 2020 2020  nt],..          
+00007710: 2020 6270 6d3d 6270 6d2c 0d0a 2020 2020    bpm=bpm,..    
+00007720: 2020 2020 2020 2020 6368 616e 6e65 6c73          channels
+00007730: 3d5b 6368 616e 6e65 6c5d 2c0d 0a20 2020  =[channel],..   
+00007740: 2020 2020 2020 2020 2073 7461 7274 5f74           start_t
+00007750: 696d 6573 3d5b 0d0a 2020 2020 2020 2020  imes=[..        
+00007760: 2020 2020 2020 2020 6375 7272 656e 745f          current_
+00007770: 6368 6f72 642e 7374 6172 745f 7469 6d65  chord.start_time
+00007780: 2069 6620 7374 6172 745f 7469 6d65 2069   if start_time i
+00007790: 7320 4e6f 6e65 2065 6c73 6520 7374 6172  s None else star
+000077a0: 745f 7469 6d65 0d0a 2020 2020 2020 2020  t_time..        
+000077b0: 2020 2020 5d2c 0d0a 2020 2020 2020 2020      ],..        
+000077c0: 2020 2020 6f74 6865 725f 6d65 7373 6167      other_messag
+000077d0: 6573 3d63 7572 7265 6e74 5f63 686f 7264  es=current_chord
+000077e0: 2e6f 7468 6572 5f6d 6573 7361 6765 7329  .other_messages)
+000077f0: 0d0a 2020 2020 656c 6966 2069 7369 6e73  ..    elif isins
+00007800: 7461 6e63 6528 6375 7272 656e 745f 6368  tance(current_ch
+00007810: 6f72 642c 2074 7261 636b 293a 0d0a 2020  ord, track):..  
+00007820: 2020 2020 2020 6973 5f74 7261 636b 5f74        is_track_t
+00007830: 7970 6520 3d20 5472 7565 0d0a 2020 2020  ype = True..    
+00007840: 2020 2020 6966 2068 6173 6174 7472 2863      if hasattr(c
+00007850: 7572 7265 6e74 5f63 686f 7264 2c20 276f  urrent_chord, 'o
+00007860: 7468 6572 5f6d 6573 7361 6765 7327 293a  ther_messages'):
+00007870: 0d0a 2020 2020 2020 2020 2020 2020 6d73  ..            ms
+00007880: 6720 3d20 6375 7272 656e 745f 6368 6f72  g = current_chor
+00007890: 642e 6f74 6865 725f 6d65 7373 6167 6573  d.other_messages
+000078a0: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+000078b0: 0a20 2020 2020 2020 2020 2020 206d 7367  .            msg
+000078c0: 203d 2063 7572 7265 6e74 5f63 686f 7264   = current_chord
+000078d0: 2e63 6f6e 7465 6e74 2e6f 7468 6572 5f6d  .content.other_m
+000078e0: 6573 7361 6765 730d 0a20 2020 2020 2020  essages..       
+000078f0: 2063 7572 7265 6e74 5f63 686f 7264 203d   current_chord =
+00007900: 2062 7569 6c64 2863 7572 7265 6e74 5f63   build(current_c
+00007910: 686f 7264 2c20 6270 6d3d 6375 7272 656e  hord, bpm=curren
+00007920: 745f 6368 6f72 642e 6270 6d29 0d0a 2020  t_chord.bpm)..  
+00007930: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
+00007940: 6528 6375 7272 656e 745f 6368 6f72 642c  e(current_chord,
+00007950: 2064 7275 6d29 3a0d 0a20 2020 2020 2020   drum):..       
+00007960: 2069 735f 7472 6163 6b5f 7479 7065 203d   is_track_type =
+00007970: 2054 7275 650d 0a20 2020 2020 2020 2069   True..        i
+00007980: 735f 7069 6563 655f 6c69 6b65 5f74 7970  s_piece_like_typ
+00007990: 6520 3d20 4661 6c73 650d 0a20 2020 2020  e = False..     
+000079a0: 2020 2069 6620 6861 7361 7474 7228 6375     if hasattr(cu
+000079b0: 7272 656e 745f 6368 6f72 642c 2027 6f74  rrent_chord, 'ot
+000079c0: 6865 725f 6d65 7373 6167 6573 2729 3a0d  her_messages'):.
+000079d0: 0a20 2020 2020 2020 2020 2020 206d 7367  .            msg
+000079e0: 203d 2063 7572 7265 6e74 5f63 686f 7264   = current_chord
+000079f0: 2e6f 7468 6572 5f6d 6573 7361 6765 730d  .other_messages.
+00007a00: 0a20 2020 2020 2020 2063 7572 7265 6e74  .        current
+00007a10: 5f63 686f 7264 203d 2050 2874 7261 636b  _chord = P(track
+00007a20: 733d 5b63 7572 7265 6e74 5f63 686f 7264  s=[current_chord
+00007a30: 2e6e 6f74 6573 5d2c 0d0a 2020 2020 2020  .notes],..      
+00007a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007a50: 2020 2020 696e 7374 7275 6d65 6e74 733d      instruments=
+00007a60: 5b63 7572 7265 6e74 5f63 686f 7264 2e69  [current_chord.i
+00007a70: 6e73 7472 756d 656e 745d 2c0d 0a20 2020  nstrument],..   
+00007a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007a90: 2020 2020 2020 2062 706d 3d62 706d 2c0d         bpm=bpm,.
+00007aa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007ab0: 2020 2020 2020 2020 2020 2073 7461 7274             start
+00007ac0: 5f74 696d 6573 3d5b 0d0a 2020 2020 2020  _times=[..      
+00007ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007ae0: 2020 2020 2020 2020 6375 7272 656e 745f          current_
+00007af0: 6368 6f72 642e 6e6f 7465 732e 7374 6172  chord.notes.star
+00007b00: 745f 7469 6d65 0d0a 2020 2020 2020 2020  t_time..        
+00007b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007b20: 2020 2020 2020 6966 2073 7461 7274 5f74        if start_t
+00007b30: 696d 6520 6973 204e 6f6e 6520 656c 7365  ime is None else
+00007b40: 2073 7461 7274 5f74 696d 650d 0a20 2020   start_time..   
+00007b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007b60: 2020 2020 2020 205d 2c0d 0a20 2020 2020         ],..     
+00007b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007b80: 2020 2020 2063 6861 6e6e 656c 733d 5b39       channels=[9
+00007b90: 5d29 0d0a 2020 2020 7472 6163 6b5f 6e75  ])..    track_nu
+00007ba0: 6d62 6572 2c20 7374 6172 745f 7469 6d65  mber, start_time
+00007bb0: 732c 2069 6e73 7472 756d 656e 7473 2c20  s, instruments, 
+00007bc0: 6270 6d2c 2074 7261 636b 735f 636f 6e74  bpm, tracks_cont
+00007bd0: 656e 7473 2c20 7472 6163 6b5f 6e61 6d65  ents, track_name
+00007be0: 732c 2063 6861 6e6e 656c 732c 2070 616e  s, channels, pan
+00007bf0: 5f6d 7367 2c20 766f 6c75 6d65 5f6d 7367  _msg, volume_msg
+00007c00: 203d 205c 0d0a 2020 2020 6375 7272 656e   = \..    curren
+00007c10: 745f 6368 6f72 642e 7472 6163 6b5f 6e75  t_chord.track_nu
+00007c20: 6d62 6572 2c20 6375 7272 656e 745f 6368  mber, current_ch
+00007c30: 6f72 642e 7374 6172 745f 7469 6d65 732c  ord.start_times,
+00007c40: 2063 7572 7265 6e74 5f63 686f 7264 2e69   current_chord.i
+00007c50: 6e73 7472 756d 656e 7473 2c20 6375 7272  nstruments, curr
+00007c60: 656e 745f 6368 6f72 642e 6270 6d2c 2063  ent_chord.bpm, c
+00007c70: 7572 7265 6e74 5f63 686f 7264 2e74 7261  urrent_chord.tra
+00007c80: 636b 732c 2063 7572 7265 6e74 5f63 686f  cks, current_cho
+00007c90: 7264 2e74 7261 636b 5f6e 616d 6573 2c20  rd.track_names, 
+00007ca0: 6375 7272 656e 745f 6368 6f72 642e 6368  current_chord.ch
+00007cb0: 616e 6e65 6c73 2c20 6375 7272 656e 745f  annels, current_
+00007cc0: 6368 6f72 642e 7061 6e2c 2063 7572 7265  chord.pan, curre
+00007cd0: 6e74 5f63 686f 7264 2e76 6f6c 756d 650d  nt_chord.volume.
+00007ce0: 0a20 2020 2069 6e73 7472 756d 656e 7473  .    instruments
+00007cf0: 203d 205b 0d0a 2020 2020 2020 2020 6920   = [..        i 
+00007d00: 6966 2069 7369 6e73 7461 6e63 6528 692c  if isinstance(i,
+00007d10: 2069 6e74 2920 656c 7365 2064 6174 6162   int) else datab
+00007d20: 6173 652e 494e 5354 5255 4d45 4e54 535b  ase.INSTRUMENTS[
+00007d30: 695d 0d0a 2020 2020 2020 2020 666f 7220  i]..        for 
+00007d40: 6920 696e 2069 6e73 7472 756d 656e 7473  i in instruments
+00007d50: 0d0a 2020 2020 5d0d 0a20 2020 2069 6620  ..    ]..    if 
+00007d60: 7469 636b 735f 7065 725f 6265 6174 2069  ticks_per_beat i
+00007d70: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+00007d80: 2069 6620 6375 7272 656e 745f 6368 6f72   if current_chor
+00007d90: 642e 7469 636b 735f 7065 725f 6265 6174  d.ticks_per_beat
+00007da0: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
+00007db0: 2020 2020 2020 2020 2020 2074 6963 6b73             ticks
+00007dc0: 5f70 6572 5f62 6561 7420 3d20 6375 7272  _per_beat = curr
+00007dd0: 656e 745f 6368 6f72 642e 7469 636b 735f  ent_chord.ticks_
+00007de0: 7065 725f 6265 6174 0d0a 2020 2020 2020  per_beat..      
+00007df0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00007e00: 2020 2020 2074 6963 6b73 5f70 6572 5f62       ticks_per_b
+00007e10: 6561 7420 3d20 3936 300d 0a20 2020 2063  eat = 960..    c
+00007e20: 7572 7265 6e74 5f6d 6964 6920 3d20 6d69  urrent_midi = mi
+00007e30: 646f 2e4d 6964 6946 696c 6528 7469 636b  do.MidiFile(tick
+00007e40: 735f 7065 725f 6265 6174 3d74 6963 6b73  s_per_beat=ticks
+00007e50: 5f70 6572 5f62 6561 742c 202a 2a6d 6964  _per_beat, **mid
+00007e60: 695f 6172 6773 290d 0a20 2020 2063 7572  i_args)..    cur
+00007e70: 7265 6e74 5f6d 6964 692e 7472 6163 6b73  rent_midi.tracks
+00007e80: 2e65 7874 656e 6428 5b6d 6964 6f2e 4d69  .extend([mido.Mi
+00007e90: 6469 5472 6163 6b28 2920 666f 7220 6920  diTrack() for i 
+00007ea0: 696e 2072 616e 6765 2874 7261 636b 5f6e  in range(track_n
+00007eb0: 756d 6265 7229 5d29 0d0a 2020 2020 6966  umber)])..    if
+00007ec0: 206e 6f74 2069 676e 6f72 655f 6270 6d3a   not ignore_bpm:
+00007ed0: 0d0a 2020 2020 2020 2020 6375 7272 656e  ..        curren
+00007ee0: 745f 6d69 6469 2e74 7261 636b 735b 305d  t_midi.tracks[0]
+00007ef0: 2e61 7070 656e 6428 0d0a 2020 2020 2020  .append(..      
+00007f00: 2020 2020 2020 6d69 646f 2e4d 6574 614d        mido.MetaM
+00007f10: 6573 7361 6765 2827 7365 745f 7465 6d70  essage('set_temp
+00007f20: 6f27 2c20 7465 6d70 6f3d 6d69 646f 2e62  o', tempo=mido.b
+00007f30: 706d 3274 656d 706f 2862 706d 292c 2074  pm2tempo(bpm), t
+00007f40: 696d 653d 3029 290d 0a20 2020 2069 6e74  ime=0))..    int
+00007f50: 6572 7661 6c5f 756e 6974 203d 2074 6963  erval_unit = tic
+00007f60: 6b73 5f70 6572 5f62 6561 7420 2a20 340d  ks_per_beat * 4.
+00007f70: 0a20 2020 2066 6f72 2069 2069 6e20 7261  .    for i in ra
+00007f80: 6e67 6528 7472 6163 6b5f 6e75 6d62 6572  nge(track_number
+00007f90: 293a 0d0a 2020 2020 2020 2020 6966 2063  ):..        if c
+00007fa0: 6861 6e6e 656c 733a 0d0a 2020 2020 2020  hannels:..      
+00007fb0: 2020 2020 2020 6375 7272 656e 745f 6368        current_ch
+00007fc0: 616e 6e65 6c20 3d20 6368 616e 6e65 6c73  annel = channels
+00007fd0: 5b69 5d0d 0a20 2020 2020 2020 2065 6c73  [i]..        els
+00007fe0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00007ff0: 6375 7272 656e 745f 6368 616e 6e65 6c20  current_channel 
+00008000: 3d20 690d 0a20 2020 2020 2020 2069 6620  = i..        if 
+00008010: 6e6f 7420 6967 6e6f 7265 5f69 6e73 7472  not ignore_instr
+00008020: 756d 656e 743a 0d0a 2020 2020 2020 2020  ument:..        
+00008030: 2020 2020 6375 7272 656e 745f 7072 6f67      current_prog
+00008040: 7261 6d5f 6368 616e 6765 5f65 7665 6e74  ram_change_event
+00008050: 203d 206d 6964 6f2e 4d65 7373 6167 6528   = mido.Message(
+00008060: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00008070: 2020 2770 726f 6772 616d 5f63 6861 6e67    'program_chang
+00008080: 6527 2c0d 0a20 2020 2020 2020 2020 2020  e',..           
+00008090: 2020 2020 2063 6861 6e6e 656c 3d63 7572       channel=cur
+000080a0: 7265 6e74 5f63 6861 6e6e 656c 2c0d 0a20  rent_channel,.. 
+000080b0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+000080c0: 696d 653d 302c 0d0a 2020 2020 2020 2020  ime=0,..        
+000080d0: 2020 2020 2020 2020 7072 6f67 7261 6d3d          program=
+000080e0: 696e 7374 7275 6d65 6e74 735b 695d 202d  instruments[i] -
+000080f0: 2031 290d 0a20 2020 2020 2020 2020 2020   1)..           
+00008100: 2063 7572 7265 6e74 5f6d 6964 692e 7472   current_midi.tr
+00008110: 6163 6b73 5b69 5d2e 6170 7065 6e64 2863  acks[i].append(c
+00008120: 7572 7265 6e74 5f70 726f 6772 616d 5f63  urrent_program_c
+00008130: 6861 6e67 655f 6576 656e 7429 0d0a 2020  hange_event)..  
+00008140: 2020 2020 2020 6966 206e 6f74 2069 676e        if not ign
+00008150: 6f72 655f 7472 6163 6b5f 6e61 6d65 7320  ore_track_names 
+00008160: 616e 6420 7472 6163 6b5f 6e61 6d65 733a  and track_names:
+00008170: 0d0a 2020 2020 2020 2020 2020 2020 6375  ..            cu
+00008180: 7272 656e 745f 6d69 6469 2e74 7261 636b  rrent_midi.track
+00008190: 735b 695d 2e61 7070 656e 6428 0d0a 2020  s[i].append(..  
+000081a0: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
+000081b0: 646f 2e4d 6574 614d 6573 7361 6765 2827  do.MetaMessage('
+000081c0: 7472 6163 6b5f 6e61 6d65 272c 2074 696d  track_name', tim
+000081d0: 653d 302c 206e 616d 653d 7472 6163 6b5f  e=0, name=track_
+000081e0: 6e61 6d65 735b 695d 2929 0d0a 0d0a 2020  names[i]))....  
+000081f0: 2020 2020 2020 6375 7272 656e 745f 7061        current_pa
+00008200: 6e5f 6d73 6720 3d20 7061 6e5f 6d73 675b  n_msg = pan_msg[
+00008210: 695d 0d0a 2020 2020 2020 2020 6966 2063  i]..        if c
+00008220: 7572 7265 6e74 5f70 616e 5f6d 7367 3a0d  urrent_pan_msg:.
+00008230: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00008240: 2065 6163 6820 696e 2063 7572 7265 6e74   each in current
+00008250: 5f70 616e 5f6d 7367 3a0d 0a20 2020 2020  _pan_msg:..     
+00008260: 2020 2020 2020 2020 2020 2063 7572 7265             curre
+00008270: 6e74 5f70 616e 5f74 7261 636b 203d 2069  nt_pan_track = i
+00008280: 2069 6620 6561 6368 2e74 7261 636b 2069   if each.track i
+00008290: 7320 4e6f 6e65 2065 6c73 6520 6561 6368  s None else each
+000082a0: 2e74 7261 636b 0d0a 2020 2020 2020 2020  .track..        
+000082b0: 2020 2020 2020 2020 6375 7272 656e 745f          current_
+000082c0: 7061 6e5f 6368 616e 6e65 6c20 3d20 6375  pan_channel = cu
+000082d0: 7272 656e 745f 6368 616e 6e65 6c20 6966  rrent_channel if
+000082e0: 2065 6163 682e 6368 616e 6e65 6c20 6973   each.channel is
+000082f0: 204e 6f6e 6520 656c 7365 2065 6163 682e   None else each.
+00008300: 6368 616e 6e65 6c0d 0a20 2020 2020 2020  channel..       
+00008310: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+00008320: 5f6d 6964 692e 7472 6163 6b73 5b0d 0a20  _midi.tracks[.. 
+00008330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008340: 2020 2063 7572 7265 6e74 5f70 616e 5f74     current_pan_t
+00008350: 7261 636b 2069 6620 6e6f 7420 6973 5f74  rack if not is_t
+00008360: 7261 636b 5f74 7970 6520 656c 7365 2030  rack_type else 0
+00008370: 5d2e 6170 7065 6e64 280d 0a20 2020 2020  ].append(..     
+00008380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008390: 2020 206d 6964 6f2e 4d65 7373 6167 6528     mido.Message(
+000083a0: 2763 6f6e 7472 6f6c 5f63 6861 6e67 6527  'control_change'
+000083b0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000083c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000083d0: 2020 2020 2020 2020 6368 616e 6e65 6c3d          channel=
+000083e0: 6375 7272 656e 745f 7061 6e5f 6368 616e  current_pan_chan
+000083f0: 6e65 6c2c 0d0a 2020 2020 2020 2020 2020  nel,..          
+00008400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008410: 2020 2020 2020 2020 2020 2074 696d 653d             time=
+00008420: 696e 7428 6561 6368 2e73 7461 7274 5f74  int(each.start_t
+00008430: 696d 6520 2a20 696e 7465 7276 616c 5f75  ime * interval_u
+00008440: 6e69 7429 2c0d 0a20 2020 2020 2020 2020  nit),..         
+00008450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008460: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00008470: 726f 6c3d 3130 2c0d 0a20 2020 2020 2020  rol=10,..       
+00008480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008490: 2020 2020 2020 2020 2020 2020 2020 7661                va
+000084a0: 6c75 653d 6561 6368 2e76 616c 7565 2929  lue=each.value))
+000084b0: 0d0a 2020 2020 2020 2020 6375 7272 656e  ..        curren
+000084c0: 745f 766f 6c75 6d65 5f6d 7367 203d 2076  t_volume_msg = v
+000084d0: 6f6c 756d 655f 6d73 675b 695d 0d0a 2020  olume_msg[i]..  
+000084e0: 2020 2020 2020 6966 2063 7572 7265 6e74        if current
+000084f0: 5f76 6f6c 756d 655f 6d73 673a 0d0a 2020  _volume_msg:..  
+00008500: 2020 2020 2020 2020 2020 666f 7220 6561            for ea
+00008510: 6368 2069 6e20 6375 7272 656e 745f 766f  ch in current_vo
+00008520: 6c75 6d65 5f6d 7367 3a0d 0a20 2020 2020  lume_msg:..     
+00008530: 2020 2020 2020 2020 2020 2063 7572 7265             curre
+00008540: 6e74 5f76 6f6c 756d 655f 6368 616e 6e65  nt_volume_channe
+00008550: 6c20 3d20 6375 7272 656e 745f 6368 616e  l = current_chan
+00008560: 6e65 6c20 6966 2065 6163 682e 6368 616e  nel if each.chan
+00008570: 6e65 6c20 6973 204e 6f6e 6520 656c 7365  nel is None else
+00008580: 2065 6163 682e 6368 616e 6e65 6c0d 0a20   each.channel.. 
+00008590: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000085a0: 7572 7265 6e74 5f76 6f6c 756d 655f 7472  urrent_volume_tr
+000085b0: 6163 6b20 3d20 6920 6966 2065 6163 682e  ack = i if each.
+000085c0: 7472 6163 6b20 6973 204e 6f6e 6520 656c  track is None el
+000085d0: 7365 2065 6163 682e 7472 6163 6b0d 0a20  se each.track.. 
+000085e0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000085f0: 7572 7265 6e74 5f6d 6964 692e 7472 6163  urrent_midi.trac
+00008600: 6b73 5b0d 0a20 2020 2020 2020 2020 2020  ks[..           
+00008610: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+00008620: 5f76 6f6c 756d 655f 7472 6163 6b20 6966  _volume_track if
+00008630: 206e 6f74 2069 735f 7472 6163 6b5f 7479   not is_track_ty
+00008640: 7065 2065 6c73 6520 305d 2e61 7070 656e  pe else 0].appen
+00008650: 6428 0d0a 2020 2020 2020 2020 2020 2020  d(..            
+00008660: 2020 2020 2020 2020 2020 2020 6d69 646f              mido
+00008670: 2e4d 6573 7361 6765 2827 636f 6e74 726f  .Message('contro
+00008680: 6c5f 6368 616e 6765 272c 0d0a 2020 2020  l_change',..    
+00008690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000086a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000086b0: 2063 6861 6e6e 656c 3d63 7572 7265 6e74   channel=current
+000086c0: 5f76 6f6c 756d 655f 6368 616e 6e65 6c2c  _volume_channel,
+000086d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000086e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000086f0: 2020 2020 2020 2074 696d 653d 696e 7428         time=int(
+00008700: 6561 6368 2e73 7461 7274 5f74 696d 6520  each.start_time 
+00008710: 2a20 696e 7465 7276 616c 5f75 6e69 7429  * interval_unit)
+00008720: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00008730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008740: 2020 2020 2020 2020 636f 6e74 726f 6c3d          control=
+00008750: 372c 0d0a 2020 2020 2020 2020 2020 2020  7,..            
+00008760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008770: 2020 2020 2020 2020 2076 616c 7565 3d65           value=e
+00008780: 6163 682e 7661 6c75 6529 290d 0a0d 0a20  ach.value)).... 
+00008790: 2020 2020 2020 2063 6f6e 7465 6e74 203d         content =
+000087a0: 2074 7261 636b 735f 636f 6e74 656e 7473   tracks_contents
+000087b0: 5b69 5d0d 0a20 2020 2020 2020 2063 6f6e  [i]..        con
+000087c0: 7465 6e74 5f6e 6f74 6573 203d 2063 6f6e  tent_notes = con
+000087d0: 7465 6e74 2e6e 6f74 6573 0d0a 2020 2020  tent.notes..    
+000087e0: 2020 2020 636f 6e74 656e 745f 696e 7465      content_inte
+000087f0: 7276 616c 7320 3d20 636f 6e74 656e 742e  rvals = content.
+00008800: 696e 7465 7276 616c 0d0a 2020 2020 2020  interval..      
+00008810: 2020 6375 7272 656e 745f 7374 6172 745f    current_start_
+00008820: 7469 6d65 203d 2073 7461 7274 5f74 696d  time = start_tim
+00008830: 6573 5b69 5d0d 0a20 2020 2020 2020 2069  es[i]..        i
+00008840: 6620 6973 5f70 6965 6365 5f6c 696b 655f  f is_piece_like_
+00008850: 7479 7065 3a0d 0a20 2020 2020 2020 2020  type:..         
+00008860: 2020 2063 7572 7265 6e74 5f73 7461 7274     current_start
+00008870: 5f74 696d 6520 2b3d 2063 6f6e 7465 6e74  _time += content
+00008880: 2e73 7461 7274 5f74 696d 650d 0a20 2020  .start_time..   
+00008890: 2020 2020 2063 7572 7265 6e74 5f73 7461       current_sta
+000088a0: 7274 5f74 696d 6520 3d20 6375 7272 656e  rt_time = curren
+000088b0: 745f 7374 6172 745f 7469 6d65 202a 2069  t_start_time * i
+000088c0: 6e74 6572 7661 6c5f 756e 6974 0d0a 2020  nterval_unit..  
+000088d0: 2020 2020 2020 666f 7220 6a20 696e 2072        for j in r
+000088e0: 616e 6765 286c 656e 2863 6f6e 7465 6e74  ange(len(content
+000088f0: 2929 3a0d 0a20 2020 2020 2020 2020 2020  )):..           
+00008900: 2063 7572 7265 6e74 5f6e 6f74 6520 3d20   current_note = 
+00008910: 636f 6e74 656e 745f 6e6f 7465 735b 6a5d  content_notes[j]
+00008920: 0d0a 2020 2020 2020 2020 2020 2020 6375  ..            cu
+00008930: 7272 656e 745f 6e6f 7465 5f6f 6e5f 6d65  rrent_note_on_me
+00008940: 7373 6167 6520 3d20 6d69 646f 2e4d 6573  ssage = mido.Mes
+00008950: 7361 6765 280d 0a20 2020 2020 2020 2020  sage(..         
+00008960: 2020 2020 2020 2027 6e6f 7465 5f6f 6e27         'note_on'
+00008970: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00008980: 2020 2074 696d 653d 696e 7428 6375 7272     time=int(curr
+00008990: 656e 745f 7374 6172 745f 7469 6d65 292c  ent_start_time),
+000089a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000089b0: 2020 6368 616e 6e65 6c3d 6375 7272 656e    channel=curren
+000089c0: 745f 6368 616e 6e65 6c0d 0a20 2020 2020  t_channel..     
+000089d0: 2020 2020 2020 2020 2020 2069 6620 6375             if cu
+000089e0: 7272 656e 745f 6e6f 7465 2e63 6861 6e6e  rrent_note.chann
+000089f0: 656c 2069 7320 4e6f 6e65 2065 6c73 6520  el is None else 
+00008a00: 6375 7272 656e 745f 6e6f 7465 2e63 6861  current_note.cha
+00008a10: 6e6e 656c 2c0d 0a20 2020 2020 2020 2020  nnel,..         
+00008a20: 2020 2020 2020 206e 6f74 653d 6375 7272         note=curr
+00008a30: 656e 745f 6e6f 7465 2e64 6567 7265 652c  ent_note.degree,
+00008a40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00008a50: 2020 7665 6c6f 6369 7479 3d63 7572 7265    velocity=curre
+00008a60: 6e74 5f6e 6f74 652e 766f 6c75 6d65 290d  nt_note.volume).
+00008a70: 0a20 2020 2020 2020 2020 2020 2063 7572  .            cur
+00008a80: 7265 6e74 5f6e 6f74 655f 6f66 665f 6d65  rent_note_off_me
+00008a90: 7373 6167 6520 3d20 6d69 646f 2e4d 6573  ssage = mido.Mes
+00008aa0: 7361 6765 280d 0a20 2020 2020 2020 2020  sage(..         
+00008ab0: 2020 2020 2020 2027 6e6f 7465 5f6f 6666         'note_off
+00008ac0: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
+00008ad0: 2020 2020 7469 6d65 3d69 6e74 2863 7572      time=int(cur
+00008ae0: 7265 6e74 5f73 7461 7274 5f74 696d 6520  rent_start_time 
+00008af0: 2b0d 0a20 2020 2020 2020 2020 2020 2020  +..             
+00008b00: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+00008b10: 656e 745f 6e6f 7465 2e64 7572 6174 696f  ent_note.duratio
+00008b20: 6e20 2a20 696e 7465 7276 616c 5f75 6e69  n * interval_uni
+00008b30: 7429 2c0d 0a20 2020 2020 2020 2020 2020  t),..           
+00008b40: 2020 2020 2063 6861 6e6e 656c 3d63 7572       channel=cur
+00008b50: 7265 6e74 5f63 6861 6e6e 656c 0d0a 2020  rent_channel..  
+00008b60: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00008b70: 2063 7572 7265 6e74 5f6e 6f74 652e 6368   current_note.ch
+00008b80: 616e 6e65 6c20 6973 204e 6f6e 6520 656c  annel is None el
+00008b90: 7365 2063 7572 7265 6e74 5f6e 6f74 652e  se current_note.
+00008ba0: 6368 616e 6e65 6c2c 0d0a 2020 2020 2020  channel,..      
+00008bb0: 2020 2020 2020 2020 2020 6e6f 7465 3d63            note=c
+00008bc0: 7572 7265 6e74 5f6e 6f74 652e 6465 6772  urrent_note.degr
+00008bd0: 6565 2c0d 0a20 2020 2020 2020 2020 2020  ee,..           
+00008be0: 2020 2020 2076 656c 6f63 6974 793d 6375       velocity=cu
+00008bf0: 7272 656e 745f 6e6f 7465 2e76 6f6c 756d  rrent_note.volum
+00008c00: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+00008c10: 6375 7272 656e 745f 6d69 6469 2e74 7261  current_midi.tra
+00008c20: 636b 735b 695d 2e61 7070 656e 6428 6375  cks[i].append(cu
+00008c30: 7272 656e 745f 6e6f 7465 5f6f 6e5f 6d65  rrent_note_on_me
+00008c40: 7373 6167 6529 0d0a 2020 2020 2020 2020  ssage)..        
+00008c50: 2020 2020 6375 7272 656e 745f 6d69 6469      current_midi
+00008c60: 2e74 7261 636b 735b 695d 2e61 7070 656e  .tracks[i].appen
+00008c70: 6428 6375 7272 656e 745f 6e6f 7465 5f6f  d(current_note_o
+00008c80: 6666 5f6d 6573 7361 6765 290d 0a20 2020  ff_message)..   
+00008c90: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+00008ca0: 5f73 7461 7274 5f74 696d 6520 2b3d 2063  _start_time += c
+00008cb0: 6f6e 7465 6e74 5f69 6e74 6572 7661 6c73  ontent_intervals
+00008cc0: 5b6a 5d20 2a20 696e 7465 7276 616c 5f75  [j] * interval_u
+00008cd0: 6e69 740d 0a20 2020 2020 2020 2066 6f72  nit..        for
+00008ce0: 2065 6163 6820 696e 2063 6f6e 7465 6e74   each in content
+00008cf0: 2e74 656d 706f 733a 0d0a 2020 2020 2020  .tempos:..      
+00008d00: 2020 2020 2020 6966 2065 6163 682e 7374        if each.st
+00008d10: 6172 745f 7469 6d65 203c 2030 3a0d 0a20  art_time < 0:.. 
+00008d20: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00008d30: 656d 706f 5f63 6861 6e67 655f 7469 6d65  empo_change_time
+00008d40: 203d 2030 0d0a 2020 2020 2020 2020 2020   = 0..          
+00008d50: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00008d60: 2020 2020 2020 2020 2074 656d 706f 5f63           tempo_c
+00008d70: 6861 6e67 655f 7469 6d65 203d 2065 6163  hange_time = eac
+00008d80: 682e 7374 6172 745f 7469 6d65 202a 2069  h.start_time * i
+00008d90: 6e74 6572 7661 6c5f 756e 6974 0d0a 2020  nterval_unit..  
+00008da0: 2020 2020 2020 2020 2020 6375 7272 656e            curren
+00008db0: 745f 6d69 6469 2e74 7261 636b 735b 305d  t_midi.tracks[0]
+00008dc0: 2e61 7070 656e 6428 0d0a 2020 2020 2020  .append(..      
+00008dd0: 2020 2020 2020 2020 2020 6d69 646f 2e4d            mido.M
+00008de0: 6574 614d 6573 7361 6765 2827 7365 745f  etaMessage('set_
+00008df0: 7465 6d70 6f27 2c0d 0a20 2020 2020 2020  tempo',..       
+00008e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008e10: 2020 2020 2020 2020 2020 7469 6d65 3d69            time=i
+00008e20: 6e74 2874 656d 706f 5f63 6861 6e67 655f  nt(tempo_change_
+00008e30: 7469 6d65 292c 0d0a 2020 2020 2020 2020  time),..        
+00008e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008e50: 2020 2020 2020 2020 2074 656d 706f 3d6d           tempo=m
+00008e60: 6964 6f2e 6270 6d32 7465 6d70 6f28 6561  ido.bpm2tempo(ea
+00008e70: 6368 2e62 706d 2929 290d 0a20 2020 2020  ch.bpm)))..     
+00008e80: 2020 2066 6f72 2065 6163 6820 696e 2063     for each in c
+00008e90: 6f6e 7465 6e74 2e70 6974 6368 5f62 656e  ontent.pitch_ben
+00008ea0: 6473 3a0d 0a20 2020 2020 2020 2020 2020  ds:..           
+00008eb0: 2069 6620 6561 6368 2e73 7461 7274 5f74   if each.start_t
+00008ec0: 696d 6520 3c20 303a 0d0a 2020 2020 2020  ime < 0:..      
+00008ed0: 2020 2020 2020 2020 2020 7069 7463 685f            pitch_
+00008ee0: 6265 6e64 5f74 696d 6520 3d20 300d 0a20  bend_time = 0.. 
+00008ef0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00008f00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00008f10: 2020 7069 7463 685f 6265 6e64 5f74 696d    pitch_bend_tim
+00008f20: 6520 3d20 6561 6368 2e73 7461 7274 5f74  e = each.start_t
+00008f30: 696d 6520 2a20 696e 7465 7276 616c 5f75  ime * interval_u
+00008f40: 6e69 740d 0a20 2020 2020 2020 2020 2020  nit..           
+00008f50: 2070 6974 6368 5f62 656e 645f 7472 6163   pitch_bend_trac
+00008f60: 6b20 3d20 6920 6966 2065 6163 682e 7472  k = i if each.tr
+00008f70: 6163 6b20 6973 204e 6f6e 6520 656c 7365  ack is None else
+00008f80: 2065 6163 682e 7472 6163 6b0d 0a20 2020   each.track..   
+00008f90: 2020 2020 2020 2020 2070 6974 6368 5f62           pitch_b
+00008fa0: 656e 645f 6368 616e 6e65 6c20 3d20 6375  end_channel = cu
+00008fb0: 7272 656e 745f 6368 616e 6e65 6c20 6966  rrent_channel if
+00008fc0: 2065 6163 682e 6368 616e 6e65 6c20 6973   each.channel is
+00008fd0: 204e 6f6e 6520 656c 7365 2065 6163 682e   None else each.
+00008fe0: 6368 616e 6e65 6c0d 0a20 2020 2020 2020  channel..       
+00008ff0: 2020 2020 2063 7572 7265 6e74 5f6d 6964       current_mid
+00009000: 692e 7472 6163 6b73 5b0d 0a20 2020 2020  i.tracks[..     
+00009010: 2020 2020 2020 2020 2020 2070 6974 6368             pitch
+00009020: 5f62 656e 645f 7472 6163 6b20 6966 206e  _bend_track if n
+00009030: 6f74 2069 735f 7472 6163 6b5f 7479 7065  ot is_track_type
+00009040: 2065 6c73 6520 305d 2e61 7070 656e 6428   else 0].append(
+00009050: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00009060: 2020 2020 2020 6d69 646f 2e4d 6573 7361        mido.Messa
+00009070: 6765 2827 7069 7463 6877 6865 656c 272c  ge('pitchwheel',
+00009080: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00009090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000090a0: 2020 2074 696d 653d 696e 7428 7069 7463     time=int(pitc
+000090b0: 685f 6265 6e64 5f74 696d 6529 2c0d 0a20  h_bend_time),.. 
+000090c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000090d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000090e0: 6368 616e 6e65 6c3d 7069 7463 685f 6265  channel=pitch_be
+000090f0: 6e64 5f63 6861 6e6e 656c 2c0d 0a20 2020  nd_channel,..   
+00009100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009110: 2020 2020 2020 2020 2020 2020 2020 7069                pi
+00009120: 7463 683d 6561 6368 2e76 616c 7565 2929  tch=each.value))
+00009130: 0d0a 0d0a 2020 2020 6966 206e 6f74 206e  ....    if not n
+00009140: 6f6d 7367 3a0d 0a20 2020 2020 2020 2069  omsg:..        i
+00009150: 6620 6375 7272 656e 745f 6368 6f72 642e  f current_chord.
+00009160: 6f74 6865 725f 6d65 7373 6167 6573 3a0d  other_messages:.
+00009170: 0a20 2020 2020 2020 2020 2020 205f 6164  .            _ad
+00009180: 645f 6f74 6865 725f 6d65 7373 6167 6573  d_other_messages
+00009190: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+000091a0: 2020 2063 7572 7265 6e74 5f6d 6964 693d     current_midi=
+000091b0: 6375 7272 656e 745f 6d69 6469 2c0d 0a20  current_midi,.. 
+000091c0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+000091d0: 7468 6572 5f6d 6573 7361 6765 733d 6375  ther_messages=cu
+000091e0: 7272 656e 745f 6368 6f72 642e 6f74 6865  rrent_chord.othe
+000091f0: 725f 6d65 7373 6167 6573 2c0d 0a20 2020  r_messages,..   
+00009200: 2020 2020 2020 2020 2020 2020 2077 7269               wri
+00009210: 7465 5f74 7970 653d 2770 6965 6365 2720  te_type='piece' 
+00009220: 6966 206e 6f74 2069 735f 7472 6163 6b5f  if not is_track_
+00009230: 7479 7065 2065 6c73 6520 2774 7261 636b  type else 'track
+00009240: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
+00009250: 2020 2020 696e 7465 7276 616c 5f75 6e69      interval_uni
+00009260: 743d 696e 7465 7276 616c 5f75 6e69 7429  t=interval_unit)
+00009270: 0d0a 2020 2020 2020 2020 656c 6966 206d  ..        elif m
+00009280: 7367 3a0d 0a20 2020 2020 2020 2020 2020  sg:..           
+00009290: 205f 6164 645f 6f74 6865 725f 6d65 7373   _add_other_mess
+000092a0: 6167 6573 280d 0a20 2020 2020 2020 2020  ages(..         
+000092b0: 2020 2020 2020 2063 7572 7265 6e74 5f6d         current_m
+000092c0: 6964 693d 6375 7272 656e 745f 6d69 6469  idi=current_midi
+000092d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000092e0: 2020 206f 7468 6572 5f6d 6573 7361 6765     other_message
+000092f0: 733d 6d73 672c 0d0a 2020 2020 2020 2020  s=msg,..        
+00009300: 2020 2020 2020 2020 7772 6974 655f 7479          write_ty
+00009310: 7065 3d27 7069 6563 6527 2069 6620 6e6f  pe='piece' if no
+00009320: 7420 6973 5f74 7261 636b 5f74 7970 6520  t is_track_type 
+00009330: 656c 7365 2027 7472 6163 6b27 2c0d 0a20  else 'track',.. 
+00009340: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00009350: 6e74 6572 7661 6c5f 756e 6974 3d69 6e74  nterval_unit=int
+00009360: 6572 7661 6c5f 756e 6974 290d 0a20 2020  erval_unit)..   
+00009370: 2066 6f72 2069 2c20 6561 6368 2069 6e20   for i, each in 
+00009380: 656e 756d 6572 6174 6528 6375 7272 656e  enumerate(curren
+00009390: 745f 6d69 6469 2e74 7261 636b 7329 3a0d  t_midi.tracks):.
+000093a0: 0a20 2020 2020 2020 2072 6573 6574 5f63  .        reset_c
+000093b0: 6f6e 7472 6f6c 5f63 6861 6e67 655f 6c69  ontrol_change_li
+000093c0: 7374 203d 205b 3132 302c 2031 3231 2c20  st = [120, 121, 
+000093d0: 3132 335d 0d0a 2020 2020 2020 2020 6561  123]..        ea
+000093e0: 6368 2e73 6f72 7428 6b65 793d 6c61 6d62  ch.sort(key=lamb
+000093f0: 6461 2073 3a20 2873 2e74 696d 652c 206e  da s: (s.time, n
+00009400: 6f74 2028 732e 6973 5f63 6328 2920 616e  ot (s.is_cc() an
+00009410: 6420 732e 636f 6e74 726f 6c20 696e 0d0a  d s.control in..
+00009420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009440: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00009450: 7365 745f 636f 6e74 726f 6c5f 6368 616e  set_control_chan
+00009460: 6765 5f6c 6973 7429 2929 0d0a 2020 2020  ge_list)))..    
+00009470: 2020 2020 6375 7272 656e 745f 7265 6c61      current_rela
+00009480: 7469 7665 5f74 696d 6520 3d20 5b65 6163  tive_time = [eac
+00009490: 685b 305d 2e74 696d 655d 202b 205b 0d0a  h[0].time] + [..
+000094a0: 2020 2020 2020 2020 2020 2020 6561 6368              each
+000094b0: 5b6a 5d2e 7469 6d65 202d 2065 6163 685b  [j].time - each[
+000094c0: 6a20 2d20 315d 2e74 696d 6520 666f 7220  j - 1].time for 
+000094d0: 6a20 696e 2072 616e 6765 2831 2c20 6c65  j in range(1, le
+000094e0: 6e28 6561 6368 2929 0d0a 2020 2020 2020  n(each))..      
+000094f0: 2020 5d0d 0a20 2020 2020 2020 2066 6f72    ]..        for
+00009500: 206b 2c20 6561 6368 5f6d 7367 2069 6e20   k, each_msg in 
+00009510: 656e 756d 6572 6174 6528 6561 6368 293a  enumerate(each):
+00009520: 0d0a 2020 2020 2020 2020 2020 2020 6561  ..            ea
+00009530: 6368 5f6d 7367 2e74 696d 6520 3d20 6375  ch_msg.time = cu
+00009540: 7272 656e 745f 7265 6c61 7469 7665 5f74  rrent_relative_t
+00009550: 696d 655b 6b5d 0d0a 2020 2020 6966 2073  ime[k]..    if s
+00009560: 6176 655f 6173 5f66 696c 653a 0d0a 2020  ave_as_file:..  
+00009570: 2020 2020 2020 6375 7272 656e 745f 6d69        current_mi
+00009580: 6469 2e73 6176 6528 6e61 6d65 290d 0a20  di.save(name).. 
+00009590: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+000095a0: 2020 6375 7272 656e 745f 696f 203d 2042    current_io = B
+000095b0: 7974 6573 494f 2829 0d0a 2020 2020 2020  ytesIO()..      
+000095c0: 2020 6375 7272 656e 745f 6d69 6469 2e73    current_midi.s
+000095d0: 6176 6528 6669 6c65 3d63 7572 7265 6e74  ave(file=current
+000095e0: 5f69 6f29 0d0a 2020 2020 2020 2020 7265  _io)..        re
+000095f0: 7475 726e 2063 7572 7265 6e74 5f69 6f0d  turn current_io.
+00009600: 0a0d 0a0d 0a64 6566 205f 6164 645f 6f74  .....def _add_ot
+00009610: 6865 725f 6d65 7373 6167 6573 2863 7572  her_messages(cur
+00009620: 7265 6e74 5f6d 6964 692c 0d0a 2020 2020  rent_midi,..    
+00009630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009640: 2020 2020 6f74 6865 725f 6d65 7373 6167      other_messag
+00009650: 6573 2c0d 0a20 2020 2020 2020 2020 2020  es,..           
+00009660: 2020 2020 2020 2020 2020 2020 2077 7269               wri
+00009670: 7465 5f74 7970 653d 2770 6965 6365 272c  te_type='piece',
+00009680: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00009690: 2020 2020 2020 2020 2020 696e 7465 7276            interv
+000096a0: 616c 5f75 6e69 743d 4e6f 6e65 293a 0d0a  al_unit=None):..
+000096b0: 2020 2020 666f 7220 6561 6368 2069 6e20      for each in 
+000096c0: 6f74 6865 725f 6d65 7373 6167 6573 3a0d  other_messages:.
+000096d0: 0a20 2020 2020 2020 2074 7279 3a0d 0a20  .        try:.. 
+000096e0: 2020 2020 2020 2020 2020 2063 7572 7265             curre
+000096f0: 6e74 5f74 696d 6520 3d20 696e 7428 6561  nt_time = int(ea
+00009700: 6368 2e73 7461 7274 5f74 696d 6520 2a20  ch.start_time * 
+00009710: 696e 7465 7276 616c 5f75 6e69 7429 0d0a  interval_unit)..
+00009720: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+00009730: 656e 745f 6174 7472 6962 7574 6573 203d  ent_attributes =
+00009740: 207b 0d0a 2020 2020 2020 2020 2020 2020   {..            
+00009750: 2020 2020 693a 206a 0d0a 2020 2020 2020      i: j..      
+00009760: 2020 2020 2020 2020 2020 666f 7220 692c            for i,
+00009770: 206a 2069 6e20 7661 7273 2865 6163 6829   j in vars(each)
+00009780: 2e69 7465 6d73 2829 0d0a 2020 2020 2020  .items()..      
+00009790: 2020 2020 2020 2020 2020 6966 2069 206e            if i n
+000097a0: 6f74 2069 6e20 5b27 7374 6172 745f 7469  ot in ['start_ti
+000097b0: 6d65 272c 2027 7472 6163 6b27 2c20 2769  me', 'track', 'i
+000097c0: 735f 6d65 7461 275d 0d0a 2020 2020 2020  s_meta']..      
+000097d0: 2020 2020 2020 7d0d 0a20 2020 2020 2020        }..       
+000097e0: 2020 2020 2069 6620 6e6f 7420 6561 6368       if not each
+000097f0: 2e69 735f 6d65 7461 3a0d 0a20 2020 2020  .is_meta:..     
+00009800: 2020 2020 2020 2020 2020 2063 7572 7265             curre
+00009810: 6e74 5f6d 6573 7361 6765 203d 206d 6964  nt_message = mid
+00009820: 6f2e 4d65 7373 6167 6528 7469 6d65 3d63  o.Message(time=c
+00009830: 7572 7265 6e74 5f74 696d 652c 0d0a 2020  urrent_time,..  
+00009840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009860: 2020 2020 2020 2020 2020 2020 202a 2a63               **c
+00009870: 7572 7265 6e74 5f61 7474 7269 6275 7465  urrent_attribute
+00009880: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
+00009890: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+000098a0: 2020 2020 2020 2063 7572 7265 6e74 5f6d         current_m
+000098b0: 6573 7361 6765 203d 206d 6964 6f2e 4d65  essage = mido.Me
+000098c0: 7461 4d65 7373 6167 6528 7469 6d65 3d63  taMessage(time=c
+000098d0: 7572 7265 6e74 5f74 696d 652c 0d0a 2020  urrent_time,..  
+000098e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000098f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009910: 202a 2a63 7572 7265 6e74 5f61 7474 7269   **current_attri
+00009920: 6275 7465 7329 0d0a 2020 2020 2020 2020  butes)..        
+00009930: 6578 6365 7074 3a0d 0a20 2020 2020 2020  except:..       
+00009940: 2020 2020 2063 6f6e 7469 6e75 650d 0a20       continue.. 
+00009950: 2020 2020 2020 2063 7572 7265 6e74 5f74         current_t
+00009960: 7261 636b 203d 2065 6163 682e 7472 6163  rack = each.trac
+00009970: 6b20 6966 2077 7269 7465 5f74 7970 6520  k if write_type 
+00009980: 3d3d 2027 7069 6563 6527 2065 6c73 6520  == 'piece' else 
+00009990: 300d 0a20 2020 2020 2020 2069 6620 6375  0..        if cu
+000099a0: 7272 656e 745f 7472 6163 6b20 3c20 6c65  rrent_track < le
+000099b0: 6e28 6375 7272 656e 745f 6d69 6469 2e74  n(current_midi.t
+000099c0: 7261 636b 7329 3a0d 0a20 2020 2020 2020  racks):..       
+000099d0: 2020 2020 2063 7572 7265 6e74 5f6d 6964       current_mid
+000099e0: 692e 7472 6163 6b73 5b63 7572 7265 6e74  i.tracks[current
+000099f0: 5f74 7261 636b 5d2e 6170 7065 6e64 2863  _track].append(c
+00009a00: 7572 7265 6e74 5f6d 6573 7361 6765 290d  urrent_message).
+00009a10: 0a0d 0a0d 0a64 6566 2066 696e 645f 6669  .....def find_fi
+00009a20: 7273 745f 7465 6d70 6f28 6669 6c65 2c20  rst_tempo(file, 
+00009a30: 6973 5f66 696c 653d 4661 6c73 6529 3a0d  is_file=False):.
+00009a40: 0a20 2020 2069 6620 6973 5f66 696c 653a  .    if is_file:
+00009a50: 0d0a 2020 2020 2020 2020 6669 6c65 2e73  ..        file.s
+00009a60: 6565 6b28 3029 0d0a 2020 2020 2020 2020  eek(0)..        
+00009a70: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+00009a80: 2020 6375 7272 656e 745f 6d69 6469 203d    current_midi =
+00009a90: 206d 6964 6f2e 4d69 6469 4669 6c65 2866   mido.MidiFile(f
+00009aa0: 696c 653d 6669 6c65 2c20 636c 6970 3d54  ile=file, clip=T
+00009ab0: 7275 6529 0d0a 2020 2020 2020 2020 2020  rue)..          
+00009ac0: 2020 6669 6c65 2e63 6c6f 7365 2829 0d0a    file.close()..
+00009ad0: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+00009ae0: 7863 6570 7469 6f6e 2061 7320 4f53 4572  xception as OSEr
+00009af0: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
+00009b00: 2020 6669 6c65 2e73 6565 6b28 3029 0d0a    file.seek(0)..
+00009b10: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+00009b20: 656e 745f 6d69 6469 203d 206d 6964 6f2e  ent_midi = mido.
+00009b30: 4d69 6469 4669 6c65 2866 696c 653d 7269  MidiFile(file=ri
+00009b40: 6666 5f74 6f5f 6d69 6469 2866 696c 6529  ff_to_midi(file)
+00009b50: 2c20 636c 6970 3d54 7275 6529 0d0a 2020  , clip=True)..  
+00009b60: 2020 2020 2020 2020 2020 6669 6c65 2e63            file.c
+00009b70: 6c6f 7365 2829 0d0a 2020 2020 656c 7365  lose()..    else
+00009b80: 3a0d 0a20 2020 2020 2020 2074 7279 3a0d  :..        try:.
+00009b90: 0a20 2020 2020 2020 2020 2020 2063 7572  .            cur
+00009ba0: 7265 6e74 5f6d 6964 6920 3d20 6d69 646f  rent_midi = mido
+00009bb0: 2e4d 6964 6946 696c 6528 6669 6c65 2c20  .MidiFile(file, 
+00009bc0: 636c 6970 3d54 7275 6529 0d0a 2020 2020  clip=True)..    
+00009bd0: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+00009be0: 7469 6f6e 2061 7320 4f53 4572 726f 723a  tion as OSError:
+00009bf0: 0d0a 2020 2020 2020 2020 2020 2020 6375  ..            cu
+00009c00: 7272 656e 745f 6d69 6469 203d 206d 6964  rrent_midi = mid
+00009c10: 6f2e 4d69 6469 4669 6c65 2866 696c 653d  o.MidiFile(file=
+00009c20: 7269 6666 5f74 6f5f 6d69 6469 2866 696c  riff_to_midi(fil
+00009c30: 6529 2c20 636c 6970 3d54 7275 6529 0d0a  e), clip=True)..
+00009c40: 2020 2020 666f 7220 7472 6163 6b20 696e      for track in
+00009c50: 2063 7572 7265 6e74 5f6d 6964 692e 7472   current_midi.tr
+00009c60: 6163 6b73 3a0d 0a20 2020 2020 2020 2066  acks:..        f
+00009c70: 6f72 206d 7367 2069 6e20 7472 6163 6b3a  or msg in track:
+00009c80: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00009c90: 206d 7367 2e74 7970 6520 3d3d 2027 7365   msg.type == 'se
+00009ca0: 745f 7465 6d70 6f27 3a0d 0a20 2020 2020  t_tempo':..     
+00009cb0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00009cc0: 6e20 6d69 646f 2e74 656d 706f 3262 706d  n mido.tempo2bpm
+00009cd0: 286d 7367 2e74 656d 706f 290d 0a20 2020  (msg.tempo)..   
+00009ce0: 2072 6574 7572 6e20 3132 300d 0a0d 0a0d   return 120.....
+00009cf0: 0a64 6566 2067 6574 5f74 6963 6b73 5f70  .def get_ticks_p
+00009d00: 6572 5f62 6561 7428 6669 6c65 2c20 6973  er_beat(file, is
+00009d10: 5f66 696c 653d 4661 6c73 6529 3a0d 0a20  _file=False):.. 
+00009d20: 2020 2069 6620 6973 5f66 696c 653a 0d0a     if is_file:..
+00009d30: 2020 2020 2020 2020 6669 6c65 2e73 6565          file.see
+00009d40: 6b28 3029 0d0a 2020 2020 2020 2020 7472  k(0)..        tr
+00009d50: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+00009d60: 6375 7272 656e 745f 6d69 6469 203d 206d  current_midi = m
+00009d70: 6964 6f2e 4d69 6469 4669 6c65 2866 696c  ido.MidiFile(fil
+00009d80: 653d 6669 6c65 2c20 636c 6970 3d54 7275  e=file, clip=Tru
+00009d90: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+00009da0: 6669 6c65 2e63 6c6f 7365 2829 0d0a 2020  file.close()..  
+00009db0: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
+00009dc0: 6570 7469 6f6e 2061 7320 4f53 4572 726f  eption as OSErro
+00009dd0: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
+00009de0: 6669 6c65 2e73 6565 6b28 3029 0d0a 2020  file.seek(0)..  
+00009df0: 2020 2020 2020 2020 2020 6375 7272 656e            curren
+00009e00: 745f 6d69 6469 203d 206d 6964 6f2e 4d69  t_midi = mido.Mi
+00009e10: 6469 4669 6c65 2866 696c 653d 7269 6666  diFile(file=riff
+00009e20: 5f74 6f5f 6d69 6469 2866 696c 6529 2c20  _to_midi(file), 
+00009e30: 636c 6970 3d54 7275 6529 0d0a 2020 2020  clip=True)..    
+00009e40: 2020 2020 2020 2020 6669 6c65 2e63 6c6f          file.clo
+00009e50: 7365 2829 0d0a 2020 2020 656c 7365 3a0d  se()..    else:.
+00009e60: 0a20 2020 2020 2020 2074 7279 3a0d 0a20  .        try:.. 
+00009e70: 2020 2020 2020 2020 2020 2063 7572 7265             curre
+00009e80: 6e74 5f6d 6964 6920 3d20 6d69 646f 2e4d  nt_midi = mido.M
+00009e90: 6964 6946 696c 6528 6669 6c65 2c20 636c  idiFile(file, cl
+00009ea0: 6970 3d54 7275 6529 0d0a 2020 2020 2020  ip=True)..      
+00009eb0: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+00009ec0: 6f6e 2061 7320 4f53 4572 726f 723a 0d0a  on as OSError:..
+00009ed0: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+00009ee0: 656e 745f 6d69 6469 203d 206d 6964 6f2e  ent_midi = mido.
+00009ef0: 4d69 6469 4669 6c65 2866 696c 653d 7269  MidiFile(file=ri
+00009f00: 6666 5f74 6f5f 6d69 6469 2866 696c 6529  ff_to_midi(file)
+00009f10: 2c20 636c 6970 3d54 7275 6529 0d0a 2020  , clip=True)..  
+00009f20: 2020 7265 7475 726e 2063 7572 7265 6e74    return current
+00009f30: 5f6d 6964 692e 7469 636b 735f 7065 725f  _midi.ticks_per_
+00009f40: 6265 6174 0d0a 0d0a 0d0a 6465 6620 6368  beat......def ch
+00009f50: 6f72 645f 746f 5f70 6965 6365 2863 7572  ord_to_piece(cur
+00009f60: 7265 6e74 5f63 686f 7264 2c20 6270 6d3d  rent_chord, bpm=
+00009f70: 3132 302c 2073 7461 7274 5f74 696d 653d  120, start_time=
+00009f80: 302c 2068 6173 5f74 7261 636b 5f6e 756d  0, has_track_num
+00009f90: 3d46 616c 7365 293a 0d0a 2020 2020 6368  =False):..    ch
+00009fa0: 616e 6e65 6c73 5f6e 756d 6265 7273 203d  annels_numbers =
+00009fb0: 205b 692e 6368 616e 6e65 6c20 666f 7220   [i.channel for 
+00009fc0: 6920 696e 2063 7572 7265 6e74 5f63 686f  i in current_cho
+00009fd0: 7264 5d20 2b20 5b0d 0a20 2020 2020 2020  rd] + [..       
+00009fe0: 2069 2e63 6861 6e6e 656c 0d0a 2020 2020   i.channel..    
+00009ff0: 2020 2020 666f 7220 6920 696e 2063 7572      for i in cur
+0000a000: 7265 6e74 5f63 686f 7264 2e6f 7468 6572  rent_chord.other
+0000a010: 5f6d 6573 7361 6765 7320 6966 2068 6173  _messages if has
+0000a020: 6174 7472 2869 2c20 2763 6861 6e6e 656c  attr(i, 'channel
+0000a030: 2729 0d0a 2020 2020 5d0d 0a20 2020 2063  ')..    ]..    c
+0000a040: 6861 6e6e 656c 735f 6c69 7374 203d 206c  hannels_list = l
+0000a050: 6973 7428 7365 7428 6368 616e 6e65 6c73  ist(set(channels
+0000a060: 5f6e 756d 6265 7273 2929 0d0a 2020 2020  _numbers))..    
+0000a070: 6368 616e 6e65 6c73 5f6c 6973 7420 3d20  channels_list = 
+0000a080: 5b69 2066 6f72 2069 2069 6e20 6368 616e  [i for i in chan
+0000a090: 6e65 6c73 5f6c 6973 7420 6966 2069 2069  nels_list if i i
+0000a0a0: 7320 6e6f 7420 4e6f 6e65 5d0d 0a20 2020  s not None]..   
+0000a0b0: 2063 6861 6e6e 656c 735f 6c69 7374 2e73   channels_list.s
+0000a0c0: 6f72 7428 290d 0a20 2020 2069 6620 6e6f  ort()..    if no
+0000a0d0: 7420 6368 616e 6e65 6c73 5f6c 6973 743a  t channels_list:
+0000a0e0: 0d0a 2020 2020 2020 2020 6368 616e 6e65  ..        channe
+0000a0f0: 6c73 5f6c 6973 7420 3d20 5b30 5d0d 0a20  ls_list = [0].. 
+0000a100: 2020 2063 6861 6e6e 656c 735f 6e75 6d20     channels_num 
+0000a110: 3d20 6c65 6e28 6368 616e 6e65 6c73 5f6c  = len(channels_l
+0000a120: 6973 7429 0d0a 2020 2020 6375 7272 656e  ist)..    curren
+0000a130: 745f 7374 6172 745f 7469 6d65 203d 2073  t_start_time = s
+0000a140: 7461 7274 5f74 696d 6520 2b20 6375 7272  tart_time + curr
+0000a150: 656e 745f 6368 6f72 642e 7374 6172 745f  ent_chord.start_
+0000a160: 7469 6d65 0d0a 2020 2020 7061 6e5f 6c69  time..    pan_li
+0000a170: 7374 203d 205b 0d0a 2020 2020 2020 2020  st = [..        
+0000a180: 7061 6e28 692e 7661 6c75 652c 0d0a 2020  pan(i.value,..  
+0000a190: 2020 2020 2020 2020 2020 6d6f 6465 3d27            mode='
+0000a1a0: 7661 6c75 6527 2c0d 0a20 2020 2020 2020  value',..       
+0000a1b0: 2020 2020 2073 7461 7274 5f74 696d 653d       start_time=
+0000a1c0: 692e 7374 6172 745f 7469 6d65 2c0d 0a20  i.start_time,.. 
+0000a1d0: 2020 2020 2020 2020 2020 2063 6861 6e6e             chann
+0000a1e0: 656c 3d69 2e63 6861 6e6e 656c 2c0d 0a20  el=i.channel,.. 
+0000a1f0: 2020 2020 2020 2020 2020 2074 7261 636b             track
+0000a200: 3d69 2e74 7261 636b 2920 666f 7220 6920  =i.track) for i 
+0000a210: 696e 2063 7572 7265 6e74 5f63 686f 7264  in current_chord
+0000a220: 2e6f 7468 6572 5f6d 6573 7361 6765 730d  .other_messages.
+0000a230: 0a20 2020 2020 2020 2069 6620 692e 7479  .        if i.ty
+0000a240: 7065 203d 3d20 2763 6f6e 7472 6f6c 5f63  pe == 'control_c
+0000a250: 6861 6e67 6527 2061 6e64 2069 2e63 6f6e  hange' and i.con
+0000a260: 7472 6f6c 203d 3d20 3130 0d0a 2020 2020  trol == 10..    
+0000a270: 5d0d 0a20 2020 2076 6f6c 756d 655f 6c69  ]..    volume_li
+0000a280: 7374 203d 205b 0d0a 2020 2020 2020 2020  st = [..        
+0000a290: 766f 6c75 6d65 2869 2e76 616c 7565 2c0d  volume(i.value,.
+0000a2a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a2b0: 6d6f 6465 3d27 7661 6c75 6527 2c0d 0a20  mode='value',.. 
+0000a2c0: 2020 2020 2020 2020 2020 2020 2020 7374                st
+0000a2d0: 6172 745f 7469 6d65 3d69 2e73 7461 7274  art_time=i.start
+0000a2e0: 5f74 696d 652c 0d0a 2020 2020 2020 2020  _time,..        
+0000a2f0: 2020 2020 2020 2063 6861 6e6e 656c 3d69         channel=i
+0000a300: 2e63 6861 6e6e 656c 2c0d 0a20 2020 2020  .channel,..     
+0000a310: 2020 2020 2020 2020 2020 7472 6163 6b3d            track=
+0000a320: 692e 7472 6163 6b29 2066 6f72 2069 2069  i.track) for i i
+0000a330: 6e20 6375 7272 656e 745f 6368 6f72 642e  n current_chord.
+0000a340: 6f74 6865 725f 6d65 7373 6167 6573 0d0a  other_messages..
+0000a350: 2020 2020 2020 2020 6966 2069 2e74 7970          if i.typ
+0000a360: 6520 3d3d 2027 636f 6e74 726f 6c5f 6368  e == 'control_ch
+0000a370: 616e 6765 2720 616e 6420 692e 636f 6e74  ange' and i.cont
+0000a380: 726f 6c20 3d3d 2037 0d0a 2020 2020 5d0d  rol == 7..    ].
+0000a390: 0a20 2020 2074 7261 636b 5f6e 616d 6573  .    track_names
+0000a3a0: 5f6d 7367 203d 205b 5b0d 0a20 2020 2020  _msg = [[..     
+0000a3b0: 2020 2069 2066 6f72 2069 2069 6e20 6375     i for i in cu
+0000a3c0: 7272 656e 745f 6368 6f72 642e 6f74 6865  rrent_chord.othe
+0000a3d0: 725f 6d65 7373 6167 6573 0d0a 2020 2020  r_messages..    
+0000a3e0: 2020 2020 6966 2069 2e74 7970 6520 3d3d      if i.type ==
+0000a3f0: 2027 7472 6163 6b5f 6e61 6d65 2720 616e   'track_name' an
+0000a400: 6420 692e 7472 6163 6b20 3d3d 206a 0d0a  d i.track == j..
+0000a410: 2020 2020 5d20 666f 7220 6a20 696e 2072      ] for j in r
+0000a420: 616e 6765 2863 6861 6e6e 656c 735f 6e75  ange(channels_nu
+0000a430: 6d29 5d0d 0a20 2020 2074 7261 636b 5f6e  m)]..    track_n
+0000a440: 616d 6573 5f6d 7367 203d 205b 695b 305d  ames_msg = [i[0]
+0000a450: 2066 6f72 2069 2069 6e20 7472 6163 6b5f   for i in track_
+0000a460: 6e61 6d65 735f 6d73 6720 6966 2069 5d0d  names_msg if i].
+0000a470: 0a20 2020 2069 6620 6e6f 7420 7472 6163  .    if not trac
+0000a480: 6b5f 6e61 6d65 735f 6d73 673a 0d0a 2020  k_names_msg:..  
+0000a490: 2020 2020 2020 7472 6163 6b5f 6e61 6d65        track_name
+0000a4a0: 735f 6c69 7374 203d 205b 5d0d 0a20 2020  s_list = []..   
+0000a4b0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+0000a4c0: 6966 206e 6f74 2068 6173 5f74 7261 636b  if not has_track
+0000a4d0: 5f6e 756d 2061 6e64 2061 6c6c 280d 0a20  _num and all(.. 
+0000a4e0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+0000a4f0: 6173 6174 7472 2869 2c20 2763 6861 6e6e  asattr(i, 'chann
+0000a500: 656c 2729 2066 6f72 2069 2069 6e20 7472  el') for i in tr
+0000a510: 6163 6b5f 6e61 6d65 735f 6d73 6729 3a0d  ack_names_msg):.
+0000a520: 0a20 2020 2020 2020 2020 2020 2074 7261  .            tra
+0000a530: 636b 5f6e 616d 6573 5f63 6861 6e6e 656c  ck_names_channel
+0000a540: 7320 3d20 5b69 2e63 6861 6e6e 656c 2066  s = [i.channel f
+0000a550: 6f72 2069 2069 6e20 7472 6163 6b5f 6e61  or i in track_na
+0000a560: 6d65 735f 6d73 675d 0d0a 2020 2020 2020  mes_msg]..      
+0000a570: 2020 2020 2020 6375 7272 656e 745f 7472        current_tr
+0000a580: 6163 6b5f 6e61 6d65 7320 3d20 5b0d 0a20  ack_names = [.. 
+0000a590: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0000a5a0: 7261 636b 5f6e 616d 6573 5f6d 7367 5b74  rack_names_msg[t
+0000a5b0: 7261 636b 5f6e 616d 6573 5f63 6861 6e6e  rack_names_chann
+0000a5c0: 656c 732e 696e 6465 7828 6929 5d0d 0a20  els.index(i)].. 
+0000a5d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000a5e0: 6f72 2069 2069 6e20 6368 616e 6e65 6c73  or i in channels
+0000a5f0: 5f6c 6973 740d 0a20 2020 2020 2020 2020  _list..         
+0000a600: 2020 205d 0d0a 2020 2020 2020 2020 656c     ]..        el
+0000a610: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+0000a620: 2063 7572 7265 6e74 5f74 7261 636b 5f6e   current_track_n
+0000a630: 616d 6573 203d 2074 7261 636b 5f6e 616d  ames = track_nam
+0000a640: 6573 5f6d 7367 0d0a 2020 2020 2020 2020  es_msg..        
+0000a650: 7472 6163 6b5f 6e61 6d65 735f 6c69 7374  track_names_list
+0000a660: 203d 205b 692e 6e61 6d65 2066 6f72 2069   = [i.name for i
+0000a670: 2069 6e20 6375 7272 656e 745f 7472 6163   in current_trac
+0000a680: 6b5f 6e61 6d65 735d 0d0a 2020 2020 6966  k_names]..    if
+0000a690: 2028 6e6f 7420 7472 6163 6b5f 6e61 6d65   (not track_name
+0000a6a0: 735f 6c69 7374 2920 6f72 2028 6c65 6e28  s_list) or (len(
+0000a6b0: 7472 6163 6b5f 6e61 6d65 735f 6c69 7374  track_names_list
+0000a6c0: 2920 213d 2063 6861 6e6e 656c 735f 6e75  ) != channels_nu
+0000a6d0: 6d29 3a0d 0a20 2020 2020 2020 2074 7261  m):..        tra
+0000a6e0: 636b 5f6e 616d 6573 5f6c 6973 7420 3d20  ck_names_list = 
+0000a6f0: 5b66 2743 6861 6e6e 656c 207b 692b 317d  [f'Channel {i+1}
+0000a700: 2720 666f 7220 6920 696e 2072 616e 6765  ' for i in range
+0000a710: 2863 6861 6e6e 656c 735f 6e75 6d29 5d0d  (channels_num)].
+0000a720: 0a20 2020 2069 6620 6e6f 7420 6861 735f  .    if not has_
+0000a730: 7472 6163 6b5f 6e75 6d3a 0d0a 2020 2020  track_num:..    
+0000a740: 2020 2020 666f 7220 6561 6368 2069 6e20      for each in 
+0000a750: 6375 7272 656e 745f 6368 6f72 642e 6e6f  current_chord.no
+0000a760: 7465 733a 0d0a 2020 2020 2020 2020 2020  tes:..          
+0000a770: 2020 6561 6368 2e74 7261 636b 5f6e 756d    each.track_num
+0000a780: 203d 2063 6861 6e6e 656c 735f 6c69 7374   = channels_list
+0000a790: 2e69 6e64 6578 280d 0a20 2020 2020 2020  .index(..       
+0000a7a0: 2020 2020 2020 2020 2065 6163 682e 6368           each.ch
+0000a7b0: 616e 6e65 6c29 2069 6620 6561 6368 2e63  annel) if each.c
+0000a7c0: 6861 6e6e 656c 2069 7320 6e6f 7420 4e6f  hannel is not No
+0000a7d0: 6e65 2065 6c73 6520 300d 0a20 2020 2020  ne else 0..     
+0000a7e0: 2020 2066 6f72 2065 6163 6820 696e 2063     for each in c
+0000a7f0: 7572 7265 6e74 5f63 686f 7264 2e70 6974  urrent_chord.pit
+0000a800: 6368 5f62 656e 6473 3a0d 0a20 2020 2020  ch_bends:..     
+0000a810: 2020 2020 2020 2069 6620 6561 6368 2e74         if each.t
+0000a820: 7261 636b 2021 3d20 6561 6368 2e74 7261  rack != each.tra
+0000a830: 636b 5f6e 756d 3a0d 0a20 2020 2020 2020  ck_num:..       
+0000a840: 2020 2020 2020 2020 2065 6163 682e 7472           each.tr
+0000a850: 6163 6b20 3d20 6561 6368 2e74 7261 636b  ack = each.track
+0000a860: 5f6e 756d 0d0a 2020 2020 2020 2020 666f  _num..        fo
+0000a870: 7220 6561 6368 2069 6e20 6375 7272 656e  r each in curren
+0000a880: 745f 6368 6f72 642e 6f74 6865 725f 6d65  t_chord.other_me
+0000a890: 7373 6167 6573 3a0d 0a20 2020 2020 2020  ssages:..       
+0000a8a0: 2020 2020 2069 6620 6861 7361 7474 7228       if hasattr(
+0000a8b0: 6561 6368 2c20 2763 6861 6e6e 656c 2729  each, 'channel')
+0000a8c0: 2061 6e64 2065 6163 682e 6368 616e 6e65   and each.channe
+0000a8d0: 6c20 6973 206e 6f74 204e 6f6e 653a 0d0a  l is not None:..
+0000a8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a8f0: 6561 6368 2e74 7261 636b 203d 2063 6861  each.track = cha
+0000a900: 6e6e 656c 735f 6c69 7374 2e69 6e64 6578  nnels_list.index
+0000a910: 2865 6163 682e 6368 616e 6e65 6c29 0d0a  (each.channel)..
+0000a920: 2020 2020 2020 2020 666f 7220 6561 6368          for each
+0000a930: 2069 6e20 7061 6e5f 6c69 7374 3a0d 0a20   in pan_list:.. 
+0000a940: 2020 2020 2020 2020 2020 2069 6620 6561             if ea
+0000a950: 6368 2e63 6861 6e6e 656c 2069 7320 6e6f  ch.channel is no
+0000a960: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+0000a970: 2020 2020 2020 2020 2065 6163 682e 7472           each.tr
+0000a980: 6163 6b20 3d20 6368 616e 6e65 6c73 5f6c  ack = channels_l
+0000a990: 6973 742e 696e 6465 7828 6561 6368 2e63  ist.index(each.c
+0000a9a0: 6861 6e6e 656c 290d 0a20 2020 2020 2020  hannel)..       
+0000a9b0: 2066 6f72 2065 6163 6820 696e 2076 6f6c   for each in vol
+0000a9c0: 756d 655f 6c69 7374 3a0d 0a20 2020 2020  ume_list:..     
+0000a9d0: 2020 2020 2020 2069 6620 6561 6368 2e63         if each.c
+0000a9e0: 6861 6e6e 656c 2069 7320 6e6f 7420 4e6f  hannel is not No
+0000a9f0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+0000aa00: 2020 2020 2065 6163 682e 7472 6163 6b20       each.track 
+0000aa10: 3d20 6368 616e 6e65 6c73 5f6c 6973 742e  = channels_list.
+0000aa20: 696e 6465 7828 6561 6368 2e63 6861 6e6e  index(each.chann
+0000aa30: 656c 290d 0a20 2020 2072 6573 756c 745f  el)..    result_
+0000aa40: 7069 6563 6520 3d20 7069 6563 6528 7472  piece = piece(tr
+0000aa50: 6163 6b73 3d5b 6368 6f72 6428 5b5d 2920  acks=[chord([]) 
+0000aa60: 666f 7220 6920 696e 2072 616e 6765 2863  for i in range(c
+0000aa70: 6861 6e6e 656c 735f 6e75 6d29 5d2c 0d0a  hannels_num)],..
+0000aa80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aa90: 2020 2020 2020 2020 2062 706d 3d62 706d           bpm=bpm
+0000aaa0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000aab0: 2020 2020 2020 2020 2020 2020 7061 6e3d              pan=
+0000aac0: 5b5b 5d20 666f 7220 6920 696e 2072 616e  [[] for i in ran
+0000aad0: 6765 2863 6861 6e6e 656c 735f 6e75 6d29  ge(channels_num)
+0000aae0: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+0000aaf0: 2020 2020 2020 2020 2020 2020 2076 6f6c               vol
+0000ab00: 756d 653d 5b5b 5d20 666f 7220 6920 696e  ume=[[] for i in
+0000ab10: 2072 616e 6765 2863 6861 6e6e 656c 735f   range(channels_
+0000ab20: 6e75 6d29 5d29 0d0a 2020 2020 7265 7375  num)])..    resu
+0000ab30: 6c74 5f70 6965 6365 2e72 6563 6f6e 7374  lt_piece.reconst
+0000ab40: 7275 6374 2863 7572 7265 6e74 5f63 686f  ruct(current_cho
+0000ab50: 7264 2c0d 0a20 2020 2020 2020 2020 2020  rd,..           
+0000ab60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ab70: 2020 6375 7272 656e 745f 7374 6172 745f    current_start_
+0000ab80: 7469 6d65 2c0d 0a20 2020 2020 2020 2020  time,..         
+0000ab90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aba0: 2020 2020 696e 636c 7564 655f 656d 7074      include_empt
+0000abb0: 795f 7472 6163 6b3d 5472 7565 290d 0a20  y_track=True).. 
+0000abc0: 2020 2069 6620 7265 7375 6c74 5f70 6965     if result_pie
+0000abd0: 6365 2e63 6861 6e6e 656c 733a 0d0a 2020  ce.channels:..  
+0000abe0: 2020 2020 2020 6966 206c 656e 2872 6573        if len(res
+0000abf0: 756c 745f 7069 6563 652e 6368 616e 6e65  ult_piece.channe
+0000ac00: 6c73 2920 213d 2063 6861 6e6e 656c 735f  ls) != channels_
+0000ac10: 6e75 6d3a 0d0a 2020 2020 2020 2020 2020  num:..          
+0000ac20: 2020 7061 6e5f 6c69 7374 203d 205b 0d0a    pan_list = [..
+0000ac30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ac40: 6920 666f 7220 6920 696e 2070 616e 5f6c  i for i in pan_l
+0000ac50: 6973 7420 6966 2069 2e63 6861 6e6e 656c  ist if i.channel
+0000ac60: 2069 6e20 7265 7375 6c74 5f70 6965 6365   in result_piece
+0000ac70: 2e63 6861 6e6e 656c 730d 0a20 2020 2020  .channels..     
+0000ac80: 2020 2020 2020 205d 0d0a 2020 2020 2020         ]..      
+0000ac90: 2020 2020 2020 766f 6c75 6d65 5f6c 6973        volume_lis
+0000aca0: 7420 3d20 5b0d 0a20 2020 2020 2020 2020  t = [..         
+0000acb0: 2020 2020 2020 2069 2066 6f72 2069 2069         i for i i
+0000acc0: 6e20 766f 6c75 6d65 5f6c 6973 7420 6966  n volume_list if
+0000acd0: 2069 2e63 6861 6e6e 656c 2069 6e20 7265   i.channel in re
+0000ace0: 7375 6c74 5f70 6965 6365 2e63 6861 6e6e  sult_piece.chann
+0000acf0: 656c 730d 0a20 2020 2020 2020 2020 2020  els..           
+0000ad00: 205d 0d0a 2020 2020 2020 2020 2020 2020   ]..            
+0000ad10: 666f 7220 6561 6368 2069 6e20 7061 6e5f  for each in pan_
+0000ad20: 6c69 7374 3a0d 0a20 2020 2020 2020 2020  list:..         
+0000ad30: 2020 2020 2020 2065 6163 682e 7472 6163         each.trac
+0000ad40: 6b20 3d20 7265 7375 6c74 5f70 6965 6365  k = result_piece
+0000ad50: 2e63 6861 6e6e 656c 732e 696e 6465 7828  .channels.index(
+0000ad60: 6561 6368 2e63 6861 6e6e 656c 290d 0a20  each.channel).. 
+0000ad70: 2020 2020 2020 2020 2020 2066 6f72 2065             for e
+0000ad80: 6163 6820 696e 2076 6f6c 756d 655f 6c69  ach in volume_li
+0000ad90: 7374 3a0d 0a20 2020 2020 2020 2020 2020  st:..           
+0000ada0: 2020 2020 2065 6163 682e 7472 6163 6b20       each.track 
+0000adb0: 3d20 7265 7375 6c74 5f70 6965 6365 2e63  = result_piece.c
+0000adc0: 6861 6e6e 656c 732e 696e 6465 7828 6561  hannels.index(ea
+0000add0: 6368 2e63 6861 6e6e 656c 290d 0a20 2020  ch.channel)..   
+0000ade0: 2020 2020 2020 2020 2066 6f72 206b 2069           for k i
+0000adf0: 6e20 7261 6e67 6528 6c65 6e28 7265 7375  n range(len(resu
+0000ae00: 6c74 5f70 6965 6365 2e74 7261 636b 7329  lt_piece.tracks)
+0000ae10: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0000ae20: 2020 2020 666f 7220 6561 6368 2069 6e20      for each in 
+0000ae30: 7265 7375 6c74 5f70 6965 6365 2e74 7261  result_piece.tra
+0000ae40: 636b 735b 6b5d 2e70 6974 6368 5f62 656e  cks[k].pitch_ben
+0000ae50: 6473 3a0d 0a20 2020 2020 2020 2020 2020  ds:..           
 0000ae60: 2020 2020 2020 2020 2065 6163 682e 7472           each.tr
-0000ae70: 6163 6b20 3d20 7265 7375 6c74 5f70 6965  ack = result_pie
-0000ae80: 6365 2e63 6861 6e6e 656c 732e 696e 6465  ce.channels.inde
-0000ae90: 7828 6561 6368 2e63 6861 6e6e 656c 290d  x(each.channel).
-0000aea0: 0a20 2020 2072 6573 756c 745f 7069 6563  .    result_piec
-0000aeb0: 652e 6f74 6865 725f 6d65 7373 6167 6573  e.other_messages
-0000aec0: 203d 2063 7572 7265 6e74 5f63 686f 7264   = current_chord
-0000aed0: 2e6f 7468 6572 5f6d 6573 7361 6765 730d  .other_messages.
-0000aee0: 0a20 2020 2066 6f72 206b 2069 6e20 7261  .    for k in ra
-0000aef0: 6e67 6528 6c65 6e28 7265 7375 6c74 5f70  nge(len(result_p
-0000af00: 6965 6365 2929 3a0d 0a20 2020 2020 2020  iece)):..       
-0000af10: 2063 7572 7265 6e74 5f6f 7468 6572 5f6d   current_other_m
-0000af20: 6573 7361 6765 7320 3d20 5b0d 0a20 2020  essages = [..   
-0000af30: 2020 2020 2020 2020 2069 2066 6f72 2069           i for i
-0000af40: 2069 6e20 7265 7375 6c74 5f70 6965 6365   in result_piece
-0000af50: 2e6f 7468 6572 5f6d 6573 7361 6765 7320  .other_messages 
-0000af60: 6966 2069 2e74 7261 636b 203d 3d20 6b0d  if i.track == k.
-0000af70: 0a20 2020 2020 2020 205d 0d0a 2020 2020  .        ]..    
-0000af80: 2020 2020 7265 7375 6c74 5f70 6965 6365      result_piece
-0000af90: 2e74 7261 636b 735b 6b5d 2e6f 7468 6572  .tracks[k].other
-0000afa0: 5f6d 6573 7361 6765 7320 3d20 6375 7272  _messages = curr
-0000afb0: 656e 745f 6f74 6865 725f 6d65 7373 6167  ent_other_messag
-0000afc0: 6573 0d0a 2020 2020 2020 2020 6375 7272  es..        curr
-0000afd0: 656e 745f 7061 6e20 3d20 5b69 2066 6f72  ent_pan = [i for
-0000afe0: 2069 2069 6e20 7061 6e5f 6c69 7374 2069   i in pan_list i
-0000aff0: 6620 692e 7472 6163 6b20 3d3d 206b 5d0d  f i.track == k].
-0000b000: 0a20 2020 2020 2020 2072 6573 756c 745f  .        result_
-0000b010: 7069 6563 652e 7061 6e5b 6b5d 203d 2063  piece.pan[k] = c
-0000b020: 7572 7265 6e74 5f70 616e 0d0a 2020 2020  urrent_pan..    
-0000b030: 2020 2020 6375 7272 656e 745f 766f 6c75      current_volu
-0000b040: 6d65 203d 205b 6920 666f 7220 6920 696e  me = [i for i in
-0000b050: 2076 6f6c 756d 655f 6c69 7374 2069 6620   volume_list if 
-0000b060: 692e 7472 6163 6b20 3d3d 206b 5d0d 0a20  i.track == k].. 
-0000b070: 2020 2020 2020 2072 6573 756c 745f 7069         result_pi
-0000b080: 6563 652e 766f 6c75 6d65 5b6b 5d20 3d20  ece.volume[k] = 
-0000b090: 6375 7272 656e 745f 766f 6c75 6d65 0d0a  current_volume..
-0000b0a0: 2020 2020 7265 7375 6c74 5f70 6965 6365      result_piece
-0000b0b0: 2e74 7261 636b 5f6e 616d 6573 203d 2074  .track_names = t
-0000b0c0: 7261 636b 5f6e 616d 6573 5f6c 6973 740d  rack_names_list.
-0000b0d0: 0a20 2020 2072 6573 756c 745f 7069 6563  .    result_piec
-0000b0e0: 652e 6f74 6865 725f 6d65 7373 6167 6573  e.other_messages
-0000b0f0: 203d 2063 6f6e 6361 7428 0d0a 2020 2020   = concat(..    
-0000b100: 2020 2020 5b69 2e6f 7468 6572 5f6d 6573      [i.other_mes
-0000b110: 7361 6765 7320 666f 7220 6920 696e 2072  sages for i in r
-0000b120: 6573 756c 745f 7069 6563 652e 7472 6163  esult_piece.trac
-0000b130: 6b73 5d2c 2073 7461 7274 3d5b 5d29 0d0a  ks], start=[])..
-0000b140: 2020 2020 696e 7374 7275 6d65 6e74 7320      instruments 
-0000b150: 3d20 5b5d 0d0a 2020 2020 7072 6f67 7261  = []..    progra
-0000b160: 6d5f 6368 616e 6765 5f65 7665 6e74 7320  m_change_events 
-0000b170: 3d20 5b0d 0a20 2020 2020 2020 2069 2066  = [..        i f
-0000b180: 6f72 2069 2069 6e20 7265 7375 6c74 5f70  or i in result_p
-0000b190: 6965 6365 2e6f 7468 6572 5f6d 6573 7361  iece.other_messa
-0000b1a0: 6765 7320 6966 2069 2e74 7970 6520 3d3d  ges if i.type ==
-0000b1b0: 2027 7072 6f67 7261 6d5f 6368 616e 6765   'program_change
-0000b1c0: 270d 0a20 2020 205d 0d0a 2020 2020 666f  '..    ]..    fo
-0000b1d0: 7220 692c 2065 6163 6820 696e 2065 6e75  r i, each in enu
-0000b1e0: 6d65 7261 7465 2872 6573 756c 745f 7069  merate(result_pi
-0000b1f0: 6563 652e 6368 616e 6e65 6c73 293a 0d0a  ece.channels):..
-0000b200: 2020 2020 2020 2020 6375 7272 656e 745f          current_
-0000b210: 7072 6f67 7261 6d20 3d20 4e6f 6e65 0d0a  program = None..
-0000b220: 2020 2020 2020 2020 666f 7220 6a20 696e          for j in
-0000b230: 2070 726f 6772 616d 5f63 6861 6e67 655f   program_change_
-0000b240: 6576 656e 7473 3a0d 0a20 2020 2020 2020  events:..       
-0000b250: 2020 2020 2069 6620 6a2e 6368 616e 6e65       if j.channe
-0000b260: 6c20 3d3d 2065 6163 683a 0d0a 2020 2020  l == each:..    
-0000b270: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-0000b280: 656e 745f 7072 6f67 7261 6d20 3d20 6a2e  ent_program = j.
-0000b290: 7072 6f67 7261 6d0d 0a20 2020 2020 2020  program..       
-0000b2a0: 2020 2020 2020 2020 2069 6e73 7472 756d           instrum
-0000b2b0: 656e 7473 2e61 7070 656e 6428 6375 7272  ents.append(curr
-0000b2c0: 656e 745f 7072 6f67 7261 6d20 2b20 3129  ent_program + 1)
-0000b2d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b2e0: 2020 6272 6561 6b0d 0a20 2020 2020 2020    break..       
-0000b2f0: 2069 6620 6375 7272 656e 745f 7072 6f67   if current_prog
-0000b300: 7261 6d20 6973 204e 6f6e 653a 0d0a 2020  ram is None:..  
-0000b310: 2020 2020 2020 2020 2020 696e 7374 7275            instru
-0000b320: 6d65 6e74 732e 6170 7065 6e64 2831 290d  ments.append(1).
-0000b330: 0a20 2020 2072 6573 756c 745f 7069 6563  .    result_piec
-0000b340: 652e 6368 616e 6765 5f69 6e73 7472 756d  e.change_instrum
-0000b350: 656e 7473 2869 6e73 7472 756d 656e 7473  ents(instruments
-0000b360: 290d 0a20 2020 2072 6574 7572 6e20 7265  )..    return re
-0000b370: 7375 6c74 5f70 6965 6365 0d0a 0d0a 0d0a  sult_piece......
-0000b380: 6465 6620 6d6f 6475 6c61 7469 6f6e 2863  def modulation(c
-0000b390: 7572 7265 6e74 5f63 686f 7264 2c20 6f6c  urrent_chord, ol
-0000b3a0: 645f 7363 616c 652c 206e 6577 5f73 6361  d_scale, new_sca
-0000b3b0: 6c65 2c20 2a2a 6172 6773 293a 0d0a 2020  le, **args):..  
-0000b3c0: 2020 2727 270d 0a20 2020 2063 6861 6e67    '''..    chang
-0000b3d0: 6520 6e6f 7465 7320 2869 6e63 6c75 6469  e notes (includi
-0000b3e0: 6e67 2062 6f74 6820 6f66 206d 656c 6f64  ng both of melod
-0000b3f0: 7920 616e 6420 6368 6f72 6473 2920 696e  y and chords) in
-0000b400: 2074 6865 2067 6976 656e 2070 6965 6365   the given piece
-0000b410: 0d0a 2020 2020 6f66 206d 7573 6963 2066  ..    of music f
-0000b420: 726f 6d20 6120 6769 7665 6e20 7363 616c  rom a given scal
-0000b430: 6520 746f 2061 6e6f 7468 6572 2067 6976  e to another giv
-0000b440: 656e 2073 6361 6c65 2c20 616e 6420 7265  en scale, and re
-0000b450: 7475 726e 0d0a 2020 2020 7468 6520 6e65  turn..    the ne
-0000b460: 7720 6368 616e 6769 6e67 2070 6965 6365  w changing piece
-0000b470: 206f 6620 6d75 7369 632e 0d0a 2020 2020   of music...    
-0000b480: 2727 270d 0a20 2020 2072 6574 7572 6e20  '''..    return 
-0000b490: 6375 7272 656e 745f 6368 6f72 642e 6d6f  current_chord.mo
-0000b4a0: 6475 6c61 7469 6f6e 286f 6c64 5f73 6361  dulation(old_sca
-0000b4b0: 6c65 2c20 6e65 775f 7363 616c 652c 202a  le, new_scale, *
-0000b4c0: 2a61 7267 7329 0d0a 0d0a 0d0a 6465 6620  *args)......def 
-0000b4d0: 7472 616e 7328 6f62 6a2c 2070 6974 6368  trans(obj, pitch
-0000b4e0: 3d34 2c20 6475 7261 7469 6f6e 3d31 202f  =4, duration=1 /
-0000b4f0: 2034 2c20 696e 7465 7276 616c 3d4e 6f6e   4, interval=Non
-0000b500: 652c 2063 7573 746f 6d5f 6d61 7070 696e  e, custom_mappin
-0000b510: 673d 4e6f 6e65 293a 0d0a 2020 2020 6f62  g=None):..    ob
-0000b520: 6a20 3d20 6f62 6a2e 7265 706c 6163 6528  j = obj.replace(
-0000b530: 2720 272c 2027 2729 0d0a 2020 2020 6966  ' ', '')..    if
-0000b540: 2027 3a27 2069 6e20 6f62 6a3a 0d0a 2020   ':' in obj:..  
-0000b550: 2020 2020 2020 6375 7272 656e 7420 3d20        current = 
-0000b560: 6f62 6a2e 7370 6c69 7428 273a 2729 0d0a  obj.split(':')..
-0000b570: 2020 2020 2020 2020 6375 7272 656e 745b          current[
-0000b580: 305d 203d 2074 6f5f 6e6f 7465 2863 7572  0] = to_note(cur
-0000b590: 7265 6e74 5b30 5d29 0d0a 2020 2020 2020  rent[0])..      
-0000b5a0: 2020 7265 7475 726e 2074 7261 6e73 2866    return trans(f
-0000b5b0: 277b 6375 7272 656e 745b 305d 2e6e 616d  '{current[0].nam
-0000b5c0: 657d 7b63 7572 7265 6e74 5b31 5d7d 272c  e}{current[1]}',
-0000b5d0: 2063 7572 7265 6e74 5b30 5d2e 6e75 6d2c   current[0].num,
-0000b5e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b5f0: 2020 2020 2020 2064 7572 6174 696f 6e2c         duration,
-0000b600: 2069 6e74 6572 7661 6c29 0d0a 2020 2020   interval)..    
-0000b610: 6966 206f 626a 2e63 6f75 6e74 2827 2f27  if obj.count('/'
-0000b620: 2920 3e20 313a 0d0a 2020 2020 2020 2020  ) > 1:..        
-0000b630: 6375 7272 656e 745f 7061 7274 7320 3d20  current_parts = 
-0000b640: 6f62 6a2e 7370 6c69 7428 272f 2729 0d0a  obj.split('/')..
-0000b650: 2020 2020 2020 2020 6375 7272 656e 745f          current_
-0000b660: 7061 7274 7320 3d20 5b69 6e74 2869 2920  parts = [int(i) 
-0000b670: 6966 2069 2e69 7364 6967 6974 2829 2065  if i.isdigit() e
-0000b680: 6c73 6520 6920 666f 7220 6920 696e 2063  lse i for i in c
-0000b690: 7572 7265 6e74 5f70 6172 7473 5d0d 0a20  urrent_parts].. 
-0000b6a0: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-0000b6b0: 7472 616e 7328 6375 7272 656e 745f 7061  trans(current_pa
-0000b6c0: 7274 735b 305d 2c20 7069 7463 682c 2064  rts[0], pitch, d
-0000b6d0: 7572 6174 696f 6e2c 2069 6e74 6572 7661  uration, interva
-0000b6e0: 6c29 0d0a 2020 2020 2020 2020 666f 7220  l)..        for 
-0000b6f0: 6561 6368 2069 6e20 6375 7272 656e 745f  each in current_
-0000b700: 7061 7274 735b 313a 5d3a 0d0a 2020 2020  parts[1:]:..    
-0000b710: 2020 2020 2020 2020 6966 2065 6163 6820          if each 
-0000b720: 696e 2064 6174 6162 6173 652e 7374 616e  in database.stan
-0000b730: 6461 7264 3a0d 0a20 2020 2020 2020 2020  dard:..         
-0000b740: 2020 2020 2020 2065 6163 6820 3d20 6461         each = da
-0000b750: 7461 6261 7365 2e73 7461 6e64 6172 645f  tabase.standard_
-0000b760: 6469 6374 2e67 6574 2865 6163 682c 2065  dict.get(each, e
-0000b770: 6163 6829 0d0a 2020 2020 2020 2020 2020  ach)..          
-0000b780: 2020 656c 6966 206e 6f74 2069 7369 6e73    elif not isins
-0000b790: 7461 6e63 6528 6561 6368 2c20 696e 7429  tance(each, int)
-0000b7a0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0000b7b0: 2020 2065 6163 6820 3d20 7472 616e 7328     each = trans(
-0000b7c0: 6561 6368 2c20 7069 7463 682c 2064 7572  each, pitch, dur
-0000b7d0: 6174 696f 6e2c 2069 6e74 6572 7661 6c29  ation, interval)
-0000b7e0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-0000b7f0: 7375 6c74 202f 3d20 6561 6368 0d0a 2020  sult /= each..  
-0000b800: 2020 2020 2020 7265 7475 726e 2072 6573        return res
-0000b810: 756c 740d 0a20 2020 2069 6620 6f62 6a20  ult..    if obj 
-0000b820: 696e 2064 6174 6162 6173 652e 7374 616e  in database.stan
-0000b830: 6461 7264 3a0d 0a20 2020 2020 2020 2072  dard:..        r
-0000b840: 6574 7572 6e20 6765 745f 6368 6f72 6428  eturn get_chord(
-0000b850: 6f62 6a2c 0d0a 2020 2020 2020 2020 2020  obj,..          
-0000b860: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0000b870: 4d27 2c0d 0a20 2020 2020 2020 2020 2020  M',..           
-0000b880: 2020 2020 2020 2020 2020 2020 2020 7069                pi
-0000b890: 7463 683d 7069 7463 682c 0d0a 2020 2020  tch=pitch,..    
-0000b8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b8b0: 2020 2020 2064 7572 6174 696f 6e3d 6475       duration=du
-0000b8c0: 7261 7469 6f6e 2c0d 0a20 2020 2020 2020  ration,..       
-0000b8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b8e0: 2020 696e 7465 7276 616c 733d 696e 7465    intervals=inte
-0000b8f0: 7276 616c 2c0d 0a20 2020 2020 2020 2020  rval,..         
-0000b900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b910: 6375 7374 6f6d 5f6d 6170 7069 6e67 3d63  custom_mapping=c
-0000b920: 7573 746f 6d5f 6d61 7070 696e 6729 0d0a  ustom_mapping)..
-0000b930: 2020 2020 6966 2027 2f27 206e 6f74 2069      if '/' not i
-0000b940: 6e20 6f62 6a3a 0d0a 2020 2020 2020 2020  n obj:..        
-0000b950: 6368 6563 6b5f 7374 7275 6374 7572 6520  check_structure 
-0000b960: 3d20 6f62 6a2e 7370 6c69 7428 272c 2729  = obj.split(',')
-0000b970: 0d0a 2020 2020 2020 2020 6368 6563 6b5f  ..        check_
-0000b980: 7374 7275 6374 7572 655f 6c65 6e20 3d20  structure_len = 
-0000b990: 6c65 6e28 6368 6563 6b5f 7374 7275 6374  len(check_struct
-0000b9a0: 7572 6529 0d0a 2020 2020 2020 2020 6966  ure)..        if
-0000b9b0: 2063 6865 636b 5f73 7472 7563 7475 7265   check_structure
-0000b9c0: 5f6c 656e 203e 2031 3a0d 0a20 2020 2020  _len > 1:..     
-0000b9d0: 2020 2020 2020 2072 6574 7572 6e20 7472         return tr
-0000b9e0: 616e 7328 6368 6563 6b5f 7374 7275 6374  ans(check_struct
-0000b9f0: 7572 655b 305d 2c20 7069 7463 6829 2827  ure[0], pitch)('
-0000ba00: 2c27 2e6a 6f69 6e28 0d0a 2020 2020 2020  ,'.join(..      
-0000ba10: 2020 2020 2020 2020 2020 6368 6563 6b5f            check_
-0000ba20: 7374 7275 6374 7572 655b 313a 5d29 2920  structure[1:])) 
-0000ba30: 2520 2864 7572 6174 696f 6e2c 2069 6e74  % (duration, int
-0000ba40: 6572 7661 6c29 0d0a 2020 2020 2020 2020  erval)..        
-0000ba50: 6375 7272 656e 745f 6368 6f72 645f 7479  current_chord_ty
-0000ba60: 7065 7320 3d20 6461 7461 6261 7365 2e63  pes = database.c
-0000ba70: 686f 7264 5479 7065 7320 6966 2063 7573  hordTypes if cus
-0000ba80: 746f 6d5f 6d61 7070 696e 6720 6973 204e  tom_mapping is N
-0000ba90: 6f6e 6520 656c 7365 2063 7573 746f 6d5f  one else custom_
-0000baa0: 6d61 7070 696e 670d 0a20 2020 2020 2020  mapping..       
-0000bab0: 204e 203d 206c 656e 286f 626a 290d 0a20   N = len(obj).. 
-0000bac0: 2020 2020 2020 2069 6620 4e20 3d3d 2032         if N == 2
-0000bad0: 3a0d 0a20 2020 2020 2020 2020 2020 2066  :..            f
-0000bae0: 6972 7374 203d 206f 626a 5b30 5d0d 0a20  irst = obj[0].. 
-0000baf0: 2020 2020 2020 2020 2020 2074 7970 6573             types
-0000bb00: 203d 206f 626a 5b31 5d0d 0a20 2020 2020   = obj[1]..     
-0000bb10: 2020 2020 2020 2069 6620 6669 7273 7420         if first 
-0000bb20: 696e 2064 6174 6162 6173 652e 7374 616e  in database.stan
-0000bb30: 6461 7264 2061 6e64 2074 7970 6573 2069  dard and types i
-0000bb40: 6e20 6375 7272 656e 745f 6368 6f72 645f  n current_chord_
-0000bb50: 7479 7065 733a 0d0a 2020 2020 2020 2020  types:..        
-0000bb60: 2020 2020 2020 2020 7265 7475 726e 2067          return g
-0000bb70: 6574 5f63 686f 7264 2866 6972 7374 2c0d  et_chord(first,.
-0000bb80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bba0: 2020 7479 7065 732c 0d0a 2020 2020 2020    types,..      
-0000bbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bbc0: 2020 2020 2020 2020 2020 2070 6974 6368             pitch
-0000bbd0: 3d70 6974 6368 2c0d 0a20 2020 2020 2020  =pitch,..       
-0000bbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bbf0: 2020 2020 2020 2020 2020 6475 7261 7469            durati
-0000bc00: 6f6e 3d64 7572 6174 696f 6e2c 0d0a 2020  on=duration,..  
-0000bc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bc20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000bc30: 6e74 6572 7661 6c73 3d69 6e74 6572 7661  ntervals=interva
-0000bc40: 6c2c 0d0a 2020 2020 2020 2020 2020 2020  l,..            
-0000bc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bc60: 2020 2020 2063 7573 746f 6d5f 6d61 7070       custom_mapp
-0000bc70: 696e 673d 6375 7374 6f6d 5f6d 6170 7069  ing=custom_mappi
-0000bc80: 6e67 290d 0a20 2020 2020 2020 2065 6c69  ng)..        eli
-0000bc90: 6620 4e20 3e20 323a 0d0a 2020 2020 2020  f N > 2:..      
-0000bca0: 2020 2020 2020 6669 7273 745f 7477 6f20        first_two 
-0000bcb0: 3d20 6f62 6a5b 3a32 5d0d 0a20 2020 2020  = obj[:2]..     
-0000bcc0: 2020 2020 2020 2074 7970 6531 203d 206f         type1 = o
-0000bcd0: 626a 5b32 3a5d 0d0a 2020 2020 2020 2020  bj[2:]..        
-0000bce0: 2020 2020 6966 2066 6972 7374 5f74 776f      if first_two
-0000bcf0: 2069 6e20 6461 7461 6261 7365 2e73 7461   in database.sta
-0000bd00: 6e64 6172 6420 616e 6420 7479 7065 3120  ndard and type1 
-0000bd10: 696e 2063 7572 7265 6e74 5f63 686f 7264  in current_chord
-0000bd20: 5f74 7970 6573 3a0d 0a20 2020 2020 2020  _types:..       
-0000bd30: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000bd40: 6765 745f 6368 6f72 6428 6669 7273 745f  get_chord(first_
-0000bd50: 7477 6f2c 0d0a 2020 2020 2020 2020 2020  two,..          
-0000bd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bd70: 2020 2020 2020 2074 7970 6531 2c0d 0a20         type1,.. 
-0000bd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ae70: 6163 6b20 3d20 6b0d 0a20 2020 2020 2020  ack = k..       
+0000ae80: 2020 2020 2063 7572 7265 6e74 5f63 686f       current_cho
+0000ae90: 7264 2e6f 7468 6572 5f6d 6573 7361 6765  rd.other_message
+0000aea0: 7320 3d20 5b0d 0a20 2020 2020 2020 2020  s = [..         
+0000aeb0: 2020 2020 2020 2069 2066 6f72 2069 2069         i for i i
+0000aec0: 6e20 6375 7272 656e 745f 6368 6f72 642e  n current_chord.
+0000aed0: 6f74 6865 725f 6d65 7373 6167 6573 0d0a  other_messages..
+0000aee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aef0: 6966 206e 6f74 2028 6861 7361 7474 7228  if not (hasattr(
+0000af00: 692c 2027 6368 616e 6e65 6c27 290d 0a20  i, 'channel').. 
+0000af10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000af20: 2020 2020 2020 2061 6e64 2069 2e63 6861         and i.cha
+0000af30: 6e6e 656c 206e 6f74 2069 6e20 7265 7375  nnel not in resu
+0000af40: 6c74 5f70 6965 6365 2e63 6861 6e6e 656c  lt_piece.channel
+0000af50: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
+0000af60: 5d0d 0a20 2020 2020 2020 2020 2020 2066  ]..            f
+0000af70: 6f72 2065 6163 6820 696e 2063 7572 7265  or each in curre
+0000af80: 6e74 5f63 686f 7264 2e6f 7468 6572 5f6d  nt_chord.other_m
+0000af90: 6573 7361 6765 733a 0d0a 2020 2020 2020  essages:..      
+0000afa0: 2020 2020 2020 2020 2020 6966 2068 6173            if has
+0000afb0: 6174 7472 2865 6163 682c 2027 6368 616e  attr(each, 'chan
+0000afc0: 6e65 6c27 293a 0d0a 2020 2020 2020 2020  nel'):..        
+0000afd0: 2020 2020 2020 2020 2020 2020 6561 6368              each
+0000afe0: 2e74 7261 636b 203d 2072 6573 756c 745f  .track = result_
+0000aff0: 7069 6563 652e 6368 616e 6e65 6c73 2e69  piece.channels.i
+0000b000: 6e64 6578 2865 6163 682e 6368 616e 6e65  ndex(each.channe
+0000b010: 6c29 0d0a 2020 2020 7265 7375 6c74 5f70  l)..    result_p
+0000b020: 6965 6365 2e6f 7468 6572 5f6d 6573 7361  iece.other_messa
+0000b030: 6765 7320 3d20 6375 7272 656e 745f 6368  ges = current_ch
+0000b040: 6f72 642e 6f74 6865 725f 6d65 7373 6167  ord.other_messag
+0000b050: 6573 0d0a 2020 2020 666f 7220 6b20 696e  es..    for k in
+0000b060: 2072 616e 6765 286c 656e 2872 6573 756c   range(len(resul
+0000b070: 745f 7069 6563 6529 293a 0d0a 2020 2020  t_piece)):..    
+0000b080: 2020 2020 6375 7272 656e 745f 6f74 6865      current_othe
+0000b090: 725f 6d65 7373 6167 6573 203d 205b 0d0a  r_messages = [..
+0000b0a0: 2020 2020 2020 2020 2020 2020 6920 666f              i fo
+0000b0b0: 7220 6920 696e 2072 6573 756c 745f 7069  r i in result_pi
+0000b0c0: 6563 652e 6f74 6865 725f 6d65 7373 6167  ece.other_messag
+0000b0d0: 6573 2069 6620 692e 7472 6163 6b20 3d3d  es if i.track ==
+0000b0e0: 206b 0d0a 2020 2020 2020 2020 5d0d 0a20   k..        ].. 
+0000b0f0: 2020 2020 2020 2072 6573 756c 745f 7069         result_pi
+0000b100: 6563 652e 7472 6163 6b73 5b6b 5d2e 6f74  ece.tracks[k].ot
+0000b110: 6865 725f 6d65 7373 6167 6573 203d 2063  her_messages = c
+0000b120: 7572 7265 6e74 5f6f 7468 6572 5f6d 6573  urrent_other_mes
+0000b130: 7361 6765 730d 0a20 2020 2020 2020 2063  sages..        c
+0000b140: 7572 7265 6e74 5f70 616e 203d 205b 6920  urrent_pan = [i 
+0000b150: 666f 7220 6920 696e 2070 616e 5f6c 6973  for i in pan_lis
+0000b160: 7420 6966 2069 2e74 7261 636b 203d 3d20  t if i.track == 
+0000b170: 6b5d 0d0a 2020 2020 2020 2020 7265 7375  k]..        resu
+0000b180: 6c74 5f70 6965 6365 2e70 616e 5b6b 5d20  lt_piece.pan[k] 
+0000b190: 3d20 6375 7272 656e 745f 7061 6e0d 0a20  = current_pan.. 
+0000b1a0: 2020 2020 2020 2063 7572 7265 6e74 5f76         current_v
+0000b1b0: 6f6c 756d 6520 3d20 5b69 2066 6f72 2069  olume = [i for i
+0000b1c0: 2069 6e20 766f 6c75 6d65 5f6c 6973 7420   in volume_list 
+0000b1d0: 6966 2069 2e74 7261 636b 203d 3d20 6b5d  if i.track == k]
+0000b1e0: 0d0a 2020 2020 2020 2020 7265 7375 6c74  ..        result
+0000b1f0: 5f70 6965 6365 2e76 6f6c 756d 655b 6b5d  _piece.volume[k]
+0000b200: 203d 2063 7572 7265 6e74 5f76 6f6c 756d   = current_volum
+0000b210: 650d 0a20 2020 2072 6573 756c 745f 7069  e..    result_pi
+0000b220: 6563 652e 7472 6163 6b5f 6e61 6d65 7320  ece.track_names 
+0000b230: 3d20 7472 6163 6b5f 6e61 6d65 735f 6c69  = track_names_li
+0000b240: 7374 0d0a 2020 2020 7265 7375 6c74 5f70  st..    result_p
+0000b250: 6965 6365 2e6f 7468 6572 5f6d 6573 7361  iece.other_messa
+0000b260: 6765 7320 3d20 636f 6e63 6174 280d 0a20  ges = concat(.. 
+0000b270: 2020 2020 2020 205b 692e 6f74 6865 725f         [i.other_
+0000b280: 6d65 7373 6167 6573 2066 6f72 2069 2069  messages for i i
+0000b290: 6e20 7265 7375 6c74 5f70 6965 6365 2e74  n result_piece.t
+0000b2a0: 7261 636b 735d 2c20 7374 6172 743d 5b5d  racks], start=[]
+0000b2b0: 290d 0a20 2020 2069 6e73 7472 756d 656e  )..    instrumen
+0000b2c0: 7473 203d 205b 5d0d 0a20 2020 2070 726f  ts = []..    pro
+0000b2d0: 6772 616d 5f63 6861 6e67 655f 6576 656e  gram_change_even
+0000b2e0: 7473 203d 205b 0d0a 2020 2020 2020 2020  ts = [..        
+0000b2f0: 6920 666f 7220 6920 696e 2072 6573 756c  i for i in resul
+0000b300: 745f 7069 6563 652e 6f74 6865 725f 6d65  t_piece.other_me
+0000b310: 7373 6167 6573 2069 6620 692e 7479 7065  ssages if i.type
+0000b320: 203d 3d20 2770 726f 6772 616d 5f63 6861   == 'program_cha
+0000b330: 6e67 6527 0d0a 2020 2020 5d0d 0a20 2020  nge'..    ]..   
+0000b340: 2066 6f72 2069 2c20 6561 6368 2069 6e20   for i, each in 
+0000b350: 656e 756d 6572 6174 6528 7265 7375 6c74  enumerate(result
+0000b360: 5f70 6965 6365 2e63 6861 6e6e 656c 7329  _piece.channels)
+0000b370: 3a0d 0a20 2020 2020 2020 2063 7572 7265  :..        curre
+0000b380: 6e74 5f70 726f 6772 616d 203d 204e 6f6e  nt_program = Non
+0000b390: 650d 0a20 2020 2020 2020 2066 6f72 206a  e..        for j
+0000b3a0: 2069 6e20 7072 6f67 7261 6d5f 6368 616e   in program_chan
+0000b3b0: 6765 5f65 7665 6e74 733a 0d0a 2020 2020  ge_events:..    
+0000b3c0: 2020 2020 2020 2020 6966 206a 2e63 6861          if j.cha
+0000b3d0: 6e6e 656c 203d 3d20 6561 6368 3a0d 0a20  nnel == each:.. 
+0000b3e0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000b3f0: 7572 7265 6e74 5f70 726f 6772 616d 203d  urrent_program =
+0000b400: 206a 2e70 726f 6772 616d 0d0a 2020 2020   j.program..    
+0000b410: 2020 2020 2020 2020 2020 2020 696e 7374              inst
+0000b420: 7275 6d65 6e74 732e 6170 7065 6e64 2863  ruments.append(c
+0000b430: 7572 7265 6e74 5f70 726f 6772 616d 202b  urrent_program +
+0000b440: 2031 290d 0a20 2020 2020 2020 2020 2020   1)..           
+0000b450: 2020 2020 2062 7265 616b 0d0a 2020 2020       break..    
+0000b460: 2020 2020 6966 2063 7572 7265 6e74 5f70      if current_p
+0000b470: 726f 6772 616d 2069 7320 4e6f 6e65 3a0d  rogram is None:.
+0000b480: 0a20 2020 2020 2020 2020 2020 2069 6e73  .            ins
+0000b490: 7472 756d 656e 7473 2e61 7070 656e 6428  truments.append(
+0000b4a0: 3129 0d0a 2020 2020 7265 7375 6c74 5f70  1)..    result_p
+0000b4b0: 6965 6365 2e63 6861 6e67 655f 696e 7374  iece.change_inst
+0000b4c0: 7275 6d65 6e74 7328 696e 7374 7275 6d65  ruments(instrume
+0000b4d0: 6e74 7329 0d0a 2020 2020 7265 7475 726e  nts)..    return
+0000b4e0: 2072 6573 756c 745f 7069 6563 650d 0a0d   result_piece...
+0000b4f0: 0a0d 0a64 6566 206d 6f64 756c 6174 696f  ...def modulatio
+0000b500: 6e28 6375 7272 656e 745f 6368 6f72 642c  n(current_chord,
+0000b510: 206f 6c64 5f73 6361 6c65 2c20 6e65 775f   old_scale, new_
+0000b520: 7363 616c 652c 202a 2a61 7267 7329 3a0d  scale, **args):.
+0000b530: 0a20 2020 2027 2727 0d0a 2020 2020 6368  .    '''..    ch
+0000b540: 616e 6765 206e 6f74 6573 2028 696e 636c  ange notes (incl
+0000b550: 7564 696e 6720 626f 7468 206f 6620 6d65  uding both of me
+0000b560: 6c6f 6479 2061 6e64 2063 686f 7264 7329  lody and chords)
+0000b570: 2069 6e20 7468 6520 6769 7665 6e20 7069   in the given pi
+0000b580: 6563 650d 0a20 2020 206f 6620 6d75 7369  ece..    of musi
+0000b590: 6320 6672 6f6d 2061 2067 6976 656e 2073  c from a given s
+0000b5a0: 6361 6c65 2074 6f20 616e 6f74 6865 7220  cale to another 
+0000b5b0: 6769 7665 6e20 7363 616c 652c 2061 6e64  given scale, and
+0000b5c0: 2072 6574 7572 6e0d 0a20 2020 2074 6865   return..    the
+0000b5d0: 206e 6577 2063 6861 6e67 696e 6720 7069   new changing pi
+0000b5e0: 6563 6520 6f66 206d 7573 6963 2e0d 0a20  ece of music... 
+0000b5f0: 2020 2027 2727 0d0a 2020 2020 7265 7475     '''..    retu
+0000b600: 726e 2063 7572 7265 6e74 5f63 686f 7264  rn current_chord
+0000b610: 2e6d 6f64 756c 6174 696f 6e28 6f6c 645f  .modulation(old_
+0000b620: 7363 616c 652c 206e 6577 5f73 6361 6c65  scale, new_scale
+0000b630: 2c20 2a2a 6172 6773 290d 0a0d 0a0d 0a64  , **args)......d
+0000b640: 6566 2074 7261 6e73 286f 626a 2c20 7069  ef trans(obj, pi
+0000b650: 7463 683d 342c 2064 7572 6174 696f 6e3d  tch=4, duration=
+0000b660: 3120 2f20 342c 2069 6e74 6572 7661 6c3d  1 / 4, interval=
+0000b670: 4e6f 6e65 2c20 6375 7374 6f6d 5f6d 6170  None, custom_map
+0000b680: 7069 6e67 3d4e 6f6e 6529 3a0d 0a20 2020  ping=None):..   
+0000b690: 206f 626a 203d 206f 626a 2e72 6570 6c61   obj = obj.repla
+0000b6a0: 6365 2827 2027 2c20 2727 290d 0a20 2020  ce(' ', '')..   
+0000b6b0: 2069 6620 273a 2720 696e 206f 626a 3a0d   if ':' in obj:.
+0000b6c0: 0a20 2020 2020 2020 2063 7572 7265 6e74  .        current
+0000b6d0: 203d 206f 626a 2e73 706c 6974 2827 3a27   = obj.split(':'
+0000b6e0: 290d 0a20 2020 2020 2020 2063 7572 7265  )..        curre
+0000b6f0: 6e74 5b30 5d20 3d20 746f 5f6e 6f74 6528  nt[0] = to_note(
+0000b700: 6375 7272 656e 745b 305d 290d 0a20 2020  current[0])..   
+0000b710: 2020 2020 2072 6574 7572 6e20 7472 616e       return tran
+0000b720: 7328 6627 7b63 7572 7265 6e74 5b30 5d2e  s(f'{current[0].
+0000b730: 6e61 6d65 7d7b 6375 7272 656e 745b 315d  name}{current[1]
+0000b740: 7d27 2c20 6375 7272 656e 745b 305d 2e6e  }', current[0].n
+0000b750: 756d 2c0d 0a20 2020 2020 2020 2020 2020  um,..           
+0000b760: 2020 2020 2020 2020 2020 6475 7261 7469            durati
+0000b770: 6f6e 2c20 696e 7465 7276 616c 290d 0a20  on, interval).. 
+0000b780: 2020 2069 6620 6f62 6a2e 636f 756e 7428     if obj.count(
+0000b790: 272f 2729 203e 2031 3a0d 0a20 2020 2020  '/') > 1:..     
+0000b7a0: 2020 2063 7572 7265 6e74 5f70 6172 7473     current_parts
+0000b7b0: 203d 206f 626a 2e73 706c 6974 2827 2f27   = obj.split('/'
+0000b7c0: 290d 0a20 2020 2020 2020 2063 7572 7265  )..        curre
+0000b7d0: 6e74 5f70 6172 7473 203d 205b 696e 7428  nt_parts = [int(
+0000b7e0: 6929 2069 6620 692e 6973 6469 6769 7428  i) if i.isdigit(
+0000b7f0: 2920 656c 7365 2069 2066 6f72 2069 2069  ) else i for i i
+0000b800: 6e20 6375 7272 656e 745f 7061 7274 735d  n current_parts]
+0000b810: 0d0a 2020 2020 2020 2020 7265 7375 6c74  ..        result
+0000b820: 203d 2074 7261 6e73 2863 7572 7265 6e74   = trans(current
+0000b830: 5f70 6172 7473 5b30 5d2c 2070 6974 6368  _parts[0], pitch
+0000b840: 2c20 6475 7261 7469 6f6e 2c20 696e 7465  , duration, inte
+0000b850: 7276 616c 290d 0a20 2020 2020 2020 2066  rval)..        f
+0000b860: 6f72 2065 6163 6820 696e 2063 7572 7265  or each in curre
+0000b870: 6e74 5f70 6172 7473 5b31 3a5d 3a0d 0a20  nt_parts[1:]:.. 
+0000b880: 2020 2020 2020 2020 2020 2069 6620 6561             if ea
+0000b890: 6368 2069 6e20 6461 7461 6261 7365 2e73  ch in database.s
+0000b8a0: 7461 6e64 6172 643a 0d0a 2020 2020 2020  tandard:..      
+0000b8b0: 2020 2020 2020 2020 2020 6561 6368 203d            each =
+0000b8c0: 2064 6174 6162 6173 652e 7374 616e 6461   database.standa
+0000b8d0: 7264 5f64 6963 742e 6765 7428 6561 6368  rd_dict.get(each
+0000b8e0: 2c20 6561 6368 290d 0a20 2020 2020 2020  , each)..       
+0000b8f0: 2020 2020 2065 6c69 6620 6e6f 7420 6973       elif not is
+0000b900: 696e 7374 616e 6365 2865 6163 682c 2069  instance(each, i
+0000b910: 6e74 293a 0d0a 2020 2020 2020 2020 2020  nt):..          
+0000b920: 2020 2020 2020 6561 6368 203d 2074 7261        each = tra
+0000b930: 6e73 2865 6163 682c 2070 6974 6368 2c20  ns(each, pitch, 
+0000b940: 6475 7261 7469 6f6e 2c20 696e 7465 7276  duration, interv
+0000b950: 616c 290d 0a20 2020 2020 2020 2020 2020  al)..           
+0000b960: 2072 6573 756c 7420 2f3d 2065 6163 680d   result /= each.
+0000b970: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000b980: 7265 7375 6c74 0d0a 2020 2020 6966 206f  result..    if o
+0000b990: 626a 2069 6e20 6461 7461 6261 7365 2e73  bj in database.s
+0000b9a0: 7461 6e64 6172 643a 0d0a 2020 2020 2020  tandard:..      
+0000b9b0: 2020 7265 7475 726e 2067 6574 5f63 686f    return get_cho
+0000b9c0: 7264 286f 626a 2c0d 0a20 2020 2020 2020  rd(obj,..       
+0000b9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b9e0: 2020 274d 272c 0d0a 2020 2020 2020 2020    'M',..        
+0000b9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba00: 2070 6974 6368 3d70 6974 6368 2c0d 0a20   pitch=pitch,.. 
+0000ba10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba20: 2020 2020 2020 2020 6475 7261 7469 6f6e          duration
+0000ba30: 3d64 7572 6174 696f 6e2c 0d0a 2020 2020  =duration,..    
+0000ba40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba50: 2020 2020 2069 6e74 6572 7661 6c73 3d69       intervals=i
+0000ba60: 6e74 6572 7661 6c2c 0d0a 2020 2020 2020  nterval,..      
+0000ba70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba80: 2020 2063 7573 746f 6d5f 6d61 7070 696e     custom_mappin
+0000ba90: 673d 6375 7374 6f6d 5f6d 6170 7069 6e67  g=custom_mapping
+0000baa0: 290d 0a20 2020 2069 6620 272f 2720 6e6f  )..    if '/' no
+0000bab0: 7420 696e 206f 626a 3a0d 0a20 2020 2020  t in obj:..     
+0000bac0: 2020 2063 6865 636b 5f73 7472 7563 7475     check_structu
+0000bad0: 7265 203d 206f 626a 2e73 706c 6974 2827  re = obj.split('
+0000bae0: 2c27 290d 0a20 2020 2020 2020 2063 6865  ,')..        che
+0000baf0: 636b 5f73 7472 7563 7475 7265 5f6c 656e  ck_structure_len
+0000bb00: 203d 206c 656e 2863 6865 636b 5f73 7472   = len(check_str
+0000bb10: 7563 7475 7265 290d 0a20 2020 2020 2020  ucture)..       
+0000bb20: 2069 6620 6368 6563 6b5f 7374 7275 6374   if check_struct
+0000bb30: 7572 655f 6c65 6e20 3e20 313a 0d0a 2020  ure_len > 1:..  
+0000bb40: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000bb50: 2074 7261 6e73 2863 6865 636b 5f73 7472   trans(check_str
+0000bb60: 7563 7475 7265 5b30 5d2c 2070 6974 6368  ucture[0], pitch
+0000bb70: 2928 272c 272e 6a6f 696e 280d 0a20 2020  )(','.join(..   
+0000bb80: 2020 2020 2020 2020 2020 2020 2063 6865               che
+0000bb90: 636b 5f73 7472 7563 7475 7265 5b31 3a5d  ck_structure[1:]
+0000bba0: 2929 2025 2028 6475 7261 7469 6f6e 2c20  )) % (duration, 
+0000bbb0: 696e 7465 7276 616c 290d 0a20 2020 2020  interval)..     
+0000bbc0: 2020 2063 7572 7265 6e74 5f63 686f 7264     current_chord
+0000bbd0: 5f74 7970 6573 203d 2064 6174 6162 6173  _types = databas
+0000bbe0: 652e 6368 6f72 6454 7970 6573 2069 6620  e.chordTypes if 
+0000bbf0: 6375 7374 6f6d 5f6d 6170 7069 6e67 2069  custom_mapping i
+0000bc00: 7320 4e6f 6e65 2065 6c73 6520 6375 7374  s None else cust
+0000bc10: 6f6d 5f6d 6170 7069 6e67 0d0a 2020 2020  om_mapping..    
+0000bc20: 2020 2020 4e20 3d20 6c65 6e28 6f62 6a29      N = len(obj)
+0000bc30: 0d0a 2020 2020 2020 2020 6966 204e 203d  ..        if N =
+0000bc40: 3d20 323a 0d0a 2020 2020 2020 2020 2020  = 2:..          
+0000bc50: 2020 6669 7273 7420 3d20 6f62 6a5b 305d    first = obj[0]
+0000bc60: 0d0a 2020 2020 2020 2020 2020 2020 7479  ..            ty
+0000bc70: 7065 7320 3d20 6f62 6a5b 315d 0d0a 2020  pes = obj[1]..  
+0000bc80: 2020 2020 2020 2020 2020 6966 2066 6972            if fir
+0000bc90: 7374 2069 6e20 6461 7461 6261 7365 2e73  st in database.s
+0000bca0: 7461 6e64 6172 6420 616e 6420 7479 7065  tandard and type
+0000bcb0: 7320 696e 2063 7572 7265 6e74 5f63 686f  s in current_cho
+0000bcc0: 7264 5f74 7970 6573 3a0d 0a20 2020 2020  rd_types:..     
+0000bcd0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000bce0: 6e20 6765 745f 6368 6f72 6428 6669 7273  n get_chord(firs
+0000bcf0: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
+0000bd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd10: 2020 2020 2074 7970 6573 2c0d 0a20 2020       types,..   
+0000bd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd30: 2020 2020 2020 2020 2020 2020 2020 7069                pi
+0000bd40: 7463 683d 7069 7463 682c 0d0a 2020 2020  tch=pitch,..    
+0000bd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd60: 2020 2020 2020 2020 2020 2020 2064 7572               dur
+0000bd70: 6174 696f 6e3d 6475 7261 7469 6f6e 2c0d  ation=duration,.
+0000bd80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 0000bd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bda0: 7069 7463 683d 7069 7463 682c 0d0a 2020  pitch=pitch,..  
-0000bdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bdc0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000bdd0: 7572 6174 696f 6e3d 6475 7261 7469 6f6e  uration=duration
-0000bde0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000bdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be00: 2020 2020 696e 7465 7276 616c 733d 696e      intervals=in
-0000be10: 7465 7276 616c 2c0d 0a20 2020 2020 2020  terval,..       
-0000be20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be30: 2020 2020 2020 2020 2020 6375 7374 6f6d            custom
-0000be40: 5f6d 6170 7069 6e67 3d63 7573 746f 6d5f  _mapping=custom_
-0000be50: 6d61 7070 696e 6729 0d0a 2020 2020 2020  mapping)..      
-0000be60: 2020 2020 2020 6669 7273 745f 6f6e 6520        first_one 
-0000be70: 3d20 6f62 6a5b 305d 0d0a 2020 2020 2020  = obj[0]..      
-0000be80: 2020 2020 2020 7479 7065 3220 3d20 6f62        type2 = ob
-0000be90: 6a5b 313a 5d0d 0a20 2020 2020 2020 2020  j[1:]..         
-0000bea0: 2020 2069 6620 6669 7273 745f 6f6e 6520     if first_one 
-0000beb0: 696e 2064 6174 6162 6173 652e 7374 616e  in database.stan
-0000bec0: 6461 7264 2061 6e64 2074 7970 6532 2069  dard and type2 i
-0000bed0: 6e20 6375 7272 656e 745f 6368 6f72 645f  n current_chord_
-0000bee0: 7479 7065 733a 0d0a 2020 2020 2020 2020  types:..        
-0000bef0: 2020 2020 2020 2020 7265 7475 726e 2067          return g
-0000bf00: 6574 5f63 686f 7264 2866 6972 7374 5f6f  et_chord(first_o
-0000bf10: 6e65 2c0d 0a20 2020 2020 2020 2020 2020  ne,..           
-0000bf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bf30: 2020 2020 2020 7479 7065 322c 0d0a 2020        type2,..  
-0000bf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bf50: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000bf60: 6974 6368 3d70 6974 6368 2c0d 0a20 2020  itch=pitch,..   
-0000bf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bf80: 2020 2020 2020 2020 2020 2020 2020 6475                du
-0000bf90: 7261 7469 6f6e 3d64 7572 6174 696f 6e2c  ration=duration,
-0000bfa0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000bfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bfc0: 2020 2069 6e74 6572 7661 6c73 3d69 6e74     intervals=int
-0000bfd0: 6572 7661 6c2c 0d0a 2020 2020 2020 2020  erval,..        
-0000bfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bff0: 2020 2020 2020 2020 2063 7573 746f 6d5f           custom_
-0000c000: 6d61 7070 696e 673d 6375 7374 6f6d 5f6d  mapping=custom_m
-0000c010: 6170 7069 6e67 290d 0a20 2020 2065 6c73  apping)..    els
-0000c020: 653a 0d0a 2020 2020 2020 2020 7061 7274  e:..        part
-0000c030: 7320 3d20 6f62 6a2e 7370 6c69 7428 272f  s = obj.split('/
-0000c040: 2729 0d0a 2020 2020 2020 2020 7061 7274  ')..        part
-0000c050: 312c 2070 6172 7432 203d 2070 6172 7473  1, part2 = parts
-0000c060: 5b30 5d2c 2027 2f27 2e6a 6f69 6e28 7061  [0], '/'.join(pa
-0000c070: 7274 735b 313a 5d29 0d0a 2020 2020 2020  rts[1:])..      
-0000c080: 2020 6669 7273 745f 6368 6f72 6420 3d20    first_chord = 
-0000c090: 7472 616e 7328 7061 7274 312c 2070 6974  trans(part1, pit
-0000c0a0: 6368 290d 0a20 2020 2020 2020 2069 6620  ch)..        if 
-0000c0b0: 6973 696e 7374 616e 6365 2866 6972 7374  isinstance(first
-0000c0c0: 5f63 686f 7264 2c20 6368 6f72 6429 3a0d  _chord, chord):.
-0000c0d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000c0e0: 7061 7274 322e 6973 6469 6769 7428 2920  part2.isdigit() 
-0000c0f0: 6f72 2028 7061 7274 325b 305d 203d 3d20  or (part2[0] == 
-0000c100: 272d 2720 616e 6420 7061 7274 325b 313a  '-' and part2[1:
-0000c110: 5d2e 6973 6469 6769 7428 2929 3a0d 0a20  ].isdigit()):.. 
-0000c120: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000c130: 6574 7572 6e20 2866 6972 7374 5f63 686f  eturn (first_cho
-0000c140: 7264 202f 2069 6e74 2870 6172 7432 2929  rd / int(part2))
-0000c150: 2025 2028 6475 7261 7469 6f6e 2c20 696e   % (duration, in
-0000c160: 7465 7276 616c 290d 0a20 2020 2020 2020  terval)..       
-0000c170: 2020 2020 2065 6c69 6620 7061 7274 325b       elif part2[
-0000c180: 2d31 5d20 3d3d 2027 2127 2061 6e64 2070  -1] == '!' and p
-0000c190: 6172 7432 5b3a 2d31 5d2e 6973 6469 6769  art2[:-1].isdigi
-0000c1a0: 7428 293a 0d0a 2020 2020 2020 2020 2020  t():..          
-0000c1b0: 2020 2020 2020 7265 7475 726e 2028 6669        return (fi
-0000c1c0: 7273 745f 6368 6f72 6420 4020 696e 7428  rst_chord @ int(
-0000c1d0: 7061 7274 325b 3a2d 315d 2929 2025 2028  part2[:-1])) % (
-0000c1e0: 6475 7261 7469 6f6e 2c20 696e 7465 7276  duration, interv
-0000c1f0: 616c 290d 0a20 2020 2020 2020 2020 2020  al)..           
-0000c200: 2065 6c69 6620 7061 7274 3220 696e 2064   elif part2 in d
-0000c210: 6174 6162 6173 652e 7374 616e 6461 7264  atabase.standard
-0000c220: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0000c230: 2020 2069 6620 7061 7274 3220 6e6f 7420     if part2 not 
-0000c240: 696e 2064 6174 6162 6173 652e 7374 616e  in database.stan
-0000c250: 6461 7264 323a 0d0a 2020 2020 2020 2020  dard2:..        
-0000c260: 2020 2020 2020 2020 2020 2020 7061 7274              part
-0000c270: 3220 3d20 6461 7461 6261 7365 2e73 7461  2 = database.sta
-0000c280: 6e64 6172 645f 6469 6374 5b70 6172 7432  ndard_dict[part2
-0000c290: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-0000c2a0: 2020 2066 6972 7374 5f63 686f 7264 5f6e     first_chord_n
-0000c2b0: 6f74 656e 616d 6573 203d 2066 6972 7374  otenames = first
-0000c2c0: 5f63 686f 7264 2e6e 616d 6573 2829 0d0a  _chord.names()..
-0000c2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c2e0: 6966 2070 6172 7432 2069 6e20 6669 7273  if part2 in firs
-0000c2f0: 745f 6368 6f72 645f 6e6f 7465 6e61 6d65  t_chord_notename
-0000c300: 7320 616e 6420 7061 7274 3220 213d 2066  s and part2 != f
-0000c310: 6972 7374 5f63 686f 7264 5f6e 6f74 656e  irst_chord_noten
-0000c320: 616d 6573 5b0d 0a20 2020 2020 2020 2020  ames[..         
-0000c330: 2020 2020 2020 2020 2020 2020 2020 2030                 0
-0000c340: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
-0000c350: 2020 2020 2020 2020 7265 7475 726e 2028          return (
-0000c360: 6669 7273 745f 6368 6f72 642e 696e 7665  first_chord.inve
-0000c370: 7273 696f 6e28 0d0a 2020 2020 2020 2020  rsion(..        
-0000c380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c390: 6669 7273 745f 6368 6f72 645f 6e6f 7465  first_chord_note
-0000c3a0: 6e61 6d65 732e 696e 6465 7828 7061 7274  names.index(part
-0000c3b0: 3229 2929 2025 2028 6475 7261 7469 6f6e  2))) % (duration
-0000c3c0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000c3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c400: 2020 2069 6e74 6572 7661 6c29 0d0a 2020     interval)..  
-0000c410: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000c420: 7475 726e 2063 686f 7264 285b 7061 7274  turn chord([part
-0000c430: 325d 202b 2066 6972 7374 5f63 686f 7264  2] + first_chord
-0000c440: 5f6e 6f74 656e 616d 6573 2c0d 0a20 2020  _notenames,..   
-0000c450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c460: 2020 2020 2020 2020 2020 726f 6f74 7069            rootpi
-0000c470: 7463 683d 7069 7463 682c 0d0a 2020 2020  tch=pitch,..    
-0000c480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c490: 2020 2020 2020 2020 2064 7572 6174 696f           duratio
-0000c4a0: 6e3d 6475 7261 7469 6f6e 2c0d 0a20 2020  n=duration,..   
-0000c4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c4c0: 2020 2020 2020 2020 2020 696e 7465 7276            interv
-0000c4d0: 616c 3d69 6e74 6572 7661 6c29 0d0a 2020  al=interval)..  
-0000c4e0: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-0000c4f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c500: 2073 6563 6f6e 645f 6368 6f72 6420 3d20   second_chord = 
-0000c510: 7472 616e 7328 7061 7274 322c 2070 6974  trans(part2, pit
-0000c520: 6368 290d 0a20 2020 2020 2020 2020 2020  ch)..           
-0000c530: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-0000c540: 6365 2873 6563 6f6e 645f 6368 6f72 642c  ce(second_chord,
-0000c550: 2063 686f 7264 293a 0d0a 2020 2020 2020   chord):..      
-0000c560: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000c570: 7475 726e 2063 686f 7264 2873 6563 6f6e  turn chord(secon
-0000c580: 645f 6368 6f72 642e 6e61 6d65 7328 2920  d_chord.names() 
-0000c590: 2b20 6669 7273 745f 6368 6f72 642e 6e61  + first_chord.na
-0000c5a0: 6d65 7328 292c 0d0a 2020 2020 2020 2020  mes(),..        
-0000c5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c5c0: 2020 2020 2020 2020 2072 6f6f 7470 6974           rootpit
-0000c5d0: 6368 3d70 6974 6368 2c0d 0a20 2020 2020  ch=pitch,..     
-0000c5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c5f0: 2020 2020 2020 2020 2020 2020 6475 7261              dura
-0000c600: 7469 6f6e 3d64 7572 6174 696f 6e2c 0d0a  tion=duration,..
-0000c610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bda0: 2020 696e 7465 7276 616c 733d 696e 7465    intervals=inte
+0000bdb0: 7276 616c 2c0d 0a20 2020 2020 2020 2020  rval,..         
+0000bdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bdd0: 2020 2020 2020 2020 6375 7374 6f6d 5f6d          custom_m
+0000bde0: 6170 7069 6e67 3d63 7573 746f 6d5f 6d61  apping=custom_ma
+0000bdf0: 7070 696e 6729 0d0a 2020 2020 2020 2020  pping)..        
+0000be00: 656c 6966 204e 203e 2032 3a0d 0a20 2020  elif N > 2:..   
+0000be10: 2020 2020 2020 2020 2066 6972 7374 5f74           first_t
+0000be20: 776f 203d 206f 626a 5b3a 325d 0d0a 2020  wo = obj[:2]..  
+0000be30: 2020 2020 2020 2020 2020 7479 7065 3120            type1 
+0000be40: 3d20 6f62 6a5b 323a 5d0d 0a20 2020 2020  = obj[2:]..     
+0000be50: 2020 2020 2020 2069 6620 6669 7273 745f         if first_
+0000be60: 7477 6f20 696e 2064 6174 6162 6173 652e  two in database.
+0000be70: 7374 616e 6461 7264 2061 6e64 2074 7970  standard and typ
+0000be80: 6531 2069 6e20 6375 7272 656e 745f 6368  e1 in current_ch
+0000be90: 6f72 645f 7479 7065 733a 0d0a 2020 2020  ord_types:..    
+0000bea0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000beb0: 726e 2067 6574 5f63 686f 7264 2866 6972  rn get_chord(fir
+0000bec0: 7374 5f74 776f 2c0d 0a20 2020 2020 2020  st_two,..       
+0000bed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bee0: 2020 2020 2020 2020 2020 7479 7065 312c            type1,
+0000bef0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000bf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf10: 2020 2070 6974 6368 3d70 6974 6368 2c0d     pitch=pitch,.
+0000bf20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf40: 2020 6475 7261 7469 6f6e 3d64 7572 6174    duration=durat
+0000bf50: 696f 6e2c 0d0a 2020 2020 2020 2020 2020  ion,..          
+0000bf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf70: 2020 2020 2020 2069 6e74 6572 7661 6c73         intervals
+0000bf80: 3d69 6e74 6572 7661 6c2c 0d0a 2020 2020  =interval,..    
+0000bf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bfa0: 2020 2020 2020 2020 2020 2020 2063 7573               cus
+0000bfb0: 746f 6d5f 6d61 7070 696e 673d 6375 7374  tom_mapping=cust
+0000bfc0: 6f6d 5f6d 6170 7069 6e67 290d 0a20 2020  om_mapping)..   
+0000bfd0: 2020 2020 2020 2020 2066 6972 7374 5f6f           first_o
+0000bfe0: 6e65 203d 206f 626a 5b30 5d0d 0a20 2020  ne = obj[0]..   
+0000bff0: 2020 2020 2020 2020 2074 7970 6532 203d           type2 =
+0000c000: 206f 626a 5b31 3a5d 0d0a 2020 2020 2020   obj[1:]..      
+0000c010: 2020 2020 2020 6966 2066 6972 7374 5f6f        if first_o
+0000c020: 6e65 2069 6e20 6461 7461 6261 7365 2e73  ne in database.s
+0000c030: 7461 6e64 6172 6420 616e 6420 7479 7065  tandard and type
+0000c040: 3220 696e 2063 7572 7265 6e74 5f63 686f  2 in current_cho
+0000c050: 7264 5f74 7970 6573 3a0d 0a20 2020 2020  rd_types:..     
+0000c060: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000c070: 6e20 6765 745f 6368 6f72 6428 6669 7273  n get_chord(firs
+0000c080: 745f 6f6e 652c 0d0a 2020 2020 2020 2020  t_one,..        
+0000c090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c0a0: 2020 2020 2020 2020 2074 7970 6532 2c0d           type2,.
+0000c0b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c0d0: 2020 7069 7463 683d 7069 7463 682c 0d0a    pitch=pitch,..
+0000c0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c100: 2064 7572 6174 696f 6e3d 6475 7261 7469   duration=durati
+0000c110: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
+0000c120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c130: 2020 2020 2020 696e 7465 7276 616c 733d        intervals=
+0000c140: 696e 7465 7276 616c 2c0d 0a20 2020 2020  interval,..     
+0000c150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c160: 2020 2020 2020 2020 2020 2020 6375 7374              cust
+0000c170: 6f6d 5f6d 6170 7069 6e67 3d63 7573 746f  om_mapping=custo
+0000c180: 6d5f 6d61 7070 696e 6729 0d0a 2020 2020  m_mapping)..    
+0000c190: 656c 7365 3a0d 0a20 2020 2020 2020 2070  else:..        p
+0000c1a0: 6172 7473 203d 206f 626a 2e73 706c 6974  arts = obj.split
+0000c1b0: 2827 2f27 290d 0a20 2020 2020 2020 2070  ('/')..        p
+0000c1c0: 6172 7431 2c20 7061 7274 3220 3d20 7061  art1, part2 = pa
+0000c1d0: 7274 735b 305d 2c20 272f 272e 6a6f 696e  rts[0], '/'.join
+0000c1e0: 2870 6172 7473 5b31 3a5d 290d 0a20 2020  (parts[1:])..   
+0000c1f0: 2020 2020 2066 6972 7374 5f63 686f 7264       first_chord
+0000c200: 203d 2074 7261 6e73 2870 6172 7431 2c20   = trans(part1, 
+0000c210: 7069 7463 6829 0d0a 2020 2020 2020 2020  pitch)..        
+0000c220: 6966 2069 7369 6e73 7461 6e63 6528 6669  if isinstance(fi
+0000c230: 7273 745f 6368 6f72 642c 2063 686f 7264  rst_chord, chord
+0000c240: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0000c250: 6966 2070 6172 7432 2e69 7364 6967 6974  if part2.isdigit
+0000c260: 2829 206f 7220 2870 6172 7432 5b30 5d20  () or (part2[0] 
+0000c270: 3d3d 2027 2d27 2061 6e64 2070 6172 7432  == '-' and part2
+0000c280: 5b31 3a5d 2e69 7364 6967 6974 2829 293a  [1:].isdigit()):
+0000c290: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000c2a0: 2020 7265 7475 726e 2028 6669 7273 745f    return (first_
+0000c2b0: 6368 6f72 6420 2f20 696e 7428 7061 7274  chord / int(part
+0000c2c0: 3229 2920 2520 2864 7572 6174 696f 6e2c  2)) % (duration,
+0000c2d0: 2069 6e74 6572 7661 6c29 0d0a 2020 2020   interval)..    
+0000c2e0: 2020 2020 2020 2020 656c 6966 2070 6172          elif par
+0000c2f0: 7432 5b2d 315d 203d 3d20 2721 2720 616e  t2[-1] == '!' an
+0000c300: 6420 7061 7274 325b 3a2d 315d 2e69 7364  d part2[:-1].isd
+0000c310: 6967 6974 2829 3a0d 0a20 2020 2020 2020  igit():..       
+0000c320: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000c330: 2866 6972 7374 5f63 686f 7264 2040 2069  (first_chord @ i
+0000c340: 6e74 2870 6172 7432 5b3a 2d31 5d29 2920  nt(part2[:-1])) 
+0000c350: 2520 2864 7572 6174 696f 6e2c 2069 6e74  % (duration, int
+0000c360: 6572 7661 6c29 0d0a 2020 2020 2020 2020  erval)..        
+0000c370: 2020 2020 656c 6966 2070 6172 7432 2069      elif part2 i
+0000c380: 6e20 6461 7461 6261 7365 2e73 7461 6e64  n database.stand
+0000c390: 6172 643a 0d0a 2020 2020 2020 2020 2020  ard:..          
+0000c3a0: 2020 2020 2020 6966 2070 6172 7432 206e        if part2 n
+0000c3b0: 6f74 2069 6e20 6461 7461 6261 7365 2e73  ot in database.s
+0000c3c0: 7461 6e64 6172 6432 3a0d 0a20 2020 2020  tandard2:..     
+0000c3d0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000c3e0: 6172 7432 203d 2064 6174 6162 6173 652e  art2 = database.
+0000c3f0: 7374 616e 6461 7264 5f64 6963 745b 7061  standard_dict[pa
+0000c400: 7274 325d 0d0a 2020 2020 2020 2020 2020  rt2]..          
+0000c410: 2020 2020 2020 6669 7273 745f 6368 6f72        first_chor
+0000c420: 645f 6e6f 7465 6e61 6d65 7320 3d20 6669  d_notenames = fi
+0000c430: 7273 745f 6368 6f72 642e 6e61 6d65 7328  rst_chord.names(
+0000c440: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000c450: 2020 2069 6620 7061 7274 3220 696e 2066     if part2 in f
+0000c460: 6972 7374 5f63 686f 7264 5f6e 6f74 656e  irst_chord_noten
+0000c470: 616d 6573 2061 6e64 2070 6172 7432 2021  ames and part2 !
+0000c480: 3d20 6669 7273 745f 6368 6f72 645f 6e6f  = first_chord_no
+0000c490: 7465 6e61 6d65 735b 0d0a 2020 2020 2020  tenames[..      
+0000c4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c4b0: 2020 305d 3a0d 0a20 2020 2020 2020 2020    0]:..         
+0000c4c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000c4d0: 6e20 2866 6972 7374 5f63 686f 7264 2e69  n (first_chord.i
+0000c4e0: 6e76 6572 7369 6f6e 280d 0a20 2020 2020  nversion(..     
+0000c4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c500: 2020 2066 6972 7374 5f63 686f 7264 5f6e     first_chord_n
+0000c510: 6f74 656e 616d 6573 2e69 6e64 6578 2870  otenames.index(p
+0000c520: 6172 7432 2929 2920 2520 2864 7572 6174  art2))) % (durat
+0000c530: 696f 6e2c 0d0a 2020 2020 2020 2020 2020  ion,..          
+0000c540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c570: 2020 2020 2020 696e 7465 7276 616c 290d        interval).
+0000c580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c590: 2072 6574 7572 6e20 6368 6f72 6428 5b70   return chord([p
+0000c5a0: 6172 7432 5d20 2b20 6669 7273 745f 6368  art2] + first_ch
+0000c5b0: 6f72 645f 6e6f 7465 6e61 6d65 732c 0d0a  ord_notenames,..
+0000c5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c5d0: 2020 2020 2020 2020 2020 2020 2072 6f6f               roo
+0000c5e0: 7470 6974 6368 3d70 6974 6368 2c0d 0a20  tpitch=pitch,.. 
+0000c5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c600: 2020 2020 2020 2020 2020 2020 6475 7261              dura
+0000c610: 7469 6f6e 3d64 7572 6174 696f 6e2c 0d0a  tion=duration,..
 0000c620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c630: 2069 6e74 6572 7661 6c3d 696e 7465 7276   interval=interv
-0000c640: 616c 290d 0a20 2020 2072 6169 7365 2056  al)..    raise V
-0000c650: 616c 7565 4572 726f 7228 0d0a 2020 2020  alueError(..    
-0000c660: 2020 2020 6627 7b6f 626a 7d20 6973 206e      f'{obj} is n
-0000c670: 6f74 2061 2076 616c 6964 2063 686f 7264  ot a valid chord
-0000c680: 2072 6570 7265 7365 6e74 6174 696f 6e20   representation 
-0000c690: 6f72 2063 686f 7264 2074 7970 6573 206e  or chord types n
-0000c6a0: 6f74 2069 6e20 6461 7461 6261 7365 270d  ot in database'.
-0000c6b0: 0a20 2020 2029 0d0a 0d0a 0d0a 6465 6620  .    )......def 
-0000c6c0: 746f 5f73 6361 6c65 286f 626a 2c20 7069  to_scale(obj, pi
-0000c6d0: 7463 683d 4e6f 6e65 293a 0d0a 2020 2020  tch=None):..    
-0000c6e0: 746f 6e69 632c 2073 6361 6c65 5f6e 616d  tonic, scale_nam
-0000c6f0: 6520 3d20 6f62 6a2e 7374 7269 7028 2720  e = obj.strip(' 
-0000c700: 2729 2e73 706c 6974 2827 2027 2c20 3129  ').split(' ', 1)
-0000c710: 0d0a 2020 2020 746f 6e69 6320 3d20 4e28  ..    tonic = N(
-0000c720: 746f 6e69 6329 0d0a 2020 2020 6966 2070  tonic)..    if p
-0000c730: 6974 6368 2069 7320 6e6f 7420 4e6f 6e65  itch is not None
-0000c740: 3a0d 0a20 2020 2020 2020 2074 6f6e 6963  :..        tonic
-0000c750: 2e6e 756d 203d 2070 6974 6368 0d0a 2020  .num = pitch..  
-0000c760: 2020 7363 616c 655f 6e61 6d65 203d 2073    scale_name = s
-0000c770: 6361 6c65 5f6e 616d 652e 7374 7269 7028  cale_name.strip(
-0000c780: 2720 2729 0d0a 2020 2020 7265 7475 726e  ' ')..    return
-0000c790: 2073 6361 6c65 2874 6f6e 6963 2c20 7363   scale(tonic, sc
-0000c7a0: 616c 655f 6e61 6d65 290d 0a0d 0a0d 0a64  ale_name)......d
-0000c7b0: 6566 2069 6e74 6572 7661 6c6f 6628 6375  ef intervalof(cu
-0000c7c0: 7272 656e 745f 6368 6f72 642c 2063 756d  rrent_chord, cum
-0000c7d0: 756c 6174 6976 653d 5472 7565 2c20 7472  ulative=True, tr
-0000c7e0: 616e 736c 6174 653d 4661 6c73 6529 3a0d  anslate=False):.
-0000c7f0: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
-0000c800: 6365 2863 7572 7265 6e74 5f63 686f 7264  ce(current_chord
-0000c810: 2c20 7363 616c 6529 3a0d 0a20 2020 2020  , scale):..     
-0000c820: 2020 2063 7572 7265 6e74 5f63 686f 7264     current_chord
-0000c830: 203d 2063 7572 7265 6e74 5f63 686f 7264   = current_chord
-0000c840: 2e67 6574 5f73 6361 6c65 2829 0d0a 2020  .get_scale()..  
-0000c850: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
-0000c860: 6e63 6528 6375 7272 656e 745f 6368 6f72  nce(current_chor
-0000c870: 642c 2063 686f 7264 293a 0d0a 2020 2020  d, chord):..    
-0000c880: 2020 2020 6375 7272 656e 745f 6368 6f72      current_chor
-0000c890: 6420 3d20 6368 6f72 6428 6375 7272 656e  d = chord(curren
-0000c8a0: 745f 6368 6f72 6429 0d0a 2020 2020 7265  t_chord)..    re
-0000c8b0: 7475 726e 2063 7572 7265 6e74 5f63 686f  turn current_cho
-0000c8c0: 7264 2e69 6e74 6572 7661 6c6f 6628 6375  rd.intervalof(cu
-0000c8d0: 6d75 6c61 7469 7665 2c20 7472 616e 736c  mulative, transl
-0000c8e0: 6174 6529 0d0a 0d0a 0d0a 6465 6620 7375  ate)......def su
-0000c8f0: 6d73 282a 6368 6f72 646c 7329 3a0d 0a20  ms(*chordls):.. 
-0000c900: 2020 2069 6620 6c65 6e28 6368 6f72 646c     if len(chordl
-0000c910: 7329 203d 3d20 313a 0d0a 2020 2020 2020  s) == 1:..      
-0000c920: 2020 6368 6f72 646c 7320 3d20 6368 6f72    chordls = chor
-0000c930: 646c 735b 305d 0d0a 2020 2020 2020 2020  dls[0]..        
-0000c940: 7374 6172 7420 3d20 6368 6f72 646c 735b  start = chordls[
-0000c950: 305d 0d0a 2020 2020 2020 2020 666f 7220  0]..        for 
-0000c960: 6920 696e 2063 686f 7264 6c73 5b31 3a5d  i in chordls[1:]
-0000c970: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-0000c980: 7461 7274 202b 3d20 690d 0a20 2020 2020  tart += i..     
-0000c990: 2020 2072 6574 7572 6e20 7374 6172 740d     return start.
-0000c9a0: 0a20 2020 2065 6c73 653a 0d0a 2020 2020  .    else:..    
-0000c9b0: 2020 2020 7265 7475 726e 2073 756d 7328      return sums(
-0000c9c0: 6c69 7374 2863 686f 7264 6c73 2929 0d0a  list(chordls))..
-0000c9d0: 0d0a 0d0a 6465 6620 6275 696c 6428 2a74  ....def build(*t
-0000c9e0: 7261 636b 735f 6c69 7374 2c20 2a2a 6b77  racks_list, **kw
-0000c9f0: 6172 6773 293a 0d0a 2020 2020 6966 206c  args):..    if l
-0000ca00: 656e 2874 7261 636b 735f 6c69 7374 2920  en(tracks_list) 
-0000ca10: 3d3d 2031 2061 6e64 2069 7369 6e73 7461  == 1 and isinsta
-0000ca20: 6e63 6528 7472 6163 6b73 5f6c 6973 745b  nce(tracks_list[
-0000ca30: 305d 2c20 6c69 7374 293a 0d0a 2020 2020  0], list):..    
-0000ca40: 2020 2020 6375 7272 656e 745f 7472 6163      current_trac
-0000ca50: 6b73 5f6c 6973 7420 3d20 7472 6163 6b73  ks_list = tracks
-0000ca60: 5f6c 6973 745b 305d 0d0a 2020 2020 2020  _list[0]..      
-0000ca70: 2020 6966 2063 7572 7265 6e74 5f74 7261    if current_tra
-0000ca80: 636b 735f 6c69 7374 2061 6e64 2069 7369  cks_list and isi
-0000ca90: 6e73 7461 6e63 6528 6375 7272 656e 745f  nstance(current_
-0000caa0: 7472 6163 6b73 5f6c 6973 745b 305d 2c0d  tracks_list[0],.
-0000cab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cad0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-0000cae0: 6c69 7374 2c20 7472 6163 6b29 293a 0d0a  list, track)):..
-0000caf0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000cb00: 726e 2062 7569 6c64 282a 7472 6163 6b73  rn build(*tracks
-0000cb10: 5f6c 6973 745b 305d 2c20 2a2a 6b77 6172  _list[0], **kwar
-0000cb20: 6773 290d 0a20 2020 2074 7261 636b 7320  gs)..    tracks 
-0000cb30: 3d20 5b5d 0d0a 2020 2020 696e 7374 7275  = []..    instru
-0000cb40: 6d65 6e74 7320 3d20 5b5d 0d0a 2020 2020  ments = []..    
-0000cb50: 7374 6172 745f 7469 6d65 7320 3d20 5b5d  start_times = []
-0000cb60: 0d0a 2020 2020 6368 616e 6e65 6c73 203d  ..    channels =
-0000cb70: 205b 5d0d 0a20 2020 2074 7261 636b 5f6e   []..    track_n
-0000cb80: 616d 6573 203d 205b 5d0d 0a20 2020 2070  ames = []..    p
-0000cb90: 616e 5f6d 7367 203d 205b 5d0d 0a20 2020  an_msg = []..   
-0000cba0: 2076 6f6c 756d 655f 6d73 6720 3d20 5b5d   volume_msg = []
-0000cbb0: 0d0a 2020 2020 6461 775f 6368 616e 6e65  ..    daw_channe
-0000cbc0: 6c73 203d 205b 5d0d 0a20 2020 2072 656d  ls = []..    rem
-0000cbd0: 6169 6e5f 6c69 7374 203d 205b 312c 2030  ain_list = [1, 0
-0000cbe0: 2c20 4e6f 6e65 2c20 4e6f 6e65 2c20 5b5d  , None, None, []
-0000cbf0: 2c20 5b5d 2c20 4e6f 6e65 5d0d 0a20 2020  , [], None]..   
-0000cc00: 2066 6f72 2065 6163 6820 696e 2074 7261   for each in tra
-0000cc10: 636b 735f 6c69 7374 3a0d 0a20 2020 2020  cks_list:..     
-0000cc20: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0000cc30: 2865 6163 682c 2074 7261 636b 293a 0d0a  (each, track):..
-0000cc40: 2020 2020 2020 2020 2020 2020 7472 6163              trac
-0000cc50: 6b73 2e61 7070 656e 6428 6561 6368 2e63  ks.append(each.c
-0000cc60: 6f6e 7465 6e74 290d 0a20 2020 2020 2020  ontent)..       
-0000cc70: 2020 2020 2069 6e73 7472 756d 656e 7473       instruments
-0000cc80: 2e61 7070 656e 6428 6561 6368 2e69 6e73  .append(each.ins
-0000cc90: 7472 756d 656e 7429 0d0a 2020 2020 2020  trument)..      
-0000cca0: 2020 2020 2020 7374 6172 745f 7469 6d65        start_time
-0000ccb0: 732e 6170 7065 6e64 2865 6163 682e 7374  s.append(each.st
-0000ccc0: 6172 745f 7469 6d65 290d 0a20 2020 2020  art_time)..     
-0000ccd0: 2020 2020 2020 2063 6861 6e6e 656c 732e         channels.
-0000cce0: 6170 7065 6e64 2865 6163 682e 6368 616e  append(each.chan
-0000ccf0: 6e65 6c29 0d0a 2020 2020 2020 2020 2020  nel)..          
-0000cd00: 2020 7472 6163 6b5f 6e61 6d65 732e 6170    track_names.ap
-0000cd10: 7065 6e64 2865 6163 682e 7472 6163 6b5f  pend(each.track_
-0000cd20: 6e61 6d65 290d 0a20 2020 2020 2020 2020  name)..         
-0000cd30: 2020 2070 616e 5f6d 7367 2e61 7070 656e     pan_msg.appen
-0000cd40: 6428 6561 6368 2e70 616e 2069 6620 6561  d(each.pan if ea
-0000cd50: 6368 2e70 616e 2065 6c73 6520 5b5d 290d  ch.pan else []).
-0000cd60: 0a20 2020 2020 2020 2020 2020 2076 6f6c  .            vol
-0000cd70: 756d 655f 6d73 672e 6170 7065 6e64 2865  ume_msg.append(e
-0000cd80: 6163 682e 766f 6c75 6d65 2069 6620 6561  ach.volume if ea
-0000cd90: 6368 2e76 6f6c 756d 6520 656c 7365 205b  ch.volume else [
-0000cda0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-0000cdb0: 6461 775f 6368 616e 6e65 6c73 2e61 7070  daw_channels.app
-0000cdc0: 656e 6428 6561 6368 2e64 6177 5f63 6861  end(each.daw_cha
-0000cdd0: 6e6e 656c 290d 0a20 2020 2020 2020 2065  nnel)..        e
-0000cde0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-0000cdf0: 2020 6e65 775f 6561 6368 203d 2065 6163    new_each = eac
-0000ce00: 6820 2b20 7265 6d61 696e 5f6c 6973 745b  h + remain_list[
-0000ce10: 6c65 6e28 6561 6368 2920 2d20 313a 5d0d  len(each) - 1:].
-0000ce20: 0a20 2020 2020 2020 2020 2020 2074 7261  .            tra
-0000ce30: 636b 732e 6170 7065 6e64 286e 6577 5f65  cks.append(new_e
-0000ce40: 6163 685b 305d 290d 0a20 2020 2020 2020  ach[0])..       
-0000ce50: 2020 2020 2069 6e73 7472 756d 656e 7473       instruments
-0000ce60: 2e61 7070 656e 6428 6e65 775f 6561 6368  .append(new_each
-0000ce70: 5b31 5d29 0d0a 2020 2020 2020 2020 2020  [1])..          
-0000ce80: 2020 7374 6172 745f 7469 6d65 732e 6170    start_times.ap
-0000ce90: 7065 6e64 286e 6577 5f65 6163 685b 325d  pend(new_each[2]
-0000cea0: 290d 0a20 2020 2020 2020 2020 2020 2063  )..            c
-0000ceb0: 6861 6e6e 656c 732e 6170 7065 6e64 286e  hannels.append(n
-0000cec0: 6577 5f65 6163 685b 335d 290d 0a20 2020  ew_each[3])..   
-0000ced0: 2020 2020 2020 2020 2074 7261 636b 5f6e           track_n
-0000cee0: 616d 6573 2e61 7070 656e 6428 6e65 775f  ames.append(new_
-0000cef0: 6561 6368 5b34 5d29 0d0a 2020 2020 2020  each[4])..      
-0000cf00: 2020 2020 2020 7061 6e5f 6d73 672e 6170        pan_msg.ap
-0000cf10: 7065 6e64 286e 6577 5f65 6163 685b 355d  pend(new_each[5]
-0000cf20: 290d 0a20 2020 2020 2020 2020 2020 2076  )..            v
-0000cf30: 6f6c 756d 655f 6d73 672e 6170 7065 6e64  olume_msg.append
-0000cf40: 286e 6577 5f65 6163 685b 365d 290d 0a20  (new_each[6]).. 
-0000cf50: 2020 2020 2020 2020 2020 2064 6177 5f63             daw_c
-0000cf60: 6861 6e6e 656c 732e 6170 7065 6e64 286e  hannels.append(n
-0000cf70: 6577 5f65 6163 685b 375d 290d 0a20 2020  ew_each[7])..   
-0000cf80: 2069 6620 616e 7928 6920 6973 204e 6f6e   if any(i is Non
-0000cf90: 6520 666f 7220 6920 696e 2063 6861 6e6e  e for i in chann
-0000cfa0: 656c 7329 3a0d 0a20 2020 2020 2020 2063  els):..        c
-0000cfb0: 6861 6e6e 656c 7320 3d20 4e6f 6e65 0d0a  hannels = None..
-0000cfc0: 2020 2020 6966 2061 6c6c 2869 2069 7320      if all(i is 
-0000cfd0: 4e6f 6e65 2066 6f72 2069 2069 6e20 7472  None for i in tr
-0000cfe0: 6163 6b5f 6e61 6d65 7329 3a0d 0a20 2020  ack_names):..   
-0000cff0: 2020 2020 2074 7261 636b 5f6e 616d 6573       track_names
-0000d000: 203d 204e 6f6e 650d 0a20 2020 2065 6c73   = None..    els
-0000d010: 653a 0d0a 2020 2020 2020 2020 7472 6163  e:..        trac
-0000d020: 6b5f 6e61 6d65 7320 3d20 5b69 2069 6620  k_names = [i if 
-0000d030: 6920 656c 7365 2027 2720 666f 7220 6920  i else '' for i 
-0000d040: 696e 2074 7261 636b 5f6e 616d 6573 5d0d  in track_names].
-0000d050: 0a20 2020 2069 6620 616e 7928 6920 6973  .    if any(i is
-0000d060: 204e 6f6e 6520 666f 7220 6920 696e 2064   None for i in d
-0000d070: 6177 5f63 6861 6e6e 656c 7329 3a0d 0a20  aw_channels):.. 
-0000d080: 2020 2020 2020 2064 6177 5f63 6861 6e6e         daw_chann
-0000d090: 656c 7320 3d20 4e6f 6e65 0d0a 2020 2020  els = None..    
-0000d0a0: 7265 7375 6c74 203d 2050 2874 7261 636b  result = P(track
-0000d0b0: 733d 7472 6163 6b73 2c0d 0a20 2020 2020  s=tracks,..     
-0000d0c0: 2020 2020 2020 2020 2020 696e 7374 7275            instru
-0000d0d0: 6d65 6e74 733d 696e 7374 7275 6d65 6e74  ments=instrument
-0000d0e0: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
-0000d0f0: 2020 2073 7461 7274 5f74 696d 6573 3d73     start_times=s
-0000d100: 7461 7274 5f74 696d 6573 2c0d 0a20 2020  tart_times,..   
-0000d110: 2020 2020 2020 2020 2020 2020 7472 6163              trac
-0000d120: 6b5f 6e61 6d65 733d 7472 6163 6b5f 6e61  k_names=track_na
-0000d130: 6d65 732c 0d0a 2020 2020 2020 2020 2020  mes,..          
-0000d140: 2020 2020 2063 6861 6e6e 656c 733d 6368       channels=ch
-0000d150: 616e 6e65 6c73 2c0d 0a20 2020 2020 2020  annels,..       
-0000d160: 2020 2020 2020 2020 7061 6e3d 7061 6e5f          pan=pan_
-0000d170: 6d73 672c 0d0a 2020 2020 2020 2020 2020  msg,..          
-0000d180: 2020 2020 2076 6f6c 756d 653d 766f 6c75       volume=volu
-0000d190: 6d65 5f6d 7367 2c0d 0a20 2020 2020 2020  me_msg,..       
-0000d1a0: 2020 2020 2020 2020 6461 775f 6368 616e          daw_chan
-0000d1b0: 6e65 6c73 3d64 6177 5f63 6861 6e6e 656c  nels=daw_channel
-0000d1c0: 7329 0d0a 2020 2020 666f 7220 6b65 792c  s)..    for key,
-0000d1d0: 2076 616c 7565 2069 6e20 6b77 6172 6773   value in kwargs
-0000d1e0: 2e69 7465 6d73 2829 3a0d 0a20 2020 2020  .items():..     
-0000d1f0: 2020 2073 6574 6174 7472 2872 6573 756c     setattr(resul
-0000d200: 742c 206b 6579 2c20 7661 6c75 6529 0d0a  t, key, value)..
-0000d210: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
-0000d220: 740d 0a0d 0a0d 0a64 6566 2074 7261 6e73  t......def trans
-0000d230: 6c61 7465 2870 6174 7465 726e 2c0d 0a20  late(pattern,.. 
-0000d240: 2020 2020 2020 2020 2020 2020 2064 6566               def
-0000d250: 6175 6c74 5f64 7572 6174 696f 6e3d 3120  ault_duration=1 
-0000d260: 2f20 382c 0d0a 2020 2020 2020 2020 2020  / 8,..          
-0000d270: 2020 2020 6465 6661 756c 745f 696e 7465      default_inte
-0000d280: 7276 616c 3d30 2c0d 0a20 2020 2020 2020  rval=0,..       
-0000d290: 2020 2020 2020 2064 6566 6175 6c74 5f76         default_v
-0000d2a0: 6f6c 756d 653d 3130 302c 0d0a 2020 2020  olume=100,..    
-0000d2b0: 2020 2020 2020 2020 2020 7374 6172 745f            start_
-0000d2c0: 7469 6d65 3d4e 6f6e 6529 3a0d 0a20 2020  time=None):..   
-0000d2d0: 2072 6573 756c 7420 3d20 6472 756d 2870   result = drum(p
-0000d2e0: 6174 7465 726e 2c0d 0a20 2020 2020 2020  attern,..       
-0000d2f0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-0000d300: 6c74 5f64 7572 6174 696f 6e3d 6465 6661  lt_duration=defa
-0000d310: 756c 745f 6475 7261 7469 6f6e 2c0d 0a20  ult_duration,.. 
-0000d320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d330: 2073 7461 7274 5f74 696d 653d 7374 6172   start_time=star
-0000d340: 745f 7469 6d65 2c0d 0a20 2020 2020 2020  t_time,..       
-0000d350: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-0000d360: 6c74 5f69 6e74 6572 7661 6c3d 6465 6661  lt_interval=defa
-0000d370: 756c 745f 696e 7465 7276 616c 2c0d 0a20  ult_interval,.. 
-0000d380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d390: 2064 6566 6175 6c74 5f76 6f6c 756d 653d   default_volume=
-0000d3a0: 6465 6661 756c 745f 766f 6c75 6d65 2c0d  default_volume,.
-0000d3b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d3c0: 2020 2074 7261 6e73 6c61 7465 5f6d 6f64     translate_mod
-0000d3d0: 653d 3129 2e6e 6f74 6573 0d0a 2020 2020  e=1).notes..    
-0000d3e0: 7265 7475 726e 2072 6573 756c 740d 0a0d  return result...
-0000d3f0: 0a0d 0a64 6566 2063 686f 7264 5f70 726f  ...def chord_pro
-0000d400: 6772 6573 7369 6f6e 2863 686f 7264 732c  gression(chords,
-0000d410: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000d420: 2020 2020 2020 2020 6475 7261 7469 6f6e          duration
-0000d430: 733d 3120 2f20 342c 0d0a 2020 2020 2020  s=1 / 4,..      
-0000d440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d450: 696e 7465 7276 616c 733d 302c 0d0a 2020  intervals=0,..  
-0000d460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d470: 2020 2020 766f 6c75 6d65 733d 4e6f 6e65      volumes=None
-0000d480: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000d490: 2020 2020 2020 2020 2063 686f 7264 735f           chords_
-0000d4a0: 696e 7465 7276 616c 3d4e 6f6e 652c 0d0a  interval=None,..
-0000d4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d4c0: 2020 2020 2020 6d65 7267 653d 5472 7565        merge=True
-0000d4d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000d4e0: 2020 2020 2020 2020 2073 6361 6c65 3d4e           scale=N
-0000d4f0: 6f6e 652c 0d0a 2020 2020 2020 2020 2020  one,..          
-0000d500: 2020 2020 2020 2020 2020 2020 7365 7061              sepa
-0000d510: 7261 746f 723d 272c 2729 3a0d 0a20 2020  rator=','):..   
-0000d520: 2069 6620 7363 616c 653a 0d0a 2020 2020   if scale:..    
-0000d530: 2020 2020 7265 7475 726e 2073 6361 6c65      return scale
-0000d540: 2e63 686f 7264 5f70 726f 6772 6573 7369  .chord_progressi
-0000d550: 6f6e 2863 686f 7264 732c 2064 7572 6174  on(chords, durat
-0000d560: 696f 6e73 2c20 696e 7465 7276 616c 732c  ions, intervals,
-0000d570: 2076 6f6c 756d 6573 2c0d 0a20 2020 2020   volumes,..     
-0000d580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d5a0: 2020 6368 6f72 6473 5f69 6e74 6572 7661    chords_interva
-0000d5b0: 6c2c 206d 6572 6765 290d 0a20 2020 2069  l, merge)..    i
-0000d5c0: 6620 6973 696e 7374 616e 6365 2863 686f  f isinstance(cho
-0000d5d0: 7264 732c 2073 7472 293a 0d0a 2020 2020  rds, str):..    
-0000d5e0: 2020 2020 6966 2027 2027 206e 6f74 2069      if ' ' not i
-0000d5f0: 6e20 7365 7061 7261 746f 723a 0d0a 2020  n separator:..  
-0000d600: 2020 2020 2020 2020 2020 6368 6f72 6473            chords
-0000d610: 203d 2063 686f 7264 732e 7265 706c 6163   = chords.replac
-0000d620: 6528 2720 272c 2027 2729 0d0a 2020 2020  e(' ', '')..    
-0000d630: 2020 2020 6368 6f72 6473 203d 2063 686f      chords = cho
-0000d640: 7264 732e 7370 6c69 7428 7365 7061 7261  rds.split(separa
-0000d650: 746f 7229 0d0a 2020 2020 6368 6f72 6473  tor)..    chords
-0000d660: 203d 205b 2869 2c20 2920 6966 2069 7369   = [(i, ) if isi
-0000d670: 6e73 7461 6e63 6528 692c 2073 7472 2920  nstance(i, str) 
-0000d680: 656c 7365 2069 2066 6f72 2069 2069 6e20  else i for i in 
-0000d690: 6368 6f72 6473 5d0d 0a20 2020 2063 686f  chords]..    cho
-0000d6a0: 7264 735f 6c65 6e20 3d20 6c65 6e28 6368  rds_len = len(ch
-0000d6b0: 6f72 6473 290d 0a20 2020 2069 6620 6e6f  ords)..    if no
-0000d6c0: 7420 6973 696e 7374 616e 6365 2864 7572  t isinstance(dur
-0000d6d0: 6174 696f 6e73 2c20 6c69 7374 293a 0d0a  ations, list):..
-0000d6e0: 2020 2020 2020 2020 6475 7261 7469 6f6e          duration
-0000d6f0: 7320 3d20 5b64 7572 6174 696f 6e73 2066  s = [durations f
-0000d700: 6f72 2069 2069 6e20 7261 6e67 6528 6368  or i in range(ch
-0000d710: 6f72 6473 5f6c 656e 295d 0d0a 2020 2020  ords_len)]..    
-0000d720: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
-0000d730: 6528 696e 7465 7276 616c 732c 206c 6973  e(intervals, lis
-0000d740: 7429 3a0d 0a20 2020 2020 2020 2069 6e74  t):..        int
-0000d750: 6572 7661 6c73 203d 205b 696e 7465 7276  ervals = [interv
-0000d760: 616c 7320 666f 7220 6920 696e 2072 616e  als for i in ran
-0000d770: 6765 2863 686f 7264 735f 6c65 6e29 5d0d  ge(chords_len)].
-0000d780: 0a20 2020 2069 6620 766f 6c75 6d65 7320  .    if volumes 
-0000d790: 616e 6420 6e6f 7420 6973 696e 7374 616e  and not isinstan
-0000d7a0: 6365 2876 6f6c 756d 6573 2c20 6c69 7374  ce(volumes, list
-0000d7b0: 293a 0d0a 2020 2020 2020 2020 766f 6c75  ):..        volu
-0000d7c0: 6d65 7320 3d20 5b76 6f6c 756d 6573 2066  mes = [volumes f
-0000d7d0: 6f72 2069 2069 6e20 7261 6e67 6528 6368  or i in range(ch
-0000d7e0: 6f72 6473 5f6c 656e 295d 0d0a 2020 2020  ords_len)]..    
-0000d7f0: 6966 2063 686f 7264 735f 696e 7465 7276  if chords_interv
-0000d800: 616c 2061 6e64 206e 6f74 2069 7369 6e73  al and not isins
-0000d810: 7461 6e63 6528 6368 6f72 6473 5f69 6e74  tance(chords_int
-0000d820: 6572 7661 6c2c 206c 6973 7429 3a0d 0a20  erval, list):.. 
-0000d830: 2020 2020 2020 2063 686f 7264 735f 696e         chords_in
-0000d840: 7465 7276 616c 203d 205b 6368 6f72 6473  terval = [chords
-0000d850: 5f69 6e74 6572 7661 6c20 666f 7220 6920  _interval for i 
-0000d860: 696e 2072 616e 6765 2863 686f 7264 735f  in range(chords_
-0000d870: 6c65 6e29 5d0d 0a20 2020 2063 686f 7264  len)]..    chord
-0000d880: 7320 3d20 5b43 282a 6929 2069 6620 6973  s = [C(*i) if is
-0000d890: 696e 7374 616e 6365 2869 2c20 7475 706c  instance(i, tupl
-0000d8a0: 6529 2065 6c73 6520 6920 666f 7220 6920  e) else i for i 
-0000d8b0: 696e 2063 686f 7264 735d 0d0a 2020 2020  in chords]..    
-0000d8c0: 666f 7220 6920 696e 2072 616e 6765 2863  for i in range(c
-0000d8d0: 686f 7264 735f 6c65 6e29 3a0d 0a20 2020  hords_len):..   
-0000d8e0: 2020 2020 2063 686f 7264 735b 695d 2025       chords[i] %
-0000d8f0: 3d20 2864 7572 6174 696f 6e73 5b69 5d2c  = (durations[i],
-0000d900: 2069 6e74 6572 7661 6c73 5b69 5d2c 0d0a   intervals[i],..
-0000d910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d920: 2020 2020 2020 766f 6c75 6d65 735b 695d        volumes[i]
-0000d930: 2069 6620 766f 6c75 6d65 7320 656c 7365   if volumes else
-0000d940: 2076 6f6c 756d 6573 290d 0a20 2020 2069   volumes)..    i
-0000d950: 6620 6d65 7267 653a 0d0a 2020 2020 2020  f merge:..      
-0000d960: 2020 7265 7375 6c74 203d 2063 686f 7264    result = chord
-0000d970: 735b 305d 0d0a 2020 2020 2020 2020 6375  s[0]..        cu
-0000d980: 7272 656e 745f 696e 7465 7276 616c 203d  rrent_interval =
-0000d990: 2030 0d0a 2020 2020 2020 2020 666f 7220   0..        for 
-0000d9a0: 6920 696e 2072 616e 6765 2831 2c20 6368  i in range(1, ch
-0000d9b0: 6f72 6473 5f6c 656e 293a 0d0a 2020 2020  ords_len):..    
-0000d9c0: 2020 2020 2020 2020 6966 2063 686f 7264          if chord
-0000d9d0: 735f 696e 7465 7276 616c 3a0d 0a20 2020  s_interval:..   
-0000d9e0: 2020 2020 2020 2020 2020 2020 2063 7572               cur
-0000d9f0: 7265 6e74 5f69 6e74 6572 7661 6c20 2b3d  rent_interval +=
-0000da00: 2063 686f 7264 735f 696e 7465 7276 616c   chords_interval
-0000da10: 5b69 202d 2031 5d0d 0a20 2020 2020 2020  [i - 1]..       
-0000da20: 2020 2020 2020 2020 2072 6573 756c 7420           result 
-0000da30: 3d20 7265 7375 6c74 2026 2028 6368 6f72  = result & (chor
-0000da40: 6473 5b69 5d2c 2063 7572 7265 6e74 5f69  ds[i], current_i
-0000da50: 6e74 6572 7661 6c29 0d0a 2020 2020 2020  nterval)..      
-0000da60: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-0000da70: 2020 2020 2020 2020 2020 2020 2072 6573               res
-0000da80: 756c 7420 7c3d 2063 686f 7264 735b 695d  ult |= chords[i]
-0000da90: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0000daa0: 2072 6573 756c 740d 0a20 2020 2065 6c73   result..    els
-0000dab0: 653a 0d0a 2020 2020 2020 2020 7265 7475  e:..        retu
-0000dac0: 726e 2063 686f 7264 730d 0a0d 0a0d 0a64  rn chords......d
-0000dad0: 6566 2061 7270 6567 6769 6f28 6368 6f72  ef arpeggio(chor
-0000dae0: 645f 7479 7065 2c0d 0a20 2020 2020 2020  d_type,..       
-0000daf0: 2020 2020 2020 7374 6172 743d 332c 0d0a        start=3,..
-0000db00: 2020 2020 2020 2020 2020 2020 2073 746f               sto
-0000db10: 703d 372c 0d0a 2020 2020 2020 2020 2020  p=7,..          
-0000db20: 2020 2064 7572 6174 696f 6e73 3d31 202f     durations=1 /
-0000db30: 2034 2c0d 0a20 2020 2020 2020 2020 2020   4,..           
-0000db40: 2020 696e 7465 7276 616c 733d 3120 2f20    intervals=1 / 
-0000db50: 3332 2c0d 0a20 2020 2020 2020 2020 2020  32,..           
-0000db60: 2020 6669 7273 745f 6861 6c66 3d54 7275    first_half=Tru
-0000db70: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-0000db80: 2073 6563 6f6e 645f 6861 6c66 3d46 616c   second_half=Fal
-0000db90: 7365 293a 0d0a 2020 2020 6966 2069 7369  se):..    if isi
-0000dba0: 6e73 7461 6e63 6528 6368 6f72 645f 7479  nstance(chord_ty
-0000dbb0: 7065 2c20 7374 7229 3a0d 0a20 2020 2020  pe, str):..     
-0000dbc0: 2020 2072 756c 6520 3d20 6c61 6d62 6461     rule = lambda
-0000dbd0: 2063 686f 7264 5f74 7970 652c 2073 7461   chord_type, sta
-0000dbe0: 7274 2c20 7374 6f70 3a20 636f 6e63 6174  rt, stop: concat
-0000dbf0: 285b 0d0a 2020 2020 2020 2020 2020 2020  ([..            
-0000dc00: 4328 6368 6f72 645f 7479 7065 2c20 6929  C(chord_type, i)
-0000dc10: 2025 2028 6475 7261 7469 6f6e 732c 2069   % (durations, i
-0000dc20: 6e74 6572 7661 6c73 290d 0a20 2020 2020  ntervals)..     
-0000dc30: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-0000dc40: 7261 6e67 6528 7374 6172 742c 2073 746f  range(start, sto
-0000dc50: 7029 0d0a 2020 2020 2020 2020 5d2c 2027  p)..        ], '
-0000dc60: 7c27 290d 0a20 2020 2065 6c73 653a 0d0a  |')..    else:..
-0000dc70: 2020 2020 2020 2020 7275 6c65 203d 206c          rule = l
-0000dc80: 616d 6264 6120 6368 6f72 645f 7479 7065  ambda chord_type
-0000dc90: 2c20 7374 6172 742c 2073 746f 703a 2063  , start, stop: c
-0000dca0: 6f6e 6361 7428 5b0d 0a20 2020 2020 2020  oncat([..       
-0000dcb0: 2020 2020 2063 686f 7264 5f74 7970 652e       chord_type.
-0000dcc0: 7265 7365 745f 6f63 7461 7665 2869 2920  reset_octave(i) 
-0000dcd0: 2520 2864 7572 6174 696f 6e73 2c20 696e  % (durations, in
-0000dce0: 7465 7276 616c 7329 0d0a 2020 2020 2020  tervals)..      
-0000dcf0: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-0000dd00: 616e 6765 2873 7461 7274 2c20 7374 6f70  ange(start, stop
-0000dd10: 290d 0a20 2020 2020 2020 205d 2c20 277c  )..        ], '|
-0000dd20: 2729 0d0a 2020 2020 7265 7375 6c74 203d  ')..    result =
-0000dd30: 2063 686f 7264 285b 5d29 0d0a 2020 2020   chord([])..    
-0000dd40: 6669 7273 745f 6861 6c66 5f70 6172 7420  first_half_part 
-0000dd50: 3d20 7275 6c65 2863 686f 7264 5f74 7970  = rule(chord_typ
-0000dd60: 652c 2073 7461 7274 2c20 7374 6f70 290d  e, start, stop).
-0000dd70: 0a20 2020 2073 6563 6f6e 645f 6861 6c66  .    second_half
-0000dd80: 5f70 6172 7420 3d20 7e66 6972 7374 5f68  _part = ~first_h
-0000dd90: 616c 665f 7061 7274 5b3a 2d31 5d0d 0a20  alf_part[:-1].. 
-0000dda0: 2020 2069 6620 6669 7273 745f 6861 6c66     if first_half
-0000ddb0: 3a0d 0a20 2020 2020 2020 2072 6573 756c  :..        resul
-0000ddc0: 7420 2b3d 2066 6972 7374 5f68 616c 665f  t += first_half_
-0000ddd0: 7061 7274 0d0a 2020 2020 6966 2073 6563  part..    if sec
-0000dde0: 6f6e 645f 6861 6c66 3a0d 0a20 2020 2020  ond_half:..     
-0000ddf0: 2020 2072 6573 756c 7420 2b3d 2073 6563     result += sec
-0000de00: 6f6e 645f 6861 6c66 5f70 6172 740d 0a20  ond_half_part.. 
-0000de10: 2020 2072 6574 7572 6e20 7265 7375 6c74     return result
-0000de20: 0d0a 0d0a 0d0a 6465 6620 6469 7374 7269  ......def distri
-0000de30: 6275 7465 2863 7572 7265 6e74 5f63 686f  bute(current_cho
-0000de40: 7264 2c0d 0a20 2020 2020 2020 2020 2020  rd,..           
-0000de50: 2020 2020 6c65 6e67 7468 3d31 202f 2034      length=1 / 4
-0000de60: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000de70: 2020 7374 6172 743d 302c 0d0a 2020 2020    start=0,..    
-0000de80: 2020 2020 2020 2020 2020 2073 746f 703d             stop=
-0000de90: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2020  None,..         
-0000dea0: 2020 2020 2020 6d65 7468 6f64 3d74 7261        method=tra
-0000deb0: 6e73 6c61 7465 2c0d 0a20 2020 2020 2020  nslate,..       
-0000dec0: 2020 2020 2020 2020 6d6f 6465 3d30 293a          mode=0):
-0000ded0: 0d0a 2020 2020 6966 2069 7369 6e73 7461  ..    if isinsta
-0000dee0: 6e63 6528 6375 7272 656e 745f 6368 6f72  nce(current_chor
-0000def0: 642c 2073 7472 293a 0d0a 2020 2020 2020  d, str):..      
-0000df00: 2020 6375 7272 656e 745f 6368 6f72 6420    current_chord 
-0000df10: 3d20 6d65 7468 6f64 2863 7572 7265 6e74  = method(current
-0000df20: 5f63 686f 7264 290d 0a20 2020 2065 6c69  _chord)..    eli
-0000df30: 6620 6973 696e 7374 616e 6365 2863 7572  f isinstance(cur
-0000df40: 7265 6e74 5f63 686f 7264 2c20 6c69 7374  rent_chord, list
-0000df50: 293a 0d0a 2020 2020 2020 2020 6375 7272  ):..        curr
-0000df60: 656e 745f 6368 6f72 6420 3d20 6368 6f72  ent_chord = chor
-0000df70: 6428 6375 7272 656e 745f 6368 6f72 6429  d(current_chord)
-0000df80: 0d0a 2020 2020 6966 2073 746f 7020 6973  ..    if stop is
-0000df90: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-0000dfa0: 7374 6f70 203d 206c 656e 2863 7572 7265  stop = len(curre
-0000dfb0: 6e74 5f63 686f 7264 290d 0a20 2020 2074  nt_chord)..    t
-0000dfc0: 656d 7020 3d20 636f 7079 2863 7572 7265  emp = copy(curre
-0000dfd0: 6e74 5f63 686f 7264 290d 0a20 2020 2070  nt_chord)..    p
-0000dfe0: 6172 7420 3d20 7465 6d70 2e6e 6f74 6573  art = temp.notes
-0000dff0: 5b73 7461 7274 3a73 746f 705d 0d0a 2020  [start:stop]..  
-0000e000: 2020 696e 7465 7276 616c 7320 3d20 7465    intervals = te
-0000e010: 6d70 2e69 6e74 6572 7661 6c5b 7374 6172  mp.interval[star
-0000e020: 743a 7374 6f70 5d0d 0a20 2020 2064 7572  t:stop]..    dur
-0000e030: 6174 696f 6e73 203d 205b 692e 6475 7261  ations = [i.dura
-0000e040: 7469 6f6e 2066 6f72 2069 2069 6e20 7061  tion for i in pa
-0000e050: 7274 5d0d 0a20 2020 2077 686f 6c65 5f64  rt]..    whole_d
-0000e060: 7572 6174 696f 6e20 3d20 7375 6d28 6475  uration = sum(du
-0000e070: 7261 7469 6f6e 7329 0d0a 2020 2020 7768  rations)..    wh
-0000e080: 6f6c 655f 696e 7465 7276 616c 203d 2073  ole_interval = s
-0000e090: 756d 2869 6e74 6572 7661 6c73 290d 0a20  um(intervals).. 
-0000e0a0: 2020 2064 7572 6174 696f 6e73 203d 205b     durations = [
-0000e0b0: 6c65 6e67 7468 202a 2028 6920 2f20 7768  length * (i / wh
-0000e0c0: 6f6c 655f 6475 7261 7469 6f6e 2920 666f  ole_duration) fo
-0000e0d0: 7220 6920 696e 2064 7572 6174 696f 6e73  r i in durations
-0000e0e0: 5d0d 0a20 2020 2069 6620 7768 6f6c 655f  ]..    if whole_
-0000e0f0: 696e 7465 7276 616c 2021 3d20 303a 0d0a  interval != 0:..
-0000e100: 2020 2020 2020 2020 696e 7465 7276 616c          interval
-0000e110: 7320 3d20 5b6c 656e 6774 6820 2a20 2869  s = [length * (i
-0000e120: 202f 2077 686f 6c65 5f69 6e74 6572 7661   / whole_interva
-0000e130: 6c29 2066 6f72 2069 2069 6e20 696e 7465  l) for i in inte
-0000e140: 7276 616c 735d 0d0a 2020 2020 656c 7365  rvals]..    else
-0000e150: 3a0d 0a20 2020 2020 2020 2069 6e74 6572  :..        inter
-0000e160: 7661 6c73 203d 205b 3020 666f 7220 6920  vals = [0 for i 
-0000e170: 696e 2069 6e74 6572 7661 6c73 5d0d 0a20  in intervals].. 
-0000e180: 2020 2069 6620 6d6f 6465 203d 3d20 313a     if mode == 1:
-0000e190: 0d0a 2020 2020 2020 2020 696e 7465 7276  ..        interv
-0000e1a0: 616c 7320 3d20 6475 7261 7469 6f6e 730d  als = durations.
-0000e1b0: 0a20 2020 206e 6577 5f64 7572 6174 696f  .    new_duratio
-0000e1c0: 6e20 3d20 7465 6d70 2e67 6574 5f64 7572  n = temp.get_dur
-0000e1d0: 6174 696f 6e28 290d 0a20 2020 206e 6577  ation()..    new
-0000e1e0: 5f64 7572 6174 696f 6e5b 7374 6172 743a  _duration[start:
-0000e1f0: 7374 6f70 5d20 3d20 6475 7261 7469 6f6e  stop] = duration
-0000e200: 730d 0a20 2020 206e 6577 5f69 6e74 6572  s..    new_inter
-0000e210: 7661 6c20 3d20 7465 6d70 2e69 6e74 6572  val = temp.inter
-0000e220: 7661 6c0d 0a20 2020 206e 6577 5f69 6e74  val..    new_int
-0000e230: 6572 7661 6c5b 7374 6172 743a 7374 6f70  erval[start:stop
-0000e240: 5d20 3d20 696e 7465 7276 616c 730d 0a20  ] = intervals.. 
-0000e250: 2020 2074 656d 7020 253d 2028 6e65 775f     temp %= (new_
-0000e260: 6475 7261 7469 6f6e 2c20 6e65 775f 696e  duration, new_in
-0000e270: 7465 7276 616c 290d 0a20 2020 2072 6574  terval)..    ret
-0000e280: 7572 6e20 7465 6d70 0d0a 0d0a 0d0a 6465  urn temp......de
-0000e290: 6620 6765 745f 6368 6f72 6473 5f66 726f  f get_chords_fro
-0000e2a0: 6d5f 7268 7974 686d 2863 686f 7264 732c  m_rhythm(chords,
-0000e2b0: 2063 7572 7265 6e74 5f72 6879 7468 6d2c   current_rhythm,
-0000e2c0: 2073 6574 5f64 7572 6174 696f 6e3d 5472   set_duration=Tr
-0000e2d0: 7565 293a 0d0a 2020 2020 6966 2069 7369  ue):..    if isi
-0000e2e0: 6e73 7461 6e63 6528 6368 6f72 6473 2c20  nstance(chords, 
-0000e2f0: 6e6f 7465 293a 0d0a 2020 2020 2020 2020  note):..        
-0000e300: 6368 6f72 6473 203d 2063 686f 7264 280d  chords = chord(.
-0000e310: 0a20 2020 2020 2020 2020 2020 205b 636f  .            [co
-0000e320: 7079 2863 686f 7264 7329 2066 6f72 2069  py(chords) for i
-0000e330: 2069 6e20 7261 6e67 6528 6375 7272 656e   in range(curren
-0000e340: 745f 7268 7974 686d 2e67 6574 5f62 6561  t_rhythm.get_bea
-0000e350: 745f 6e75 6d28 2929 5d29 0d0a 2020 2020  t_num())])..    
-0000e360: 2020 2020 7265 7475 726e 2063 686f 7264      return chord
-0000e370: 732e 6170 706c 795f 7268 7974 686d 2863  s.apply_rhythm(c
-0000e380: 7572 7265 6e74 5f72 6879 7468 6d2c 2073  urrent_rhythm, s
-0000e390: 6574 5f64 7572 6174 696f 6e3d 7365 745f  et_duration=set_
-0000e3a0: 6475 7261 7469 6f6e 290d 0a20 2020 2069  duration)..    i
-0000e3b0: 6620 6973 696e 7374 616e 6365 2863 686f  f isinstance(cho
-0000e3c0: 7264 732c 2063 686f 7264 293a 0d0a 2020  rds, chord):..  
-0000e3d0: 2020 2020 2020 6368 6f72 6473 203d 205b        chords = [
-0000e3e0: 636f 7079 2863 686f 7264 7329 2066 6f72  copy(chords) for
-0000e3f0: 2069 2069 6e20 7261 6e67 6528 6375 7272   i in range(curr
-0000e400: 656e 745f 7268 7974 686d 2e67 6574 5f62  ent_rhythm.get_b
-0000e410: 6561 745f 6e75 6d28 2929 5d0d 0a20 2020  eat_num())]..   
-0000e420: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-0000e430: 6368 6f72 6473 203d 2063 6f70 7928 6368  chords = copy(ch
-0000e440: 6f72 6473 290d 0a20 2020 206c 656e 6774  ords)..    lengt
-0000e450: 6820 3d20 6c65 6e28 6368 6f72 6473 290d  h = len(chords).
-0000e460: 0a20 2020 2063 6f75 6e74 6572 203d 202d  .    counter = -
-0000e470: 310d 0a20 2020 2068 6173 5f62 6561 7420  1..    has_beat 
-0000e480: 3d20 4661 6c73 650d 0a20 2020 2063 7572  = False..    cur
-0000e490: 7265 6e74 5f73 7461 7274 5f74 696d 6520  rent_start_time 
-0000e4a0: 3d20 300d 0a20 2020 2063 686f 7264 5f69  = 0..    chord_i
-0000e4b0: 6e74 6572 7661 6c73 203d 205b 3020 666f  ntervals = [0 fo
-0000e4c0: 7220 6920 696e 2072 616e 6765 286c 656e  r i in range(len
-0000e4d0: 2863 686f 7264 7329 295d 0d0a 2020 2020  (chords))]..    
-0000e4e0: 666f 7220 692c 2065 6163 6820 696e 2065  for i, each in e
-0000e4f0: 6e75 6d65 7261 7465 2863 7572 7265 6e74  numerate(current
-0000e500: 5f72 6879 7468 6d29 3a0d 0a20 2020 2020  _rhythm):..     
-0000e510: 2020 2063 7572 7265 6e74 5f64 7572 6174     current_durat
-0000e520: 696f 6e20 3d20 6561 6368 2e67 6574 5f64  ion = each.get_d
-0000e530: 7572 6174 696f 6e28 290d 0a20 2020 2020  uration()..     
-0000e540: 2020 2069 6620 7479 7065 2865 6163 6829     if type(each)
-0000e550: 2069 7320 6265 6174 3a0d 0a20 2020 2020   is beat:..     
-0000e560: 2020 2020 2020 2063 6f75 6e74 6572 202b         counter +
-0000e570: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
-0000e580: 2069 6620 636f 756e 7465 7220 3e3d 206c   if counter >= l
-0000e590: 656e 6774 683a 0d0a 2020 2020 2020 2020  ength:..        
-0000e5a0: 2020 2020 2020 2020 6272 6561 6b0d 0a20          break.. 
-0000e5b0: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-0000e5c0: 6e74 5f63 686f 7264 203d 2063 686f 7264  nt_chord = chord
-0000e5d0: 735b 636f 756e 7465 725d 0d0a 2020 2020  s[counter]..    
-0000e5e0: 2020 2020 2020 2020 6966 2073 6574 5f64          if set_d
-0000e5f0: 7572 6174 696f 6e3a 0d0a 2020 2020 2020  uration:..      
-0000e600: 2020 2020 2020 2020 2020 6966 2063 7572            if cur
-0000e610: 7265 6e74 5f64 7572 6174 696f 6e20 213d  rent_duration !=
-0000e620: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
-0000e630: 2020 2020 2020 2020 2066 6f72 206b 2069           for k i
-0000e640: 6e20 6375 7272 656e 745f 6368 6f72 643a  n current_chord:
-0000e650: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000e660: 2020 2020 2020 2020 2020 6b2e 6475 7261            k.dura
-0000e670: 7469 6f6e 203d 2063 7572 7265 6e74 5f64  tion = current_d
-0000e680: 7572 6174 696f 6e0d 0a20 2020 2020 2020  uration..       
-0000e690: 2020 2020 2063 686f 7264 5f69 6e74 6572       chord_inter
-0000e6a0: 7661 6c73 5b63 6f75 6e74 6572 5d20 2b3d  vals[counter] +=
-0000e6b0: 2063 7572 7265 6e74 5f64 7572 6174 696f   current_duratio
-0000e6c0: 6e0d 0a20 2020 2020 2020 2020 2020 2068  n..            h
-0000e6d0: 6173 5f62 6561 7420 3d20 5472 7565 0d0a  as_beat = True..
-0000e6e0: 2020 2020 2020 2020 656c 6966 2074 7970          elif typ
-0000e6f0: 6528 6561 6368 2920 6973 2072 6573 745f  e(each) is rest_
-0000e700: 7379 6d62 6f6c 3a0d 0a20 2020 2020 2020  symbol:..       
-0000e710: 2020 2020 2069 6620 6e6f 7420 6861 735f       if not has_
-0000e720: 6265 6174 3a0d 0a20 2020 2020 2020 2020  beat:..         
-0000e730: 2020 2020 2020 2063 7572 7265 6e74 5f73         current_s
-0000e740: 7461 7274 5f74 696d 6520 2b3d 2063 7572  tart_time += cur
-0000e750: 7265 6e74 5f64 7572 6174 696f 6e0d 0a20  rent_duration.. 
-0000e760: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000e770: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000e780: 2020 6368 6f72 645f 696e 7465 7276 616c    chord_interval
-0000e790: 735b 636f 756e 7465 725d 202b 3d20 6375  s[counter] += cu
-0000e7a0: 7272 656e 745f 6475 7261 7469 6f6e 0d0a  rrent_duration..
-0000e7b0: 2020 2020 2020 2020 656c 6966 2074 7970          elif typ
-0000e7c0: 6528 6561 6368 2920 6973 2063 6f6e 7469  e(each) is conti
-0000e7d0: 6e75 655f 7379 6d62 6f6c 3a0d 0a20 2020  nue_symbol:..   
-0000e7e0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-0000e7f0: 6861 735f 6265 6174 3a0d 0a20 2020 2020  has_beat:..     
-0000e800: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-0000e810: 6e74 5f73 7461 7274 5f74 696d 6520 2b3d  nt_start_time +=
-0000e820: 2063 7572 7265 6e74 5f64 7572 6174 696f   current_duratio
-0000e830: 6e0d 0a20 2020 2020 2020 2020 2020 2065  n..            e
-0000e840: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-0000e850: 2020 2020 2020 6375 7272 656e 745f 6368        current_ch
-0000e860: 6f72 6420 3d20 6368 6f72 6473 5b63 6f75  ord = chords[cou
-0000e870: 6e74 6572 5d0d 0a20 2020 2020 2020 2020  nter]..         
-0000e880: 2020 2020 2020 2066 6f72 206b 2069 6e20         for k in 
-0000e890: 6375 7272 656e 745f 6368 6f72 643a 0d0a  current_chord:..
-0000e8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e8b0: 2020 2020 6b2e 6475 7261 7469 6f6e 202b      k.duration +
-0000e8c0: 3d20 6375 7272 656e 745f 6475 7261 7469  = current_durati
-0000e8d0: 6f6e 0d0a 2020 2020 2020 2020 2020 2020  on..            
-0000e8e0: 2020 2020 6368 6f72 645f 696e 7465 7276      chord_interv
-0000e8f0: 616c 735b 636f 756e 7465 725d 202b 3d20  als[counter] += 
-0000e900: 6375 7272 656e 745f 6475 7261 7469 6f6e  current_duration
-0000e910: 0d0a 2020 2020 7265 7375 6c74 203d 2063  ..    result = c
-0000e920: 686f 7264 735b 305d 0d0a 2020 2020 6375  hords[0]..    cu
-0000e930: 7272 656e 745f 696e 7465 7276 616c 203d  rrent_interval =
-0000e940: 2030 0d0a 2020 2020 666f 7220 692c 2065   0..    for i, e
-0000e950: 6163 6820 696e 2065 6e75 6d65 7261 7465  ach in enumerate
-0000e960: 2863 686f 7264 735b 313a 5d29 3a0d 0a20  (chords[1:]):.. 
-0000e970: 2020 2020 2020 2063 7572 7265 6e74 5f69         current_i
-0000e980: 6e74 6572 7661 6c20 2b3d 2063 686f 7264  nterval += chord
-0000e990: 5f69 6e74 6572 7661 6c73 5b69 5d0d 0a20  _intervals[i].. 
-0000e9a0: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-0000e9b0: 7265 7375 6c74 2026 2028 6561 6368 2c20  result & (each, 
-0000e9c0: 6375 7272 656e 745f 696e 7465 7276 616c  current_interval
-0000e9d0: 290d 0a20 2020 2065 7874 7261 5f69 6e74  )..    extra_int
-0000e9e0: 6572 7661 6c20 3d20 6368 6f72 645f 696e  erval = chord_in
-0000e9f0: 7465 7276 616c 735b 6c65 6e28 6368 6f72  tervals[len(chor
-0000ea00: 6473 2920 2d20 315d 0d0a 2020 2020 7265  ds) - 1]..    re
-0000ea10: 7375 6c74 2e69 6e74 6572 7661 6c5b 2d31  sult.interval[-1
-0000ea20: 5d20 3d20 6578 7472 615f 696e 7465 7276  ] = extra_interv
-0000ea30: 616c 0d0a 2020 2020 7265 7375 6c74 2e73  al..    result.s
-0000ea40: 7461 7274 5f74 696d 6520 3d20 6375 7272  tart_time = curr
-0000ea50: 656e 745f 7374 6172 745f 7469 6d65 0d0a  ent_start_time..
-0000ea60: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
-0000ea70: 740d 0a0d 0a0d 0a40 6d65 7468 6f64 5f77  t......@method_w
-0000ea80: 7261 7070 6572 2863 686f 7264 290d 0a64  rapper(chord)..d
-0000ea90: 6566 2061 6e61 6c79 7a65 5f72 6879 7468  ef analyze_rhyth
-0000eaa0: 6d28 6375 7272 656e 745f 6368 6f72 642c  m(current_chord,
-0000eab0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000eac0: 2020 2020 2069 6e63 6c75 6465 5f63 6f6e       include_con
-0000ead0: 7469 6e75 653d 5472 7565 2c0d 0a20 2020  tinue=True,..   
-0000eae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eaf0: 746f 7461 6c5f 6c65 6e67 7468 3d4e 6f6e  total_length=Non
-0000eb00: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-0000eb10: 2020 2020 2020 2072 656d 6f76 655f 656d         remove_em
-0000eb20: 7074 795f 6265 6174 733d 4661 6c73 652c  pty_beats=False,
-0000eb30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000eb40: 2020 2020 2075 6e69 743d 4e6f 6e65 2c0d       unit=None,.
-0000eb50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000eb60: 2020 2020 6669 6e64 5f75 6e69 745f 6967      find_unit_ig
-0000eb70: 6e6f 7265 5f64 7572 6174 696f 6e3d 4661  nore_duration=Fa
-0000eb80: 6c73 652c 0d0a 2020 2020 2020 2020 2020  lse,..          
-0000eb90: 2020 2020 2020 2020 206d 6572 6765 5f63           merge_c
-0000eba0: 6f6e 7469 6e75 653d 5472 7565 293a 0d0a  ontinue=True):..
-0000ebb0: 2020 2020 6966 2061 6c6c 2869 203c 3d20      if all(i <= 
-0000ebc0: 3020 666f 7220 6920 696e 2063 7572 7265  0 for i in curre
-0000ebd0: 6e74 5f63 686f 7264 2e69 6e74 6572 7661  nt_chord.interva
-0000ebe0: 6c29 3a0d 0a20 2020 2020 2020 2072 6574  l):..        ret
-0000ebf0: 7572 6e20 7268 7974 686d 285b 6265 6174  urn rhythm([beat
-0000ec00: 2830 2920 666f 7220 6920 696e 2072 616e  (0) for i in ran
-0000ec10: 6765 286c 656e 2863 7572 7265 6e74 5f63  ge(len(current_c
-0000ec20: 686f 7264 2929 5d29 0d0a 2020 2020 6966  hord))])..    if
-0000ec30: 2075 6e69 7420 6973 204e 6f6e 653a 0d0a   unit is None:..
-0000ec40: 2020 2020 2020 2020 6375 7272 656e 745f          current_
-0000ec50: 696e 7465 7276 616c 203d 2063 6f70 7928  interval = copy(
-0000ec60: 6375 7272 656e 745f 6368 6f72 642e 696e  current_chord.in
-0000ec70: 7465 7276 616c 290d 0a20 2020 2020 2020  terval)..       
-0000ec80: 2069 6620 6e6f 7420 6669 6e64 5f75 6e69   if not find_uni
-0000ec90: 745f 6967 6e6f 7265 5f64 7572 6174 696f  t_ignore_duratio
-0000eca0: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
-0000ecb0: 6375 7272 656e 745f 696e 7465 7276 616c  current_interval
-0000ecc0: 202b 3d20 5b0d 0a20 2020 2020 2020 2020   += [..         
-0000ecd0: 2020 2020 2020 2063 7572 7265 6e74 5f63         current_c
-0000ece0: 686f 7264 2e69 6e74 6572 7661 6c5b 695d  hord.interval[i]
-0000ecf0: 202d 2063 7572 7265 6e74 5f63 686f 7264   - current_chord
-0000ed00: 5b69 5d2e 6475 7261 7469 6f6e 0d0a 2020  [i].duration..  
-0000ed10: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0000ed20: 7220 6920 696e 2072 616e 6765 286c 656e  r i in range(len
-0000ed30: 2863 7572 7265 6e74 5f63 686f 7264 2929  (current_chord))
-0000ed40: 0d0a 2020 2020 2020 2020 2020 2020 5d0d  ..            ].
-0000ed50: 0a20 2020 2020 2020 2063 7572 7265 6e74  .        current
-0000ed60: 5f69 6e74 6572 7661 6c20 3d20 5b69 2066  _interval = [i f
-0000ed70: 6f72 2069 2069 6e20 6375 7272 656e 745f  or i in current_
-0000ed80: 696e 7465 7276 616c 2069 6620 6920 3e20  interval if i > 
-0000ed90: 305d 0d0a 2020 2020 2020 2020 756e 6974  0]..        unit
-0000eda0: 203d 206d 696e 2863 7572 7265 6e74 5f69   = min(current_i
-0000edb0: 6e74 6572 7661 6c29 0d0a 2020 2020 6265  nterval)..    be
-0000edc0: 6174 5f6c 6973 7420 3d20 5b5d 0d0a 2020  at_list = []..  
-0000edd0: 2020 6966 2063 7572 7265 6e74 5f63 686f    if current_cho
-0000ede0: 7264 2e73 7461 7274 5f74 696d 6520 3e20  rd.start_time > 
-0000edf0: 303a 0d0a 2020 2020 2020 2020 6265 6174  0:..        beat
-0000ee00: 5f6c 6973 742e 6578 7465 6e64 285b 0d0a  _list.extend([..
-0000ee10: 2020 2020 2020 2020 2020 2020 7265 7374              rest
-0000ee20: 5f73 796d 626f 6c28 756e 6974 290d 0a20  _symbol(unit).. 
-0000ee30: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-0000ee40: 2069 6e20 7261 6e67 6528 696e 7428 6375   in range(int(cu
-0000ee50: 7272 656e 745f 6368 6f72 642e 7374 6172  rrent_chord.star
-0000ee60: 745f 7469 6d65 202f 2f20 756e 6974 2929  t_time // unit))
-0000ee70: 0d0a 2020 2020 2020 2020 5d29 0d0a 2020  ..        ])..  
-0000ee80: 2020 666f 7220 692c 2065 6163 6820 696e    for i, each in
-0000ee90: 2065 6e75 6d65 7261 7465 2863 7572 7265   enumerate(curre
-0000eea0: 6e74 5f63 686f 7264 2e69 6e74 6572 7661  nt_chord.interva
-0000eeb0: 6c29 3a0d 0a20 2020 2020 2020 2069 6620  l):..        if 
-0000eec0: 6561 6368 203d 3d20 303a 0d0a 2020 2020  each == 0:..    
-0000eed0: 2020 2020 2020 2020 6265 6174 5f6c 6973          beat_lis
-0000eee0: 742e 6170 7065 6e64 2862 6561 7428 3029  t.append(beat(0)
-0000eef0: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
-0000ef00: 0d0a 2020 2020 2020 2020 2020 2020 6375  ..            cu
-0000ef10: 7272 656e 745f 6265 6174 203d 2062 6561  rrent_beat = bea
-0000ef20: 7428 756e 6974 290d 0a20 2020 2020 2020  t(unit)..       
-0000ef30: 2020 2020 2072 656d 6169 6e5f 696e 7465       remain_inte
-0000ef40: 7276 616c 203d 2065 6163 6820 2d20 756e  rval = each - un
-0000ef50: 6974 0d0a 2020 2020 2020 2020 2020 2020  it..            
-0000ef60: 7265 7374 5f6e 756d 2c20 6578 7472 615f  rest_num, extra_
-0000ef70: 6265 6174 203d 2064 6976 6d6f 6428 7265  beat = divmod(re
-0000ef80: 6d61 696e 5f69 6e74 6572 7661 6c2c 2075  main_interval, u
-0000ef90: 6e69 7429 0d0a 2020 2020 2020 2020 2020  nit)..          
-0000efa0: 2020 6966 2065 7874 7261 5f62 6561 7420    if extra_beat 
-0000efb0: 3e20 303a 0d0a 2020 2020 2020 2020 2020  > 0:..          
-0000efc0: 2020 2020 2020 6375 7272 656e 745f 646f        current_do
-0000efd0: 7474 6564 5f6e 756d 203d 2069 6e74 280d  tted_num = int(.
-0000efe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000eff0: 2020 2020 206d 6174 682e 6c6f 6728 3120       math.log(1 
-0000f000: 2f20 2831 202d 0d0a 2020 2020 2020 2020  / (1 -..        
-0000f010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f020: 2020 2020 2020 2020 2020 2828 2865 7874            (((ext
-0000f030: 7261 5f62 6561 7420 2b20 756e 6974 2920  ra_beat + unit) 
-0000f040: 2f20 756e 6974 2920 2f20 3229 292c 2032  / unit) / 2)), 2
-0000f050: 2929 202d 2031 0d0a 2020 2020 2020 2020  )) - 1..        
-0000f060: 2020 2020 2020 2020 6375 7272 656e 745f          current_
-0000f070: 6265 6174 2e64 6f74 7465 6420 3d20 6375  beat.dotted = cu
-0000f080: 7272 656e 745f 646f 7474 6564 5f6e 756d  rrent_dotted_num
-0000f090: 0d0a 2020 2020 2020 2020 2020 2020 6265  ..            be
-0000f0a0: 6174 5f6c 6973 742e 6170 7065 6e64 2863  at_list.append(c
-0000f0b0: 7572 7265 6e74 5f62 6561 7429 0d0a 2020  urrent_beat)..  
-0000f0c0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0000f0d0: 2069 6e63 6c75 6465 5f63 6f6e 7469 6e75   include_continu
-0000f0e0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0000f0f0: 2020 2020 6265 6174 5f6c 6973 742e 6578      beat_list.ex
-0000f100: 7465 6e64 280d 0a20 2020 2020 2020 2020  tend(..         
-0000f110: 2020 2020 2020 2020 2020 205b 7265 7374             [rest
-0000f120: 5f73 796d 626f 6c28 756e 6974 2920 666f  _symbol(unit) fo
-0000f130: 7220 6b20 696e 2072 616e 6765 2869 6e74  r k in range(int
-0000f140: 2872 6573 745f 6e75 6d29 295d 290d 0a20  (rest_num))]).. 
-0000f150: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000f160: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000f170: 2020 6375 7272 656e 745f 6475 7261 7469    current_durati
-0000f180: 6f6e 203d 2063 7572 7265 6e74 5f63 686f  on = current_cho
-0000f190: 7264 2e6e 6f74 6573 5b69 5d2e 6475 7261  rd.notes[i].dura
-0000f1a0: 7469 6f6e 0d0a 2020 2020 2020 2020 2020  tion..          
-0000f1b0: 2020 2020 2020 6966 2063 7572 7265 6e74        if current
-0000f1c0: 5f64 7572 6174 696f 6e20 3e3d 2065 6163  _duration >= eac
-0000f1d0: 683a 0d0a 2020 2020 2020 2020 2020 2020  h:..            
-0000f1e0: 2020 2020 2020 2020 6966 206e 6f74 206d          if not m
-0000f1f0: 6572 6765 5f63 6f6e 7469 6e75 653a 0d0a  erge_continue:..
-0000f200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f210: 2020 2020 2020 2020 6265 6174 5f6c 6973          beat_lis
-0000f220: 742e 6578 7465 6e64 285b 0d0a 2020 2020  t.extend([..    
-0000f230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f240: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-0000f250: 5f73 796d 626f 6c28 756e 6974 2920 666f  _symbol(unit) fo
-0000f260: 7220 6b20 696e 2072 616e 6765 2869 6e74  r k in range(int
-0000f270: 2872 6573 745f 6e75 6d29 290d 0a20 2020  (rest_num))..   
-0000f280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f290: 2020 2020 205d 290d 0a20 2020 2020 2020       ])..       
-0000f2a0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0000f2b0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0000f2c0: 2020 2020 2020 2020 2020 2020 6265 6174              beat
-0000f2d0: 5f6c 6973 745b 2d31 5d2e 6475 7261 7469  _list[-1].durati
-0000f2e0: 6f6e 202b 3d20 756e 6974 202a 2069 6e74  on += unit * int
-0000f2f0: 2872 6573 745f 6e75 6d29 0d0a 2020 2020  (rest_num)..    
-0000f300: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0000f310: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0000f320: 2020 2020 2020 2063 7572 7265 6e74 5f72         current_r
-0000f330: 6573 745f 6475 7261 7469 6f6e 203d 2065  est_duration = e
-0000f340: 6163 6820 2d20 6375 7272 656e 745f 6475  ach - current_du
-0000f350: 7261 7469 6f6e 0d0a 2020 2020 2020 2020  ration..        
-0000f360: 2020 2020 2020 2020 2020 2020 7265 7374              rest
-0000f370: 5f6e 756d 203d 2063 7572 7265 6e74 5f72  _num = current_r
-0000f380: 6573 745f 6475 7261 7469 6f6e 202f 2f20  est_duration // 
-0000f390: 756e 6974 0d0a 2020 2020 2020 2020 2020  unit..          
-0000f3a0: 2020 2020 2020 2020 2020 6375 7272 656e            curren
-0000f3b0: 745f 636f 6e74 696e 7565 5f64 7572 6174  t_continue_durat
-0000f3c0: 696f 6e20 3d20 6375 7272 656e 745f 6475  ion = current_du
-0000f3d0: 7261 7469 6f6e 202d 2075 6e69 740d 0a20  ration - unit.. 
+0000c630: 2020 2020 2020 2020 2020 2020 2069 6e74               int
+0000c640: 6572 7661 6c3d 696e 7465 7276 616c 290d  erval=interval).
+0000c650: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0000c660: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0000c670: 2020 2020 7365 636f 6e64 5f63 686f 7264      second_chord
+0000c680: 203d 2074 7261 6e73 2870 6172 7432 2c20   = trans(part2, 
+0000c690: 7069 7463 6829 0d0a 2020 2020 2020 2020  pitch)..        
+0000c6a0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+0000c6b0: 7461 6e63 6528 7365 636f 6e64 5f63 686f  tance(second_cho
+0000c6c0: 7264 2c20 6368 6f72 6429 3a0d 0a20 2020  rd, chord):..   
+0000c6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c6e0: 2072 6574 7572 6e20 6368 6f72 6428 7365   return chord(se
+0000c6f0: 636f 6e64 5f63 686f 7264 2e6e 616d 6573  cond_chord.names
+0000c700: 2829 202b 2066 6972 7374 5f63 686f 7264  () + first_chord
+0000c710: 2e6e 616d 6573 2829 2c0d 0a20 2020 2020  .names(),..     
+0000c720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c730: 2020 2020 2020 2020 2020 2020 726f 6f74              root
+0000c740: 7069 7463 683d 7069 7463 682c 0d0a 2020  pitch=pitch,..  
+0000c750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c760: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0000c770: 7572 6174 696f 6e3d 6475 7261 7469 6f6e  uration=duration
+0000c780: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000c790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c7a0: 2020 2020 696e 7465 7276 616c 3d69 6e74      interval=int
+0000c7b0: 6572 7661 6c29 0d0a 2020 2020 7261 6973  erval)..    rais
+0000c7c0: 6520 5661 6c75 6545 7272 6f72 280d 0a20  e ValueError(.. 
+0000c7d0: 2020 2020 2020 2066 277b 6f62 6a7d 2069         f'{obj} i
+0000c7e0: 7320 6e6f 7420 6120 7661 6c69 6420 6368  s not a valid ch
+0000c7f0: 6f72 6420 7265 7072 6573 656e 7461 7469  ord representati
+0000c800: 6f6e 206f 7220 6368 6f72 6420 7479 7065  on or chord type
+0000c810: 7320 6e6f 7420 696e 2064 6174 6162 6173  s not in databas
+0000c820: 6527 0d0a 2020 2020 290d 0a0d 0a0d 0a64  e'..    )......d
+0000c830: 6566 2074 6f5f 7363 616c 6528 6f62 6a2c  ef to_scale(obj,
+0000c840: 2070 6974 6368 3d4e 6f6e 6529 3a0d 0a20   pitch=None):.. 
+0000c850: 2020 2074 6f6e 6963 2c20 7363 616c 655f     tonic, scale_
+0000c860: 6e61 6d65 203d 206f 626a 2e73 7472 6970  name = obj.strip
+0000c870: 2827 2027 292e 7370 6c69 7428 2720 272c  (' ').split(' ',
+0000c880: 2031 290d 0a20 2020 2074 6f6e 6963 203d   1)..    tonic =
+0000c890: 204e 2874 6f6e 6963 290d 0a20 2020 2069   N(tonic)..    i
+0000c8a0: 6620 7069 7463 6820 6973 206e 6f74 204e  f pitch is not N
+0000c8b0: 6f6e 653a 0d0a 2020 2020 2020 2020 746f  one:..        to
+0000c8c0: 6e69 632e 6e75 6d20 3d20 7069 7463 680d  nic.num = pitch.
+0000c8d0: 0a20 2020 2073 6361 6c65 5f6e 616d 6520  .    scale_name 
+0000c8e0: 3d20 7363 616c 655f 6e61 6d65 2e73 7472  = scale_name.str
+0000c8f0: 6970 2827 2027 290d 0a20 2020 2072 6574  ip(' ')..    ret
+0000c900: 7572 6e20 7363 616c 6528 746f 6e69 632c  urn scale(tonic,
+0000c910: 2073 6361 6c65 5f6e 616d 6529 0d0a 0d0a   scale_name)....
+0000c920: 0d0a 6465 6620 696e 7465 7276 616c 6f66  ..def intervalof
+0000c930: 2863 7572 7265 6e74 5f63 686f 7264 2c20  (current_chord, 
+0000c940: 6375 6d75 6c61 7469 7665 3d54 7275 652c  cumulative=True,
+0000c950: 2074 7261 6e73 6c61 7465 3d46 616c 7365   translate=False
+0000c960: 293a 0d0a 2020 2020 6966 2069 7369 6e73  ):..    if isins
+0000c970: 7461 6e63 6528 6375 7272 656e 745f 6368  tance(current_ch
+0000c980: 6f72 642c 2073 6361 6c65 293a 0d0a 2020  ord, scale):..  
+0000c990: 2020 2020 2020 6375 7272 656e 745f 6368        current_ch
+0000c9a0: 6f72 6420 3d20 6375 7272 656e 745f 6368  ord = current_ch
+0000c9b0: 6f72 642e 6765 745f 7363 616c 6528 290d  ord.get_scale().
+0000c9c0: 0a20 2020 2069 6620 6e6f 7420 6973 696e  .    if not isin
+0000c9d0: 7374 616e 6365 2863 7572 7265 6e74 5f63  stance(current_c
+0000c9e0: 686f 7264 2c20 6368 6f72 6429 3a0d 0a20  hord, chord):.. 
+0000c9f0: 2020 2020 2020 2063 7572 7265 6e74 5f63         current_c
+0000ca00: 686f 7264 203d 2063 686f 7264 2863 7572  hord = chord(cur
+0000ca10: 7265 6e74 5f63 686f 7264 290d 0a20 2020  rent_chord)..   
+0000ca20: 2072 6574 7572 6e20 6375 7272 656e 745f   return current_
+0000ca30: 6368 6f72 642e 696e 7465 7276 616c 6f66  chord.intervalof
+0000ca40: 2863 756d 756c 6174 6976 652c 2074 7261  (cumulative, tra
+0000ca50: 6e73 6c61 7465 290d 0a0d 0a0d 0a64 6566  nslate)......def
+0000ca60: 2073 756d 7328 2a63 686f 7264 6c73 293a   sums(*chordls):
+0000ca70: 0d0a 2020 2020 6966 206c 656e 2863 686f  ..    if len(cho
+0000ca80: 7264 6c73 2920 3d3d 2031 3a0d 0a20 2020  rdls) == 1:..   
+0000ca90: 2020 2020 2063 686f 7264 6c73 203d 2063       chordls = c
+0000caa0: 686f 7264 6c73 5b30 5d0d 0a20 2020 2020  hordls[0]..     
+0000cab0: 2020 2073 7461 7274 203d 2063 686f 7264     start = chord
+0000cac0: 6c73 5b30 5d0d 0a20 2020 2020 2020 2066  ls[0]..        f
+0000cad0: 6f72 2069 2069 6e20 6368 6f72 646c 735b  or i in chordls[
+0000cae0: 313a 5d3a 0d0a 2020 2020 2020 2020 2020  1:]:..          
+0000caf0: 2020 7374 6172 7420 2b3d 2069 0d0a 2020    start += i..  
+0000cb00: 2020 2020 2020 7265 7475 726e 2073 7461        return sta
+0000cb10: 7274 0d0a 2020 2020 656c 7365 3a0d 0a20  rt..    else:.. 
+0000cb20: 2020 2020 2020 2072 6574 7572 6e20 7375         return su
+0000cb30: 6d73 286c 6973 7428 6368 6f72 646c 7329  ms(list(chordls)
+0000cb40: 290d 0a0d 0a0d 0a64 6566 2062 7569 6c64  )......def build
+0000cb50: 282a 7472 6163 6b73 5f6c 6973 742c 202a  (*tracks_list, *
+0000cb60: 2a6b 7761 7267 7329 3a0d 0a20 2020 2069  *kwargs):..    i
+0000cb70: 6620 6c65 6e28 7472 6163 6b73 5f6c 6973  f len(tracks_lis
+0000cb80: 7429 203d 3d20 3120 616e 6420 6973 696e  t) == 1 and isin
+0000cb90: 7374 616e 6365 2874 7261 636b 735f 6c69  stance(tracks_li
+0000cba0: 7374 5b30 5d2c 206c 6973 7429 3a0d 0a20  st[0], list):.. 
+0000cbb0: 2020 2020 2020 2063 7572 7265 6e74 5f74         current_t
+0000cbc0: 7261 636b 735f 6c69 7374 203d 2074 7261  racks_list = tra
+0000cbd0: 636b 735f 6c69 7374 5b30 5d0d 0a20 2020  cks_list[0]..   
+0000cbe0: 2020 2020 2069 6620 6375 7272 656e 745f       if current_
+0000cbf0: 7472 6163 6b73 5f6c 6973 7420 616e 6420  tracks_list and 
+0000cc00: 6973 696e 7374 616e 6365 2863 7572 7265  isinstance(curre
+0000cc10: 6e74 5f74 7261 636b 735f 6c69 7374 5b30  nt_tracks_list[0
+0000cc20: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+0000cc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cc50: 2020 286c 6973 742c 2074 7261 636b 2929    (list, track))
+0000cc60: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+0000cc70: 6574 7572 6e20 6275 696c 6428 2a74 7261  eturn build(*tra
+0000cc80: 636b 735f 6c69 7374 5b30 5d2c 202a 2a6b  cks_list[0], **k
+0000cc90: 7761 7267 7329 0d0a 2020 2020 7472 6163  wargs)..    trac
+0000cca0: 6b73 203d 205b 5d0d 0a20 2020 2069 6e73  ks = []..    ins
+0000ccb0: 7472 756d 656e 7473 203d 205b 5d0d 0a20  truments = [].. 
+0000ccc0: 2020 2073 7461 7274 5f74 696d 6573 203d     start_times =
+0000ccd0: 205b 5d0d 0a20 2020 2063 6861 6e6e 656c   []..    channel
+0000cce0: 7320 3d20 5b5d 0d0a 2020 2020 7472 6163  s = []..    trac
+0000ccf0: 6b5f 6e61 6d65 7320 3d20 5b5d 0d0a 2020  k_names = []..  
+0000cd00: 2020 7061 6e5f 6d73 6720 3d20 5b5d 0d0a    pan_msg = []..
+0000cd10: 2020 2020 766f 6c75 6d65 5f6d 7367 203d      volume_msg =
+0000cd20: 205b 5d0d 0a20 2020 2064 6177 5f63 6861   []..    daw_cha
+0000cd30: 6e6e 656c 7320 3d20 5b5d 0d0a 2020 2020  nnels = []..    
+0000cd40: 7265 6d61 696e 5f6c 6973 7420 3d20 5b31  remain_list = [1
+0000cd50: 2c20 302c 204e 6f6e 652c 204e 6f6e 652c  , 0, None, None,
+0000cd60: 205b 5d2c 205b 5d2c 204e 6f6e 655d 0d0a   [], [], None]..
+0000cd70: 2020 2020 6f74 6865 725f 6d65 7373 6167      other_messag
+0000cd80: 6573 203d 205b 5d0d 0a20 2020 2066 6f72  es = []..    for
+0000cd90: 2065 6163 6820 696e 2074 7261 636b 735f   each in tracks_
+0000cda0: 6c69 7374 3a0d 0a20 2020 2020 2020 2069  list:..        i
+0000cdb0: 6620 6973 696e 7374 616e 6365 2865 6163  f isinstance(eac
+0000cdc0: 682c 2074 7261 636b 293a 0d0a 2020 2020  h, track):..    
+0000cdd0: 2020 2020 2020 2020 7472 6163 6b73 2e61          tracks.a
+0000cde0: 7070 656e 6428 6561 6368 2e63 6f6e 7465  ppend(each.conte
+0000cdf0: 6e74 290d 0a20 2020 2020 2020 2020 2020  nt)..           
+0000ce00: 2069 6e73 7472 756d 656e 7473 2e61 7070   instruments.app
+0000ce10: 656e 6428 6561 6368 2e69 6e73 7472 756d  end(each.instrum
+0000ce20: 656e 7429 0d0a 2020 2020 2020 2020 2020  ent)..          
+0000ce30: 2020 7374 6172 745f 7469 6d65 732e 6170    start_times.ap
+0000ce40: 7065 6e64 2865 6163 682e 7374 6172 745f  pend(each.start_
+0000ce50: 7469 6d65 290d 0a20 2020 2020 2020 2020  time)..         
+0000ce60: 2020 2063 6861 6e6e 656c 732e 6170 7065     channels.appe
+0000ce70: 6e64 2865 6163 682e 6368 616e 6e65 6c29  nd(each.channel)
+0000ce80: 0d0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
+0000ce90: 6163 6b5f 6e61 6d65 732e 6170 7065 6e64  ack_names.append
+0000cea0: 2865 6163 682e 7472 6163 6b5f 6e61 6d65  (each.track_name
+0000ceb0: 290d 0a20 2020 2020 2020 2020 2020 2070  )..            p
+0000cec0: 616e 5f6d 7367 2e61 7070 656e 6428 6561  an_msg.append(ea
+0000ced0: 6368 2e70 616e 2069 6620 6561 6368 2e70  ch.pan if each.p
+0000cee0: 616e 2065 6c73 6520 5b5d 290d 0a20 2020  an else [])..   
+0000cef0: 2020 2020 2020 2020 2076 6f6c 756d 655f           volume_
+0000cf00: 6d73 672e 6170 7065 6e64 2865 6163 682e  msg.append(each.
+0000cf10: 766f 6c75 6d65 2069 6620 6561 6368 2e76  volume if each.v
+0000cf20: 6f6c 756d 6520 656c 7365 205b 5d29 0d0a  olume else [])..
+0000cf30: 2020 2020 2020 2020 2020 2020 6461 775f              daw_
+0000cf40: 6368 616e 6e65 6c73 2e61 7070 656e 6428  channels.append(
+0000cf50: 6561 6368 2e64 6177 5f63 6861 6e6e 656c  each.daw_channel
+0000cf60: 290d 0a20 2020 2020 2020 2020 2020 206f  )..            o
+0000cf70: 7468 6572 5f6d 6573 7361 6765 732e 6578  ther_messages.ex
+0000cf80: 7465 6e64 2865 6163 682e 636f 6e74 656e  tend(each.conten
+0000cf90: 742e 6f74 6865 725f 6d65 7373 6167 6573  t.other_messages
+0000cfa0: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
+0000cfb0: 0d0a 2020 2020 2020 2020 2020 2020 6e65  ..            ne
+0000cfc0: 775f 6561 6368 203d 2065 6163 6820 2b20  w_each = each + 
+0000cfd0: 7265 6d61 696e 5f6c 6973 745b 6c65 6e28  remain_list[len(
+0000cfe0: 6561 6368 2920 2d20 313a 5d0d 0a20 2020  each) - 1:]..   
+0000cff0: 2020 2020 2020 2020 2074 7261 636b 732e           tracks.
+0000d000: 6170 7065 6e64 286e 6577 5f65 6163 685b  append(new_each[
+0000d010: 305d 290d 0a20 2020 2020 2020 2020 2020  0])..           
+0000d020: 2069 6e73 7472 756d 656e 7473 2e61 7070   instruments.app
+0000d030: 656e 6428 6e65 775f 6561 6368 5b31 5d29  end(new_each[1])
+0000d040: 0d0a 2020 2020 2020 2020 2020 2020 7374  ..            st
+0000d050: 6172 745f 7469 6d65 732e 6170 7065 6e64  art_times.append
+0000d060: 286e 6577 5f65 6163 685b 325d 290d 0a20  (new_each[2]).. 
+0000d070: 2020 2020 2020 2020 2020 2063 6861 6e6e             chann
+0000d080: 656c 732e 6170 7065 6e64 286e 6577 5f65  els.append(new_e
+0000d090: 6163 685b 335d 290d 0a20 2020 2020 2020  ach[3])..       
+0000d0a0: 2020 2020 2074 7261 636b 5f6e 616d 6573       track_names
+0000d0b0: 2e61 7070 656e 6428 6e65 775f 6561 6368  .append(new_each
+0000d0c0: 5b34 5d29 0d0a 2020 2020 2020 2020 2020  [4])..          
+0000d0d0: 2020 7061 6e5f 6d73 672e 6170 7065 6e64    pan_msg.append
+0000d0e0: 286e 6577 5f65 6163 685b 355d 290d 0a20  (new_each[5]).. 
+0000d0f0: 2020 2020 2020 2020 2020 2076 6f6c 756d             volum
+0000d100: 655f 6d73 672e 6170 7065 6e64 286e 6577  e_msg.append(new
+0000d110: 5f65 6163 685b 365d 290d 0a20 2020 2020  _each[6])..     
+0000d120: 2020 2020 2020 2064 6177 5f63 6861 6e6e         daw_chann
+0000d130: 656c 732e 6170 7065 6e64 286e 6577 5f65  els.append(new_e
+0000d140: 6163 685b 375d 290d 0a20 2020 2020 2020  ach[7])..       
+0000d150: 2020 2020 206f 7468 6572 5f6d 6573 7361       other_messa
+0000d160: 6765 732e 6578 7465 6e64 286e 6577 5f65  ges.extend(new_e
+0000d170: 6163 685b 305d 2e6f 7468 6572 5f6d 6573  ach[0].other_mes
+0000d180: 7361 6765 7329 0d0a 2020 2020 6966 2061  sages)..    if a
+0000d190: 6e79 2869 2069 7320 4e6f 6e65 2066 6f72  ny(i is None for
+0000d1a0: 2069 2069 6e20 6368 616e 6e65 6c73 293a   i in channels):
+0000d1b0: 0d0a 2020 2020 2020 2020 6368 616e 6e65  ..        channe
+0000d1c0: 6c73 203d 204e 6f6e 650d 0a20 2020 2069  ls = None..    i
+0000d1d0: 6620 616c 6c28 6920 6973 204e 6f6e 6520  f all(i is None 
+0000d1e0: 666f 7220 6920 696e 2074 7261 636b 5f6e  for i in track_n
+0000d1f0: 616d 6573 293a 0d0a 2020 2020 2020 2020  ames):..        
+0000d200: 7472 6163 6b5f 6e61 6d65 7320 3d20 4e6f  track_names = No
+0000d210: 6e65 0d0a 2020 2020 656c 7365 3a0d 0a20  ne..    else:.. 
+0000d220: 2020 2020 2020 2074 7261 636b 5f6e 616d         track_nam
+0000d230: 6573 203d 205b 6920 6966 2069 2065 6c73  es = [i if i els
+0000d240: 6520 2727 2066 6f72 2069 2069 6e20 7472  e '' for i in tr
+0000d250: 6163 6b5f 6e61 6d65 735d 0d0a 2020 2020  ack_names]..    
+0000d260: 6966 2061 6e79 2869 2069 7320 4e6f 6e65  if any(i is None
+0000d270: 2066 6f72 2069 2069 6e20 6461 775f 6368   for i in daw_ch
+0000d280: 616e 6e65 6c73 293a 0d0a 2020 2020 2020  annels):..      
+0000d290: 2020 6461 775f 6368 616e 6e65 6c73 203d    daw_channels =
+0000d2a0: 204e 6f6e 650d 0a20 2020 2072 6573 756c   None..    resul
+0000d2b0: 7420 3d20 5028 7472 6163 6b73 3d74 7261  t = P(tracks=tra
+0000d2c0: 636b 732c 0d0a 2020 2020 2020 2020 2020  cks,..          
+0000d2d0: 2020 2020 2069 6e73 7472 756d 656e 7473       instruments
+0000d2e0: 3d69 6e73 7472 756d 656e 7473 2c0d 0a20  =instruments,.. 
+0000d2f0: 2020 2020 2020 2020 2020 2020 2020 7374                st
+0000d300: 6172 745f 7469 6d65 733d 7374 6172 745f  art_times=start_
+0000d310: 7469 6d65 732c 0d0a 2020 2020 2020 2020  times,..        
+0000d320: 2020 2020 2020 2074 7261 636b 5f6e 616d         track_nam
+0000d330: 6573 3d74 7261 636b 5f6e 616d 6573 2c0d  es=track_names,.
+0000d340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d350: 6368 616e 6e65 6c73 3d63 6861 6e6e 656c  channels=channel
+0000d360: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+0000d370: 2020 2070 616e 3d70 616e 5f6d 7367 2c0d     pan=pan_msg,.
+0000d380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d390: 766f 6c75 6d65 3d76 6f6c 756d 655f 6d73  volume=volume_ms
+0000d3a0: 672c 0d0a 2020 2020 2020 2020 2020 2020  g,..            
+0000d3b0: 2020 2064 6177 5f63 6861 6e6e 656c 733d     daw_channels=
+0000d3c0: 6461 775f 6368 616e 6e65 6c73 2c0d 0a20  daw_channels,.. 
+0000d3d0: 2020 2020 2020 2020 2020 2020 2020 6f74                ot
+0000d3e0: 6865 725f 6d65 7373 6167 6573 3d6f 7468  her_messages=oth
+0000d3f0: 6572 5f6d 6573 7361 6765 7329 0d0a 2020  er_messages)..  
+0000d400: 2020 666f 7220 6b65 792c 2076 616c 7565    for key, value
+0000d410: 2069 6e20 6b77 6172 6773 2e69 7465 6d73   in kwargs.items
+0000d420: 2829 3a0d 0a20 2020 2020 2020 2073 6574  ():..        set
+0000d430: 6174 7472 2872 6573 756c 742c 206b 6579  attr(result, key
+0000d440: 2c20 7661 6c75 6529 0d0a 2020 2020 7265  , value)..    re
+0000d450: 7475 726e 2072 6573 756c 740d 0a0d 0a0d  turn result.....
+0000d460: 0a64 6566 2074 7261 6e73 6c61 7465 2870  .def translate(p
+0000d470: 6174 7465 726e 2c0d 0a20 2020 2020 2020  attern,..       
+0000d480: 2020 2020 2020 2064 6566 6175 6c74 5f64         default_d
+0000d490: 7572 6174 696f 6e3d 3120 2f20 382c 0d0a  uration=1 / 8,..
+0000d4a0: 2020 2020 2020 2020 2020 2020 2020 6465                de
+0000d4b0: 6661 756c 745f 696e 7465 7276 616c 3d30  fault_interval=0
+0000d4c0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000d4d0: 2064 6566 6175 6c74 5f76 6f6c 756d 653d   default_volume=
+0000d4e0: 3130 302c 0d0a 2020 2020 2020 2020 2020  100,..          
+0000d4f0: 2020 2020 7374 6172 745f 7469 6d65 3d4e      start_time=N
+0000d500: 6f6e 6529 3a0d 0a20 2020 2072 6573 756c  one):..    resul
+0000d510: 7420 3d20 6472 756d 2870 6174 7465 726e  t = drum(pattern
+0000d520: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000d530: 2020 2020 2064 6566 6175 6c74 5f64 7572       default_dur
+0000d540: 6174 696f 6e3d 6465 6661 756c 745f 6475  ation=default_du
+0000d550: 7261 7469 6f6e 2c0d 0a20 2020 2020 2020  ration,..       
+0000d560: 2020 2020 2020 2020 2020 2073 7461 7274             start
+0000d570: 5f74 696d 653d 7374 6172 745f 7469 6d65  _time=start_time
+0000d580: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000d590: 2020 2020 2064 6566 6175 6c74 5f69 6e74       default_int
+0000d5a0: 6572 7661 6c3d 6465 6661 756c 745f 696e  erval=default_in
+0000d5b0: 7465 7276 616c 2c0d 0a20 2020 2020 2020  terval,..       
+0000d5c0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+0000d5d0: 6c74 5f76 6f6c 756d 653d 6465 6661 756c  lt_volume=defaul
+0000d5e0: 745f 766f 6c75 6d65 2c0d 0a20 2020 2020  t_volume,..     
+0000d5f0: 2020 2020 2020 2020 2020 2020 2074 7261               tra
+0000d600: 6e73 6c61 7465 5f6d 6f64 653d 3129 2e6e  nslate_mode=1).n
+0000d610: 6f74 6573 0d0a 2020 2020 7265 7475 726e  otes..    return
+0000d620: 2072 6573 756c 740d 0a0d 0a0d 0a64 6566   result......def
+0000d630: 2063 686f 7264 5f70 726f 6772 6573 7369   chord_progressi
+0000d640: 6f6e 2863 686f 7264 732c 0d0a 2020 2020  on(chords,..    
+0000d650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d660: 2020 6475 7261 7469 6f6e 733d 3120 2f20    durations=1 / 
+0000d670: 342c 0d0a 2020 2020 2020 2020 2020 2020  4,..            
+0000d680: 2020 2020 2020 2020 2020 696e 7465 7276            interv
+0000d690: 616c 733d 302c 0d0a 2020 2020 2020 2020  als=0,..        
+0000d6a0: 2020 2020 2020 2020 2020 2020 2020 766f                vo
+0000d6b0: 6c75 6d65 733d 4e6f 6e65 2c0d 0a20 2020  lumes=None,..   
+0000d6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d6d0: 2020 2063 686f 7264 735f 696e 7465 7276     chords_interv
+0000d6e0: 616c 3d4e 6f6e 652c 0d0a 2020 2020 2020  al=None,..      
+0000d6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d700: 6d65 7267 653d 5472 7565 2c0d 0a20 2020  merge=True,..   
+0000d710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d720: 2020 2073 6361 6c65 3d4e 6f6e 652c 0d0a     scale=None,..
+0000d730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d740: 2020 2020 2020 7365 7061 7261 746f 723d        separator=
+0000d750: 272c 2729 3a0d 0a20 2020 2069 6620 7363  ','):..    if sc
+0000d760: 616c 653a 0d0a 2020 2020 2020 2020 7265  ale:..        re
+0000d770: 7475 726e 2073 6361 6c65 2e63 686f 7264  turn scale.chord
+0000d780: 5f70 726f 6772 6573 7369 6f6e 2863 686f  _progression(cho
+0000d790: 7264 732c 2064 7572 6174 696f 6e73 2c20  rds, durations, 
+0000d7a0: 696e 7465 7276 616c 732c 2076 6f6c 756d  intervals, volum
+0000d7b0: 6573 2c0d 0a20 2020 2020 2020 2020 2020  es,..           
+0000d7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d7d0: 2020 2020 2020 2020 2020 2020 6368 6f72              chor
+0000d7e0: 6473 5f69 6e74 6572 7661 6c2c 206d 6572  ds_interval, mer
+0000d7f0: 6765 290d 0a20 2020 2069 6620 6973 696e  ge)..    if isin
+0000d800: 7374 616e 6365 2863 686f 7264 732c 2073  stance(chords, s
+0000d810: 7472 293a 0d0a 2020 2020 2020 2020 6966  tr):..        if
+0000d820: 2027 2027 206e 6f74 2069 6e20 7365 7061   ' ' not in sepa
+0000d830: 7261 746f 723a 0d0a 2020 2020 2020 2020  rator:..        
+0000d840: 2020 2020 6368 6f72 6473 203d 2063 686f      chords = cho
+0000d850: 7264 732e 7265 706c 6163 6528 2720 272c  rds.replace(' ',
+0000d860: 2027 2729 0d0a 2020 2020 2020 2020 6368   '')..        ch
+0000d870: 6f72 6473 203d 2063 686f 7264 732e 7370  ords = chords.sp
+0000d880: 6c69 7428 7365 7061 7261 746f 7229 0d0a  lit(separator)..
+0000d890: 2020 2020 6368 6f72 6473 203d 205b 2869      chords = [(i
+0000d8a0: 2c20 2920 6966 2069 7369 6e73 7461 6e63  , ) if isinstanc
+0000d8b0: 6528 692c 2073 7472 2920 656c 7365 2069  e(i, str) else i
+0000d8c0: 2066 6f72 2069 2069 6e20 6368 6f72 6473   for i in chords
+0000d8d0: 5d0d 0a20 2020 2063 686f 7264 735f 6c65  ]..    chords_le
+0000d8e0: 6e20 3d20 6c65 6e28 6368 6f72 6473 290d  n = len(chords).
+0000d8f0: 0a20 2020 2069 6620 6e6f 7420 6973 696e  .    if not isin
+0000d900: 7374 616e 6365 2864 7572 6174 696f 6e73  stance(durations
+0000d910: 2c20 6c69 7374 293a 0d0a 2020 2020 2020  , list):..      
+0000d920: 2020 6475 7261 7469 6f6e 7320 3d20 5b64    durations = [d
+0000d930: 7572 6174 696f 6e73 2066 6f72 2069 2069  urations for i i
+0000d940: 6e20 7261 6e67 6528 6368 6f72 6473 5f6c  n range(chords_l
+0000d950: 656e 295d 0d0a 2020 2020 6966 206e 6f74  en)]..    if not
+0000d960: 2069 7369 6e73 7461 6e63 6528 696e 7465   isinstance(inte
+0000d970: 7276 616c 732c 206c 6973 7429 3a0d 0a20  rvals, list):.. 
+0000d980: 2020 2020 2020 2069 6e74 6572 7661 6c73         intervals
+0000d990: 203d 205b 696e 7465 7276 616c 7320 666f   = [intervals fo
+0000d9a0: 7220 6920 696e 2072 616e 6765 2863 686f  r i in range(cho
+0000d9b0: 7264 735f 6c65 6e29 5d0d 0a20 2020 2069  rds_len)]..    i
+0000d9c0: 6620 766f 6c75 6d65 7320 616e 6420 6e6f  f volumes and no
+0000d9d0: 7420 6973 696e 7374 616e 6365 2876 6f6c  t isinstance(vol
+0000d9e0: 756d 6573 2c20 6c69 7374 293a 0d0a 2020  umes, list):..  
+0000d9f0: 2020 2020 2020 766f 6c75 6d65 7320 3d20        volumes = 
+0000da00: 5b76 6f6c 756d 6573 2066 6f72 2069 2069  [volumes for i i
+0000da10: 6e20 7261 6e67 6528 6368 6f72 6473 5f6c  n range(chords_l
+0000da20: 656e 295d 0d0a 2020 2020 6966 2063 686f  en)]..    if cho
+0000da30: 7264 735f 696e 7465 7276 616c 2061 6e64  rds_interval and
+0000da40: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+0000da50: 6368 6f72 6473 5f69 6e74 6572 7661 6c2c  chords_interval,
+0000da60: 206c 6973 7429 3a0d 0a20 2020 2020 2020   list):..       
+0000da70: 2063 686f 7264 735f 696e 7465 7276 616c   chords_interval
+0000da80: 203d 205b 6368 6f72 6473 5f69 6e74 6572   = [chords_inter
+0000da90: 7661 6c20 666f 7220 6920 696e 2072 616e  val for i in ran
+0000daa0: 6765 2863 686f 7264 735f 6c65 6e29 5d0d  ge(chords_len)].
+0000dab0: 0a20 2020 2063 686f 7264 7320 3d20 5b43  .    chords = [C
+0000dac0: 282a 6929 2069 6620 6973 696e 7374 616e  (*i) if isinstan
+0000dad0: 6365 2869 2c20 7475 706c 6529 2065 6c73  ce(i, tuple) els
+0000dae0: 6520 6920 666f 7220 6920 696e 2063 686f  e i for i in cho
+0000daf0: 7264 735d 0d0a 2020 2020 666f 7220 6920  rds]..    for i 
+0000db00: 696e 2072 616e 6765 2863 686f 7264 735f  in range(chords_
+0000db10: 6c65 6e29 3a0d 0a20 2020 2020 2020 2063  len):..        c
+0000db20: 686f 7264 735b 695d 2025 3d20 2864 7572  hords[i] %= (dur
+0000db30: 6174 696f 6e73 5b69 5d2c 2069 6e74 6572  ations[i], inter
+0000db40: 7661 6c73 5b69 5d2c 0d0a 2020 2020 2020  vals[i],..      
+0000db50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000db60: 766f 6c75 6d65 735b 695d 2069 6620 766f  volumes[i] if vo
+0000db70: 6c75 6d65 7320 656c 7365 2076 6f6c 756d  lumes else volum
+0000db80: 6573 290d 0a20 2020 2069 6620 6d65 7267  es)..    if merg
+0000db90: 653a 0d0a 2020 2020 2020 2020 7265 7375  e:..        resu
+0000dba0: 6c74 203d 2063 686f 7264 735b 305d 0d0a  lt = chords[0]..
+0000dbb0: 2020 2020 2020 2020 6375 7272 656e 745f          current_
+0000dbc0: 696e 7465 7276 616c 203d 2030 0d0a 2020  interval = 0..  
+0000dbd0: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
+0000dbe0: 616e 6765 2831 2c20 6368 6f72 6473 5f6c  ange(1, chords_l
+0000dbf0: 656e 293a 0d0a 2020 2020 2020 2020 2020  en):..          
+0000dc00: 2020 6966 2063 686f 7264 735f 696e 7465    if chords_inte
+0000dc10: 7276 616c 3a0d 0a20 2020 2020 2020 2020  rval:..         
+0000dc20: 2020 2020 2020 2063 7572 7265 6e74 5f69         current_i
+0000dc30: 6e74 6572 7661 6c20 2b3d 2063 686f 7264  nterval += chord
+0000dc40: 735f 696e 7465 7276 616c 5b69 202d 2031  s_interval[i - 1
+0000dc50: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+0000dc60: 2020 2072 6573 756c 7420 3d20 7265 7375     result = resu
+0000dc70: 6c74 2026 2028 6368 6f72 6473 5b69 5d2c  lt & (chords[i],
+0000dc80: 2063 7572 7265 6e74 5f69 6e74 6572 7661   current_interva
+0000dc90: 6c29 0d0a 2020 2020 2020 2020 2020 2020  l)..            
+0000dca0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+0000dcb0: 2020 2020 2020 2072 6573 756c 7420 7c3d         result |=
+0000dcc0: 2063 686f 7264 735b 695d 0d0a 2020 2020   chords[i]..    
+0000dcd0: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
+0000dce0: 740d 0a20 2020 2065 6c73 653a 0d0a 2020  t..    else:..  
+0000dcf0: 2020 2020 2020 7265 7475 726e 2063 686f        return cho
+0000dd00: 7264 730d 0a0d 0a0d 0a64 6566 2061 7270  rds......def arp
+0000dd10: 6567 6769 6f28 6368 6f72 645f 7479 7065  eggio(chord_type
+0000dd20: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000dd30: 7374 6172 743d 332c 0d0a 2020 2020 2020  start=3,..      
+0000dd40: 2020 2020 2020 2073 746f 703d 372c 0d0a         stop=7,..
+0000dd50: 2020 2020 2020 2020 2020 2020 2064 7572               dur
+0000dd60: 6174 696f 6e73 3d31 202f 2034 2c0d 0a20  ations=1 / 4,.. 
+0000dd70: 2020 2020 2020 2020 2020 2020 696e 7465              inte
+0000dd80: 7276 616c 733d 3120 2f20 3332 2c0d 0a20  rvals=1 / 32,.. 
+0000dd90: 2020 2020 2020 2020 2020 2020 6669 7273              firs
+0000dda0: 745f 6861 6c66 3d54 7275 652c 0d0a 2020  t_half=True,..  
+0000ddb0: 2020 2020 2020 2020 2020 2073 6563 6f6e             secon
+0000ddc0: 645f 6861 6c66 3d46 616c 7365 293a 0d0a  d_half=False):..
+0000ddd0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0000dde0: 6528 6368 6f72 645f 7479 7065 2c20 7374  e(chord_type, st
+0000ddf0: 7229 3a0d 0a20 2020 2020 2020 2072 756c  r):..        rul
+0000de00: 6520 3d20 6c61 6d62 6461 2063 686f 7264  e = lambda chord
+0000de10: 5f74 7970 652c 2073 7461 7274 2c20 7374  _type, start, st
+0000de20: 6f70 3a20 636f 6e63 6174 285b 0d0a 2020  op: concat([..  
+0000de30: 2020 2020 2020 2020 2020 4328 6368 6f72            C(chor
+0000de40: 645f 7479 7065 2c20 6929 2025 2028 6475  d_type, i) % (du
+0000de50: 7261 7469 6f6e 732c 2069 6e74 6572 7661  rations, interva
+0000de60: 6c73 290d 0a20 2020 2020 2020 2020 2020  ls)..           
+0000de70: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+0000de80: 7374 6172 742c 2073 746f 7029 0d0a 2020  start, stop)..  
+0000de90: 2020 2020 2020 5d2c 2027 7c27 290d 0a20        ], '|').. 
+0000dea0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0000deb0: 2020 7275 6c65 203d 206c 616d 6264 6120    rule = lambda 
+0000dec0: 6368 6f72 645f 7479 7065 2c20 7374 6172  chord_type, star
+0000ded0: 742c 2073 746f 703a 2063 6f6e 6361 7428  t, stop: concat(
+0000dee0: 5b0d 0a20 2020 2020 2020 2020 2020 2063  [..            c
+0000def0: 686f 7264 5f74 7970 652e 7265 7365 745f  hord_type.reset_
+0000df00: 6f63 7461 7665 2869 2920 2520 2864 7572  octave(i) % (dur
+0000df10: 6174 696f 6e73 2c20 696e 7465 7276 616c  ations, interval
+0000df20: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
+0000df30: 666f 7220 6920 696e 2072 616e 6765 2873  for i in range(s
+0000df40: 7461 7274 2c20 7374 6f70 290d 0a20 2020  tart, stop)..   
+0000df50: 2020 2020 205d 2c20 277c 2729 0d0a 2020       ], '|')..  
+0000df60: 2020 7265 7375 6c74 203d 2063 686f 7264    result = chord
+0000df70: 285b 5d29 0d0a 2020 2020 6669 7273 745f  ([])..    first_
+0000df80: 6861 6c66 5f70 6172 7420 3d20 7275 6c65  half_part = rule
+0000df90: 2863 686f 7264 5f74 7970 652c 2073 7461  (chord_type, sta
+0000dfa0: 7274 2c20 7374 6f70 290d 0a20 2020 2073  rt, stop)..    s
+0000dfb0: 6563 6f6e 645f 6861 6c66 5f70 6172 7420  econd_half_part 
+0000dfc0: 3d20 7e66 6972 7374 5f68 616c 665f 7061  = ~first_half_pa
+0000dfd0: 7274 5b3a 2d31 5d0d 0a20 2020 2069 6620  rt[:-1]..    if 
+0000dfe0: 6669 7273 745f 6861 6c66 3a0d 0a20 2020  first_half:..   
+0000dff0: 2020 2020 2072 6573 756c 7420 2b3d 2066       result += f
+0000e000: 6972 7374 5f68 616c 665f 7061 7274 0d0a  irst_half_part..
+0000e010: 2020 2020 6966 2073 6563 6f6e 645f 6861      if second_ha
+0000e020: 6c66 3a0d 0a20 2020 2020 2020 2072 6573  lf:..        res
+0000e030: 756c 7420 2b3d 2073 6563 6f6e 645f 6861  ult += second_ha
+0000e040: 6c66 5f70 6172 740d 0a20 2020 2072 6574  lf_part..    ret
+0000e050: 7572 6e20 7265 7375 6c74 0d0a 0d0a 0d0a  urn result......
+0000e060: 6465 6620 6469 7374 7269 6275 7465 2863  def distribute(c
+0000e070: 7572 7265 6e74 5f63 686f 7264 2c0d 0a20  urrent_chord,.. 
+0000e080: 2020 2020 2020 2020 2020 2020 2020 6c65                le
+0000e090: 6e67 7468 3d31 202f 2034 2c0d 0a20 2020  ngth=1 / 4,..   
+0000e0a0: 2020 2020 2020 2020 2020 2020 7374 6172              star
+0000e0b0: 743d 302c 0d0a 2020 2020 2020 2020 2020  t=0,..          
+0000e0c0: 2020 2020 2073 746f 703d 4e6f 6e65 2c0d       stop=None,.
+0000e0d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e0e0: 6d65 7468 6f64 3d74 7261 6e73 6c61 7465  method=translate
+0000e0f0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000e100: 2020 6d6f 6465 3d30 293a 0d0a 2020 2020    mode=0):..    
+0000e110: 6966 2069 7369 6e73 7461 6e63 6528 6375  if isinstance(cu
+0000e120: 7272 656e 745f 6368 6f72 642c 2073 7472  rrent_chord, str
+0000e130: 293a 0d0a 2020 2020 2020 2020 6375 7272  ):..        curr
+0000e140: 656e 745f 6368 6f72 6420 3d20 6d65 7468  ent_chord = meth
+0000e150: 6f64 2863 7572 7265 6e74 5f63 686f 7264  od(current_chord
+0000e160: 290d 0a20 2020 2065 6c69 6620 6973 696e  )..    elif isin
+0000e170: 7374 616e 6365 2863 7572 7265 6e74 5f63  stance(current_c
+0000e180: 686f 7264 2c20 6c69 7374 293a 0d0a 2020  hord, list):..  
+0000e190: 2020 2020 2020 6375 7272 656e 745f 6368        current_ch
+0000e1a0: 6f72 6420 3d20 6368 6f72 6428 6375 7272  ord = chord(curr
+0000e1b0: 656e 745f 6368 6f72 6429 0d0a 2020 2020  ent_chord)..    
+0000e1c0: 6966 2073 746f 7020 6973 204e 6f6e 653a  if stop is None:
+0000e1d0: 0d0a 2020 2020 2020 2020 7374 6f70 203d  ..        stop =
+0000e1e0: 206c 656e 2863 7572 7265 6e74 5f63 686f   len(current_cho
+0000e1f0: 7264 290d 0a20 2020 2074 656d 7020 3d20  rd)..    temp = 
+0000e200: 636f 7079 2863 7572 7265 6e74 5f63 686f  copy(current_cho
+0000e210: 7264 290d 0a20 2020 2070 6172 7420 3d20  rd)..    part = 
+0000e220: 7465 6d70 2e6e 6f74 6573 5b73 7461 7274  temp.notes[start
+0000e230: 3a73 746f 705d 0d0a 2020 2020 696e 7465  :stop]..    inte
+0000e240: 7276 616c 7320 3d20 7465 6d70 2e69 6e74  rvals = temp.int
+0000e250: 6572 7661 6c5b 7374 6172 743a 7374 6f70  erval[start:stop
+0000e260: 5d0d 0a20 2020 2064 7572 6174 696f 6e73  ]..    durations
+0000e270: 203d 205b 692e 6475 7261 7469 6f6e 2066   = [i.duration f
+0000e280: 6f72 2069 2069 6e20 7061 7274 5d0d 0a20  or i in part].. 
+0000e290: 2020 2077 686f 6c65 5f64 7572 6174 696f     whole_duratio
+0000e2a0: 6e20 3d20 7375 6d28 6475 7261 7469 6f6e  n = sum(duration
+0000e2b0: 7329 0d0a 2020 2020 7768 6f6c 655f 696e  s)..    whole_in
+0000e2c0: 7465 7276 616c 203d 2073 756d 2869 6e74  terval = sum(int
+0000e2d0: 6572 7661 6c73 290d 0a20 2020 2064 7572  ervals)..    dur
+0000e2e0: 6174 696f 6e73 203d 205b 6c65 6e67 7468  ations = [length
+0000e2f0: 202a 2028 6920 2f20 7768 6f6c 655f 6475   * (i / whole_du
+0000e300: 7261 7469 6f6e 2920 666f 7220 6920 696e  ration) for i in
+0000e310: 2064 7572 6174 696f 6e73 5d0d 0a20 2020   durations]..   
+0000e320: 2069 6620 7768 6f6c 655f 696e 7465 7276   if whole_interv
+0000e330: 616c 2021 3d20 303a 0d0a 2020 2020 2020  al != 0:..      
+0000e340: 2020 696e 7465 7276 616c 7320 3d20 5b6c    intervals = [l
+0000e350: 656e 6774 6820 2a20 2869 202f 2077 686f  ength * (i / who
+0000e360: 6c65 5f69 6e74 6572 7661 6c29 2066 6f72  le_interval) for
+0000e370: 2069 2069 6e20 696e 7465 7276 616c 735d   i in intervals]
+0000e380: 0d0a 2020 2020 656c 7365 3a0d 0a20 2020  ..    else:..   
+0000e390: 2020 2020 2069 6e74 6572 7661 6c73 203d       intervals =
+0000e3a0: 205b 3020 666f 7220 6920 696e 2069 6e74   [0 for i in int
+0000e3b0: 6572 7661 6c73 5d0d 0a20 2020 2069 6620  ervals]..    if 
+0000e3c0: 6d6f 6465 203d 3d20 313a 0d0a 2020 2020  mode == 1:..    
+0000e3d0: 2020 2020 696e 7465 7276 616c 7320 3d20      intervals = 
+0000e3e0: 6475 7261 7469 6f6e 730d 0a20 2020 206e  durations..    n
+0000e3f0: 6577 5f64 7572 6174 696f 6e20 3d20 7465  ew_duration = te
+0000e400: 6d70 2e67 6574 5f64 7572 6174 696f 6e28  mp.get_duration(
+0000e410: 290d 0a20 2020 206e 6577 5f64 7572 6174  )..    new_durat
+0000e420: 696f 6e5b 7374 6172 743a 7374 6f70 5d20  ion[start:stop] 
+0000e430: 3d20 6475 7261 7469 6f6e 730d 0a20 2020  = durations..   
+0000e440: 206e 6577 5f69 6e74 6572 7661 6c20 3d20   new_interval = 
+0000e450: 7465 6d70 2e69 6e74 6572 7661 6c0d 0a20  temp.interval.. 
+0000e460: 2020 206e 6577 5f69 6e74 6572 7661 6c5b     new_interval[
+0000e470: 7374 6172 743a 7374 6f70 5d20 3d20 696e  start:stop] = in
+0000e480: 7465 7276 616c 730d 0a20 2020 2074 656d  tervals..    tem
+0000e490: 7020 253d 2028 6e65 775f 6475 7261 7469  p %= (new_durati
+0000e4a0: 6f6e 2c20 6e65 775f 696e 7465 7276 616c  on, new_interval
+0000e4b0: 290d 0a20 2020 2072 6574 7572 6e20 7465  )..    return te
+0000e4c0: 6d70 0d0a 0d0a 0d0a 6465 6620 6765 745f  mp......def get_
+0000e4d0: 6368 6f72 6473 5f66 726f 6d5f 7268 7974  chords_from_rhyt
+0000e4e0: 686d 2863 686f 7264 732c 2063 7572 7265  hm(chords, curre
+0000e4f0: 6e74 5f72 6879 7468 6d2c 2073 6574 5f64  nt_rhythm, set_d
+0000e500: 7572 6174 696f 6e3d 5472 7565 293a 0d0a  uration=True):..
+0000e510: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0000e520: 6528 6368 6f72 6473 2c20 6e6f 7465 293a  e(chords, note):
+0000e530: 0d0a 2020 2020 2020 2020 6368 6f72 6473  ..        chords
+0000e540: 203d 2063 686f 7264 280d 0a20 2020 2020   = chord(..     
+0000e550: 2020 2020 2020 205b 636f 7079 2863 686f         [copy(cho
+0000e560: 7264 7329 2066 6f72 2069 2069 6e20 7261  rds) for i in ra
+0000e570: 6e67 6528 6375 7272 656e 745f 7268 7974  nge(current_rhyt
+0000e580: 686d 2e67 6574 5f62 6561 745f 6e75 6d28  hm.get_beat_num(
+0000e590: 2929 5d29 0d0a 2020 2020 2020 2020 7265  ))])..        re
+0000e5a0: 7475 726e 2063 686f 7264 732e 6170 706c  turn chords.appl
+0000e5b0: 795f 7268 7974 686d 2863 7572 7265 6e74  y_rhythm(current
+0000e5c0: 5f72 6879 7468 6d2c 2073 6574 5f64 7572  _rhythm, set_dur
+0000e5d0: 6174 696f 6e3d 7365 745f 6475 7261 7469  ation=set_durati
+0000e5e0: 6f6e 290d 0a20 2020 2069 6620 6973 696e  on)..    if isin
+0000e5f0: 7374 616e 6365 2863 686f 7264 732c 2063  stance(chords, c
+0000e600: 686f 7264 293a 0d0a 2020 2020 2020 2020  hord):..        
+0000e610: 6368 6f72 6473 203d 205b 636f 7079 2863  chords = [copy(c
+0000e620: 686f 7264 7329 2066 6f72 2069 2069 6e20  hords) for i in 
+0000e630: 7261 6e67 6528 6375 7272 656e 745f 7268  range(current_rh
+0000e640: 7974 686d 2e67 6574 5f62 6561 745f 6e75  ythm.get_beat_nu
+0000e650: 6d28 2929 5d0d 0a20 2020 2065 6c73 653a  m())]..    else:
+0000e660: 0d0a 2020 2020 2020 2020 6368 6f72 6473  ..        chords
+0000e670: 203d 2063 6f70 7928 6368 6f72 6473 290d   = copy(chords).
+0000e680: 0a20 2020 206c 656e 6774 6820 3d20 6c65  .    length = le
+0000e690: 6e28 6368 6f72 6473 290d 0a20 2020 2063  n(chords)..    c
+0000e6a0: 6f75 6e74 6572 203d 202d 310d 0a20 2020  ounter = -1..   
+0000e6b0: 2068 6173 5f62 6561 7420 3d20 4661 6c73   has_beat = Fals
+0000e6c0: 650d 0a20 2020 2063 7572 7265 6e74 5f73  e..    current_s
+0000e6d0: 7461 7274 5f74 696d 6520 3d20 300d 0a20  tart_time = 0.. 
+0000e6e0: 2020 2063 686f 7264 5f69 6e74 6572 7661     chord_interva
+0000e6f0: 6c73 203d 205b 3020 666f 7220 6920 696e  ls = [0 for i in
+0000e700: 2072 616e 6765 286c 656e 2863 686f 7264   range(len(chord
+0000e710: 7329 295d 0d0a 2020 2020 666f 7220 692c  s))]..    for i,
+0000e720: 2065 6163 6820 696e 2065 6e75 6d65 7261   each in enumera
+0000e730: 7465 2863 7572 7265 6e74 5f72 6879 7468  te(current_rhyth
+0000e740: 6d29 3a0d 0a20 2020 2020 2020 2063 7572  m):..        cur
+0000e750: 7265 6e74 5f64 7572 6174 696f 6e20 3d20  rent_duration = 
+0000e760: 6561 6368 2e67 6574 5f64 7572 6174 696f  each.get_duratio
+0000e770: 6e28 290d 0a20 2020 2020 2020 2069 6620  n()..        if 
+0000e780: 7479 7065 2865 6163 6829 2069 7320 6265  type(each) is be
+0000e790: 6174 3a0d 0a20 2020 2020 2020 2020 2020  at:..           
+0000e7a0: 2063 6f75 6e74 6572 202b 3d20 310d 0a20   counter += 1.. 
+0000e7b0: 2020 2020 2020 2020 2020 2069 6620 636f             if co
+0000e7c0: 756e 7465 7220 3e3d 206c 656e 6774 683a  unter >= length:
+0000e7d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000e7e0: 2020 6272 6561 6b0d 0a20 2020 2020 2020    break..       
+0000e7f0: 2020 2020 2063 7572 7265 6e74 5f63 686f       current_cho
+0000e800: 7264 203d 2063 686f 7264 735b 636f 756e  rd = chords[coun
+0000e810: 7465 725d 0d0a 2020 2020 2020 2020 2020  ter]..          
+0000e820: 2020 6966 2073 6574 5f64 7572 6174 696f    if set_duratio
+0000e830: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
+0000e840: 2020 2020 6966 2063 7572 7265 6e74 5f64      if current_d
+0000e850: 7572 6174 696f 6e20 213d 2030 3a0d 0a20  uration != 0:.. 
+0000e860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e870: 2020 2066 6f72 206b 2069 6e20 6375 7272     for k in curr
+0000e880: 656e 745f 6368 6f72 643a 0d0a 2020 2020  ent_chord:..    
+0000e890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e8a0: 2020 2020 6b2e 6475 7261 7469 6f6e 203d      k.duration =
+0000e8b0: 2063 7572 7265 6e74 5f64 7572 6174 696f   current_duratio
+0000e8c0: 6e0d 0a20 2020 2020 2020 2020 2020 2063  n..            c
+0000e8d0: 686f 7264 5f69 6e74 6572 7661 6c73 5b63  hord_intervals[c
+0000e8e0: 6f75 6e74 6572 5d20 2b3d 2063 7572 7265  ounter] += curre
+0000e8f0: 6e74 5f64 7572 6174 696f 6e0d 0a20 2020  nt_duration..   
+0000e900: 2020 2020 2020 2020 2068 6173 5f62 6561           has_bea
+0000e910: 7420 3d20 5472 7565 0d0a 2020 2020 2020  t = True..      
+0000e920: 2020 656c 6966 2074 7970 6528 6561 6368    elif type(each
+0000e930: 2920 6973 2072 6573 745f 7379 6d62 6f6c  ) is rest_symbol
+0000e940: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+0000e950: 6620 6e6f 7420 6861 735f 6265 6174 3a0d  f not has_beat:.
+0000e960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e970: 2063 7572 7265 6e74 5f73 7461 7274 5f74   current_start_t
+0000e980: 696d 6520 2b3d 2063 7572 7265 6e74 5f64  ime += current_d
+0000e990: 7572 6174 696f 6e0d 0a20 2020 2020 2020  uration..       
+0000e9a0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+0000e9b0: 2020 2020 2020 2020 2020 2020 6368 6f72              chor
+0000e9c0: 645f 696e 7465 7276 616c 735b 636f 756e  d_intervals[coun
+0000e9d0: 7465 725d 202b 3d20 6375 7272 656e 745f  ter] += current_
+0000e9e0: 6475 7261 7469 6f6e 0d0a 2020 2020 2020  duration..      
+0000e9f0: 2020 656c 6966 2074 7970 6528 6561 6368    elif type(each
+0000ea00: 2920 6973 2063 6f6e 7469 6e75 655f 7379  ) is continue_sy
+0000ea10: 6d62 6f6c 3a0d 0a20 2020 2020 2020 2020  mbol:..         
+0000ea20: 2020 2069 6620 6e6f 7420 6861 735f 6265     if not has_be
+0000ea30: 6174 3a0d 0a20 2020 2020 2020 2020 2020  at:..           
+0000ea40: 2020 2020 2063 7572 7265 6e74 5f73 7461       current_sta
+0000ea50: 7274 5f74 696d 6520 2b3d 2063 7572 7265  rt_time += curre
+0000ea60: 6e74 5f64 7572 6174 696f 6e0d 0a20 2020  nt_duration..   
+0000ea70: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+0000ea80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ea90: 6375 7272 656e 745f 6368 6f72 6420 3d20  current_chord = 
+0000eaa0: 6368 6f72 6473 5b63 6f75 6e74 6572 5d0d  chords[counter].
+0000eab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000eac0: 2066 6f72 206b 2069 6e20 6375 7272 656e   for k in curren
+0000ead0: 745f 6368 6f72 643a 0d0a 2020 2020 2020  t_chord:..      
+0000eae0: 2020 2020 2020 2020 2020 2020 2020 6b2e                k.
+0000eaf0: 6475 7261 7469 6f6e 202b 3d20 6375 7272  duration += curr
+0000eb00: 656e 745f 6475 7261 7469 6f6e 0d0a 2020  ent_duration..  
+0000eb10: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+0000eb20: 6f72 645f 696e 7465 7276 616c 735b 636f  ord_intervals[co
+0000eb30: 756e 7465 725d 202b 3d20 6375 7272 656e  unter] += curren
+0000eb40: 745f 6475 7261 7469 6f6e 0d0a 2020 2020  t_duration..    
+0000eb50: 7265 7375 6c74 203d 2063 686f 7264 735b  result = chords[
+0000eb60: 305d 0d0a 2020 2020 6375 7272 656e 745f  0]..    current_
+0000eb70: 696e 7465 7276 616c 203d 2030 0d0a 2020  interval = 0..  
+0000eb80: 2020 666f 7220 692c 2065 6163 6820 696e    for i, each in
+0000eb90: 2065 6e75 6d65 7261 7465 2863 686f 7264   enumerate(chord
+0000eba0: 735b 313a 5d29 3a0d 0a20 2020 2020 2020  s[1:]):..       
+0000ebb0: 2063 7572 7265 6e74 5f69 6e74 6572 7661   current_interva
+0000ebc0: 6c20 2b3d 2063 686f 7264 5f69 6e74 6572  l += chord_inter
+0000ebd0: 7661 6c73 5b69 5d0d 0a20 2020 2020 2020  vals[i]..       
+0000ebe0: 2072 6573 756c 7420 3d20 7265 7375 6c74   result = result
+0000ebf0: 2026 2028 6561 6368 2c20 6375 7272 656e   & (each, curren
+0000ec00: 745f 696e 7465 7276 616c 290d 0a20 2020  t_interval)..   
+0000ec10: 2065 7874 7261 5f69 6e74 6572 7661 6c20   extra_interval 
+0000ec20: 3d20 6368 6f72 645f 696e 7465 7276 616c  = chord_interval
+0000ec30: 735b 6c65 6e28 6368 6f72 6473 2920 2d20  s[len(chords) - 
+0000ec40: 315d 0d0a 2020 2020 7265 7375 6c74 2e69  1]..    result.i
+0000ec50: 6e74 6572 7661 6c5b 2d31 5d20 3d20 6578  nterval[-1] = ex
+0000ec60: 7472 615f 696e 7465 7276 616c 0d0a 2020  tra_interval..  
+0000ec70: 2020 7265 7375 6c74 2e73 7461 7274 5f74    result.start_t
+0000ec80: 696d 6520 3d20 6375 7272 656e 745f 7374  ime = current_st
+0000ec90: 6172 745f 7469 6d65 0d0a 2020 2020 7265  art_time..    re
+0000eca0: 7475 726e 2072 6573 756c 740d 0a0d 0a0d  turn result.....
+0000ecb0: 0a40 6d65 7468 6f64 5f77 7261 7070 6572  .@method_wrapper
+0000ecc0: 2863 686f 7264 290d 0a64 6566 2061 6e61  (chord)..def ana
+0000ecd0: 6c79 7a65 5f72 6879 7468 6d28 6375 7272  lyze_rhythm(curr
+0000ece0: 656e 745f 6368 6f72 642c 0d0a 2020 2020  ent_chord,..    
+0000ecf0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000ed00: 6e63 6c75 6465 5f63 6f6e 7469 6e75 653d  nclude_continue=
+0000ed10: 5472 7565 2c0d 0a20 2020 2020 2020 2020  True,..         
+0000ed20: 2020 2020 2020 2020 2020 746f 7461 6c5f            total_
+0000ed30: 6c65 6e67 7468 3d4e 6f6e 652c 0d0a 2020  length=None,..  
+0000ed40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ed50: 2072 656d 6f76 655f 656d 7074 795f 6265   remove_empty_be
+0000ed60: 6174 733d 4661 6c73 652c 0d0a 2020 2020  ats=False,..    
+0000ed70: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+0000ed80: 6e69 743d 4e6f 6e65 2c0d 0a20 2020 2020  nit=None,..     
+0000ed90: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0000eda0: 6e64 5f75 6e69 745f 6967 6e6f 7265 5f64  nd_unit_ignore_d
+0000edb0: 7572 6174 696f 6e3d 4661 6c73 652c 0d0a  uration=False,..
+0000edc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000edd0: 2020 206d 6572 6765 5f63 6f6e 7469 6e75     merge_continu
+0000ede0: 653d 5472 7565 293a 0d0a 2020 2020 6966  e=True):..    if
+0000edf0: 2061 6c6c 2869 203c 3d20 3020 666f 7220   all(i <= 0 for 
+0000ee00: 6920 696e 2063 7572 7265 6e74 5f63 686f  i in current_cho
+0000ee10: 7264 2e69 6e74 6572 7661 6c29 3a0d 0a20  rd.interval):.. 
+0000ee20: 2020 2020 2020 2072 6574 7572 6e20 7268         return rh
+0000ee30: 7974 686d 285b 6265 6174 2830 2920 666f  ythm([beat(0) fo
+0000ee40: 7220 6920 696e 2072 616e 6765 286c 656e  r i in range(len
+0000ee50: 2863 7572 7265 6e74 5f63 686f 7264 2929  (current_chord))
+0000ee60: 5d29 0d0a 2020 2020 6966 2075 6e69 7420  ])..    if unit 
+0000ee70: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
+0000ee80: 2020 6375 7272 656e 745f 696e 7465 7276    current_interv
+0000ee90: 616c 203d 2063 6f70 7928 6375 7272 656e  al = copy(curren
+0000eea0: 745f 6368 6f72 642e 696e 7465 7276 616c  t_chord.interval
+0000eeb0: 290d 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
+0000eec0: 7420 6669 6e64 5f75 6e69 745f 6967 6e6f  t find_unit_igno
+0000eed0: 7265 5f64 7572 6174 696f 6e3a 0d0a 2020  re_duration:..  
+0000eee0: 2020 2020 2020 2020 2020 6375 7272 656e            curren
+0000eef0: 745f 696e 7465 7276 616c 202b 3d20 5b0d  t_interval += [.
+0000ef00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ef10: 2063 7572 7265 6e74 5f63 686f 7264 2e69   current_chord.i
+0000ef20: 6e74 6572 7661 6c5b 695d 202d 2063 7572  nterval[i] - cur
+0000ef30: 7265 6e74 5f63 686f 7264 5b69 5d2e 6475  rent_chord[i].du
+0000ef40: 7261 7469 6f6e 0d0a 2020 2020 2020 2020  ration..        
+0000ef50: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
+0000ef60: 2072 616e 6765 286c 656e 2863 7572 7265   range(len(curre
+0000ef70: 6e74 5f63 686f 7264 2929 0d0a 2020 2020  nt_chord))..    
+0000ef80: 2020 2020 2020 2020 5d0d 0a20 2020 2020          ]..     
+0000ef90: 2020 2063 7572 7265 6e74 5f69 6e74 6572     current_inter
+0000efa0: 7661 6c20 3d20 5b69 2066 6f72 2069 2069  val = [i for i i
+0000efb0: 6e20 6375 7272 656e 745f 696e 7465 7276  n current_interv
+0000efc0: 616c 2069 6620 6920 3e20 305d 0d0a 2020  al if i > 0]..  
+0000efd0: 2020 2020 2020 756e 6974 203d 206d 696e        unit = min
+0000efe0: 2863 7572 7265 6e74 5f69 6e74 6572 7661  (current_interva
+0000eff0: 6c29 0d0a 2020 2020 6265 6174 5f6c 6973  l)..    beat_lis
+0000f000: 7420 3d20 5b5d 0d0a 2020 2020 6966 2063  t = []..    if c
+0000f010: 7572 7265 6e74 5f63 686f 7264 2e73 7461  urrent_chord.sta
+0000f020: 7274 5f74 696d 6520 3e20 303a 0d0a 2020  rt_time > 0:..  
+0000f030: 2020 2020 2020 6265 6174 5f6c 6973 742e        beat_list.
+0000f040: 6578 7465 6e64 285b 0d0a 2020 2020 2020  extend([..      
+0000f050: 2020 2020 2020 7265 7374 5f73 796d 626f        rest_symbo
+0000f060: 6c28 756e 6974 290d 0a20 2020 2020 2020  l(unit)..       
+0000f070: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
+0000f080: 6e67 6528 696e 7428 6375 7272 656e 745f  nge(int(current_
+0000f090: 6368 6f72 642e 7374 6172 745f 7469 6d65  chord.start_time
+0000f0a0: 202f 2f20 756e 6974 2929 0d0a 2020 2020   // unit))..    
+0000f0b0: 2020 2020 5d29 0d0a 2020 2020 666f 7220      ])..    for 
+0000f0c0: 692c 2065 6163 6820 696e 2065 6e75 6d65  i, each in enume
+0000f0d0: 7261 7465 2863 7572 7265 6e74 5f63 686f  rate(current_cho
+0000f0e0: 7264 2e69 6e74 6572 7661 6c29 3a0d 0a20  rd.interval):.. 
+0000f0f0: 2020 2020 2020 2069 6620 6561 6368 203d         if each =
+0000f100: 3d20 303a 0d0a 2020 2020 2020 2020 2020  = 0:..          
+0000f110: 2020 6265 6174 5f6c 6973 742e 6170 7065    beat_list.appe
+0000f120: 6e64 2862 6561 7428 3029 290d 0a20 2020  nd(beat(0))..   
+0000f130: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+0000f140: 2020 2020 2020 2020 6375 7272 656e 745f          current_
+0000f150: 6265 6174 203d 2062 6561 7428 756e 6974  beat = beat(unit
+0000f160: 290d 0a20 2020 2020 2020 2020 2020 2072  )..            r
+0000f170: 656d 6169 6e5f 696e 7465 7276 616c 203d  emain_interval =
+0000f180: 2065 6163 6820 2d20 756e 6974 0d0a 2020   each - unit..  
+0000f190: 2020 2020 2020 2020 2020 7265 7374 5f6e            rest_n
+0000f1a0: 756d 2c20 6578 7472 615f 6265 6174 203d  um, extra_beat =
+0000f1b0: 2064 6976 6d6f 6428 7265 6d61 696e 5f69   divmod(remain_i
+0000f1c0: 6e74 6572 7661 6c2c 2075 6e69 7429 0d0a  nterval, unit)..
+0000f1d0: 2020 2020 2020 2020 2020 2020 6966 2065              if e
+0000f1e0: 7874 7261 5f62 6561 7420 3e20 303a 0d0a  xtra_beat > 0:..
+0000f1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f200: 6375 7272 656e 745f 646f 7474 6564 5f6e  current_dotted_n
+0000f210: 756d 203d 2069 6e74 280d 0a20 2020 2020  um = int(..     
+0000f220: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0000f230: 6174 682e 6c6f 6728 3120 2f20 2831 202d  ath.log(1 / (1 -
+0000f240: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000f250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f260: 2020 2020 2828 2865 7874 7261 5f62 6561      (((extra_bea
+0000f270: 7420 2b20 756e 6974 2920 2f20 756e 6974  t + unit) / unit
+0000f280: 2920 2f20 3229 292c 2032 2929 202d 2031  ) / 2)), 2)) - 1
+0000f290: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000f2a0: 2020 6375 7272 656e 745f 6265 6174 2e64    current_beat.d
+0000f2b0: 6f74 7465 6420 3d20 6375 7272 656e 745f  otted = current_
+0000f2c0: 646f 7474 6564 5f6e 756d 0d0a 2020 2020  dotted_num..    
+0000f2d0: 2020 2020 2020 2020 6265 6174 5f6c 6973          beat_lis
+0000f2e0: 742e 6170 7065 6e64 2863 7572 7265 6e74  t.append(current
+0000f2f0: 5f62 6561 7429 0d0a 2020 2020 2020 2020  _beat)..        
+0000f300: 2020 2020 6966 206e 6f74 2069 6e63 6c75      if not inclu
+0000f310: 6465 5f63 6f6e 7469 6e75 653a 0d0a 2020  de_continue:..  
+0000f320: 2020 2020 2020 2020 2020 2020 2020 6265                be
+0000f330: 6174 5f6c 6973 742e 6578 7465 6e64 280d  at_list.extend(.
+0000f340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f350: 2020 2020 205b 7265 7374 5f73 796d 626f       [rest_symbo
+0000f360: 6c28 756e 6974 2920 666f 7220 6b20 696e  l(unit) for k in
+0000f370: 2072 616e 6765 2869 6e74 2872 6573 745f   range(int(rest_
+0000f380: 6e75 6d29 295d 290d 0a20 2020 2020 2020  num))])..       
+0000f390: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+0000f3a0: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+0000f3b0: 656e 745f 6475 7261 7469 6f6e 203d 2063  ent_duration = c
+0000f3c0: 7572 7265 6e74 5f63 686f 7264 2e6e 6f74  urrent_chord.not
+0000f3d0: 6573 5b69 5d2e 6475 7261 7469 6f6e 0d0a  es[i].duration..
 0000f3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f3f0: 2020 2063 6f6e 7469 6e75 655f 6e75 6d20     continue_num 
-0000f400: 3d20 6375 7272 656e 745f 636f 6e74 696e  = current_contin
-0000f410: 7565 5f64 7572 6174 696f 6e20 2f2f 2075  ue_duration // u
-0000f420: 6e69 740d 0a20 2020 2020 2020 2020 2020  nit..           
-0000f430: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-0000f440: 6d65 7267 655f 636f 6e74 696e 7565 3a0d  merge_continue:.
-0000f450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f460: 2020 2020 2020 2020 2062 6561 745f 6c69           beat_li
-0000f470: 7374 2e65 7874 656e 6428 5b0d 0a20 2020  st.extend([..   
-0000f480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f490: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-0000f4a0: 655f 7379 6d62 6f6c 2875 6e69 7429 0d0a  e_symbol(unit)..
-0000f4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f4c0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0000f4d0: 6b20 696e 2072 616e 6765 2869 6e74 2863  k in range(int(c
-0000f4e0: 6f6e 7469 6e75 655f 6e75 6d29 290d 0a20  ontinue_num)).. 
+0000f3f0: 6966 2063 7572 7265 6e74 5f64 7572 6174  if current_durat
+0000f400: 696f 6e20 3e3d 2065 6163 683a 0d0a 2020  ion >= each:..  
+0000f410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f420: 2020 6966 206e 6f74 206d 6572 6765 5f63    if not merge_c
+0000f430: 6f6e 7469 6e75 653a 0d0a 2020 2020 2020  ontinue:..      
+0000f440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f450: 2020 6265 6174 5f6c 6973 742e 6578 7465    beat_list.exte
+0000f460: 6e64 285b 0d0a 2020 2020 2020 2020 2020  nd([..          
+0000f470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f480: 2020 636f 6e74 696e 7565 5f73 796d 626f    continue_symbo
+0000f490: 6c28 756e 6974 2920 666f 7220 6b20 696e  l(unit) for k in
+0000f4a0: 2072 616e 6765 2869 6e74 2872 6573 745f   range(int(rest_
+0000f4b0: 6e75 6d29 290d 0a20 2020 2020 2020 2020  num))..         
+0000f4c0: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
+0000f4d0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000f4e0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
 0000f4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f500: 2020 2020 2020 205d 290d 0a20 2020 2020         ])..     
-0000f510: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000f520: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-0000f530: 2020 2020 2020 2020 2020 2020 2020 6265                be
-0000f540: 6174 5f6c 6973 745b 2d31 5d2e 6475 7261  at_list[-1].dura
-0000f550: 7469 6f6e 202b 3d20 756e 6974 202a 2069  tion += unit * i
-0000f560: 6e74 2863 6f6e 7469 6e75 655f 6e75 6d29  nt(continue_num)
-0000f570: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000f580: 2020 2020 2020 6265 6174 5f6c 6973 742e        beat_list.
-0000f590: 6578 7465 6e64 280d 0a20 2020 2020 2020  extend(..       
-0000f5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f5b0: 205b 7265 7374 5f73 796d 626f 6c28 756e   [rest_symbol(un
-0000f5c0: 6974 2920 666f 7220 6b20 696e 2072 616e  it) for k in ran
-0000f5d0: 6765 2869 6e74 2872 6573 745f 6e75 6d29  ge(int(rest_num)
-0000f5e0: 295d 290d 0a20 2020 2072 6573 756c 7420  )])..    result 
-0000f5f0: 3d20 7268 7974 686d 2862 6561 745f 6c69  = rhythm(beat_li
-0000f600: 7374 290d 0a20 2020 2069 6620 746f 7461  st)..    if tota
-0000f610: 6c5f 6c65 6e67 7468 2069 7320 6e6f 7420  l_length is not 
-0000f620: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2063  None:..        c
-0000f630: 7572 7265 6e74 5f74 696d 655f 7369 676e  urrent_time_sign
-0000f640: 6174 7572 6520 3d20 4672 6163 7469 6f6e  ature = Fraction
-0000f650: 2872 6573 756c 742e 6765 745f 746f 7461  (result.get_tota
-0000f660: 6c5f 6475 7261 7469 6f6e 2829 202f 0d0a  l_duration() /..
-0000f670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f690: 2020 2020 2020 2020 2020 746f 7461 6c5f            total_
-0000f6a0: 6c65 6e67 7468 292e 6c69 6d69 745f 6465  length).limit_de
-0000f6b0: 6e6f 6d69 6e61 746f 7228 290d 0a20 2020  nominator()..   
-0000f6c0: 2020 2020 2069 6620 6375 7272 656e 745f       if current_
-0000f6d0: 7469 6d65 5f73 6967 6e61 7475 7265 203d  time_signature =
-0000f6e0: 3d20 313a 0d0a 2020 2020 2020 2020 2020  = 1:..          
-0000f6f0: 2020 6375 7272 656e 745f 7469 6d65 5f73    current_time_s
-0000f700: 6967 6e61 7475 7265 203d 205b 342c 2034  ignature = [4, 4
-0000f710: 5d0d 0a20 2020 2020 2020 2065 6c73 653a  ]..        else:
-0000f720: 0d0a 2020 2020 2020 2020 2020 2020 6375  ..            cu
-0000f730: 7272 656e 745f 7469 6d65 5f73 6967 6e61  rrent_time_signa
-0000f740: 7475 7265 203d 205b 0d0a 2020 2020 2020  ture = [..      
-0000f750: 2020 2020 2020 2020 2020 6375 7272 656e            curren
-0000f760: 745f 7469 6d65 5f73 6967 6e61 7475 7265  t_time_signature
-0000f770: 2e6e 756d 6572 6174 6f72 2c0d 0a20 2020  .numerator,..   
-0000f780: 2020 2020 2020 2020 2020 2020 2063 7572               cur
-0000f790: 7265 6e74 5f74 696d 655f 7369 676e 6174  rent_time_signat
-0000f7a0: 7572 652e 6465 6e6f 6d69 6e61 746f 720d  ure.denominator.
-0000f7b0: 0a20 2020 2020 2020 2020 2020 205d 0d0a  .            ]..
-0000f7c0: 2020 2020 2020 2020 7265 7375 6c74 2e74          result.t
-0000f7d0: 696d 655f 7369 676e 6174 7572 6520 3d20  ime_signature = 
-0000f7e0: 6375 7272 656e 745f 7469 6d65 5f73 6967  current_time_sig
-0000f7f0: 6e61 7475 7265 0d0a 2020 2020 6966 2072  nature..    if r
-0000f800: 656d 6f76 655f 656d 7074 795f 6265 6174  emove_empty_beat
-0000f810: 733a 0d0a 2020 2020 2020 2020 7265 7375  s:..        resu
-0000f820: 6c74 203d 2072 6879 7468 6d28 5b69 2066  lt = rhythm([i f
-0000f830: 6f72 2069 2069 6e20 7265 7375 6c74 2069  or i in result i
-0000f840: 6620 692e 6475 7261 7469 6f6e 2021 3d20  f i.duration != 
-0000f850: 305d 2c0d 0a20 2020 2020 2020 2020 2020  0],..           
-0000f860: 2020 2020 2020 2020 2020 2020 2074 696d               tim
-0000f870: 655f 7369 676e 6174 7572 653d 7265 7375  e_signature=resu
-0000f880: 6c74 2e74 696d 655f 7369 676e 6174 7572  lt.time_signatur
-0000f890: 6529 0d0a 2020 2020 7265 7475 726e 2072  e)..    return r
-0000f8a0: 6573 756c 740d 0a0d 0a0d 0a64 6566 2073  esult......def s
-0000f8b0: 746f 7061 6c6c 2829 3a0d 0a20 2020 2070  topall():..    p
-0000f8c0: 7967 616d 652e 6d69 7865 722e 7374 6f70  ygame.mixer.stop
-0000f8d0: 2829 0d0a 2020 2020 7079 6761 6d65 2e6d  ()..    pygame.m
-0000f8e0: 6978 6572 2e6d 7573 6963 2e73 746f 7028  ixer.music.stop(
-0000f8f0: 290d 0a0d 0a0d 0a64 6566 2072 6966 665f  )......def riff_
-0000f900: 746f 5f6d 6964 6928 7269 6666 5f6e 616d  to_midi(riff_nam
-0000f910: 652c 206e 616d 653d 2774 656d 702e 6d69  e, name='temp.mi
-0000f920: 6427 2c20 6f75 7470 7574 5f66 696c 653d  d', output_file=
-0000f930: 4661 6c73 6529 3a0d 0a20 2020 2069 6620  False):..    if 
-0000f940: 6973 696e 7374 616e 6365 2872 6966 665f  isinstance(riff_
-0000f950: 6e61 6d65 2c20 7374 7229 3a0d 0a20 2020  name, str):..   
-0000f960: 2020 2020 2063 7572 7265 6e74 5f66 696c       current_fil
-0000f970: 6520 3d20 6f70 656e 2872 6966 665f 6e61  e = open(riff_na
-0000f980: 6d65 2c20 2772 6227 290d 0a20 2020 2020  me, 'rb')..     
-0000f990: 2020 2072 6f6f 7420 3d20 6368 756e 6b2e     root = chunk.
-0000f9a0: 4368 756e 6b28 6375 7272 656e 745f 6669  Chunk(current_fi
-0000f9b0: 6c65 2c20 6269 6765 6e64 6961 6e3d 4661  le, bigendian=Fa
-0000f9c0: 6c73 6529 0d0a 2020 2020 656c 7365 3a0d  lse)..    else:.
-0000f9d0: 0a20 2020 2020 2020 2072 6f6f 7420 3d20  .        root = 
-0000f9e0: 6368 756e 6b2e 4368 756e 6b28 7269 6666  chunk.Chunk(riff
-0000f9f0: 5f6e 616d 652c 2062 6967 656e 6469 616e  _name, bigendian
-0000fa00: 3d46 616c 7365 290d 0a0d 0a20 2020 2063  =False)....    c
-0000fa10: 6875 6e6b 5f69 6420 3d20 726f 6f74 2e67  hunk_id = root.g
-0000fa20: 6574 6e61 6d65 2829 0d0a 2020 2020 6966  etname()..    if
-0000fa30: 2063 6875 6e6b 5f69 6420 3d3d 2062 274d   chunk_id == b'M
-0000fa40: 5468 6427 3a0d 0a20 2020 2020 2020 2072  Thd':..        r
-0000fa50: 6169 7365 2049 4f45 7272 6f72 2866 2741  aise IOError(f'A
-0000fa60: 6c72 6561 6479 2061 2053 7461 6e64 6172  lready a Standar
-0000fa70: 6420 4d49 4449 2066 6f72 6d61 7420 6669  d MIDI format fi
-0000fa80: 6c65 3a20 7b72 6966 665f 6e61 6d65 7d27  le: {riff_name}'
-0000fa90: 290d 0a20 2020 2065 6c69 6620 6368 756e  )..    elif chun
-0000faa0: 6b5f 6964 2021 3d20 6227 5249 4646 273a  k_id != b'RIFF':
-0000fab0: 0d0a 2020 2020 2020 2020 6368 756e 6b5f  ..        chunk_
-0000fac0: 7369 7a65 203d 2072 6f6f 742e 6765 7473  size = root.gets
-0000fad0: 697a 6528 290d 0a20 2020 2020 2020 2063  ize()..        c
-0000fae0: 6875 6e6b 5f72 6177 203d 2072 6f6f 742e  hunk_raw = root.
-0000faf0: 7265 6164 2863 6875 6e6b 5f73 697a 6529  read(chunk_size)
-0000fb00: 0d0a 2020 2020 2020 2020 6966 2062 274d  ..        if b'M
-0000fb10: 5468 6427 2069 6e20 6368 756e 6b5f 7261  Thd' in chunk_ra
-0000fb20: 773a 0d0a 2020 2020 2020 2020 2020 2020  w:..            
-0000fb30: 6d69 6469 5f72 6177 203d 2063 6875 6e6b  midi_raw = chunk
-0000fb40: 5f72 6177 5b63 6875 6e6b 5f72 6177 2e69  _raw[chunk_raw.i
-0000fb50: 6e64 6578 2862 274d 5468 6427 293a 5d0d  ndex(b'MThd'):].
-0000fb60: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-0000fb70: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000fb80: 6520 5661 6c75 6545 7272 6f72 2827 4361  e ValueError('Ca
-0000fb90: 6e6e 6f74 2066 696e 6420 6865 6164 6572  nnot find header
-0000fba0: 2729 0d0a 2020 2020 656c 7365 3a0d 0a20  ')..    else:.. 
-0000fbb0: 2020 2020 2020 2063 6875 6e6b 5f73 697a         chunk_siz
-0000fbc0: 6520 3d20 726f 6f74 2e67 6574 7369 7a65  e = root.getsize
-0000fbd0: 2829 0d0a 2020 2020 2020 2020 6368 756e  ()..        chun
-0000fbe0: 6b5f 7261 7720 3d20 726f 6f74 2e72 6561  k_raw = root.rea
-0000fbf0: 6428 6368 756e 6b5f 7369 7a65 290d 0a20  d(chunk_size).. 
-0000fc00: 2020 2020 2020 2028 6864 725f 6964 2c20         (hdr_id, 
-0000fc10: 6864 725f 6461 7461 2c20 6d69 6469 5f73  hdr_data, midi_s
-0000fc20: 697a 6529 203d 2073 7472 7563 742e 756e  ize) = struct.un
-0000fc30: 7061 636b 2822 3c34 7334 734c 222c 0d0a  pack("<4s4sL",..
-0000fc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fc70: 2020 2020 2020 6368 756e 6b5f 7261 775b        chunk_raw[
-0000fc80: 303a 3132 5d29 0d0a 0d0a 2020 2020 2020  0:12])....      
-0000fc90: 2020 6966 2068 6472 5f69 6420 213d 2062    if hdr_id != b
-0000fca0: 2752 4d49 4427 206f 7220 6864 725f 6461  'RMID' or hdr_da
-0000fcb0: 7461 2021 3d20 6227 6461 7461 273a 0d0a  ta != b'data':..
-0000fcc0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000fcd0: 6520 494f 4572 726f 7228 6627 496e 7661  e IOError(f'Inva
-0000fce0: 6c69 6420 6f72 2075 6e73 7570 706f 7274  lid or unsupport
-0000fcf0: 6564 2069 6e70 7574 2066 696c 653a 207b  ed input file: {
-0000fd00: 7269 6666 5f6e 616d 657d 2729 0d0a 2020  riff_name}')..  
-0000fd10: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
-0000fd20: 2020 2020 2020 2020 6d69 6469 5f72 6177          midi_raw
-0000fd30: 203d 2063 6875 6e6b 5f72 6177 5b31 323a   = chunk_raw[12:
-0000fd40: 3132 202b 206d 6964 695f 7369 7a65 5d0d  12 + midi_size].
-0000fd50: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-0000fd60: 496e 6465 7845 7272 6f72 3a0d 0a20 2020  IndexError:..   
-0000fd70: 2020 2020 2020 2020 2072 6169 7365 2049           raise I
-0000fd80: 4f45 7272 6f72 2866 2742 726f 6b65 6e20  OError(f'Broken 
-0000fd90: 696e 7075 7420 6669 6c65 3a20 7b72 6966  input file: {rif
-0000fda0: 665f 6e61 6d65 7d27 290d 0a0d 0a20 2020  f_name}')....   
-0000fdb0: 2072 6f6f 742e 636c 6f73 6528 290d 0a20   root.close().. 
-0000fdc0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0000fdd0: 2872 6966 665f 6e61 6d65 2c20 7374 7229  (riff_name, str)
-0000fde0: 3a0d 0a20 2020 2020 2020 2063 7572 7265  :..        curre
-0000fdf0: 6e74 5f66 696c 652e 636c 6f73 6528 290d  nt_file.close().
-0000fe00: 0a0d 0a20 2020 2069 6620 6f75 7470 7574  ...    if output
-0000fe10: 5f66 696c 653a 0d0a 2020 2020 2020 2020  _file:..        
-0000fe20: 7769 7468 206f 7065 6e28 6e61 6d65 2c20  with open(name, 
-0000fe30: 2777 6227 2920 6173 2066 3a0d 0a20 2020  'wb') as f:..   
-0000fe40: 2020 2020 2020 2020 2066 2e77 7269 7465           f.write
-0000fe50: 286d 6964 695f 7261 7729 0d0a 2020 2020  (midi_raw)..    
-0000fe60: 656c 7365 3a0d 0a20 2020 2020 2020 2072  else:..        r
-0000fe70: 6573 756c 7420 3d20 4279 7465 7349 4f28  esult = BytesIO(
-0000fe80: 290d 0a20 2020 2020 2020 2072 6573 756c  )..        resul
-0000fe90: 742e 7772 6974 6528 6d69 6469 5f72 6177  t.write(midi_raw
-0000fea0: 290d 0a20 2020 2020 2020 2072 6573 756c  )..        resul
-0000feb0: 742e 7365 656b 2830 290d 0a20 2020 2020  t.seek(0)..     
-0000fec0: 2020 2072 6574 7572 6e20 7265 7375 6c74     return result
-0000fed0: 0d0a 0d0a 0d0a 6465 6620 7772 6974 655f  ......def write_
-0000fee0: 6461 7461 286f 626a 2c20 6e61 6d65 3d27  data(obj, name='
-0000fef0: 756e 7469 746c 6564 2e6d 7062 2729 3a0d  untitled.mpb'):.
-0000ff00: 0a20 2020 2069 6d70 6f72 7420 7069 636b  .    import pick
-0000ff10: 6c65 0d0a 2020 2020 7769 7468 206f 7065  le..    with ope
-0000ff20: 6e28 6e61 6d65 2c20 2777 6227 2920 6173  n(name, 'wb') as
-0000ff30: 2066 3a0d 0a20 2020 2020 2020 2070 6963   f:..        pic
-0000ff40: 6b6c 652e 6475 6d70 286f 626a 2c20 6629  kle.dump(obj, f)
-0000ff50: 0d0a 0d0a 0d0a 6465 6620 6c6f 6164 5f64  ......def load_d
-0000ff60: 6174 6128 6e61 6d65 293a 0d0a 2020 2020  ata(name):..    
-0000ff70: 696d 706f 7274 2070 6963 6b6c 650d 0a20  import pickle.. 
-0000ff80: 2020 2077 6974 6820 6f70 656e 286e 616d     with open(nam
-0000ff90: 652c 2027 7262 2729 2061 7320 663a 0d0a  e, 'rb') as f:..
-0000ffa0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-0000ffb0: 2070 6963 6b6c 652e 6c6f 6164 2866 290d   pickle.load(f).
-0000ffc0: 0a20 2020 2072 6574 7572 6e20 7265 7375  .    return resu
-0000ffd0: 6c74 0d0a 0d0a 0d0a 6465 6620 646f 7474  lt......def dott
-0000ffe0: 6564 2864 7572 6174 696f 6e2c 206e 756d  ed(duration, num
-0000fff0: 3d31 293a 0d0a 2020 2020 7265 7475 726e  =1):..    return
-00010000: 2064 7572 6174 696f 6e20 2a20 7375 6d28   duration * sum(
-00010010: 5b28 3120 2f20 3229 2a2a 6920 666f 7220  [(1 / 2)**i for 
-00010020: 6920 696e 2072 616e 6765 286e 756d 202b  i in range(num +
-00010030: 2031 295d 290d 0a0d 0a0d 0a64 6566 2070   1)])......def p
-00010040: 6172 7365 5f64 6f74 7465 6428 7465 7874  arse_dotted(text
-00010050: 2c20 6765 745f 6672 6163 7469 6f6e 3d46  , get_fraction=F
-00010060: 616c 7365 293a 0d0a 2020 2020 6c65 6e67  alse):..    leng
-00010070: 7468 203d 206c 656e 2874 6578 7429 0d0a  th = len(text)..
-00010080: 2020 2020 646f 7474 6564 5f6e 756d 203d      dotted_num =
-00010090: 2030 0d0a 2020 2020 696e 6420 3d20 300d   0..    ind = 0.
-000100a0: 0a20 2020 2066 6f72 2069 2069 6e20 7261  .    for i in ra
-000100b0: 6e67 6528 6c65 6e67 7468 202d 2031 2c20  nge(length - 1, 
-000100c0: 2d31 2c20 2d31 293a 0d0a 2020 2020 2020  -1, -1):..      
-000100d0: 2020 6966 2074 6578 745b 695d 2021 3d20    if text[i] != 
-000100e0: 272e 273a 0d0a 2020 2020 2020 2020 2020  '.':..          
-000100f0: 2020 696e 6420 3d20 690d 0a20 2020 2020    ind = i..     
-00010100: 2020 2020 2020 2062 7265 616b 0d0a 2020         break..  
-00010110: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00010120: 2020 2020 2020 2020 2064 6f74 7465 645f           dotted_
-00010130: 6e75 6d20 2b3d 2031 0d0a 2020 2020 6475  num += 1..    du
-00010140: 7261 7469 6f6e 203d 2070 6172 7365 5f6e  ration = parse_n
-00010150: 756d 2874 6578 745b 3a69 6e64 202b 2031  um(text[:ind + 1
-00010160: 5d2c 2067 6574 5f66 7261 6374 696f 6e3d  ], get_fraction=
-00010170: 6765 745f 6672 6163 7469 6f6e 290d 0a20  get_fraction).. 
-00010180: 2020 2063 7572 7265 6e74 5f64 7572 6174     current_durat
-00010190: 696f 6e20 3d20 6d70 2e62 6561 7428 6475  ion = mp.beat(du
-000101a0: 7261 7469 6f6e 2c20 646f 7474 6564 5f6e  ration, dotted_n
-000101b0: 756d 292e 6765 745f 6475 7261 7469 6f6e  um).get_duration
-000101c0: 2829 0d0a 2020 2020 7265 7475 726e 2063  ()..    return c
-000101d0: 7572 7265 6e74 5f64 7572 6174 696f 6e0d  urrent_duration.
-000101e0: 0a0d 0a0d 0a64 6566 2070 6172 7365 5f6e  .....def parse_n
-000101f0: 756d 2864 7572 6174 696f 6e2c 2067 6574  um(duration, get
-00010200: 5f66 7261 6374 696f 6e3d 4661 6c73 6529  _fraction=False)
-00010210: 3a0d 0a20 2020 2069 6620 272f 2720 696e  :..    if '/' in
-00010220: 2064 7572 6174 696f 6e3a 0d0a 2020 2020   duration:..    
-00010230: 2020 2020 6e75 6d65 7261 746f 722c 2064      numerator, d
-00010240: 656e 6f6d 696e 6174 6f72 203d 2064 7572  enominator = dur
-00010250: 6174 696f 6e2e 7370 6c69 7428 272f 2729  ation.split('/')
-00010260: 0d0a 2020 2020 2020 2020 6e75 6d65 7261  ..        numera
-00010270: 746f 7220 3d20 696e 7428 6e75 6d65 7261  tor = int(numera
-00010280: 746f 7229 2069 6620 6e75 6d65 7261 746f  tor) if numerato
-00010290: 722e 6973 6469 6769 7428 2920 656c 7365  r.isdigit() else
-000102a0: 2066 6c6f 6174 286e 756d 6572 6174 6f72   float(numerator
-000102b0: 290d 0a20 2020 2020 2020 2064 656e 6f6d  )..        denom
-000102c0: 696e 6174 6f72 203d 2069 6e74 2864 656e  inator = int(den
-000102d0: 6f6d 696e 6174 6f72 2920 6966 2064 656e  ominator) if den
-000102e0: 6f6d 696e 6174 6f72 2e69 7364 6967 6974  ominator.isdigit
-000102f0: 2829 2065 6c73 6520 666c 6f61 7428 0d0a  () else float(..
-00010300: 2020 2020 2020 2020 2020 2020 6465 6e6f              deno
-00010310: 6d69 6e61 746f 7229 0d0a 2020 2020 2020  minator)..      
-00010320: 2020 6966 2067 6574 5f66 7261 6374 696f    if get_fractio
-00010330: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
-00010340: 6966 206e 6f74 2028 6973 696e 7374 616e  if not (isinstan
-00010350: 6365 286e 756d 6572 6174 6f72 2c20 696e  ce(numerator, in
-00010360: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
-00010370: 2020 2020 2020 2020 616e 6420 6973 696e          and isin
-00010380: 7374 616e 6365 2864 656e 6f6d 696e 6174  stance(denominat
-00010390: 6f72 2c20 696e 7429 293a 0d0a 2020 2020  or, int)):..    
-000103a0: 2020 2020 2020 2020 2020 2020 6475 7261              dura
-000103b0: 7469 6f6e 203d 2046 7261 6374 696f 6e28  tion = Fraction(
-000103c0: 6e75 6d65 7261 746f 7220 2f0d 0a20 2020  numerator /..   
-000103d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000103e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000103f0: 2064 656e 6f6d 696e 6174 6f72 292e 6c69   denominator).li
-00010400: 6d69 745f 6465 6e6f 6d69 6e61 746f 7228  mit_denominator(
-00010410: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-00010420: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00010430: 2020 2020 2020 6475 7261 7469 6f6e 203d        duration =
-00010440: 2046 7261 6374 696f 6e28 6e75 6d65 7261   Fraction(numera
-00010450: 746f 722c 2064 656e 6f6d 696e 6174 6f72  tor, denominator
-00010460: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
-00010470: 0d0a 2020 2020 2020 2020 2020 2020 6475  ..            du
-00010480: 7261 7469 6f6e 203d 206e 756d 6572 6174  ration = numerat
-00010490: 6f72 202f 2064 656e 6f6d 696e 6174 6f72  or / denominator
-000104a0: 0d0a 2020 2020 656c 7365 3a0d 0a20 2020  ..    else:..   
-000104b0: 2020 2020 2064 7572 6174 696f 6e20 3d20       duration = 
-000104c0: 696e 7428 6475 7261 7469 6f6e 2920 6966  int(duration) if
-000104d0: 2064 7572 6174 696f 6e2e 6973 6469 6769   duration.isdigi
-000104e0: 7428 2920 656c 7365 2066 6c6f 6174 2864  t() else float(d
-000104f0: 7572 6174 696f 6e29 0d0a 2020 2020 2020  uration)..      
-00010500: 2020 6966 2067 6574 5f66 7261 6374 696f    if get_fractio
-00010510: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
-00010520: 6475 7261 7469 6f6e 203d 2046 7261 6374  duration = Fract
-00010530: 696f 6e28 6475 7261 7469 6f6e 292e 6c69  ion(duration).li
-00010540: 6d69 745f 6465 6e6f 6d69 6e61 746f 7228  mit_denominator(
-00010550: 290d 0a20 2020 2072 6574 7572 6e20 6475  )..    return du
-00010560: 7261 7469 6f6e 0d0a 0d0a 0d0a 6465 6620  ration......def 
-00010570: 7265 6c61 7469 7665 5f6e 6f74 6528 612c  relative_note(a,
-00010580: 2062 293a 0d0a 2020 2020 2727 270d 0a20   b):..    '''.. 
-00010590: 2020 2072 6574 7572 6e20 7468 6520 6e6f     return the no
-000105a0: 7461 7469 6f6e 206f 6620 6e6f 7465 2061  tation of note a
-000105b0: 2066 726f 6d20 6e6f 7465 2062 2077 6974   from note b wit
-000105c0: 6820 6163 6369 6465 6e74 616c 730d 0a20  h accidentals.. 
-000105d0: 2020 2028 686f 7720 6e6f 7465 2062 2061     (how note b a
-000105e0: 6464 7320 6163 6369 6465 6e74 616c 7320  dds accidentals 
-000105f0: 746f 206d 6174 6368 2074 6865 2073 616d  to match the sam
-00010600: 6520 7069 7463 6820 6173 206e 6f74 6520  e pitch as note 
-00010610: 6129 2c0d 0a20 2020 2077 6f72 6b73 2066  a),..    works f
-00010620: 6f72 2074 6865 2061 6363 6964 656e 7461  or the accidenta
-00010630: 6c73 2069 6e63 6c75 6469 6e67 2073 6861  ls including sha
-00010640: 7270 2c20 666c 6174 2c20 6e61 7475 7261  rp, flat, natura
-00010650: 6c2c 0d0a 2020 2020 646f 7562 6c65 2073  l,..    double s
-00010660: 6861 7270 2c20 646f 7562 6c65 2066 6c61  harp, double fla
-00010670: 740d 0a20 2020 2028 612c 2062 2061 7265  t..    (a, b are
-00010680: 2073 7472 696e 6773 2074 6861 7420 7265   strings that re
-00010690: 7072 6573 656e 7473 2061 206e 6f74 652c  presents a note,
-000106a0: 2063 6f75 6c64 2062 6520 7769 7468 2061   could be with a
-000106b0: 6363 6964 656e 7461 6c73 290d 0a20 2020  ccidentals)..   
-000106c0: 2027 2727 0d0a 2020 2020 6c65 6e5f 612c   '''..    len_a,
-000106d0: 206c 656e 5f62 203d 206c 656e 2861 292c   len_b = len(a),
-000106e0: 206c 656e 2862 290d 0a20 2020 2061 5f6e   len(b)..    a_n
-000106f0: 616d 652c 2062 5f6e 616d 652c 2061 6363  ame, b_name, acc
-00010700: 6964 656e 7461 6c5f 612c 2061 6363 6964  idental_a, accid
-00010710: 656e 7461 6c5f 6220 3d20 615b 305d 2c20  ental_b = a[0], 
-00010720: 625b 305d 2c20 615b 313a 5d2c 2062 5b31  b[0], a[1:], b[1
-00010730: 3a5d 0d0a 2020 2020 6966 206c 656e 5f61  :]..    if len_a
-00010740: 203d 3d20 3120 616e 6420 6c65 6e5f 6220   == 1 and len_b 
-00010750: 3e20 3120 616e 6420 615f 6e61 6d65 203d  > 1 and a_name =
-00010760: 3d20 625f 6e61 6d65 3a0d 0a20 2020 2020  = b_name:..     
-00010770: 2020 2072 6574 7572 6e20 6120 2b20 27e2     return a + '.
-00010780: 99ae 270d 0a20 2020 2069 6620 6120 696e  ..'..    if a in
-00010790: 2064 6174 6162 6173 652e 7374 616e 6461   database.standa
-000107a0: 7264 3a0d 0a20 2020 2020 2020 2061 203d  rd:..        a =
-000107b0: 206e 6f74 6528 612c 2035 290d 0a20 2020   note(a, 5)..   
-000107c0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-000107d0: 6120 3d20 6e6f 7465 2861 5f6e 616d 652c  a = note(a_name,
-000107e0: 2035 290d 0a20 2020 2020 2020 2069 6620   5)..        if 
-000107f0: 6163 6369 6465 6e74 616c 5f61 203d 3d20  accidental_a == 
-00010800: 2762 273a 0d0a 2020 2020 2020 2020 2020  'b':..          
-00010810: 2020 6120 3d20 612e 646f 776e 2829 0d0a    a = a.down()..
-00010820: 2020 2020 2020 2020 656c 6966 2061 6363          elif acc
-00010830: 6964 656e 7461 6c5f 6120 3d3d 2027 6262  idental_a == 'bb
-00010840: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
-00010850: 6120 3d20 612e 646f 776e 2832 290d 0a20  a = a.down(2).. 
-00010860: 2020 2020 2020 2065 6c69 6620 6163 6369         elif acci
-00010870: 6465 6e74 616c 5f61 203d 3d20 2723 273a  dental_a == '#':
-00010880: 0d0a 2020 2020 2020 2020 2020 2020 6120  ..            a 
-00010890: 3d20 612e 7570 2829 0d0a 2020 2020 2020  = a.up()..      
-000108a0: 2020 656c 6966 2061 6363 6964 656e 7461    elif accidenta
-000108b0: 6c5f 6120 3d3d 2027 7827 3a0d 0a20 2020  l_a == 'x':..   
-000108c0: 2020 2020 2020 2020 2061 203d 2061 2e75           a = a.u
-000108d0: 7028 3229 0d0a 2020 2020 2020 2020 656c  p(2)..        el
-000108e0: 6966 2061 6363 6964 656e 7461 6c5f 6120  if accidental_a 
-000108f0: 3d3d 2027 e299 ae27 3a0d 0a20 2020 2020  == '...':..     
-00010900: 2020 2020 2020 2070 6173 730d 0a20 2020         pass..   
-00010910: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00010920: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00010930: 6c75 6545 7272 6f72 2866 2775 6e72 6563  lueError(f'unrec
-00010940: 6f67 6e69 7a61 626c 6520 6163 6369 6465  ognizable accide
-00010950: 6e74 616c 7320 7b61 6363 6964 656e 7461  ntals {accidenta
-00010960: 6c5f 617d 2729 0d0a 2020 2020 6966 2062  l_a}')..    if b
-00010970: 2069 6e20 6461 7461 6261 7365 2e73 7461   in database.sta
-00010980: 6e64 6172 643a 0d0a 2020 2020 2020 2020  ndard:..        
-00010990: 6220 3d20 6e6f 7465 2862 2c20 3529 0d0a  b = note(b, 5)..
-000109a0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-000109b0: 2020 2062 203d 206e 6f74 6528 625f 6e61     b = note(b_na
-000109c0: 6d65 2c20 3529 0d0a 2020 2020 2020 2020  me, 5)..        
-000109d0: 6966 2061 6363 6964 656e 7461 6c5f 6220  if accidental_b 
-000109e0: 3d3d 2027 6227 3a0d 0a20 2020 2020 2020  == 'b':..       
-000109f0: 2020 2020 2062 203d 2062 2e64 6f77 6e28       b = b.down(
-00010a00: 290d 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
-00010a10: 6163 6369 6465 6e74 616c 5f62 203d 3d20  accidental_b == 
-00010a20: 2762 6227 3a0d 0a20 2020 2020 2020 2020  'bb':..         
-00010a30: 2020 2062 203d 2062 2e64 6f77 6e28 3229     b = b.down(2)
-00010a40: 0d0a 2020 2020 2020 2020 656c 6966 2061  ..        elif a
-00010a50: 6363 6964 656e 7461 6c5f 6220 3d3d 2027  ccidental_b == '
-00010a60: 2327 3a0d 0a20 2020 2020 2020 2020 2020  #':..           
-00010a70: 2062 203d 2062 2e75 7028 290d 0a20 2020   b = b.up()..   
-00010a80: 2020 2020 2065 6c69 6620 6163 6369 6465       elif accide
-00010a90: 6e74 616c 5f62 203d 3d20 2778 273a 0d0a  ntal_b == 'x':..
-00010aa0: 2020 2020 2020 2020 2020 2020 6220 3d20              b = 
-00010ab0: 622e 7570 2832 290d 0a20 2020 2020 2020  b.up(2)..       
-00010ac0: 2065 6c69 6620 6163 6369 6465 6e74 616c   elif accidental
-00010ad0: 5f62 203d 3d20 27e2 99ae 273a 0d0a 2020  _b == '...':..  
-00010ae0: 2020 2020 2020 2020 2020 7061 7373 0d0a            pass..
-00010af0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00010b00: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00010b10: 2056 616c 7565 4572 726f 7228 6627 756e   ValueError(f'un
-00010b20: 7265 636f 676e 697a 6162 6c65 2061 6363  recognizable acc
-00010b30: 6964 656e 7461 6c73 207b 6163 6369 6465  identals {accide
-00010b40: 6e74 616c 5f62 7d27 290d 0a20 2020 2064  ntal_b}')..    d
-00010b50: 6567 7265 6531 2c20 6465 6772 6565 3220  egree1, degree2 
-00010b60: 3d20 612e 6465 6772 6565 2c20 622e 6465  = a.degree, b.de
-00010b70: 6772 6565 0d0a 2020 2020 6469 6666 312c  gree..    diff1,
-00010b80: 2064 6966 6632 203d 2064 6567 7265 6531   diff2 = degree1
-00010b90: 202d 2064 6567 7265 6532 2c20 2864 6567   - degree2, (deg
-00010ba0: 7265 6531 202d 2064 6567 7265 6532 202d  ree1 - degree2 -
-00010bb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00010bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010bd0: 2020 2020 2020 2020 2031 3220 6966 2064           12 if d
-00010be0: 6567 7265 6531 203e 3d20 6465 6772 6565  egree1 >= degree
-00010bf0: 3220 656c 7365 2064 6567 7265 6531 202b  2 else degree1 +
-00010c00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00010c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010c20: 2020 2020 2020 2020 2031 3220 2d20 6465           12 - de
-00010c30: 6772 6565 3229 0d0a 2020 2020 6966 2061  gree2)..    if a
-00010c40: 6273 2864 6966 6631 2920 3c20 6162 7328  bs(diff1) < abs(
-00010c50: 6469 6666 3229 3a0d 0a20 2020 2020 2020  diff2):..       
-00010c60: 2064 6966 6620 3d20 6469 6666 310d 0a20   diff = diff1.. 
-00010c70: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00010c80: 2020 6469 6666 203d 2064 6966 6632 0d0a    diff = diff2..
-00010c90: 2020 2020 6966 2064 6966 6620 3d3d 2030      if diff == 0
-00010ca0: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
-00010cb0: 6e20 622e 6e61 6d65 0d0a 2020 2020 6966  n b.name..    if
-00010cc0: 2064 6966 6620 3d3d 2031 3a0d 0a20 2020   diff == 1:..   
-00010cd0: 2020 2020 2072 6574 7572 6e20 622e 6e61       return b.na
-00010ce0: 6d65 202b 2027 2327 0d0a 2020 2020 6966  me + '#'..    if
-00010cf0: 2064 6966 6620 3d3d 2032 3a0d 0a20 2020   diff == 2:..   
-00010d00: 2020 2020 2072 6574 7572 6e20 622e 6e61       return b.na
-00010d10: 6d65 202b 2027 7827 0d0a 2020 2020 6966  me + 'x'..    if
-00010d20: 2064 6966 6620 3d3d 202d 313a 0d0a 2020   diff == -1:..  
-00010d30: 2020 2020 2020 7265 7475 726e 2062 2e6e        return b.n
-00010d40: 616d 6520 2b20 2762 270d 0a20 2020 2069  ame + 'b'..    i
-00010d50: 6620 6469 6666 203d 3d20 2d32 3a0d 0a20  f diff == -2:.. 
-00010d60: 2020 2020 2020 2072 6574 7572 6e20 622e         return b.
-00010d70: 6e61 6d65 202b 2027 6262 270d 0a0d 0a0d  name + 'bb'.....
-00010d80: 0a64 6566 2067 6574 5f6e 6f74 655f 6e61  .def get_note_na
-00010d90: 6d65 2863 7572 7265 6e74 5f6e 6f74 6529  me(current_note)
-00010da0: 3a0d 0a20 2020 2069 6620 616e 7928 692e  :..    if any(i.
-00010db0: 6973 6469 6769 7428 2920 666f 7220 6920  isdigit() for i 
-00010dc0: 696e 2063 7572 7265 6e74 5f6e 6f74 6529  in current_note)
-00010dd0: 3a0d 0a20 2020 2020 2020 2063 7572 7265  :..        curre
-00010de0: 6e74 5f6e 6f74 6520 3d20 2727 2e6a 6f69  nt_note = ''.joi
-00010df0: 6e28 5b69 2066 6f72 2069 2069 6e20 6375  n([i for i in cu
-00010e00: 7272 656e 745f 6e6f 7465 2069 6620 6e6f  rrent_note if no
-00010e10: 7420 692e 6973 6469 6769 7428 295d 290d  t i.isdigit()]).
-00010e20: 0a20 2020 2072 6574 7572 6e20 6375 7272  .    return curr
-00010e30: 656e 745f 6e6f 7465 0d0a 0d0a 0d0a 6465  ent_note......de
-00010e40: 6620 6765 745f 6e6f 7465 5f6e 756d 2863  f get_note_num(c
-00010e50: 7572 7265 6e74 5f6e 6f74 6529 3a0d 0a20  urrent_note):.. 
-00010e60: 2020 2072 6573 756c 7420 3d20 2727 2e6a     result = ''.j
-00010e70: 6f69 6e28 5b69 2066 6f72 2069 2069 6e20  oin([i for i in 
-00010e80: 6375 7272 656e 745f 6e6f 7465 2069 6620  current_note if 
-00010e90: 692e 6973 6469 6769 7428 295d 290d 0a20  i.isdigit()]).. 
-00010ea0: 2020 2072 6574 7572 6e20 696e 7428 7265     return int(re
-00010eb0: 7375 6c74 2920 6966 2072 6573 756c 7420  sult) if result 
-00010ec0: 656c 7365 204e 6f6e 650d 0a0d 0a0d 0a64  else None......d
-00010ed0: 6566 2073 7461 6e64 6172 6469 7a65 5f6e  ef standardize_n
-00010ee0: 6f74 6528 6375 7272 656e 745f 6e6f 7465  ote(current_note
-00010ef0: 293a 0d0a 2020 2020 6375 7272 656e 745f  ):..    current_
-00010f00: 6e6f 7465 203d 2067 6574 5f6e 6f74 655f  note = get_note_
-00010f10: 6e61 6d65 2863 7572 7265 6e74 5f6e 6f74  name(current_not
-00010f20: 6529 0d0a 2020 2020 6966 2063 7572 7265  e)..    if curre
-00010f30: 6e74 5f6e 6f74 6520 696e 2064 6174 6162  nt_note in datab
-00010f40: 6173 652e 7374 616e 6461 7264 323a 0d0a  ase.standard2:..
-00010f50: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-00010f60: 7572 7265 6e74 5f6e 6f74 650d 0a20 2020  urrent_note..   
-00010f70: 2065 6c69 6620 6375 7272 656e 745f 6e6f   elif current_no
-00010f80: 7465 2069 6e20 6461 7461 6261 7365 2e73  te in database.s
-00010f90: 7461 6e64 6172 645f 6469 6374 3a0d 0a20  tandard_dict:.. 
-00010fa0: 2020 2020 2020 2072 6574 7572 6e20 6461         return da
-00010fb0: 7461 6261 7365 2e73 7461 6e64 6172 645f  tabase.standard_
-00010fc0: 6469 6374 5b63 7572 7265 6e74 5f6e 6f74  dict[current_not
-00010fd0: 655d 0d0a 2020 2020 656c 7365 3a0d 0a20  e]..    else:.. 
-00010fe0: 2020 2020 2020 2069 6620 6375 7272 656e         if curren
-00010ff0: 745f 6e6f 7465 2e65 6e64 7377 6974 6828  t_note.endswith(
-00011000: 2762 6227 293a 0d0a 2020 2020 2020 2020  'bb'):..        
-00011010: 2020 2020 6375 7272 656e 745f 6e61 6d65      current_name
-00011020: 203d 2063 7572 7265 6e74 5f6e 6f74 655b   = current_note[
-00011030: 3a2d 325d 0d0a 2020 2020 2020 2020 2020  :-2]..          
-00011040: 2020 7265 7375 6c74 203d 2028 4e28 7374    result = (N(st
-00011050: 616e 6461 7264 697a 655f 6e6f 7465 2863  andardize_note(c
-00011060: 7572 7265 6e74 5f6e 616d 6529 2920 2d20  urrent_name)) - 
-00011070: 3229 2e6e 616d 650d 0a20 2020 2020 2020  2).name..       
-00011080: 2065 6c69 6620 6375 7272 656e 745f 6e6f   elif current_no
-00011090: 7465 2e65 6e64 7377 6974 6828 2778 2729  te.endswith('x')
-000110a0: 3a0d 0a20 2020 2020 2020 2020 2020 2063  :..            c
-000110b0: 7572 7265 6e74 5f6e 616d 6520 3d20 6375  urrent_name = cu
-000110c0: 7272 656e 745f 6e6f 7465 5b3a 2d31 5d0d  rrent_note[:-1].
-000110d0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-000110e0: 756c 7420 3d20 284e 2873 7461 6e64 6172  ult = (N(standar
-000110f0: 6469 7a65 5f6e 6f74 6528 6375 7272 656e  dize_note(curren
-00011100: 745f 6e61 6d65 2929 202b 2032 292e 6e61  t_name)) + 2).na
-00011110: 6d65 0d0a 2020 2020 2020 2020 656c 6966  me..        elif
-00011120: 2063 7572 7265 6e74 5f6e 6f74 652e 656e   current_note.en
-00011130: 6473 7769 7468 2827 e299 ae27 293a 0d0a  dswith('...'):..
-00011140: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-00011150: 6c74 203d 2063 7572 7265 6e74 5f6e 6f74  lt = current_not
-00011160: 655b 3a2d 315d 0d0a 2020 2020 2020 2020  e[:-1]..        
-00011170: 656c 6966 2063 7572 7265 6e74 5f6e 6f74  elif current_not
-00011180: 652e 656e 6473 7769 7468 2827 2327 293a  e.endswith('#'):
-00011190: 0d0a 2020 2020 2020 2020 2020 2020 6375  ..            cu
-000111a0: 7272 656e 745f 6e61 6d65 203d 2063 7572  rrent_name = cur
-000111b0: 7265 6e74 5f6e 6f74 655b 3a2d 315d 0d0a  rent_note[:-1]..
-000111c0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-000111d0: 6c74 203d 2028 4e28 7374 616e 6461 7264  lt = (N(standard
-000111e0: 697a 655f 6e6f 7465 2863 7572 7265 6e74  ize_note(current
-000111f0: 5f6e 616d 6529 2920 2b20 3129 2e6e 616d  _name)) + 1).nam
-00011200: 650d 0a20 2020 2020 2020 2065 6c69 6620  e..        elif 
-00011210: 6375 7272 656e 745f 6e6f 7465 2e65 6e64  current_note.end
-00011220: 7377 6974 6828 2762 2729 3a0d 0a20 2020  swith('b'):..   
-00011230: 2020 2020 2020 2020 2063 7572 7265 6e74           current
-00011240: 5f6e 616d 6520 3d20 6375 7272 656e 745f  _name = current_
-00011250: 6e6f 7465 5b3a 2d31 5d0d 0a20 2020 2020  note[:-1]..     
-00011260: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-00011270: 284e 2873 7461 6e64 6172 6469 7a65 5f6e  (N(standardize_n
-00011280: 6f74 6528 6375 7272 656e 745f 6e61 6d65  ote(current_name
-00011290: 2929 202d 2031 292e 6e61 6d65 0d0a 2020  )) - 1).name..  
-000112a0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-000112b0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-000112c0: 616c 7565 4572 726f 7228 6627 496e 7661  alueError(f'Inva
-000112d0: 6c69 6420 6e6f 7465 206e 616d 6520 6f72  lid note name or
-000112e0: 2061 6363 6964 656e 7461 6c20 7b63 7572   accidental {cur
-000112f0: 7265 6e74 5f6e 6f74 657d 2729 0d0a 2020  rent_note}')..  
-00011300: 2020 2020 2020 7265 7475 726e 2072 6573        return res
-00011310: 756c 740d 0a0d 0a0d 0a64 6566 2067 6574  ult......def get
-00011320: 5f61 6363 6964 656e 7461 6c28 6375 7272  _accidental(curr
-00011330: 656e 745f 6e6f 7465 293a 0d0a 2020 2020  ent_note):..    
-00011340: 6966 2063 7572 7265 6e74 5f6e 6f74 652e  if current_note.
-00011350: 656e 6473 7769 7468 2827 6262 2729 3a0d  endswith('bb'):.
-00011360: 0a20 2020 2020 2020 2072 6573 756c 7420  .        result 
-00011370: 3d20 2762 6227 0d0a 2020 2020 656c 6966  = 'bb'..    elif
-00011380: 2063 7572 7265 6e74 5f6e 6f74 652e 656e   current_note.en
-00011390: 6473 7769 7468 2827 7827 293a 0d0a 2020  dswith('x'):..  
-000113a0: 2020 2020 2020 7265 7375 6c74 203d 2027        result = '
-000113b0: 7827 0d0a 2020 2020 656c 6966 2063 7572  x'..    elif cur
-000113c0: 7265 6e74 5f6e 6f74 652e 656e 6473 7769  rent_note.endswi
-000113d0: 7468 2827 e299 ae27 293a 0d0a 2020 2020  th('...'):..    
-000113e0: 2020 2020 7265 7375 6c74 203d 2027 e299      result = '..
-000113f0: ae27 0d0a 2020 2020 656c 6966 2063 7572  .'..    elif cur
-00011400: 7265 6e74 5f6e 6f74 652e 656e 6473 7769  rent_note.endswi
-00011410: 7468 2827 2327 293a 0d0a 2020 2020 2020  th('#'):..      
-00011420: 2020 7265 7375 6c74 203d 2027 2327 0d0a    result = '#'..
-00011430: 2020 2020 656c 6966 2063 7572 7265 6e74      elif current
-00011440: 5f6e 6f74 652e 656e 6473 7769 7468 2827  _note.endswith('
-00011450: 6227 293a 0d0a 2020 2020 2020 2020 7265  b'):..        re
-00011460: 7375 6c74 203d 2027 6227 0d0a 2020 2020  sult = 'b'..    
-00011470: 656c 7365 3a0d 0a20 2020 2020 2020 2072  else:..        r
-00011480: 6573 756c 7420 3d20 2727 0d0a 2020 2020  esult = ''..    
-00011490: 7265 7475 726e 2072 6573 756c 740d 0a0d  return result...
-000114a0: 0a0d 0a64 6566 2072 6573 6574 2873 656c  ...def reset(sel
-000114b0: 662c 202a 2a6b 7761 7267 7329 3a0d 0a20  f, **kwargs):.. 
-000114c0: 2020 2074 656d 7020 3d20 636f 7079 2873     temp = copy(s
-000114d0: 656c 6629 0d0a 2020 2020 666f 7220 692c  elf)..    for i,
-000114e0: 206a 2069 6e20 6b77 6172 6773 2e69 7465   j in kwargs.ite
-000114f0: 6d73 2829 3a0d 0a20 2020 2020 2020 2073  ms():..        s
-00011500: 6574 6174 7472 2874 656d 702c 2069 2c20  etattr(temp, i, 
-00011510: 6a29 0d0a 2020 2020 7265 7475 726e 2074  j)..    return t
-00011520: 656d 700d 0a0d 0a0d 0a64 6566 2063 6c6f  emp......def clo
-00011530: 7365 7374 5f6e 6f74 6528 6e6f 7465 312c  sest_note(note1,
-00011540: 206e 6f74 6532 2c20 6765 745f 6469 7374   note2, get_dist
-00011550: 616e 6365 3d46 616c 7365 293a 0d0a 2020  ance=False):..  
-00011560: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00011570: 6e6f 7465 312c 206e 6f74 6529 3a0d 0a20  note1, note):.. 
-00011580: 2020 2020 2020 206e 6f74 6531 203d 206e         note1 = n
-00011590: 6f74 6531 2e6e 616d 650d 0a20 2020 2069  ote1.name..    i
-000115a0: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
-000115b0: 286e 6f74 6532 2c20 6e6f 7465 293a 0d0a  (note2, note):..
-000115c0: 2020 2020 2020 2020 6e6f 7465 3220 3d20          note2 = 
-000115d0: 746f 5f6e 6f74 6528 6e6f 7465 3229 0d0a  to_note(note2)..
-000115e0: 2020 2020 6375 7272 656e 745f 6e6f 7465      current_note
-000115f0: 203d 205b 0d0a 2020 2020 2020 2020 6e6f   = [..        no
-00011600: 7465 286e 6f74 6531 2c20 6e6f 7465 322e  te(note1, note2.
-00011610: 6e75 6d29 2c0d 0a20 2020 2020 2020 206e  num),..        n
-00011620: 6f74 6528 6e6f 7465 312c 206e 6f74 6532  ote(note1, note2
-00011630: 2e6e 756d 202d 2031 292c 0d0a 2020 2020  .num - 1),..    
-00011640: 2020 2020 6e6f 7465 286e 6f74 6531 2c20      note(note1, 
-00011650: 6e6f 7465 322e 6e75 6d20 2b20 3129 0d0a  note2.num + 1)..
-00011660: 2020 2020 5d0d 0a20 2020 2069 6620 6e6f      ]..    if no
-00011670: 7420 6765 745f 6469 7374 616e 6365 3a0d  t get_distance:.
-00011680: 0a20 2020 2020 2020 2072 6573 756c 7420  .        result 
-00011690: 3d20 6d69 6e28 6375 7272 656e 745f 6e6f  = min(current_no
-000116a0: 7465 2c20 6b65 793d 6c61 6d62 6461 2073  te, key=lambda s
-000116b0: 3a20 6162 7328 732e 6465 6772 6565 202d  : abs(s.degree -
-000116c0: 206e 6f74 6532 2e64 6567 7265 6529 290d   note2.degree)).
-000116d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000116e0: 7265 7375 6c74 0d0a 2020 2020 656c 7365  result..    else
-000116f0: 3a0d 0a20 2020 2020 2020 2064 6973 7461  :..        dista
-00011700: 6e63 6573 203d 205b 5b69 2c20 6162 7328  nces = [[i, abs(
-00011710: 692e 6465 6772 6565 202d 206e 6f74 6532  i.degree - note2
-00011720: 2e64 6567 7265 6529 5d20 666f 7220 6920  .degree)] for i 
-00011730: 696e 2063 7572 7265 6e74 5f6e 6f74 655d  in current_note]
-00011740: 0d0a 2020 2020 2020 2020 6469 7374 616e  ..        distan
-00011750: 6365 732e 736f 7274 286b 6579 3d6c 616d  ces.sort(key=lam
-00011760: 6264 6120 733a 2073 5b31 5d29 0d0a 2020  bda s: s[1])..  
-00011770: 2020 2020 2020 7265 7375 6c74 203d 2064        result = d
-00011780: 6973 7461 6e63 6573 5b30 5d0d 0a20 2020  istances[0]..   
-00011790: 2020 2020 2072 6574 7572 6e20 7265 7375       return resu
-000117a0: 6c74 0d0a 0d0a 0d0a 6465 6620 636c 6f73  lt......def clos
-000117b0: 6573 745f 6e6f 7465 5f66 726f 6d5f 6368  est_note_from_ch
-000117c0: 6f72 6428 6e6f 7465 312c 2063 686f 7264  ord(note1, chord
-000117d0: 312c 206d 6f64 653d 302c 2067 6574 5f64  1, mode=0, get_d
-000117e0: 6973 7461 6e63 653d 4661 6c73 6529 3a0d  istance=False):.
-000117f0: 0a20 2020 2069 6620 6e6f 7420 6973 696e  .    if not isin
-00011800: 7374 616e 6365 286e 6f74 6531 2c20 6e6f  stance(note1, no
-00011810: 7465 293a 0d0a 2020 2020 2020 2020 6e6f  te):..        no
-00011820: 7465 3120 3d20 746f 5f6e 6f74 6528 6e6f  te1 = to_note(no
-00011830: 7465 3129 0d0a 2020 2020 6966 2069 7369  te1)..    if isi
-00011840: 6e73 7461 6e63 6528 6368 6f72 6431 2c20  nstance(chord1, 
-00011850: 6368 6f72 6429 3a0d 0a20 2020 2020 2020  chord):..       
-00011860: 2063 686f 7264 3120 3d20 6368 6f72 6431   chord1 = chord1
-00011870: 2e6e 6f74 6573 0d0a 2020 2020 6375 7272  .notes..    curr
-00011880: 656e 745f 6e61 6d65 203d 2064 6174 6162  ent_name = datab
-00011890: 6173 652e 7374 616e 6461 7264 5f64 6963  ase.standard_dic
-000118a0: 742e 6765 7428 6e6f 7465 312e 6e61 6d65  t.get(note1.name
-000118b0: 2c20 6e6f 7465 312e 6e61 6d65 290d 0a20  , note1.name).. 
-000118c0: 2020 2064 6973 7461 6e63 6573 203d 205b     distances = [
-000118d0: 2863 6c6f 7365 7374 5f6e 6f74 6528 6e6f  (closest_note(no
-000118e0: 7465 312c 2065 6163 682c 2067 6574 5f64  te1, each, get_d
-000118f0: 6973 7461 6e63 653d 5472 7565 292c 2069  istance=True), i
-00011900: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00011910: 2020 2020 666f 7220 692c 2065 6163 6820      for i, each 
-00011920: 696e 2065 6e75 6d65 7261 7465 2863 686f  in enumerate(cho
-00011930: 7264 3129 5d0d 0a20 2020 2064 6973 7461  rd1)]..    dista
-00011940: 6e63 6573 2e73 6f72 7428 6b65 793d 6c61  nces.sort(key=la
-00011950: 6d62 6461 2073 3a20 735b 305d 5b31 5d29  mbda s: s[0][1])
-00011960: 0d0a 2020 2020 7265 7375 6c74 203d 2063  ..    result = c
-00011970: 686f 7264 315b 6469 7374 616e 6365 735b  hord1[distances[
-00011980: 305d 5b31 5d5d 0d0a 2020 2020 6966 206d  0][1]]..    if m
-00011990: 6f64 6520 3d3d 2031 3a0d 0a20 2020 2020  ode == 1:..     
-000119a0: 2020 2072 6573 756c 7420 3d20 6469 7374     result = dist
-000119b0: 616e 6365 735b 305d 5b30 5d5b 305d 0d0a  ances[0][0][0]..
-000119c0: 2020 2020 6966 2067 6574 5f64 6973 7461      if get_dista
-000119d0: 6e63 653a 0d0a 2020 2020 2020 2020 7265  nce:..        re
-000119e0: 7375 6c74 203d 2028 7265 7375 6c74 2c20  sult = (result, 
-000119f0: 6469 7374 616e 6365 735b 305d 5b30 5d5b  distances[0][0][
-00011a00: 315d 290d 0a20 2020 2072 6574 7572 6e20  1])..    return 
-00011a10: 7265 7375 6c74 0d0a 0d0a 0d0a 6465 6620  result......def 
-00011a20: 6e6f 7465 5f72 616e 6765 286e 6f74 6531  note_range(note1
-00011a30: 2c20 6e6f 7465 3229 3a0d 0a20 2020 2063  , note2):..    c
-00011a40: 7572 7265 6e74 5f72 616e 6765 203d 206c  urrent_range = l
-00011a50: 6973 7428 7261 6e67 6528 6e6f 7465 312e  ist(range(note1.
-00011a60: 6465 6772 6565 2c20 6e6f 7465 322e 6465  degree, note2.de
-00011a70: 6772 6565 2929 0d0a 2020 2020 7265 7375  gree))..    resu
-00011a80: 6c74 203d 205b 6465 6772 6565 5f74 6f5f  lt = [degree_to_
-00011a90: 6e6f 7465 2869 2920 666f 7220 6920 696e  note(i) for i in
-00011aa0: 2063 7572 7265 6e74 5f72 616e 6765 5d0d   current_range].
-00011ab0: 0a20 2020 2072 6574 7572 6e20 7265 7375  .    return resu
-00011ac0: 6c74 0d0a 0d0a 0d0a 6465 6620 6164 6a75  lt......def adju
-00011ad0: 7374 5f74 6f5f 7363 616c 6528 6375 7272  st_to_scale(curr
-00011ae0: 656e 745f 6368 6f72 642c 2063 7572 7265  ent_chord, curre
-00011af0: 6e74 5f73 6361 6c65 293a 0d0a 2020 2020  nt_scale):..    
-00011b00: 7465 6d70 203d 2063 6f70 7928 6375 7272  temp = copy(curr
-00011b10: 656e 745f 6368 6f72 6429 0d0a 2020 2020  ent_chord)..    
-00011b20: 6375 7272 656e 745f 6e6f 7465 7320 3d20  current_notes = 
-00011b30: 6375 7272 656e 745f 7363 616c 652e 6765  current_scale.ge
-00011b40: 745f 7363 616c 6528 290d 0a20 2020 2066  t_scale()..    f
-00011b50: 6f72 2065 6163 6820 696e 2074 656d 703a  or each in temp:
-00011b60: 0d0a 2020 2020 2020 2020 6375 7272 656e  ..        curren
-00011b70: 745f 6e6f 7465 203d 2063 6c6f 7365 7374  t_note = closest
-00011b80: 5f6e 6f74 655f 6672 6f6d 5f63 686f 7264  _note_from_chord
-00011b90: 2865 6163 682c 2063 7572 7265 6e74 5f6e  (each, current_n
-00011ba0: 6f74 6573 290d 0a20 2020 2020 2020 2065  otes)..        e
-00011bb0: 6163 682e 6e61 6d65 203d 2063 7572 7265  ach.name = curre
-00011bc0: 6e74 5f6e 6f74 652e 6e61 6d65 0d0a 2020  nt_note.name..  
-00011bd0: 2020 2020 2020 6561 6368 2e6e 756d 203d        each.num =
-00011be0: 2063 7572 7265 6e74 5f6e 6f74 652e 6e75   current_note.nu
-00011bf0: 6d0d 0a20 2020 2072 6574 7572 6e20 7465  m..    return te
-00011c00: 6d70 0d0a 0d0a 0d0a 6465 6620 6461 7461  mp......def data
-00011c10: 636c 6173 735f 7265 7072 2873 2c20 6b65  class_repr(s, ke
-00011c20: 7977 6f72 6473 3d4e 6f6e 6529 3a0d 0a20  ywords=None):.. 
-00011c30: 2020 2069 6620 6e6f 7420 6b65 7977 6f72     if not keywor
-00011c40: 6473 3a0d 0a20 2020 2020 2020 2072 6573  ds:..        res
-00011c50: 756c 7420 3d20 6622 7b74 7970 6528 7329  ult = f"{type(s)
-00011c60: 2e5f 5f6e 616d 655f 5f7d 287b 272c 2027  .__name__}({', '
-00011c70: 2e6a 6f69 6e28 5b66 277b 697d 3d7b 6a7d  .join([f'{i}={j}
-00011c80: 2720 666f 7220 692c 206a 2069 6e20 7661  ' for i, j in va
-00011c90: 7273 2873 292e 6974 656d 7328 295d 297d  rs(s).items()])}
-00011ca0: 2922 0d0a 2020 2020 656c 7365 3a0d 0a20  )"..    else:.. 
-00011cb0: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-00011cc0: 6622 7b74 7970 6528 7329 2e5f 5f6e 616d  f"{type(s).__nam
-00011cd0: 655f 5f7d 287b 272c 2027 2e6a 6f69 6e28  e__}({', '.join(
-00011ce0: 5b66 277b 697d 3d7b 7661 7273 2873 295b  [f'{i}={vars(s)[
-00011cf0: 695d 7d27 2066 6f72 2069 2069 6e20 6b65  i]}' for i in ke
-00011d00: 7977 6f72 6473 5d29 7d29 220d 0a20 2020  ywords])})"..   
-00011d10: 2072 6574 7572 6e20 7265 7375 6c74 0d0a   return result..
-00011d20: 0d0a 0d0a 6465 6620 7265 6164 5f6d 7573  ....def read_mus
-00011d30: 6963 786d 6c28 6669 6c65 2c20 6c6f 6164  icxml(file, load
-00011d40: 5f6d 7573 6963 786d 6c5f 6172 6773 3d7b  _musicxml_args={
-00011d50: 7d2c 2073 6176 655f 6d69 6469 5f61 7267  }, save_midi_arg
-00011d60: 733d 7b7d 293a 0d0a 2020 2020 696d 706f  s={}):..    impo
-00011d70: 7274 2070 6172 7469 7475 7261 0d0a 2020  rt partitura..  
-00011d80: 2020 6375 7272 656e 745f 7363 6f72 6520    current_score 
-00011d90: 3d20 7061 7274 6974 7572 612e 6c6f 6164  = partitura.load
-00011da0: 5f6d 7573 6963 786d 6c28 6669 6c65 2c20  _musicxml(file, 
-00011db0: 2a2a 6c6f 6164 5f6d 7573 6963 786d 6c5f  **load_musicxml_
-00011dc0: 6172 6773 290d 0a20 2020 2063 7572 7265  args)..    curre
-00011dd0: 6e74 5f66 696c 6520 3d20 4279 7465 7349  nt_file = BytesI
-00011de0: 4f28 290d 0a20 2020 2070 6172 7469 7475  O()..    partitu
-00011df0: 7261 2e73 6176 655f 7363 6f72 655f 6d69  ra.save_score_mi
-00011e00: 6469 2863 7572 7265 6e74 5f73 636f 7265  di(current_score
-00011e10: 2c20 6375 7272 656e 745f 6669 6c65 2c20  , current_file, 
-00011e20: 2a2a 7361 7665 5f6d 6964 695f 6172 6773  **save_midi_args
-00011e30: 290d 0a20 2020 2072 6573 756c 7420 3d20  )..    result = 
-00011e40: 7265 6164 2863 7572 7265 6e74 5f66 696c  read(current_fil
-00011e50: 652c 2069 735f 6669 6c65 3d54 7275 6529  e, is_file=True)
-00011e60: 0d0a 2020 2020 7265 7375 6c74 2e6d 7573  ..    result.mus
-00011e70: 6963 786d 6c5f 696e 666f 203d 207b 0d0a  icxml_info = {..
-00011e80: 2020 2020 2020 2020 693a 206a 0d0a 2020          i: j..  
-00011e90: 2020 2020 2020 666f 7220 692c 206a 2069        for i, j i
-00011ea0: 6e20 7661 7273 2863 7572 7265 6e74 5f73  n vars(current_s
-00011eb0: 636f 7265 292e 6974 656d 7328 290d 0a20  core).items().. 
-00011ec0: 2020 2020 2020 2069 6620 6920 6e6f 7420         if i not 
-00011ed0: 696e 205b 2770 6172 7473 272c 2027 7061  in ['parts', 'pa
-00011ee0: 7274 5f73 7472 7563 7475 7265 275d 0d0a  rt_structure']..
-00011ef0: 2020 2020 7d0d 0a20 2020 2072 6574 7572      }..    retur
-00011f00: 6e20 7265 7375 6c74 0d0a 0d0a 0d0a 6465  n result......de
-00011f10: 6620 7772 6974 655f 6d75 7369 6378 6d6c  f write_musicxml
-00011f20: 2863 7572 7265 6e74 5f63 686f 7264 2c20  (current_chord, 
-00011f30: 6669 6c65 6e61 6d65 2c20 7361 7665 5f6d  filename, save_m
-00011f40: 7573 6963 786d 6c5f 6172 6773 3d7b 7d29  usicxml_args={})
-00011f50: 3a0d 0a20 2020 2069 6d70 6f72 7420 7061  :..    import pa
-00011f60: 7274 6974 7572 610d 0a20 2020 2063 7572  rtitura..    cur
-00011f70: 7265 6e74 5f66 696c 6520 3d20 4279 7465  rent_file = Byte
-00011f80: 7349 4f28 290d 0a20 2020 2063 7572 7265  sIO()..    curre
-00011f90: 6e74 5f66 696c 6520 3d20 7772 6974 6528  nt_file = write(
-00011fa0: 6375 7272 656e 745f 6368 6f72 642c 2073  current_chord, s
-00011fb0: 6176 655f 6173 5f66 696c 653d 4661 6c73  ave_as_file=Fals
-00011fc0: 6529 0d0a 2020 2020 6375 7272 656e 745f  e)..    current_
-00011fd0: 6669 6c65 2e73 6565 6b28 3029 0d0a 2020  file.seek(0)..  
-00011fe0: 2020 6375 7272 656e 745f 6669 6c65 203d    current_file =
-00011ff0: 2070 6172 7469 7475 7261 2e69 6f2e 696d   partitura.io.im
-00012000: 706f 7274 6d69 6469 2e6d 6964 6f2e 4d69  portmidi.mido.Mi
-00012010: 6469 4669 6c65 2866 696c 653d 6375 7272  diFile(file=curr
-00012020: 656e 745f 6669 6c65 2c0d 0a20 2020 2020  ent_file,..     
-00012030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012060: 2020 2020 636c 6970 3d54 7275 6529 0d0a      clip=True)..
-00012070: 2020 2020 6375 7272 656e 745f 6d69 6469      current_midi
-00012080: 203d 2070 6172 7469 7475 7261 2e6c 6f61   = partitura.loa
-00012090: 645f 7363 6f72 655f 6d69 6469 2863 7572  d_score_midi(cur
-000120a0: 7265 6e74 5f66 696c 6529 0d0a 2020 2020  rent_file)..    
-000120b0: 7061 7274 6974 7572 612e 7361 7665 5f6d  partitura.save_m
-000120c0: 7573 6963 786d 6c28 6375 7272 656e 745f  usicxml(current_
-000120d0: 6d69 6469 2c20 6669 6c65 6e61 6d65 2c20  midi, filename, 
-000120e0: 2a2a 7361 7665 5f6d 7573 6963 786d 6c5f  **save_musicxml_
-000120f0: 6172 6773 290d 0a0d 0a0d 0a64 6566 2072  args)......def r
-00012100: 6561 645f 6a73 6f6e 2866 696c 6529 3a0d  ead_json(file):.
-00012110: 0a20 2020 206e 6f74 655f 6c69 7374 5f64  .    note_list_d
-00012120: 6963 7420 3d20 7b27 6e6f 7465 273a 206e  ict = {'note': n
-00012130: 6f74 652c 2027 7069 7463 685f 6265 6e64  ote, 'pitch_bend
-00012140: 273a 2070 6974 6368 5f62 656e 642c 2027  ': pitch_bend, '
-00012150: 7465 6d70 6f27 3a20 7465 6d70 6f7d 0d0a  tempo': tempo}..
-00012160: 2020 2020 7769 7468 206f 7065 6e28 6669      with open(fi
-00012170: 6c65 2c20 656e 636f 6469 6e67 3d27 7574  le, encoding='ut
-00012180: 662d 3827 2920 6173 2066 3a0d 0a20 2020  f-8') as f:..   
-00012190: 2020 2020 2063 7572 7265 6e74 203d 206a       current = j
-000121a0: 736f 6e2e 6c6f 6164 2866 290d 0a20 2020  son.load(f)..   
-000121b0: 2066 6f72 206a 2069 6e20 6375 7272 656e   for j in curren
-000121c0: 745b 2774 7261 636b 7327 5d3a 0d0a 2020  t['tracks']:..  
-000121d0: 2020 2020 2020 6a5b 2769 6e74 6572 7661        j['interva
-000121e0: 6c27 5d20 3d20 5b69 5b27 696e 7465 7276  l'] = [i['interv
-000121f0: 616c 275d 2066 6f72 2069 2069 6e20 6a5b  al'] for i in j[
-00012200: 276e 6f74 6573 275d 5d0d 0a20 2020 2020  'notes']]..     
-00012210: 2020 2066 6f72 2069 2069 6e20 6a5b 276e     for i in j['n
-00012220: 6f74 6573 275d 3a0d 0a20 2020 2020 2020  otes']:..       
-00012230: 2020 2020 2064 656c 2069 5b27 696e 7465       del i['inte
-00012240: 7276 616c 275d 0d0a 2020 2020 2020 2020  rval']..        
-00012250: 6a5b 276e 6f74 6573 275d 203d 205b 0d0a  j['notes'] = [..
-00012260: 2020 2020 2020 2020 2020 2020 6e6f 7465              note
-00012270: 5f6c 6973 745f 6469 6374 5b6b 5b27 7479  _list_dict[k['ty
-00012280: 7065 275d 5d28 0d0a 2020 2020 2020 2020  pe']](..        
-00012290: 2020 2020 2020 2020 2a2a 7b69 3a20 6a0d          **{i: j.
-000122a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000122b0: 2020 2020 666f 7220 692c 206a 2069 6e20      for i, j in 
-000122c0: 6b2e 6974 656d 7328 2920 6966 2069 2021  k.items() if i !
-000122d0: 3d20 2774 7970 6527 7d29 2066 6f72 206b  = 'type'}) for k
-000122e0: 2069 6e20 6a5b 276e 6f74 6573 275d 0d0a   in j['notes']..
-000122f0: 2020 2020 2020 2020 5d0d 0a20 2020 2020          ]..     
-00012300: 2020 206a 5b27 7465 6d70 6f73 275d 203d     j['tempos'] =
-00012310: 205b 7465 6d70 6f28 2a2a 6b29 2066 6f72   [tempo(**k) for
-00012320: 206b 2069 6e20 6a5b 2774 656d 706f 7327   k in j['tempos'
-00012330: 5d5d 0d0a 2020 2020 2020 2020 6a5b 2770  ]]..        j['p
-00012340: 6974 6368 5f62 656e 6473 275d 203d 205b  itch_bends'] = [
-00012350: 7069 7463 685f 6265 6e64 282a 2a6b 2920  pitch_bend(**k) 
-00012360: 666f 7220 6b20 696e 206a 5b27 7069 7463  for k in j['pitc
-00012370: 685f 6265 6e64 7327 5d5d 0d0a 2020 2020  h_bends']]..    
-00012380: 2020 2020 6a5b 276f 7468 6572 5f6d 6573      j['other_mes
-00012390: 7361 6765 7327 5d20 3d20 5b65 7665 6e74  sages'] = [event
-000123a0: 282a 2a6b 2920 666f 7220 6b20 696e 206a  (**k) for k in j
-000123b0: 5b27 6f74 6865 725f 6d65 7373 6167 6573  ['other_messages
-000123c0: 275d 5d0d 0a20 2020 2063 7572 7265 6e74  ']]..    current
-000123d0: 5b27 7472 6163 6b73 275d 203d 205b 6368  ['tracks'] = [ch
-000123e0: 6f72 6428 2a2a 6929 2066 6f72 2069 2069  ord(**i) for i i
-000123f0: 6e20 6375 7272 656e 745b 2774 7261 636b  n current['track
-00012400: 7327 5d5d 0d0a 2020 2020 6375 7272 656e  s']]..    curren
-00012410: 745b 276f 7468 6572 5f6d 6573 7361 6765  t['other_message
-00012420: 7327 5d20 3d20 5b65 7665 6e74 282a 2a6b  s'] = [event(**k
-00012430: 2920 666f 7220 6b20 696e 2063 7572 7265  ) for k in curre
-00012440: 6e74 5b27 6f74 6865 725f 6d65 7373 6167  nt['other_messag
-00012450: 6573 275d 5d0d 0a20 2020 2063 7572 7265  es']]..    curre
-00012460: 6e74 5b27 7061 6e27 5d20 3d20 5b5b 7061  nt['pan'] = [[pa
-00012470: 6e28 2a2a 6929 2066 6f72 2069 2069 6e20  n(**i) for i in 
-00012480: 6a5d 2066 6f72 206a 2069 6e20 6375 7272  j] for j in curr
-00012490: 656e 745b 2770 616e 275d 5d0d 0a20 2020  ent['pan']]..   
-000124a0: 2063 7572 7265 6e74 5b27 766f 6c75 6d65   current['volume
-000124b0: 275d 203d 205b 5b76 6f6c 756d 6528 2a2a  '] = [[volume(**
-000124c0: 6929 2066 6f72 2069 2069 6e20 6a5d 2066  i) for i in j] f
-000124d0: 6f72 206a 2069 6e20 6375 7272 656e 745b  or j in current[
-000124e0: 2776 6f6c 756d 6527 5d5d 0d0a 2020 2020  'volume']]..    
-000124f0: 7265 7375 6c74 203d 2070 6965 6365 282a  result = piece(*
-00012500: 2a63 7572 7265 6e74 290d 0a20 2020 2072  *current)..    r
-00012510: 6574 7572 6e20 7265 7375 6c74 0d0a 0d0a  eturn result....
-00012520: 0d0a 6465 6620 7772 6974 655f 6a73 6f6e  ..def write_json
-00012530: 2863 7572 7265 6e74 5f63 686f 7264 2c0d  (current_chord,.
-00012540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012550: 6270 6d3d 3132 302c 0d0a 2020 2020 2020  bpm=120,..      
-00012560: 2020 2020 2020 2020 2063 6861 6e6e 656c           channel
-00012570: 3d30 2c0d 0a20 2020 2020 2020 2020 2020  =0,..           
-00012580: 2020 2020 7374 6172 745f 7469 6d65 3d4e      start_time=N
-00012590: 6f6e 652c 0d0a 2020 2020 2020 2020 2020  one,..          
-000125a0: 2020 2020 2066 696c 656e 616d 653d 2775       filename='u
-000125b0: 6e74 6974 6c65 642e 6a73 6f6e 272c 0d0a  ntitled.json',..
-000125c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000125d0: 6e73 7472 756d 656e 743d 4e6f 6e65 2c0d  nstrument=None,.
-000125e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000125f0: 693d 4e6f 6e65 293a 0d0a 2020 2020 6966  i=None):..    if
-00012600: 2069 2069 7320 6e6f 7420 4e6f 6e65 3a0d   i is not None:.
-00012610: 0a20 2020 2020 2020 2069 6e73 7472 756d  .        instrum
-00012620: 656e 7420 3d20 690d 0a20 2020 2069 6620  ent = i..    if 
-00012630: 6973 696e 7374 616e 6365 2863 7572 7265  isinstance(curre
-00012640: 6e74 5f63 686f 7264 2c20 6e6f 7465 293a  nt_chord, note):
-00012650: 0d0a 2020 2020 2020 2020 6375 7272 656e  ..        curren
-00012660: 745f 6368 6f72 6420 3d20 6368 6f72 6428  t_chord = chord(
-00012670: 5b63 7572 7265 6e74 5f63 686f 7264 5d29  [current_chord])
-00012680: 0d0a 2020 2020 656c 6966 2069 7369 6e73  ..    elif isins
-00012690: 7461 6e63 6528 6375 7272 656e 745f 6368  tance(current_ch
-000126a0: 6f72 642c 206c 6973 7429 3a0d 0a20 2020  ord, list):..   
-000126b0: 2020 2020 2063 7572 7265 6e74 5f63 686f       current_cho
-000126c0: 7264 203d 2063 6f6e 6361 7428 6375 7272  rd = concat(curr
-000126d0: 656e 745f 6368 6f72 642c 2027 7c27 290d  ent_chord, '|').
-000126e0: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
-000126f0: 6365 2863 7572 7265 6e74 5f63 686f 7264  ce(current_chord
-00012700: 2c20 6368 6f72 6429 3a0d 0a20 2020 2020  , chord):..     
-00012710: 2020 2069 6620 696e 7374 7275 6d65 6e74     if instrument
-00012720: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
-00012730: 2020 2020 2020 2069 6e73 7472 756d 656e         instrumen
-00012740: 7420 3d20 310d 0a20 2020 2020 2020 2063  t = 1..        c
-00012750: 7572 7265 6e74 5f63 686f 7264 203d 2050  urrent_chord = P
-00012760: 280d 0a20 2020 2020 2020 2020 2020 2074  (..            t
-00012770: 7261 636b 733d 5b63 7572 7265 6e74 5f63  racks=[current_c
-00012780: 686f 7264 5d2c 0d0a 2020 2020 2020 2020  hord],..        
-00012790: 2020 2020 696e 7374 7275 6d65 6e74 733d      instruments=
-000127a0: 5b69 6e73 7472 756d 656e 745d 2c0d 0a20  [instrument],.. 
-000127b0: 2020 2020 2020 2020 2020 2062 706d 3d62             bpm=b
-000127c0: 706d 2c0d 0a20 2020 2020 2020 2020 2020  pm,..           
-000127d0: 2063 6861 6e6e 656c 733d 5b63 6861 6e6e   channels=[chann
-000127e0: 656c 5d2c 0d0a 2020 2020 2020 2020 2020  el],..          
-000127f0: 2020 7374 6172 745f 7469 6d65 733d 5b0d    start_times=[.
-00012800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012810: 2063 7572 7265 6e74 5f63 686f 7264 2e73   current_chord.s
-00012820: 7461 7274 5f74 696d 6520 6966 2073 7461  tart_time if sta
-00012830: 7274 5f74 696d 6520 6973 204e 6f6e 6520  rt_time is None 
-00012840: 656c 7365 2073 7461 7274 5f74 696d 650d  else start_time.
-00012850: 0a20 2020 2020 2020 2020 2020 205d 2c0d  .            ],.
-00012860: 0a20 2020 2020 2020 2020 2020 206f 7468  .            oth
-00012870: 6572 5f6d 6573 7361 6765 733d 6375 7272  er_messages=curr
-00012880: 656e 745f 6368 6f72 642e 6f74 6865 725f  ent_chord.other_
-00012890: 6d65 7373 6167 6573 290d 0a20 2020 2065  messages)..    e
-000128a0: 6c69 6620 6973 696e 7374 616e 6365 2863  lif isinstance(c
-000128b0: 7572 7265 6e74 5f63 686f 7264 2c20 7472  urrent_chord, tr
-000128c0: 6163 6b29 3a0d 0a20 2020 2020 2020 2063  ack):..        c
-000128d0: 7572 7265 6e74 5f63 686f 7264 203d 2062  urrent_chord = b
-000128e0: 7569 6c64 2863 7572 7265 6e74 5f63 686f  uild(current_cho
-000128f0: 7264 2c20 6270 6d3d 6375 7272 656e 745f  rd, bpm=current_
-00012900: 6368 6f72 642e 6270 6d29 0d0a 2020 2020  chord.bpm)..    
-00012910: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
-00012920: 6375 7272 656e 745f 6368 6f72 642c 2064  current_chord, d
-00012930: 7275 6d29 3a0d 0a20 2020 2020 2020 2063  rum):..        c
-00012940: 7572 7265 6e74 5f63 686f 7264 203d 2050  urrent_chord = P
-00012950: 2874 7261 636b 733d 5b63 7572 7265 6e74  (tracks=[current
-00012960: 5f63 686f 7264 2e6e 6f74 6573 5d2c 0d0a  _chord.notes],..
-00012970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012980: 2020 2020 2020 2020 2020 696e 7374 7275            instru
-00012990: 6d65 6e74 733d 5b63 7572 7265 6e74 5f63  ments=[current_c
-000129a0: 686f 7264 2e69 6e73 7472 756d 656e 745d  hord.instrument]
-000129b0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000129c0: 2020 2020 2020 2020 2020 2020 2062 706d               bpm
-000129d0: 3d62 706d 2c0d 0a20 2020 2020 2020 2020  =bpm,..         
-000129e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000129f0: 2073 7461 7274 5f74 696d 6573 3d5b 0d0a   start_times=[..
-00012a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012a10: 2020 2020 2020 2020 2020 2020 2020 6375                cu
-00012a20: 7272 656e 745f 6368 6f72 642e 6e6f 7465  rrent_chord.note
-00012a30: 732e 7374 6172 745f 7469 6d65 0d0a 2020  s.start_time..  
-00012a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012a50: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00012a60: 7461 7274 5f74 696d 6520 6973 204e 6f6e  tart_time is Non
-00012a70: 6520 656c 7365 2073 7461 7274 5f74 696d  e else start_tim
-00012a80: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-00012a90: 2020 2020 2020 2020 2020 2020 205d 2c0d               ],.
-00012aa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012ab0: 2020 2020 2020 2020 2020 2063 6861 6e6e             chann
-00012ac0: 656c 733d 5b39 5d29 0d0a 2020 2020 656c  els=[9])..    el
-00012ad0: 7365 3a0d 0a20 2020 2020 2020 2063 7572  se:..        cur
-00012ae0: 7265 6e74 5f63 686f 7264 203d 2063 6f70  rent_chord = cop
-00012af0: 7928 6375 7272 656e 745f 6368 6f72 6429  y(current_chord)
-00012b00: 0d0a 2020 2020 7265 7375 6c74 203d 2063  ..    result = c
-00012b10: 7572 7265 6e74 5f63 686f 7264 2e5f 5f64  urrent_chord.__d
-00012b20: 6963 745f 5f0d 0a20 2020 2072 6573 756c  ict__..    resul
-00012b30: 745b 2774 7261 636b 7327 5d20 3d20 5b69  t['tracks'] = [i
-00012b40: 2e5f 5f64 6963 745f 5f20 666f 7220 6920  .__dict__ for i 
-00012b50: 696e 2072 6573 756c 745b 2774 7261 636b  in result['track
-00012b60: 7327 5d5d 0d0a 2020 2020 666f 7220 6a20  s']]..    for j 
-00012b70: 696e 2072 6573 756c 745b 2774 7261 636b  in result['track
-00012b80: 7327 5d3a 0d0a 2020 2020 2020 2020 666f  s']:..        fo
-00012b90: 7220 692c 2065 6163 6820 696e 2065 6e75  r i, each in enu
-00012ba0: 6d65 7261 7465 286a 5b27 6e6f 7465 7327  merate(j['notes'
-00012bb0: 5d29 3a0d 0a20 2020 2020 2020 2020 2020  ]):..           
-00012bc0: 2063 7572 7265 6e74 5f64 6963 7420 3d20   current_dict = 
-00012bd0: 7b27 7479 7065 273a 2065 6163 682e 5f5f  {'type': each.__
-00012be0: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
-00012bf0: 7d0d 0a20 2020 2020 2020 2020 2020 2063  }..            c
-00012c00: 7572 7265 6e74 5f64 6963 742e 7570 6461  urrent_dict.upda
-00012c10: 7465 287b 0d0a 2020 2020 2020 2020 2020  te({..          
-00012c20: 2020 2020 2020 6b31 3a20 6b32 0d0a 2020        k1: k2..  
-00012c30: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00012c40: 7220 6b31 2c20 6b32 2069 6e20 6561 6368  r k1, k2 in each
-00012c50: 2e5f 5f64 6963 745f 5f2e 6974 656d 7328  .__dict__.items(
-00012c60: 2920 6966 206b 3120 6e6f 7420 696e 205b  ) if k1 not in [
-00012c70: 2764 6567 7265 6527 5d0d 0a20 2020 2020  'degree']..     
-00012c80: 2020 2020 2020 207d 290d 0a20 2020 2020         })..     
-00012c90: 2020 2020 2020 206a 5b27 6e6f 7465 7327         j['notes'
-00012ca0: 5d5b 695d 203d 2063 7572 7265 6e74 5f64  ][i] = current_d
-00012cb0: 6963 740d 0a20 2020 2020 2020 2066 6f72  ict..        for
-00012cc0: 2065 6163 6820 696e 206a 5b27 7069 7463   each in j['pitc
-00012cd0: 685f 6265 6e64 7327 5d3a 0d0a 2020 2020  h_bends']:..    
-00012ce0: 2020 2020 2020 2020 6375 7272 656e 745f          current_
-00012cf0: 6469 6374 2e75 7064 6174 6528 7b0d 0a20  dict.update({.. 
-00012d00: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-00012d10: 313a 206b 320d 0a20 2020 2020 2020 2020  1: k2..         
-00012d20: 2020 2020 2020 2066 6f72 206b 312c 206b         for k1, k
-00012d30: 3220 696e 2065 6163 682e 5f5f 6469 6374  2 in each.__dict
-00012d40: 5f5f 2e69 7465 6d73 2829 0d0a 2020 2020  __.items()..    
-00012d50: 2020 2020 2020 2020 2020 2020 6966 206b              if k
-00012d60: 3120 6e6f 7420 696e 205b 2764 6567 7265  1 not in ['degre
-00012d70: 6527 2c20 2776 6f6c 756d 6527 2c20 2764  e', 'volume', 'd
-00012d80: 7572 6174 696f 6e27 5d0d 0a20 2020 2020  uration']..     
-00012d90: 2020 2020 2020 207d 290d 0a20 2020 2020         })..     
-00012da0: 2020 2020 2020 2063 7572 7265 6e74 5f64         current_d
-00012db0: 6963 745b 276d 6f64 6527 5d20 3d20 2776  ict['mode'] = 'v
-00012dc0: 616c 7565 270d 0a20 2020 2020 2020 2066  alue'..        f
-00012dd0: 6f72 2065 6163 6820 696e 206a 5b27 7465  or each in j['te
-00012de0: 6d70 6f73 275d 3a0d 0a20 2020 2020 2020  mpos']:..       
-00012df0: 2020 2020 2063 7572 7265 6e74 5f64 6963       current_dic
-00012e00: 742e 7570 6461 7465 287b 0d0a 2020 2020  t.update({..    
-00012e10: 2020 2020 2020 2020 2020 2020 6b31 3a20              k1: 
-00012e20: 6b32 0d0a 2020 2020 2020 2020 2020 2020  k2..            
-00012e30: 2020 2020 666f 7220 6b31 2c20 6b32 2069      for k1, k2 i
-00012e40: 6e20 6561 6368 2e5f 5f64 6963 745f 5f2e  n each.__dict__.
-00012e50: 6974 656d 7328 290d 0a20 2020 2020 2020  items()..       
-00012e60: 2020 2020 2020 2020 2069 6620 6b31 206e           if k1 n
-00012e70: 6f74 2069 6e20 5b27 6465 6772 6565 272c  ot in ['degree',
-00012e80: 2027 766f 6c75 6d65 272c 2027 6475 7261   'volume', 'dura
-00012e90: 7469 6f6e 275d 0d0a 2020 2020 2020 2020  tion']..        
-00012ea0: 2020 2020 7d29 0d0a 2020 2020 2020 2020      })..        
-00012eb0: 6a5b 276f 7468 6572 5f6d 6573 7361 6765  j['other_message
-00012ec0: 7327 5d20 3d20 5b6b 2e5f 5f64 6963 745f  s'] = [k.__dict_
-00012ed0: 5f20 666f 7220 6b20 696e 206a 5b27 6f74  _ for k in j['ot
-00012ee0: 6865 725f 6d65 7373 6167 6573 275d 5d0d  her_messages']].
-00012ef0: 0a20 2020 2020 2020 2066 6f72 2069 2c20  .        for i, 
-00012f00: 6561 6368 2069 6e20 656e 756d 6572 6174  each in enumerat
-00012f10: 6528 6a5b 276e 6f74 6573 275d 293a 0d0a  e(j['notes']):..
-00012f20: 2020 2020 2020 2020 2020 2020 6561 6368              each
-00012f30: 5b27 696e 7465 7276 616c 275d 203d 206a  ['interval'] = j
-00012f40: 5b27 696e 7465 7276 616c 275d 5b69 5d0d  ['interval'][i].
-00012f50: 0a20 2020 2020 2020 2064 656c 206a 5b27  .        del j['
-00012f60: 696e 7465 7276 616c 275d 0d0a 2020 2020  interval']..    
-00012f70: 7265 7375 6c74 5b27 6f74 6865 725f 6d65  result['other_me
-00012f80: 7373 6167 6573 275d 203d 205b 692e 5f5f  ssages'] = [i.__
-00012f90: 6469 6374 5f5f 2066 6f72 2069 2069 6e20  dict__ for i in 
-00012fa0: 7265 7375 6c74 5b27 6f74 6865 725f 6d65  result['other_me
-00012fb0: 7373 6167 6573 275d 5d0d 0a20 2020 2072  ssages']]..    r
-00012fc0: 6573 756c 745b 2770 616e 275d 203d 205b  esult['pan'] = [
-00012fd0: 5b69 2e5f 5f64 6963 745f 5f20 666f 7220  [i.__dict__ for 
-00012fe0: 6920 696e 206a 5d20 666f 7220 6a20 696e  i in j] for j in
-00012ff0: 2072 6573 756c 745b 2770 616e 275d 5d0d   result['pan']].
-00013000: 0a20 2020 2072 6573 756c 745b 2776 6f6c  .    result['vol
-00013010: 756d 6527 5d20 3d20 5b5b 692e 5f5f 6469  ume'] = [[i.__di
-00013020: 6374 5f5f 2066 6f72 2069 2069 6e20 6a5d  ct__ for i in j]
-00013030: 2066 6f72 206a 2069 6e20 7265 7375 6c74   for j in result
-00013040: 5b27 766f 6c75 6d65 275d 5d0d 0a20 2020  ['volume']]..   
-00013050: 2066 6f72 2069 2069 6e20 7265 7375 6c74   for i in result
-00013060: 5b27 7061 6e27 5d3a 0d0a 2020 2020 2020  ['pan']:..      
-00013070: 2020 666f 7220 6a20 696e 2069 3a0d 0a20    for j in i:.. 
-00013080: 2020 2020 2020 2020 2020 206a 5b27 6d6f             j['mo
-00013090: 6465 275d 203d 2027 7661 6c75 6527 0d0a  de'] = 'value'..
-000130a0: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
-000130b0: 6a5b 2776 616c 7565 5f70 6572 6365 6e74  j['value_percent
-000130c0: 6167 6527 5d0d 0a20 2020 2066 6f72 2069  age']..    for i
-000130d0: 2069 6e20 7265 7375 6c74 5b27 766f 6c75   in result['volu
-000130e0: 6d65 275d 3a0d 0a20 2020 2020 2020 2066  me']:..        f
-000130f0: 6f72 206a 2069 6e20 693a 0d0a 2020 2020  or j in i:..    
-00013100: 2020 2020 2020 2020 6a5b 276d 6f64 6527          j['mode'
-00013110: 5d20 3d20 2776 616c 7565 270d 0a20 2020  ] = 'value'..   
-00013120: 2020 2020 2020 2020 2064 656c 206a 5b27           del j['
-00013130: 7661 6c75 655f 7065 7263 656e 7461 6765  value_percentage
-00013140: 275d 0d0a 2020 2020 6465 6c20 7265 7375  ']..    del resu
-00013150: 6c74 5b27 7472 6163 6b5f 6e75 6d62 6572  lt['track_number
-00013160: 275d 0d0a 2020 2020 7769 7468 206f 7065  ']..    with ope
-00013170: 6e28 6669 6c65 6e61 6d65 2c20 2777 272c  n(filename, 'w',
-00013180: 2065 6e63 6f64 696e 673d 2775 7466 2d38   encoding='utf-8
-00013190: 2729 2061 7320 663a 0d0a 2020 2020 2020  ') as f:..      
-000131a0: 2020 6a73 6f6e 2e64 756d 7028 7265 7375    json.dump(resu
-000131b0: 6c74 2c0d 0a20 2020 2020 2020 2020 2020  lt,..           
-000131c0: 2020 2020 2020 2066 2c0d 0a20 2020 2020         f,..     
-000131d0: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
-000131e0: 656e 743d 342c 0d0a 2020 2020 2020 2020  ent=4,..        
-000131f0: 2020 2020 2020 2020 2020 7365 7061 7261            separa
-00013200: 746f 7273 3d28 272c 272c 2027 3a20 2729  tors=(',', ': ')
-00013210: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00013220: 2020 2020 2065 6e73 7572 655f 6173 6369       ensure_asci
-00013230: 693d 4661 6c73 6529 0d0a 0d0a 0d0a 6465  i=False)......de
-00013240: 6620 6261 725f 746f 5f72 6561 6c5f 7469  f bar_to_real_ti
-00013250: 6d65 2862 6172 2c20 6270 6d2c 206d 6f64  me(bar, bpm, mod
-00013260: 653d 3029 3a0d 0a20 2020 2023 2063 6f6e  e=0):..    # con
-00013270: 7665 7274 2062 6172 2074 6f20 7469 6d65  vert bar to time
-00013280: 2069 6e20 6d73 0d0a 2020 2020 7265 7475   in ms..    retu
-00013290: 726e 2069 6e74 280d 0a20 2020 2020 2020  rn int(..       
-000132a0: 2028 3630 3030 3020 2f20 6270 6d29 202a   (60000 / bpm) *
-000132b0: 2028 6261 7220 2a20 3429 2920 6966 206d   (bar * 4)) if m
-000132c0: 6f64 6520 3d3d 2030 2065 6c73 6520 2836  ode == 0 else (6
-000132d0: 3030 3030 202f 2062 706d 2920 2a20 2862  0000 / bpm) * (b
-000132e0: 6172 202a 2034 290d 0a0d 0a0d 0a64 6566  ar * 4)......def
-000132f0: 2072 6561 6c5f 7469 6d65 5f74 6f5f 6261   real_time_to_ba
-00013300: 7228 7469 6d65 2c20 6270 6d29 3a0d 0a20  r(time, bpm):.. 
-00013310: 2020 2023 2063 6f6e 7665 7274 2074 696d     # convert tim
-00013320: 6520 696e 206d 7320 746f 2062 6172 0d0a  e in ms to bar..
-00013330: 2020 2020 7265 7475 726e 2028 7469 6d65      return (time
-00013340: 202f 2028 3630 3030 3020 2f20 6270 6d29   / (60000 / bpm)
-00013350: 2920 2f20 340d 0a0d 0a0d 0a43 203d 2074  ) / 4......C = t
-00013360: 7261 6e73 0d0a 4e20 3d20 746f 5f6e 6f74  rans..N = to_not
-00013370: 650d 0a53 203d 2074 6f5f 7363 616c 650d  e..S = to_scale.
-00013380: 0a50 203d 2070 6965 6365 0d0a 6172 7020  .P = piece..arp 
-00013390: 3d20 6172 7065 6767 696f 0d0a 0d0a 666f  = arpeggio....fo
-000133a0: 7220 6561 6368 2069 6e20 5b0d 0a20 2020  r each in [..   
-000133b0: 2020 2020 206e 6f74 652c 2063 686f 7264       note, chord
-000133c0: 2c20 7069 6563 652c 2074 7261 636b 2c20  , piece, track, 
-000133d0: 7363 616c 652c 2064 7275 6d2c 2072 6573  scale, drum, res
-000133e0: 742c 2074 656d 706f 2c20 7069 7463 685f  t, tempo, pitch_
-000133f0: 6265 6e64 2c20 7061 6e2c 0d0a 2020 2020  bend, pan,..    
-00013400: 2020 2020 766f 6c75 6d65 2c20 6576 656e      volume, even
-00013410: 742c 2062 6561 742c 2072 6573 745f 7379  t, beat, rest_sy
-00013420: 6d62 6f6c 2c20 636f 6e74 696e 7565 5f73  mbol, continue_s
-00013430: 796d 626f 6c2c 2072 6879 7468 6d0d 0a5d  ymbol, rhythm..]
-00013440: 3a0d 0a20 2020 2065 6163 682e 7265 7365  :..    each.rese
-00013450: 7420 3d20 7265 7365 740d 0a20 2020 2065  t = reset..    e
-00013460: 6163 682e 5f5f 6861 7368 5f5f 203d 206c  ach.__hash__ = l
-00013470: 616d 6264 6120 7365 6c66 3a20 6861 7368  ambda self: hash
-00013480: 2872 6570 7228 7365 6c66 2929 0d0a 2020  (repr(self))..  
-00013490: 2020 6561 6368 2e63 6f70 7920 3d20 6c61    each.copy = la
-000134a0: 6d62 6461 2073 656c 663a 2063 6f70 7928  mbda self: copy(
-000134b0: 7365 6c66 290d 0a20 2020 2069 6620 6561  self)..    if ea
-000134c0: 6368 2e5f 5f65 715f 5f20 3d3d 206f 626a  ch.__eq__ == obj
-000134d0: 6563 742e 5f5f 6571 5f5f 3a0d 0a20 2020  ect.__eq__:..   
-000134e0: 2020 2020 2065 6163 682e 5f5f 6571 5f5f       each.__eq__
-000134f0: 203d 206c 616d 6264 6120 7365 6c66 2c20   = lambda self, 
-00013500: 6f74 6865 723a 2074 7970 6528 6f74 6865  other: type(othe
-00013510: 7229 2069 7320 7479 7065 280d 0a20 2020  r) is type(..   
-00013520: 2020 2020 2020 2020 2073 656c 6629 2061           self) a
-00013530: 6e64 2073 656c 662e 5f5f 6469 6374 5f5f  nd self.__dict__
-00013540: 203d 3d20 6f74 6865 722e 5f5f 6469 6374   == other.__dict
-00013550: 5f5f 0d0a 0d0a 6966 205f 5f6e 616d 655f  __....if __name_
-00013560: 5f20 3d3d 2027 5f5f 6d61 696e 5f5f 2720  _ == '__main__' 
-00013570: 6f72 205f 5f6e 616d 655f 5f20 3d3d 2027  or __name__ == '
-00013580: 6d75 7369 6370 7927 3a0d 0a20 2020 2069  musicpy':..    i
-00013590: 6d70 6f72 7420 616c 676f 7269 7468 6d73  mport algorithms
-000135a0: 2061 7320 616c 670d 0a65 6c73 653a 0d0a   as alg..else:..
-000135b0: 2020 2020 6672 6f6d 202e 2069 6d70 6f72      from . impor
-000135c0: 7420 616c 676f 7269 7468 6d73 2061 7320  t algorithms as 
-000135d0: 616c 670d 0a                             alg..
+0000f500: 2020 2020 2020 6265 6174 5f6c 6973 745b        beat_list[
+0000f510: 2d31 5d2e 6475 7261 7469 6f6e 202b 3d20  -1].duration += 
+0000f520: 756e 6974 202a 2069 6e74 2872 6573 745f  unit * int(rest_
+0000f530: 6e75 6d29 0d0a 2020 2020 2020 2020 2020  num)..          
+0000f540: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+0000f550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f560: 2063 7572 7265 6e74 5f72 6573 745f 6475   current_rest_du
+0000f570: 7261 7469 6f6e 203d 2065 6163 6820 2d20  ration = each - 
+0000f580: 6375 7272 656e 745f 6475 7261 7469 6f6e  current_duration
+0000f590: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000f5a0: 2020 2020 2020 7265 7374 5f6e 756d 203d        rest_num =
+0000f5b0: 2063 7572 7265 6e74 5f72 6573 745f 6475   current_rest_du
+0000f5c0: 7261 7469 6f6e 202f 2f20 756e 6974 0d0a  ration // unit..
+0000f5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f5e0: 2020 2020 6375 7272 656e 745f 636f 6e74      current_cont
+0000f5f0: 696e 7565 5f64 7572 6174 696f 6e20 3d20  inue_duration = 
+0000f600: 6375 7272 656e 745f 6475 7261 7469 6f6e  current_duration
+0000f610: 202d 2075 6e69 740d 0a20 2020 2020 2020   - unit..       
+0000f620: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0000f630: 7469 6e75 655f 6e75 6d20 3d20 6375 7272  tinue_num = curr
+0000f640: 656e 745f 636f 6e74 696e 7565 5f64 7572  ent_continue_dur
+0000f650: 6174 696f 6e20 2f2f 2075 6e69 740d 0a20  ation // unit.. 
+0000f660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f670: 2020 2069 6620 6e6f 7420 6d65 7267 655f     if not merge_
+0000f680: 636f 6e74 696e 7565 3a0d 0a20 2020 2020  continue:..     
+0000f690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f6a0: 2020 2062 6561 745f 6c69 7374 2e65 7874     beat_list.ext
+0000f6b0: 656e 6428 5b0d 0a20 2020 2020 2020 2020  end([..         
+0000f6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f6d0: 2020 2063 6f6e 7469 6e75 655f 7379 6d62     continue_symb
+0000f6e0: 6f6c 2875 6e69 7429 0d0a 2020 2020 2020  ol(unit)..      
+0000f6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f700: 2020 2020 2020 666f 7220 6b20 696e 2072        for k in r
+0000f710: 616e 6765 2869 6e74 2863 6f6e 7469 6e75  ange(int(continu
+0000f720: 655f 6e75 6d29 290d 0a20 2020 2020 2020  e_num))..       
+0000f730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f740: 205d 290d 0a20 2020 2020 2020 2020 2020   ])..           
+0000f750: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+0000f760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f770: 2020 2020 2020 2020 6265 6174 5f6c 6973          beat_lis
+0000f780: 745b 2d31 5d2e 6475 7261 7469 6f6e 202b  t[-1].duration +
+0000f790: 3d20 756e 6974 202a 2069 6e74 2863 6f6e  = unit * int(con
+0000f7a0: 7469 6e75 655f 6e75 6d29 0d0a 2020 2020  tinue_num)..    
+0000f7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f7c0: 6265 6174 5f6c 6973 742e 6578 7465 6e64  beat_list.extend
+0000f7d0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+0000f7e0: 2020 2020 2020 2020 2020 205b 7265 7374             [rest
+0000f7f0: 5f73 796d 626f 6c28 756e 6974 2920 666f  _symbol(unit) fo
+0000f800: 7220 6b20 696e 2072 616e 6765 2869 6e74  r k in range(int
+0000f810: 2872 6573 745f 6e75 6d29 295d 290d 0a20  (rest_num))]).. 
+0000f820: 2020 2072 6573 756c 7420 3d20 7268 7974     result = rhyt
+0000f830: 686d 2862 6561 745f 6c69 7374 290d 0a20  hm(beat_list).. 
+0000f840: 2020 2069 6620 746f 7461 6c5f 6c65 6e67     if total_leng
+0000f850: 7468 2069 7320 6e6f 7420 4e6f 6e65 3a0d  th is not None:.
+0000f860: 0a20 2020 2020 2020 2063 7572 7265 6e74  .        current
+0000f870: 5f74 696d 655f 7369 676e 6174 7572 6520  _time_signature 
+0000f880: 3d20 4672 6163 7469 6f6e 2872 6573 756c  = Fraction(resul
+0000f890: 742e 6765 745f 746f 7461 6c5f 6475 7261  t.get_total_dura
+0000f8a0: 7469 6f6e 2829 202f 0d0a 2020 2020 2020  tion() /..      
+0000f8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f8d0: 2020 2020 746f 7461 6c5f 6c65 6e67 7468      total_length
+0000f8e0: 292e 6c69 6d69 745f 6465 6e6f 6d69 6e61  ).limit_denomina
+0000f8f0: 746f 7228 290d 0a20 2020 2020 2020 2069  tor()..        i
+0000f900: 6620 6375 7272 656e 745f 7469 6d65 5f73  f current_time_s
+0000f910: 6967 6e61 7475 7265 203d 3d20 313a 0d0a  ignature == 1:..
+0000f920: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+0000f930: 656e 745f 7469 6d65 5f73 6967 6e61 7475  ent_time_signatu
+0000f940: 7265 203d 205b 342c 2034 5d0d 0a20 2020  re = [4, 4]..   
+0000f950: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+0000f960: 2020 2020 2020 2020 6375 7272 656e 745f          current_
+0000f970: 7469 6d65 5f73 6967 6e61 7475 7265 203d  time_signature =
+0000f980: 205b 0d0a 2020 2020 2020 2020 2020 2020   [..            
+0000f990: 2020 2020 6375 7272 656e 745f 7469 6d65      current_time
+0000f9a0: 5f73 6967 6e61 7475 7265 2e6e 756d 6572  _signature.numer
+0000f9b0: 6174 6f72 2c0d 0a20 2020 2020 2020 2020  ator,..         
+0000f9c0: 2020 2020 2020 2063 7572 7265 6e74 5f74         current_t
+0000f9d0: 696d 655f 7369 676e 6174 7572 652e 6465  ime_signature.de
+0000f9e0: 6e6f 6d69 6e61 746f 720d 0a20 2020 2020  nominator..     
+0000f9f0: 2020 2020 2020 205d 0d0a 2020 2020 2020         ]..      
+0000fa00: 2020 7265 7375 6c74 2e74 696d 655f 7369    result.time_si
+0000fa10: 676e 6174 7572 6520 3d20 6375 7272 656e  gnature = curren
+0000fa20: 745f 7469 6d65 5f73 6967 6e61 7475 7265  t_time_signature
+0000fa30: 0d0a 2020 2020 6966 2072 656d 6f76 655f  ..    if remove_
+0000fa40: 656d 7074 795f 6265 6174 733a 0d0a 2020  empty_beats:..  
+0000fa50: 2020 2020 2020 7265 7375 6c74 203d 2072        result = r
+0000fa60: 6879 7468 6d28 5b69 2066 6f72 2069 2069  hythm([i for i i
+0000fa70: 6e20 7265 7375 6c74 2069 6620 692e 6475  n result if i.du
+0000fa80: 7261 7469 6f6e 2021 3d20 305d 2c0d 0a20  ration != 0],.. 
+0000fa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000faa0: 2020 2020 2020 2074 696d 655f 7369 676e         time_sign
+0000fab0: 6174 7572 653d 7265 7375 6c74 2e74 696d  ature=result.tim
+0000fac0: 655f 7369 676e 6174 7572 6529 0d0a 2020  e_signature)..  
+0000fad0: 2020 7265 7475 726e 2072 6573 756c 740d    return result.
+0000fae0: 0a0d 0a0d 0a64 6566 2073 746f 7061 6c6c  .....def stopall
+0000faf0: 2829 3a0d 0a20 2020 2070 7967 616d 652e  ():..    pygame.
+0000fb00: 6d69 7865 722e 7374 6f70 2829 0d0a 2020  mixer.stop()..  
+0000fb10: 2020 7079 6761 6d65 2e6d 6978 6572 2e6d    pygame.mixer.m
+0000fb20: 7573 6963 2e73 746f 7028 290d 0a0d 0a0d  usic.stop().....
+0000fb30: 0a64 6566 2072 6966 665f 746f 5f6d 6964  .def riff_to_mid
+0000fb40: 6928 7269 6666 5f6e 616d 652c 206e 616d  i(riff_name, nam
+0000fb50: 653d 2774 656d 702e 6d69 6427 2c20 6f75  e='temp.mid', ou
+0000fb60: 7470 7574 5f66 696c 653d 4661 6c73 6529  tput_file=False)
+0000fb70: 3a0d 0a20 2020 2069 6620 6973 696e 7374  :..    if isinst
+0000fb80: 616e 6365 2872 6966 665f 6e61 6d65 2c20  ance(riff_name, 
+0000fb90: 7374 7229 3a0d 0a20 2020 2020 2020 2063  str):..        c
+0000fba0: 7572 7265 6e74 5f66 696c 6520 3d20 6f70  urrent_file = op
+0000fbb0: 656e 2872 6966 665f 6e61 6d65 2c20 2772  en(riff_name, 'r
+0000fbc0: 6227 290d 0a20 2020 2020 2020 2072 6f6f  b')..        roo
+0000fbd0: 7420 3d20 6368 756e 6b2e 4368 756e 6b28  t = chunk.Chunk(
+0000fbe0: 6375 7272 656e 745f 6669 6c65 2c20 6269  current_file, bi
+0000fbf0: 6765 6e64 6961 6e3d 4661 6c73 6529 0d0a  gendian=False)..
+0000fc00: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+0000fc10: 2020 2072 6f6f 7420 3d20 6368 756e 6b2e     root = chunk.
+0000fc20: 4368 756e 6b28 7269 6666 5f6e 616d 652c  Chunk(riff_name,
+0000fc30: 2062 6967 656e 6469 616e 3d46 616c 7365   bigendian=False
+0000fc40: 290d 0a0d 0a20 2020 2063 6875 6e6b 5f69  )....    chunk_i
+0000fc50: 6420 3d20 726f 6f74 2e67 6574 6e61 6d65  d = root.getname
+0000fc60: 2829 0d0a 2020 2020 6966 2063 6875 6e6b  ()..    if chunk
+0000fc70: 5f69 6420 3d3d 2062 274d 5468 6427 3a0d  _id == b'MThd':.
+0000fc80: 0a20 2020 2020 2020 2072 6169 7365 2049  .        raise I
+0000fc90: 4f45 7272 6f72 2866 2741 6c72 6561 6479  OError(f'Already
+0000fca0: 2061 2053 7461 6e64 6172 6420 4d49 4449   a Standard MIDI
+0000fcb0: 2066 6f72 6d61 7420 6669 6c65 3a20 7b72   format file: {r
+0000fcc0: 6966 665f 6e61 6d65 7d27 290d 0a20 2020  iff_name}')..   
+0000fcd0: 2065 6c69 6620 6368 756e 6b5f 6964 2021   elif chunk_id !
+0000fce0: 3d20 6227 5249 4646 273a 0d0a 2020 2020  = b'RIFF':..    
+0000fcf0: 2020 2020 6368 756e 6b5f 7369 7a65 203d      chunk_size =
+0000fd00: 2072 6f6f 742e 6765 7473 697a 6528 290d   root.getsize().
+0000fd10: 0a20 2020 2020 2020 2063 6875 6e6b 5f72  .        chunk_r
+0000fd20: 6177 203d 2072 6f6f 742e 7265 6164 2863  aw = root.read(c
+0000fd30: 6875 6e6b 5f73 697a 6529 0d0a 2020 2020  hunk_size)..    
+0000fd40: 2020 2020 6966 2062 274d 5468 6427 2069      if b'MThd' i
+0000fd50: 6e20 6368 756e 6b5f 7261 773a 0d0a 2020  n chunk_raw:..  
+0000fd60: 2020 2020 2020 2020 2020 6d69 6469 5f72            midi_r
+0000fd70: 6177 203d 2063 6875 6e6b 5f72 6177 5b63  aw = chunk_raw[c
+0000fd80: 6875 6e6b 5f72 6177 2e69 6e64 6578 2862  hunk_raw.index(b
+0000fd90: 274d 5468 6427 293a 5d0d 0a20 2020 2020  'MThd'):]..     
+0000fda0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0000fdb0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+0000fdc0: 6545 7272 6f72 2827 4361 6e6e 6f74 2066  eError('Cannot f
+0000fdd0: 696e 6420 6865 6164 6572 2729 0d0a 2020  ind header')..  
+0000fde0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+0000fdf0: 2063 6875 6e6b 5f73 697a 6520 3d20 726f   chunk_size = ro
+0000fe00: 6f74 2e67 6574 7369 7a65 2829 0d0a 2020  ot.getsize()..  
+0000fe10: 2020 2020 2020 6368 756e 6b5f 7261 7720        chunk_raw 
+0000fe20: 3d20 726f 6f74 2e72 6561 6428 6368 756e  = root.read(chun
+0000fe30: 6b5f 7369 7a65 290d 0a20 2020 2020 2020  k_size)..       
+0000fe40: 2028 6864 725f 6964 2c20 6864 725f 6461   (hdr_id, hdr_da
+0000fe50: 7461 2c20 6d69 6469 5f73 697a 6529 203d  ta, midi_size) =
+0000fe60: 2073 7472 7563 742e 756e 7061 636b 2822   struct.unpack("
+0000fe70: 3c34 7334 734c 222c 0d0a 2020 2020 2020  <4s4sL",..      
+0000fe80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fe90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000feb0: 6368 756e 6b5f 7261 775b 303a 3132 5d29  chunk_raw[0:12])
+0000fec0: 0d0a 0d0a 2020 2020 2020 2020 6966 2068  ....        if h
+0000fed0: 6472 5f69 6420 213d 2062 2752 4d49 4427  dr_id != b'RMID'
+0000fee0: 206f 7220 6864 725f 6461 7461 2021 3d20   or hdr_data != 
+0000fef0: 6227 6461 7461 273a 0d0a 2020 2020 2020  b'data':..      
+0000ff00: 2020 2020 2020 7261 6973 6520 494f 4572        raise IOEr
+0000ff10: 726f 7228 6627 496e 7661 6c69 6420 6f72  ror(f'Invalid or
+0000ff20: 2075 6e73 7570 706f 7274 6564 2069 6e70   unsupported inp
+0000ff30: 7574 2066 696c 653a 207b 7269 6666 5f6e  ut file: {riff_n
+0000ff40: 616d 657d 2729 0d0a 2020 2020 2020 2020  ame}')..        
+0000ff50: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+0000ff60: 2020 6d69 6469 5f72 6177 203d 2063 6875    midi_raw = chu
+0000ff70: 6e6b 5f72 6177 5b31 323a 3132 202b 206d  nk_raw[12:12 + m
+0000ff80: 6964 695f 7369 7a65 5d0d 0a20 2020 2020  idi_size]..     
+0000ff90: 2020 2065 7863 6570 7420 496e 6465 7845     except IndexE
+0000ffa0: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
+0000ffb0: 2020 2072 6169 7365 2049 4f45 7272 6f72     raise IOError
+0000ffc0: 2866 2742 726f 6b65 6e20 696e 7075 7420  (f'Broken input 
+0000ffd0: 6669 6c65 3a20 7b72 6966 665f 6e61 6d65  file: {riff_name
+0000ffe0: 7d27 290d 0a0d 0a20 2020 2072 6f6f 742e  }')....    root.
+0000fff0: 636c 6f73 6528 290d 0a20 2020 2069 6620  close()..    if 
+00010000: 6973 696e 7374 616e 6365 2872 6966 665f  isinstance(riff_
+00010010: 6e61 6d65 2c20 7374 7229 3a0d 0a20 2020  name, str):..   
+00010020: 2020 2020 2063 7572 7265 6e74 5f66 696c       current_fil
+00010030: 652e 636c 6f73 6528 290d 0a0d 0a20 2020  e.close()....   
+00010040: 2069 6620 6f75 7470 7574 5f66 696c 653a   if output_file:
+00010050: 0d0a 2020 2020 2020 2020 7769 7468 206f  ..        with o
+00010060: 7065 6e28 6e61 6d65 2c20 2777 6227 2920  pen(name, 'wb') 
+00010070: 6173 2066 3a0d 0a20 2020 2020 2020 2020  as f:..         
+00010080: 2020 2066 2e77 7269 7465 286d 6964 695f     f.write(midi_
+00010090: 7261 7729 0d0a 2020 2020 656c 7365 3a0d  raw)..    else:.
+000100a0: 0a20 2020 2020 2020 2072 6573 756c 7420  .        result 
+000100b0: 3d20 4279 7465 7349 4f28 290d 0a20 2020  = BytesIO()..   
+000100c0: 2020 2020 2072 6573 756c 742e 7772 6974       result.writ
+000100d0: 6528 6d69 6469 5f72 6177 290d 0a20 2020  e(midi_raw)..   
+000100e0: 2020 2020 2072 6573 756c 742e 7365 656b       result.seek
+000100f0: 2830 290d 0a20 2020 2020 2020 2072 6574  (0)..        ret
+00010100: 7572 6e20 7265 7375 6c74 0d0a 0d0a 0d0a  urn result......
+00010110: 6465 6620 7772 6974 655f 6461 7461 286f  def write_data(o
+00010120: 626a 2c20 6e61 6d65 3d27 756e 7469 746c  bj, name='untitl
+00010130: 6564 2e6d 7062 2729 3a0d 0a20 2020 2069  ed.mpb'):..    i
+00010140: 6d70 6f72 7420 7069 636b 6c65 0d0a 2020  mport pickle..  
+00010150: 2020 7769 7468 206f 7065 6e28 6e61 6d65    with open(name
+00010160: 2c20 2777 6227 2920 6173 2066 3a0d 0a20  , 'wb') as f:.. 
+00010170: 2020 2020 2020 2070 6963 6b6c 652e 6475         pickle.du
+00010180: 6d70 286f 626a 2c20 6629 0d0a 0d0a 0d0a  mp(obj, f)......
+00010190: 6465 6620 6c6f 6164 5f64 6174 6128 6e61  def load_data(na
+000101a0: 6d65 293a 0d0a 2020 2020 696d 706f 7274  me):..    import
+000101b0: 2070 6963 6b6c 650d 0a20 2020 2077 6974   pickle..    wit
+000101c0: 6820 6f70 656e 286e 616d 652c 2027 7262  h open(name, 'rb
+000101d0: 2729 2061 7320 663a 0d0a 2020 2020 2020  ') as f:..      
+000101e0: 2020 7265 7375 6c74 203d 2070 6963 6b6c    result = pickl
+000101f0: 652e 6c6f 6164 2866 290d 0a20 2020 2072  e.load(f)..    r
+00010200: 6574 7572 6e20 7265 7375 6c74 0d0a 0d0a  eturn result....
+00010210: 0d0a 6465 6620 646f 7474 6564 2864 7572  ..def dotted(dur
+00010220: 6174 696f 6e2c 206e 756d 3d31 293a 0d0a  ation, num=1):..
+00010230: 2020 2020 7265 7475 726e 2064 7572 6174      return durat
+00010240: 696f 6e20 2a20 7375 6d28 5b28 3120 2f20  ion * sum([(1 / 
+00010250: 3229 2a2a 6920 666f 7220 6920 696e 2072  2)**i for i in r
+00010260: 616e 6765 286e 756d 202b 2031 295d 290d  ange(num + 1)]).
+00010270: 0a0d 0a0d 0a64 6566 2070 6172 7365 5f64  .....def parse_d
+00010280: 6f74 7465 6428 7465 7874 2c20 6765 745f  otted(text, get_
+00010290: 6672 6163 7469 6f6e 3d46 616c 7365 293a  fraction=False):
+000102a0: 0d0a 2020 2020 6c65 6e67 7468 203d 206c  ..    length = l
+000102b0: 656e 2874 6578 7429 0d0a 2020 2020 646f  en(text)..    do
+000102c0: 7474 6564 5f6e 756d 203d 2030 0d0a 2020  tted_num = 0..  
+000102d0: 2020 696e 6420 3d20 300d 0a20 2020 2066    ind = 0..    f
+000102e0: 6f72 2069 2069 6e20 7261 6e67 6528 6c65  or i in range(le
+000102f0: 6e67 7468 202d 2031 2c20 2d31 2c20 2d31  ngth - 1, -1, -1
+00010300: 293a 0d0a 2020 2020 2020 2020 6966 2074  ):..        if t
+00010310: 6578 745b 695d 2021 3d20 272e 273a 0d0a  ext[i] != '.':..
+00010320: 2020 2020 2020 2020 2020 2020 696e 6420              ind 
+00010330: 3d20 690d 0a20 2020 2020 2020 2020 2020  = i..           
+00010340: 2062 7265 616b 0d0a 2020 2020 2020 2020   break..        
+00010350: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00010360: 2020 2064 6f74 7465 645f 6e75 6d20 2b3d     dotted_num +=
+00010370: 2031 0d0a 2020 2020 6475 7261 7469 6f6e   1..    duration
+00010380: 203d 2070 6172 7365 5f6e 756d 2874 6578   = parse_num(tex
+00010390: 745b 3a69 6e64 202b 2031 5d2c 2067 6574  t[:ind + 1], get
+000103a0: 5f66 7261 6374 696f 6e3d 6765 745f 6672  _fraction=get_fr
+000103b0: 6163 7469 6f6e 290d 0a20 2020 2063 7572  action)..    cur
+000103c0: 7265 6e74 5f64 7572 6174 696f 6e20 3d20  rent_duration = 
+000103d0: 6d70 2e62 6561 7428 6475 7261 7469 6f6e  mp.beat(duration
+000103e0: 2c20 646f 7474 6564 5f6e 756d 292e 6765  , dotted_num).ge
+000103f0: 745f 6475 7261 7469 6f6e 2829 0d0a 2020  t_duration()..  
+00010400: 2020 7265 7475 726e 2063 7572 7265 6e74    return current
+00010410: 5f64 7572 6174 696f 6e0d 0a0d 0a0d 0a64  _duration......d
+00010420: 6566 2070 6172 7365 5f6e 756d 2864 7572  ef parse_num(dur
+00010430: 6174 696f 6e2c 2067 6574 5f66 7261 6374  ation, get_fract
+00010440: 696f 6e3d 4661 6c73 6529 3a0d 0a20 2020  ion=False):..   
+00010450: 2069 6620 272f 2720 696e 2064 7572 6174   if '/' in durat
+00010460: 696f 6e3a 0d0a 2020 2020 2020 2020 6e75  ion:..        nu
+00010470: 6d65 7261 746f 722c 2064 656e 6f6d 696e  merator, denomin
+00010480: 6174 6f72 203d 2064 7572 6174 696f 6e2e  ator = duration.
+00010490: 7370 6c69 7428 272f 2729 0d0a 2020 2020  split('/')..    
+000104a0: 2020 2020 6e75 6d65 7261 746f 7220 3d20      numerator = 
+000104b0: 696e 7428 6e75 6d65 7261 746f 7229 2069  int(numerator) i
+000104c0: 6620 6e75 6d65 7261 746f 722e 6973 6469  f numerator.isdi
+000104d0: 6769 7428 2920 656c 7365 2066 6c6f 6174  git() else float
+000104e0: 286e 756d 6572 6174 6f72 290d 0a20 2020  (numerator)..   
+000104f0: 2020 2020 2064 656e 6f6d 696e 6174 6f72       denominator
+00010500: 203d 2069 6e74 2864 656e 6f6d 696e 6174   = int(denominat
+00010510: 6f72 2920 6966 2064 656e 6f6d 696e 6174  or) if denominat
+00010520: 6f72 2e69 7364 6967 6974 2829 2065 6c73  or.isdigit() els
+00010530: 6520 666c 6f61 7428 0d0a 2020 2020 2020  e float(..      
+00010540: 2020 2020 2020 6465 6e6f 6d69 6e61 746f        denominato
+00010550: 7229 0d0a 2020 2020 2020 2020 6966 2067  r)..        if g
+00010560: 6574 5f66 7261 6374 696f 6e3a 0d0a 2020  et_fraction:..  
+00010570: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00010580: 2028 6973 696e 7374 616e 6365 286e 756d   (isinstance(num
+00010590: 6572 6174 6f72 2c20 696e 7429 0d0a 2020  erator, int)..  
+000105a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000105b0: 2020 616e 6420 6973 696e 7374 616e 6365    and isinstance
+000105c0: 2864 656e 6f6d 696e 6174 6f72 2c20 696e  (denominator, in
+000105d0: 7429 293a 0d0a 2020 2020 2020 2020 2020  t)):..          
+000105e0: 2020 2020 2020 6475 7261 7469 6f6e 203d        duration =
+000105f0: 2046 7261 6374 696f 6e28 6e75 6d65 7261   Fraction(numera
+00010600: 746f 7220 2f0d 0a20 2020 2020 2020 2020  tor /..         
+00010610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010620: 2020 2020 2020 2020 2020 2064 656e 6f6d             denom
+00010630: 696e 6174 6f72 292e 6c69 6d69 745f 6465  inator).limit_de
+00010640: 6e6f 6d69 6e61 746f 7228 290d 0a20 2020  nominator()..   
+00010650: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+00010660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010670: 6475 7261 7469 6f6e 203d 2046 7261 6374  duration = Fract
+00010680: 696f 6e28 6e75 6d65 7261 746f 722c 2064  ion(numerator, d
+00010690: 656e 6f6d 696e 6174 6f72 290d 0a20 2020  enominator)..   
+000106a0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+000106b0: 2020 2020 2020 2020 6475 7261 7469 6f6e          duration
+000106c0: 203d 206e 756d 6572 6174 6f72 202f 2064   = numerator / d
+000106d0: 656e 6f6d 696e 6174 6f72 0d0a 2020 2020  enominator..    
+000106e0: 656c 7365 3a0d 0a20 2020 2020 2020 2064  else:..        d
+000106f0: 7572 6174 696f 6e20 3d20 696e 7428 6475  uration = int(du
+00010700: 7261 7469 6f6e 2920 6966 2064 7572 6174  ration) if durat
+00010710: 696f 6e2e 6973 6469 6769 7428 2920 656c  ion.isdigit() el
+00010720: 7365 2066 6c6f 6174 2864 7572 6174 696f  se float(duratio
+00010730: 6e29 0d0a 2020 2020 2020 2020 6966 2067  n)..        if g
+00010740: 6574 5f66 7261 6374 696f 6e3a 0d0a 2020  et_fraction:..  
+00010750: 2020 2020 2020 2020 2020 6475 7261 7469            durati
+00010760: 6f6e 203d 2046 7261 6374 696f 6e28 6475  on = Fraction(du
+00010770: 7261 7469 6f6e 292e 6c69 6d69 745f 6465  ration).limit_de
+00010780: 6e6f 6d69 6e61 746f 7228 290d 0a20 2020  nominator()..   
+00010790: 2072 6574 7572 6e20 6475 7261 7469 6f6e   return duration
+000107a0: 0d0a 0d0a 0d0a 6465 6620 7265 6c61 7469  ......def relati
+000107b0: 7665 5f6e 6f74 6528 612c 2062 293a 0d0a  ve_note(a, b):..
+000107c0: 2020 2020 2727 270d 0a20 2020 2072 6574      '''..    ret
+000107d0: 7572 6e20 7468 6520 6e6f 7461 7469 6f6e  urn the notation
+000107e0: 206f 6620 6e6f 7465 2061 2066 726f 6d20   of note a from 
+000107f0: 6e6f 7465 2062 2077 6974 6820 6163 6369  note b with acci
+00010800: 6465 6e74 616c 730d 0a20 2020 2028 686f  dentals..    (ho
+00010810: 7720 6e6f 7465 2062 2061 6464 7320 6163  w note b adds ac
+00010820: 6369 6465 6e74 616c 7320 746f 206d 6174  cidentals to mat
+00010830: 6368 2074 6865 2073 616d 6520 7069 7463  ch the same pitc
+00010840: 6820 6173 206e 6f74 6520 6129 2c0d 0a20  h as note a),.. 
+00010850: 2020 2077 6f72 6b73 2066 6f72 2074 6865     works for the
+00010860: 2061 6363 6964 656e 7461 6c73 2069 6e63   accidentals inc
+00010870: 6c75 6469 6e67 2073 6861 7270 2c20 666c  luding sharp, fl
+00010880: 6174 2c20 6e61 7475 7261 6c2c 0d0a 2020  at, natural,..  
+00010890: 2020 646f 7562 6c65 2073 6861 7270 2c20    double sharp, 
+000108a0: 646f 7562 6c65 2066 6c61 740d 0a20 2020  double flat..   
+000108b0: 2028 612c 2062 2061 7265 2073 7472 696e   (a, b are strin
+000108c0: 6773 2074 6861 7420 7265 7072 6573 656e  gs that represen
+000108d0: 7473 2061 206e 6f74 652c 2063 6f75 6c64  ts a note, could
+000108e0: 2062 6520 7769 7468 2061 6363 6964 656e   be with acciden
+000108f0: 7461 6c73 290d 0a20 2020 2027 2727 0d0a  tals)..    '''..
+00010900: 2020 2020 6c65 6e5f 612c 206c 656e 5f62      len_a, len_b
+00010910: 203d 206c 656e 2861 292c 206c 656e 2862   = len(a), len(b
+00010920: 290d 0a20 2020 2061 5f6e 616d 652c 2062  )..    a_name, b
+00010930: 5f6e 616d 652c 2061 6363 6964 656e 7461  _name, accidenta
+00010940: 6c5f 612c 2061 6363 6964 656e 7461 6c5f  l_a, accidental_
+00010950: 6220 3d20 615b 305d 2c20 625b 305d 2c20  b = a[0], b[0], 
+00010960: 615b 313a 5d2c 2062 5b31 3a5d 0d0a 2020  a[1:], b[1:]..  
+00010970: 2020 6966 206c 656e 5f61 203d 3d20 3120    if len_a == 1 
+00010980: 616e 6420 6c65 6e5f 6220 3e20 3120 616e  and len_b > 1 an
+00010990: 6420 615f 6e61 6d65 203d 3d20 625f 6e61  d a_name == b_na
+000109a0: 6d65 3a0d 0a20 2020 2020 2020 2072 6574  me:..        ret
+000109b0: 7572 6e20 6120 2b20 27e2 99ae 270d 0a20  urn a + '...'.. 
+000109c0: 2020 2069 6620 6120 696e 2064 6174 6162     if a in datab
+000109d0: 6173 652e 7374 616e 6461 7264 3a0d 0a20  ase.standard:.. 
+000109e0: 2020 2020 2020 2061 203d 206e 6f74 6528         a = note(
+000109f0: 612c 2035 290d 0a20 2020 2065 6c73 653a  a, 5)..    else:
+00010a00: 0d0a 2020 2020 2020 2020 6120 3d20 6e6f  ..        a = no
+00010a10: 7465 2861 5f6e 616d 652c 2035 290d 0a20  te(a_name, 5).. 
+00010a20: 2020 2020 2020 2069 6620 6163 6369 6465         if accide
+00010a30: 6e74 616c 5f61 203d 3d20 2762 273a 0d0a  ntal_a == 'b':..
+00010a40: 2020 2020 2020 2020 2020 2020 6120 3d20              a = 
+00010a50: 612e 646f 776e 2829 0d0a 2020 2020 2020  a.down()..      
+00010a60: 2020 656c 6966 2061 6363 6964 656e 7461    elif accidenta
+00010a70: 6c5f 6120 3d3d 2027 6262 273a 0d0a 2020  l_a == 'bb':..  
+00010a80: 2020 2020 2020 2020 2020 6120 3d20 612e            a = a.
+00010a90: 646f 776e 2832 290d 0a20 2020 2020 2020  down(2)..       
+00010aa0: 2065 6c69 6620 6163 6369 6465 6e74 616c   elif accidental
+00010ab0: 5f61 203d 3d20 2723 273a 0d0a 2020 2020  _a == '#':..    
+00010ac0: 2020 2020 2020 2020 6120 3d20 612e 7570          a = a.up
+00010ad0: 2829 0d0a 2020 2020 2020 2020 656c 6966  ()..        elif
+00010ae0: 2061 6363 6964 656e 7461 6c5f 6120 3d3d   accidental_a ==
+00010af0: 2027 7827 3a0d 0a20 2020 2020 2020 2020   'x':..         
+00010b00: 2020 2061 203d 2061 2e75 7028 3229 0d0a     a = a.up(2)..
+00010b10: 2020 2020 2020 2020 656c 6966 2061 6363          elif acc
+00010b20: 6964 656e 7461 6c5f 6120 3d3d 2027 e299  idental_a == '..
+00010b30: ae27 3a0d 0a20 2020 2020 2020 2020 2020  .':..           
+00010b40: 2070 6173 730d 0a20 2020 2020 2020 2065   pass..        e
+00010b50: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00010b60: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00010b70: 6f72 2866 2775 6e72 6563 6f67 6e69 7a61  or(f'unrecogniza
+00010b80: 626c 6520 6163 6369 6465 6e74 616c 7320  ble accidentals 
+00010b90: 7b61 6363 6964 656e 7461 6c5f 617d 2729  {accidental_a}')
+00010ba0: 0d0a 2020 2020 6966 2062 2069 6e20 6461  ..    if b in da
+00010bb0: 7461 6261 7365 2e73 7461 6e64 6172 643a  tabase.standard:
+00010bc0: 0d0a 2020 2020 2020 2020 6220 3d20 6e6f  ..        b = no
+00010bd0: 7465 2862 2c20 3529 0d0a 2020 2020 656c  te(b, 5)..    el
+00010be0: 7365 3a0d 0a20 2020 2020 2020 2062 203d  se:..        b =
+00010bf0: 206e 6f74 6528 625f 6e61 6d65 2c20 3529   note(b_name, 5)
+00010c00: 0d0a 2020 2020 2020 2020 6966 2061 6363  ..        if acc
+00010c10: 6964 656e 7461 6c5f 6220 3d3d 2027 6227  idental_b == 'b'
+00010c20: 3a0d 0a20 2020 2020 2020 2020 2020 2062  :..            b
+00010c30: 203d 2062 2e64 6f77 6e28 290d 0a20 2020   = b.down()..   
+00010c40: 2020 2020 2065 6c69 6620 6163 6369 6465       elif accide
+00010c50: 6e74 616c 5f62 203d 3d20 2762 6227 3a0d  ntal_b == 'bb':.
+00010c60: 0a20 2020 2020 2020 2020 2020 2062 203d  .            b =
+00010c70: 2062 2e64 6f77 6e28 3229 0d0a 2020 2020   b.down(2)..    
+00010c80: 2020 2020 656c 6966 2061 6363 6964 656e      elif acciden
+00010c90: 7461 6c5f 6220 3d3d 2027 2327 3a0d 0a20  tal_b == '#':.. 
+00010ca0: 2020 2020 2020 2020 2020 2062 203d 2062             b = b
+00010cb0: 2e75 7028 290d 0a20 2020 2020 2020 2065  .up()..        e
+00010cc0: 6c69 6620 6163 6369 6465 6e74 616c 5f62  lif accidental_b
+00010cd0: 203d 3d20 2778 273a 0d0a 2020 2020 2020   == 'x':..      
+00010ce0: 2020 2020 2020 6220 3d20 622e 7570 2832        b = b.up(2
+00010cf0: 290d 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
+00010d00: 6163 6369 6465 6e74 616c 5f62 203d 3d20  accidental_b == 
+00010d10: 27e2 99ae 273a 0d0a 2020 2020 2020 2020  '...':..        
+00010d20: 2020 2020 7061 7373 0d0a 2020 2020 2020      pass..      
+00010d30: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00010d40: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00010d50: 4572 726f 7228 6627 756e 7265 636f 676e  Error(f'unrecogn
+00010d60: 697a 6162 6c65 2061 6363 6964 656e 7461  izable accidenta
+00010d70: 6c73 207b 6163 6369 6465 6e74 616c 5f62  ls {accidental_b
+00010d80: 7d27 290d 0a20 2020 2064 6567 7265 6531  }')..    degree1
+00010d90: 2c20 6465 6772 6565 3220 3d20 612e 6465  , degree2 = a.de
+00010da0: 6772 6565 2c20 622e 6465 6772 6565 0d0a  gree, b.degree..
+00010db0: 2020 2020 6469 6666 312c 2064 6966 6632      diff1, diff2
+00010dc0: 203d 2064 6567 7265 6531 202d 2064 6567   = degree1 - deg
+00010dd0: 7265 6532 2c20 2864 6567 7265 6531 202d  ree2, (degree1 -
+00010de0: 2064 6567 7265 6532 202d 0d0a 2020 2020   degree2 -..    
+00010df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e10: 2020 2031 3220 6966 2064 6567 7265 6531     12 if degree1
+00010e20: 203e 3d20 6465 6772 6565 3220 656c 7365   >= degree2 else
+00010e30: 2064 6567 7265 6531 202b 0d0a 2020 2020   degree1 +..    
+00010e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e60: 2020 2031 3220 2d20 6465 6772 6565 3229     12 - degree2)
+00010e70: 0d0a 2020 2020 6966 2061 6273 2864 6966  ..    if abs(dif
+00010e80: 6631 2920 3c20 6162 7328 6469 6666 3229  f1) < abs(diff2)
+00010e90: 3a0d 0a20 2020 2020 2020 2064 6966 6620  :..        diff 
+00010ea0: 3d20 6469 6666 310d 0a20 2020 2065 6c73  = diff1..    els
+00010eb0: 653a 0d0a 2020 2020 2020 2020 6469 6666  e:..        diff
+00010ec0: 203d 2064 6966 6632 0d0a 2020 2020 6966   = diff2..    if
+00010ed0: 2064 6966 6620 3d3d 2030 3a0d 0a20 2020   diff == 0:..   
+00010ee0: 2020 2020 2072 6574 7572 6e20 622e 6e61       return b.na
+00010ef0: 6d65 0d0a 2020 2020 6966 2064 6966 6620  me..    if diff 
+00010f00: 3d3d 2031 3a0d 0a20 2020 2020 2020 2072  == 1:..        r
+00010f10: 6574 7572 6e20 622e 6e61 6d65 202b 2027  eturn b.name + '
+00010f20: 2327 0d0a 2020 2020 6966 2064 6966 6620  #'..    if diff 
+00010f30: 3d3d 2032 3a0d 0a20 2020 2020 2020 2072  == 2:..        r
+00010f40: 6574 7572 6e20 622e 6e61 6d65 202b 2027  eturn b.name + '
+00010f50: 7827 0d0a 2020 2020 6966 2064 6966 6620  x'..    if diff 
+00010f60: 3d3d 202d 313a 0d0a 2020 2020 2020 2020  == -1:..        
+00010f70: 7265 7475 726e 2062 2e6e 616d 6520 2b20  return b.name + 
+00010f80: 2762 270d 0a20 2020 2069 6620 6469 6666  'b'..    if diff
+00010f90: 203d 3d20 2d32 3a0d 0a20 2020 2020 2020   == -2:..       
+00010fa0: 2072 6574 7572 6e20 622e 6e61 6d65 202b   return b.name +
+00010fb0: 2027 6262 270d 0a0d 0a0d 0a64 6566 2067   'bb'......def g
+00010fc0: 6574 5f6e 6f74 655f 6e61 6d65 2863 7572  et_note_name(cur
+00010fd0: 7265 6e74 5f6e 6f74 6529 3a0d 0a20 2020  rent_note):..   
+00010fe0: 2069 6620 616e 7928 692e 6973 6469 6769   if any(i.isdigi
+00010ff0: 7428 2920 666f 7220 6920 696e 2063 7572  t() for i in cur
+00011000: 7265 6e74 5f6e 6f74 6529 3a0d 0a20 2020  rent_note):..   
+00011010: 2020 2020 2063 7572 7265 6e74 5f6e 6f74       current_not
+00011020: 6520 3d20 2727 2e6a 6f69 6e28 5b69 2066  e = ''.join([i f
+00011030: 6f72 2069 2069 6e20 6375 7272 656e 745f  or i in current_
+00011040: 6e6f 7465 2069 6620 6e6f 7420 692e 6973  note if not i.is
+00011050: 6469 6769 7428 295d 290d 0a20 2020 2072  digit()])..    r
+00011060: 6574 7572 6e20 6375 7272 656e 745f 6e6f  eturn current_no
+00011070: 7465 0d0a 0d0a 0d0a 6465 6620 6765 745f  te......def get_
+00011080: 6e6f 7465 5f6e 756d 2863 7572 7265 6e74  note_num(current
+00011090: 5f6e 6f74 6529 3a0d 0a20 2020 2072 6573  _note):..    res
+000110a0: 756c 7420 3d20 2727 2e6a 6f69 6e28 5b69  ult = ''.join([i
+000110b0: 2066 6f72 2069 2069 6e20 6375 7272 656e   for i in curren
+000110c0: 745f 6e6f 7465 2069 6620 692e 6973 6469  t_note if i.isdi
+000110d0: 6769 7428 295d 290d 0a20 2020 2072 6574  git()])..    ret
+000110e0: 7572 6e20 696e 7428 7265 7375 6c74 2920  urn int(result) 
+000110f0: 6966 2072 6573 756c 7420 656c 7365 204e  if result else N
+00011100: 6f6e 650d 0a0d 0a0d 0a64 6566 2073 7461  one......def sta
+00011110: 6e64 6172 6469 7a65 5f6e 6f74 6528 6375  ndardize_note(cu
+00011120: 7272 656e 745f 6e6f 7465 293a 0d0a 2020  rrent_note):..  
+00011130: 2020 6375 7272 656e 745f 6e6f 7465 203d    current_note =
+00011140: 2067 6574 5f6e 6f74 655f 6e61 6d65 2863   get_note_name(c
+00011150: 7572 7265 6e74 5f6e 6f74 6529 0d0a 2020  urrent_note)..  
+00011160: 2020 6966 2063 7572 7265 6e74 5f6e 6f74    if current_not
+00011170: 6520 696e 2064 6174 6162 6173 652e 7374  e in database.st
+00011180: 616e 6461 7264 323a 0d0a 2020 2020 2020  andard2:..      
+00011190: 2020 7265 7475 726e 2063 7572 7265 6e74    return current
+000111a0: 5f6e 6f74 650d 0a20 2020 2065 6c69 6620  _note..    elif 
+000111b0: 6375 7272 656e 745f 6e6f 7465 2069 6e20  current_note in 
+000111c0: 6461 7461 6261 7365 2e73 7461 6e64 6172  database.standar
+000111d0: 645f 6469 6374 3a0d 0a20 2020 2020 2020  d_dict:..       
+000111e0: 2072 6574 7572 6e20 6461 7461 6261 7365   return database
+000111f0: 2e73 7461 6e64 6172 645f 6469 6374 5b63  .standard_dict[c
+00011200: 7572 7265 6e74 5f6e 6f74 655d 0d0a 2020  urrent_note]..  
+00011210: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00011220: 2069 6620 6375 7272 656e 745f 6e6f 7465   if current_note
+00011230: 2e65 6e64 7377 6974 6828 2762 6227 293a  .endswith('bb'):
+00011240: 0d0a 2020 2020 2020 2020 2020 2020 6375  ..            cu
+00011250: 7272 656e 745f 6e61 6d65 203d 2063 7572  rrent_name = cur
+00011260: 7265 6e74 5f6e 6f74 655b 3a2d 325d 0d0a  rent_note[:-2]..
+00011270: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+00011280: 6c74 203d 2028 4e28 7374 616e 6461 7264  lt = (N(standard
+00011290: 697a 655f 6e6f 7465 2863 7572 7265 6e74  ize_note(current
+000112a0: 5f6e 616d 6529 2920 2d20 3229 2e6e 616d  _name)) - 2).nam
+000112b0: 650d 0a20 2020 2020 2020 2065 6c69 6620  e..        elif 
+000112c0: 6375 7272 656e 745f 6e6f 7465 2e65 6e64  current_note.end
+000112d0: 7377 6974 6828 2778 2729 3a0d 0a20 2020  swith('x'):..   
+000112e0: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+000112f0: 5f6e 616d 6520 3d20 6375 7272 656e 745f  _name = current_
+00011300: 6e6f 7465 5b3a 2d31 5d0d 0a20 2020 2020  note[:-1]..     
+00011310: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+00011320: 284e 2873 7461 6e64 6172 6469 7a65 5f6e  (N(standardize_n
+00011330: 6f74 6528 6375 7272 656e 745f 6e61 6d65  ote(current_name
+00011340: 2929 202b 2032 292e 6e61 6d65 0d0a 2020  )) + 2).name..  
+00011350: 2020 2020 2020 656c 6966 2063 7572 7265        elif curre
+00011360: 6e74 5f6e 6f74 652e 656e 6473 7769 7468  nt_note.endswith
+00011370: 2827 e299 ae27 293a 0d0a 2020 2020 2020  ('...'):..      
+00011380: 2020 2020 2020 7265 7375 6c74 203d 2063        result = c
+00011390: 7572 7265 6e74 5f6e 6f74 655b 3a2d 315d  urrent_note[:-1]
+000113a0: 0d0a 2020 2020 2020 2020 656c 6966 2063  ..        elif c
+000113b0: 7572 7265 6e74 5f6e 6f74 652e 656e 6473  urrent_note.ends
+000113c0: 7769 7468 2827 2327 293a 0d0a 2020 2020  with('#'):..    
+000113d0: 2020 2020 2020 2020 6375 7272 656e 745f          current_
+000113e0: 6e61 6d65 203d 2063 7572 7265 6e74 5f6e  name = current_n
+000113f0: 6f74 655b 3a2d 315d 0d0a 2020 2020 2020  ote[:-1]..      
+00011400: 2020 2020 2020 7265 7375 6c74 203d 2028        result = (
+00011410: 4e28 7374 616e 6461 7264 697a 655f 6e6f  N(standardize_no
+00011420: 7465 2863 7572 7265 6e74 5f6e 616d 6529  te(current_name)
+00011430: 2920 2b20 3129 2e6e 616d 650d 0a20 2020  ) + 1).name..   
+00011440: 2020 2020 2065 6c69 6620 6375 7272 656e       elif curren
+00011450: 745f 6e6f 7465 2e65 6e64 7377 6974 6828  t_note.endswith(
+00011460: 2762 2729 3a0d 0a20 2020 2020 2020 2020  'b'):..         
+00011470: 2020 2063 7572 7265 6e74 5f6e 616d 6520     current_name 
+00011480: 3d20 6375 7272 656e 745f 6e6f 7465 5b3a  = current_note[:
+00011490: 2d31 5d0d 0a20 2020 2020 2020 2020 2020  -1]..           
+000114a0: 2072 6573 756c 7420 3d20 284e 2873 7461   result = (N(sta
+000114b0: 6e64 6172 6469 7a65 5f6e 6f74 6528 6375  ndardize_note(cu
+000114c0: 7272 656e 745f 6e61 6d65 2929 202d 2031  rrent_name)) - 1
+000114d0: 292e 6e61 6d65 0d0a 2020 2020 2020 2020  ).name..        
+000114e0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+000114f0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00011500: 726f 7228 6627 496e 7661 6c69 6420 6e6f  ror(f'Invalid no
+00011510: 7465 206e 616d 6520 6f72 2061 6363 6964  te name or accid
+00011520: 656e 7461 6c20 7b63 7572 7265 6e74 5f6e  ental {current_n
+00011530: 6f74 657d 2729 0d0a 2020 2020 2020 2020  ote}')..        
+00011540: 7265 7475 726e 2072 6573 756c 740d 0a0d  return result...
+00011550: 0a0d 0a64 6566 2067 6574 5f61 6363 6964  ...def get_accid
+00011560: 656e 7461 6c28 6375 7272 656e 745f 6e6f  ental(current_no
+00011570: 7465 293a 0d0a 2020 2020 6966 2063 7572  te):..    if cur
+00011580: 7265 6e74 5f6e 6f74 652e 656e 6473 7769  rent_note.endswi
+00011590: 7468 2827 6262 2729 3a0d 0a20 2020 2020  th('bb'):..     
+000115a0: 2020 2072 6573 756c 7420 3d20 2762 6227     result = 'bb'
+000115b0: 0d0a 2020 2020 656c 6966 2063 7572 7265  ..    elif curre
+000115c0: 6e74 5f6e 6f74 652e 656e 6473 7769 7468  nt_note.endswith
+000115d0: 2827 7827 293a 0d0a 2020 2020 2020 2020  ('x'):..        
+000115e0: 7265 7375 6c74 203d 2027 7827 0d0a 2020  result = 'x'..  
+000115f0: 2020 656c 6966 2063 7572 7265 6e74 5f6e    elif current_n
+00011600: 6f74 652e 656e 6473 7769 7468 2827 e299  ote.endswith('..
+00011610: ae27 293a 0d0a 2020 2020 2020 2020 7265  .'):..        re
+00011620: 7375 6c74 203d 2027 e299 ae27 0d0a 2020  sult = '...'..  
+00011630: 2020 656c 6966 2063 7572 7265 6e74 5f6e    elif current_n
+00011640: 6f74 652e 656e 6473 7769 7468 2827 2327  ote.endswith('#'
+00011650: 293a 0d0a 2020 2020 2020 2020 7265 7375  ):..        resu
+00011660: 6c74 203d 2027 2327 0d0a 2020 2020 656c  lt = '#'..    el
+00011670: 6966 2063 7572 7265 6e74 5f6e 6f74 652e  if current_note.
+00011680: 656e 6473 7769 7468 2827 6227 293a 0d0a  endswith('b'):..
+00011690: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+000116a0: 2027 6227 0d0a 2020 2020 656c 7365 3a0d   'b'..    else:.
+000116b0: 0a20 2020 2020 2020 2072 6573 756c 7420  .        result 
+000116c0: 3d20 2727 0d0a 2020 2020 7265 7475 726e  = ''..    return
+000116d0: 2072 6573 756c 740d 0a0d 0a0d 0a64 6566   result......def
+000116e0: 2072 6573 6574 2873 656c 662c 202a 2a6b   reset(self, **k
+000116f0: 7761 7267 7329 3a0d 0a20 2020 2074 656d  wargs):..    tem
+00011700: 7020 3d20 636f 7079 2873 656c 6629 0d0a  p = copy(self)..
+00011710: 2020 2020 666f 7220 692c 206a 2069 6e20      for i, j in 
+00011720: 6b77 6172 6773 2e69 7465 6d73 2829 3a0d  kwargs.items():.
+00011730: 0a20 2020 2020 2020 2073 6574 6174 7472  .        setattr
+00011740: 2874 656d 702c 2069 2c20 6a29 0d0a 2020  (temp, i, j)..  
+00011750: 2020 7265 7475 726e 2074 656d 700d 0a0d    return temp...
+00011760: 0a0d 0a64 6566 2063 6c6f 7365 7374 5f6e  ...def closest_n
+00011770: 6f74 6528 6e6f 7465 312c 206e 6f74 6532  ote(note1, note2
+00011780: 2c20 6765 745f 6469 7374 616e 6365 3d46  , get_distance=F
+00011790: 616c 7365 293a 0d0a 2020 2020 6966 2069  alse):..    if i
+000117a0: 7369 6e73 7461 6e63 6528 6e6f 7465 312c  sinstance(note1,
+000117b0: 206e 6f74 6529 3a0d 0a20 2020 2020 2020   note):..       
+000117c0: 206e 6f74 6531 203d 206e 6f74 6531 2e6e   note1 = note1.n
+000117d0: 616d 650d 0a20 2020 2069 6620 6e6f 7420  ame..    if not 
+000117e0: 6973 696e 7374 616e 6365 286e 6f74 6532  isinstance(note2
+000117f0: 2c20 6e6f 7465 293a 0d0a 2020 2020 2020  , note):..      
+00011800: 2020 6e6f 7465 3220 3d20 746f 5f6e 6f74    note2 = to_not
+00011810: 6528 6e6f 7465 3229 0d0a 2020 2020 6375  e(note2)..    cu
+00011820: 7272 656e 745f 6e6f 7465 203d 205b 0d0a  rrent_note = [..
+00011830: 2020 2020 2020 2020 6e6f 7465 286e 6f74          note(not
+00011840: 6531 2c20 6e6f 7465 322e 6e75 6d29 2c0d  e1, note2.num),.
+00011850: 0a20 2020 2020 2020 206e 6f74 6528 6e6f  .        note(no
+00011860: 7465 312c 206e 6f74 6532 2e6e 756d 202d  te1, note2.num -
+00011870: 2031 292c 0d0a 2020 2020 2020 2020 6e6f   1),..        no
+00011880: 7465 286e 6f74 6531 2c20 6e6f 7465 322e  te(note1, note2.
+00011890: 6e75 6d20 2b20 3129 0d0a 2020 2020 5d0d  num + 1)..    ].
+000118a0: 0a20 2020 2069 6620 6e6f 7420 6765 745f  .    if not get_
+000118b0: 6469 7374 616e 6365 3a0d 0a20 2020 2020  distance:..     
+000118c0: 2020 2072 6573 756c 7420 3d20 6d69 6e28     result = min(
+000118d0: 6375 7272 656e 745f 6e6f 7465 2c20 6b65  current_note, ke
+000118e0: 793d 6c61 6d62 6461 2073 3a20 6162 7328  y=lambda s: abs(
+000118f0: 732e 6465 6772 6565 202d 206e 6f74 6532  s.degree - note2
+00011900: 2e64 6567 7265 6529 290d 0a20 2020 2020  .degree))..     
+00011910: 2020 2072 6574 7572 6e20 7265 7375 6c74     return result
+00011920: 0d0a 2020 2020 656c 7365 3a0d 0a20 2020  ..    else:..   
+00011930: 2020 2020 2064 6973 7461 6e63 6573 203d       distances =
+00011940: 205b 5b69 2c20 6162 7328 692e 6465 6772   [[i, abs(i.degr
+00011950: 6565 202d 206e 6f74 6532 2e64 6567 7265  ee - note2.degre
+00011960: 6529 5d20 666f 7220 6920 696e 2063 7572  e)] for i in cur
+00011970: 7265 6e74 5f6e 6f74 655d 0d0a 2020 2020  rent_note]..    
+00011980: 2020 2020 6469 7374 616e 6365 732e 736f      distances.so
+00011990: 7274 286b 6579 3d6c 616d 6264 6120 733a  rt(key=lambda s:
+000119a0: 2073 5b31 5d29 0d0a 2020 2020 2020 2020   s[1])..        
+000119b0: 7265 7375 6c74 203d 2064 6973 7461 6e63  result = distanc
+000119c0: 6573 5b30 5d0d 0a20 2020 2020 2020 2072  es[0]..        r
+000119d0: 6574 7572 6e20 7265 7375 6c74 0d0a 0d0a  eturn result....
+000119e0: 0d0a 6465 6620 636c 6f73 6573 745f 6e6f  ..def closest_no
+000119f0: 7465 5f66 726f 6d5f 6368 6f72 6428 6e6f  te_from_chord(no
+00011a00: 7465 312c 2063 686f 7264 312c 206d 6f64  te1, chord1, mod
+00011a10: 653d 302c 2067 6574 5f64 6973 7461 6e63  e=0, get_distanc
+00011a20: 653d 4661 6c73 6529 3a0d 0a20 2020 2069  e=False):..    i
+00011a30: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
+00011a40: 286e 6f74 6531 2c20 6e6f 7465 293a 0d0a  (note1, note):..
+00011a50: 2020 2020 2020 2020 6e6f 7465 3120 3d20          note1 = 
+00011a60: 746f 5f6e 6f74 6528 6e6f 7465 3129 0d0a  to_note(note1)..
+00011a70: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00011a80: 6528 6368 6f72 6431 2c20 6368 6f72 6429  e(chord1, chord)
+00011a90: 3a0d 0a20 2020 2020 2020 2063 686f 7264  :..        chord
+00011aa0: 3120 3d20 6368 6f72 6431 2e6e 6f74 6573  1 = chord1.notes
+00011ab0: 0d0a 2020 2020 6375 7272 656e 745f 6e61  ..    current_na
+00011ac0: 6d65 203d 2064 6174 6162 6173 652e 7374  me = database.st
+00011ad0: 616e 6461 7264 5f64 6963 742e 6765 7428  andard_dict.get(
+00011ae0: 6e6f 7465 312e 6e61 6d65 2c20 6e6f 7465  note1.name, note
+00011af0: 312e 6e61 6d65 290d 0a20 2020 2064 6973  1.name)..    dis
+00011b00: 7461 6e63 6573 203d 205b 2863 6c6f 7365  tances = [(close
+00011b10: 7374 5f6e 6f74 6528 6e6f 7465 312c 2065  st_note(note1, e
+00011b20: 6163 682c 2067 6574 5f64 6973 7461 6e63  ach, get_distanc
+00011b30: 653d 5472 7565 292c 2069 290d 0a20 2020  e=True), i)..   
+00011b40: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00011b50: 7220 692c 2065 6163 6820 696e 2065 6e75  r i, each in enu
+00011b60: 6d65 7261 7465 2863 686f 7264 3129 5d0d  merate(chord1)].
+00011b70: 0a20 2020 2064 6973 7461 6e63 6573 2e73  .    distances.s
+00011b80: 6f72 7428 6b65 793d 6c61 6d62 6461 2073  ort(key=lambda s
+00011b90: 3a20 735b 305d 5b31 5d29 0d0a 2020 2020  : s[0][1])..    
+00011ba0: 7265 7375 6c74 203d 2063 686f 7264 315b  result = chord1[
+00011bb0: 6469 7374 616e 6365 735b 305d 5b31 5d5d  distances[0][1]]
+00011bc0: 0d0a 2020 2020 6966 206d 6f64 6520 3d3d  ..    if mode ==
+00011bd0: 2031 3a0d 0a20 2020 2020 2020 2072 6573   1:..        res
+00011be0: 756c 7420 3d20 6469 7374 616e 6365 735b  ult = distances[
+00011bf0: 305d 5b30 5d5b 305d 0d0a 2020 2020 6966  0][0][0]..    if
+00011c00: 2067 6574 5f64 6973 7461 6e63 653a 0d0a   get_distance:..
+00011c10: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+00011c20: 2028 7265 7375 6c74 2c20 6469 7374 616e   (result, distan
+00011c30: 6365 735b 305d 5b30 5d5b 315d 290d 0a20  ces[0][0][1]).. 
+00011c40: 2020 2072 6574 7572 6e20 7265 7375 6c74     return result
+00011c50: 0d0a 0d0a 0d0a 6465 6620 6e6f 7465 5f72  ......def note_r
+00011c60: 616e 6765 286e 6f74 6531 2c20 6e6f 7465  ange(note1, note
+00011c70: 3229 3a0d 0a20 2020 2063 7572 7265 6e74  2):..    current
+00011c80: 5f72 616e 6765 203d 206c 6973 7428 7261  _range = list(ra
+00011c90: 6e67 6528 6e6f 7465 312e 6465 6772 6565  nge(note1.degree
+00011ca0: 2c20 6e6f 7465 322e 6465 6772 6565 2929  , note2.degree))
+00011cb0: 0d0a 2020 2020 7265 7375 6c74 203d 205b  ..    result = [
+00011cc0: 6465 6772 6565 5f74 6f5f 6e6f 7465 2869  degree_to_note(i
+00011cd0: 2920 666f 7220 6920 696e 2063 7572 7265  ) for i in curre
+00011ce0: 6e74 5f72 616e 6765 5d0d 0a20 2020 2072  nt_range]..    r
+00011cf0: 6574 7572 6e20 7265 7375 6c74 0d0a 0d0a  eturn result....
+00011d00: 0d0a 6465 6620 6164 6a75 7374 5f74 6f5f  ..def adjust_to_
+00011d10: 7363 616c 6528 6375 7272 656e 745f 6368  scale(current_ch
+00011d20: 6f72 642c 2063 7572 7265 6e74 5f73 6361  ord, current_sca
+00011d30: 6c65 293a 0d0a 2020 2020 7465 6d70 203d  le):..    temp =
+00011d40: 2063 6f70 7928 6375 7272 656e 745f 6368   copy(current_ch
+00011d50: 6f72 6429 0d0a 2020 2020 6375 7272 656e  ord)..    curren
+00011d60: 745f 6e6f 7465 7320 3d20 6375 7272 656e  t_notes = curren
+00011d70: 745f 7363 616c 652e 6765 745f 7363 616c  t_scale.get_scal
+00011d80: 6528 290d 0a20 2020 2066 6f72 2065 6163  e()..    for eac
+00011d90: 6820 696e 2074 656d 703a 0d0a 2020 2020  h in temp:..    
+00011da0: 2020 2020 6375 7272 656e 745f 6e6f 7465      current_note
+00011db0: 203d 2063 6c6f 7365 7374 5f6e 6f74 655f   = closest_note_
+00011dc0: 6672 6f6d 5f63 686f 7264 2865 6163 682c  from_chord(each,
+00011dd0: 2063 7572 7265 6e74 5f6e 6f74 6573 290d   current_notes).
+00011de0: 0a20 2020 2020 2020 2065 6163 682e 6e61  .        each.na
+00011df0: 6d65 203d 2063 7572 7265 6e74 5f6e 6f74  me = current_not
+00011e00: 652e 6e61 6d65 0d0a 2020 2020 2020 2020  e.name..        
+00011e10: 6561 6368 2e6e 756d 203d 2063 7572 7265  each.num = curre
+00011e20: 6e74 5f6e 6f74 652e 6e75 6d0d 0a20 2020  nt_note.num..   
+00011e30: 2072 6574 7572 6e20 7465 6d70 0d0a 0d0a   return temp....
+00011e40: 0d0a 6465 6620 6461 7461 636c 6173 735f  ..def dataclass_
+00011e50: 7265 7072 2873 2c20 6b65 7977 6f72 6473  repr(s, keywords
+00011e60: 3d4e 6f6e 6529 3a0d 0a20 2020 2069 6620  =None):..    if 
+00011e70: 6e6f 7420 6b65 7977 6f72 6473 3a0d 0a20  not keywords:.. 
+00011e80: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+00011e90: 6622 7b74 7970 6528 7329 2e5f 5f6e 616d  f"{type(s).__nam
+00011ea0: 655f 5f7d 287b 272c 2027 2e6a 6f69 6e28  e__}({', '.join(
+00011eb0: 5b66 277b 697d 3d7b 6a7d 2720 666f 7220  [f'{i}={j}' for 
+00011ec0: 692c 206a 2069 6e20 7661 7273 2873 292e  i, j in vars(s).
+00011ed0: 6974 656d 7328 295d 297d 2922 0d0a 2020  items()])})"..  
+00011ee0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00011ef0: 2072 6573 756c 7420 3d20 6622 7b74 7970   result = f"{typ
+00011f00: 6528 7329 2e5f 5f6e 616d 655f 5f7d 287b  e(s).__name__}({
+00011f10: 272c 2027 2e6a 6f69 6e28 5b66 277b 697d  ', '.join([f'{i}
+00011f20: 3d7b 7661 7273 2873 295b 695d 7d27 2066  ={vars(s)[i]}' f
+00011f30: 6f72 2069 2069 6e20 6b65 7977 6f72 6473  or i in keywords
+00011f40: 5d29 7d29 220d 0a20 2020 2072 6574 7572  ])})"..    retur
+00011f50: 6e20 7265 7375 6c74 0d0a 0d0a 0d0a 6465  n result......de
+00011f60: 6620 7265 6164 5f6d 7573 6963 786d 6c28  f read_musicxml(
+00011f70: 6669 6c65 2c20 6c6f 6164 5f6d 7573 6963  file, load_music
+00011f80: 786d 6c5f 6172 6773 3d7b 7d2c 2073 6176  xml_args={}, sav
+00011f90: 655f 6d69 6469 5f61 7267 733d 7b7d 293a  e_midi_args={}):
+00011fa0: 0d0a 2020 2020 696d 706f 7274 2070 6172  ..    import par
+00011fb0: 7469 7475 7261 0d0a 2020 2020 6375 7272  titura..    curr
+00011fc0: 656e 745f 7363 6f72 6520 3d20 7061 7274  ent_score = part
+00011fd0: 6974 7572 612e 6c6f 6164 5f6d 7573 6963  itura.load_music
+00011fe0: 786d 6c28 6669 6c65 2c20 2a2a 6c6f 6164  xml(file, **load
+00011ff0: 5f6d 7573 6963 786d 6c5f 6172 6773 290d  _musicxml_args).
+00012000: 0a20 2020 2063 7572 7265 6e74 5f66 696c  .    current_fil
+00012010: 6520 3d20 4279 7465 7349 4f28 290d 0a20  e = BytesIO().. 
+00012020: 2020 2070 6172 7469 7475 7261 2e73 6176     partitura.sav
+00012030: 655f 7363 6f72 655f 6d69 6469 2863 7572  e_score_midi(cur
+00012040: 7265 6e74 5f73 636f 7265 2c20 6375 7272  rent_score, curr
+00012050: 656e 745f 6669 6c65 2c20 2a2a 7361 7665  ent_file, **save
+00012060: 5f6d 6964 695f 6172 6773 290d 0a20 2020  _midi_args)..   
+00012070: 2072 6573 756c 7420 3d20 7265 6164 2863   result = read(c
+00012080: 7572 7265 6e74 5f66 696c 652c 2069 735f  urrent_file, is_
+00012090: 6669 6c65 3d54 7275 6529 0d0a 2020 2020  file=True)..    
+000120a0: 7265 7375 6c74 2e6d 7573 6963 786d 6c5f  result.musicxml_
+000120b0: 696e 666f 203d 207b 0d0a 2020 2020 2020  info = {..      
+000120c0: 2020 693a 206a 0d0a 2020 2020 2020 2020    i: j..        
+000120d0: 666f 7220 692c 206a 2069 6e20 7661 7273  for i, j in vars
+000120e0: 2863 7572 7265 6e74 5f73 636f 7265 292e  (current_score).
+000120f0: 6974 656d 7328 290d 0a20 2020 2020 2020  items()..       
+00012100: 2069 6620 6920 6e6f 7420 696e 205b 2770   if i not in ['p
+00012110: 6172 7473 272c 2027 7061 7274 5f73 7472  arts', 'part_str
+00012120: 7563 7475 7265 275d 0d0a 2020 2020 7d0d  ucture']..    }.
+00012130: 0a20 2020 2072 6574 7572 6e20 7265 7375  .    return resu
+00012140: 6c74 0d0a 0d0a 0d0a 6465 6620 7772 6974  lt......def writ
+00012150: 655f 6d75 7369 6378 6d6c 2863 7572 7265  e_musicxml(curre
+00012160: 6e74 5f63 686f 7264 2c20 6669 6c65 6e61  nt_chord, filena
+00012170: 6d65 2c20 7361 7665 5f6d 7573 6963 786d  me, save_musicxm
+00012180: 6c5f 6172 6773 3d7b 7d29 3a0d 0a20 2020  l_args={}):..   
+00012190: 2069 6d70 6f72 7420 7061 7274 6974 7572   import partitur
+000121a0: 610d 0a20 2020 2063 7572 7265 6e74 5f66  a..    current_f
+000121b0: 696c 6520 3d20 4279 7465 7349 4f28 290d  ile = BytesIO().
+000121c0: 0a20 2020 2063 7572 7265 6e74 5f66 696c  .    current_fil
+000121d0: 6520 3d20 7772 6974 6528 6375 7272 656e  e = write(curren
+000121e0: 745f 6368 6f72 642c 2073 6176 655f 6173  t_chord, save_as
+000121f0: 5f66 696c 653d 4661 6c73 6529 0d0a 2020  _file=False)..  
+00012200: 2020 6375 7272 656e 745f 6669 6c65 2e73    current_file.s
+00012210: 6565 6b28 3029 0d0a 2020 2020 6375 7272  eek(0)..    curr
+00012220: 656e 745f 6669 6c65 203d 2070 6172 7469  ent_file = parti
+00012230: 7475 7261 2e69 6f2e 696d 706f 7274 6d69  tura.io.importmi
+00012240: 6469 2e6d 6964 6f2e 4d69 6469 4669 6c65  di.mido.MidiFile
+00012250: 2866 696c 653d 6375 7272 656e 745f 6669  (file=current_fi
+00012260: 6c65 2c0d 0a20 2020 2020 2020 2020 2020  le,..           
+00012270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012290: 2020 2020 2020 2020 2020 2020 2020 636c                cl
+000122a0: 6970 3d54 7275 6529 0d0a 2020 2020 6375  ip=True)..    cu
+000122b0: 7272 656e 745f 6d69 6469 203d 2070 6172  rrent_midi = par
+000122c0: 7469 7475 7261 2e6c 6f61 645f 7363 6f72  titura.load_scor
+000122d0: 655f 6d69 6469 2863 7572 7265 6e74 5f66  e_midi(current_f
+000122e0: 696c 6529 0d0a 2020 2020 7061 7274 6974  ile)..    partit
+000122f0: 7572 612e 7361 7665 5f6d 7573 6963 786d  ura.save_musicxm
+00012300: 6c28 6375 7272 656e 745f 6d69 6469 2c20  l(current_midi, 
+00012310: 6669 6c65 6e61 6d65 2c20 2a2a 7361 7665  filename, **save
+00012320: 5f6d 7573 6963 786d 6c5f 6172 6773 290d  _musicxml_args).
+00012330: 0a0d 0a0d 0a64 6566 2072 6561 645f 6a73  .....def read_js
+00012340: 6f6e 2866 696c 6529 3a0d 0a20 2020 206e  on(file):..    n
+00012350: 6f74 655f 6c69 7374 5f64 6963 7420 3d20  ote_list_dict = 
+00012360: 7b27 6e6f 7465 273a 206e 6f74 652c 2027  {'note': note, '
+00012370: 7069 7463 685f 6265 6e64 273a 2070 6974  pitch_bend': pit
+00012380: 6368 5f62 656e 642c 2027 7465 6d70 6f27  ch_bend, 'tempo'
+00012390: 3a20 7465 6d70 6f7d 0d0a 2020 2020 7769  : tempo}..    wi
+000123a0: 7468 206f 7065 6e28 6669 6c65 2c20 656e  th open(file, en
+000123b0: 636f 6469 6e67 3d27 7574 662d 3827 2920  coding='utf-8') 
+000123c0: 6173 2066 3a0d 0a20 2020 2020 2020 2063  as f:..        c
+000123d0: 7572 7265 6e74 203d 206a 736f 6e2e 6c6f  urrent = json.lo
+000123e0: 6164 2866 290d 0a20 2020 2066 6f72 206a  ad(f)..    for j
+000123f0: 2069 6e20 6375 7272 656e 745b 2774 7261   in current['tra
+00012400: 636b 7327 5d3a 0d0a 2020 2020 2020 2020  cks']:..        
+00012410: 6a5b 2769 6e74 6572 7661 6c27 5d20 3d20  j['interval'] = 
+00012420: 5b69 5b27 696e 7465 7276 616c 275d 2066  [i['interval'] f
+00012430: 6f72 2069 2069 6e20 6a5b 276e 6f74 6573  or i in j['notes
+00012440: 275d 5d0d 0a20 2020 2020 2020 2066 6f72  ']]..        for
+00012450: 2069 2069 6e20 6a5b 276e 6f74 6573 275d   i in j['notes']
+00012460: 3a0d 0a20 2020 2020 2020 2020 2020 2064  :..            d
+00012470: 656c 2069 5b27 696e 7465 7276 616c 275d  el i['interval']
+00012480: 0d0a 2020 2020 2020 2020 6a5b 276e 6f74  ..        j['not
+00012490: 6573 275d 203d 205b 0d0a 2020 2020 2020  es'] = [..      
+000124a0: 2020 2020 2020 6e6f 7465 5f6c 6973 745f        note_list_
+000124b0: 6469 6374 5b6b 5b27 7479 7065 275d 5d28  dict[k['type']](
+000124c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000124d0: 2020 2a2a 7b69 3a20 6a0d 0a20 2020 2020    **{i: j..     
+000124e0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+000124f0: 7220 692c 206a 2069 6e20 6b2e 6974 656d  r i, j in k.item
+00012500: 7328 2920 6966 2069 2021 3d20 2774 7970  s() if i != 'typ
+00012510: 6527 7d29 2066 6f72 206b 2069 6e20 6a5b  e'}) for k in j[
+00012520: 276e 6f74 6573 275d 0d0a 2020 2020 2020  'notes']..      
+00012530: 2020 5d0d 0a20 2020 2020 2020 206a 5b27    ]..        j['
+00012540: 7465 6d70 6f73 275d 203d 205b 7465 6d70  tempos'] = [temp
+00012550: 6f28 2a2a 6b29 2066 6f72 206b 2069 6e20  o(**k) for k in 
+00012560: 6a5b 2774 656d 706f 7327 5d5d 0d0a 2020  j['tempos']]..  
+00012570: 2020 2020 2020 6a5b 2770 6974 6368 5f62        j['pitch_b
+00012580: 656e 6473 275d 203d 205b 7069 7463 685f  ends'] = [pitch_
+00012590: 6265 6e64 282a 2a6b 2920 666f 7220 6b20  bend(**k) for k 
+000125a0: 696e 206a 5b27 7069 7463 685f 6265 6e64  in j['pitch_bend
+000125b0: 7327 5d5d 0d0a 2020 2020 2020 2020 6a5b  s']]..        j[
+000125c0: 276f 7468 6572 5f6d 6573 7361 6765 7327  'other_messages'
+000125d0: 5d20 3d20 5b65 7665 6e74 282a 2a6b 2920  ] = [event(**k) 
+000125e0: 666f 7220 6b20 696e 206a 5b27 6f74 6865  for k in j['othe
+000125f0: 725f 6d65 7373 6167 6573 275d 5d0d 0a20  r_messages']].. 
+00012600: 2020 2063 7572 7265 6e74 5b27 7472 6163     current['trac
+00012610: 6b73 275d 203d 205b 6368 6f72 6428 2a2a  ks'] = [chord(**
+00012620: 6929 2066 6f72 2069 2069 6e20 6375 7272  i) for i in curr
+00012630: 656e 745b 2774 7261 636b 7327 5d5d 0d0a  ent['tracks']]..
+00012640: 2020 2020 6375 7272 656e 745b 276f 7468      current['oth
+00012650: 6572 5f6d 6573 7361 6765 7327 5d20 3d20  er_messages'] = 
+00012660: 5b65 7665 6e74 282a 2a6b 2920 666f 7220  [event(**k) for 
+00012670: 6b20 696e 2063 7572 7265 6e74 5b27 6f74  k in current['ot
+00012680: 6865 725f 6d65 7373 6167 6573 275d 5d0d  her_messages']].
+00012690: 0a20 2020 2063 7572 7265 6e74 5b27 7061  .    current['pa
+000126a0: 6e27 5d20 3d20 5b5b 7061 6e28 2a2a 6929  n'] = [[pan(**i)
+000126b0: 2066 6f72 2069 2069 6e20 6a5d 2066 6f72   for i in j] for
+000126c0: 206a 2069 6e20 6375 7272 656e 745b 2770   j in current['p
+000126d0: 616e 275d 5d0d 0a20 2020 2063 7572 7265  an']]..    curre
+000126e0: 6e74 5b27 766f 6c75 6d65 275d 203d 205b  nt['volume'] = [
+000126f0: 5b76 6f6c 756d 6528 2a2a 6929 2066 6f72  [volume(**i) for
+00012700: 2069 2069 6e20 6a5d 2066 6f72 206a 2069   i in j] for j i
+00012710: 6e20 6375 7272 656e 745b 2776 6f6c 756d  n current['volum
+00012720: 6527 5d5d 0d0a 2020 2020 7265 7375 6c74  e']]..    result
+00012730: 203d 2070 6965 6365 282a 2a63 7572 7265   = piece(**curre
+00012740: 6e74 290d 0a20 2020 2072 6574 7572 6e20  nt)..    return 
+00012750: 7265 7375 6c74 0d0a 0d0a 0d0a 6465 6620  result......def 
+00012760: 7772 6974 655f 6a73 6f6e 2863 7572 7265  write_json(curre
+00012770: 6e74 5f63 686f 7264 2c0d 0a20 2020 2020  nt_chord,..     
+00012780: 2020 2020 2020 2020 2020 6270 6d3d 3132            bpm=12
+00012790: 302c 0d0a 2020 2020 2020 2020 2020 2020  0,..            
+000127a0: 2020 2063 6861 6e6e 656c 3d30 2c0d 0a20     channel=0,.. 
+000127b0: 2020 2020 2020 2020 2020 2020 2020 7374                st
+000127c0: 6172 745f 7469 6d65 3d4e 6f6e 652c 0d0a  art_time=None,..
+000127d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000127e0: 696c 656e 616d 653d 2775 6e74 6974 6c65  ilename='untitle
+000127f0: 642e 6a73 6f6e 272c 0d0a 2020 2020 2020  d.json',..      
+00012800: 2020 2020 2020 2020 2069 6e73 7472 756d           instrum
+00012810: 656e 743d 4e6f 6e65 2c0d 0a20 2020 2020  ent=None,..     
+00012820: 2020 2020 2020 2020 2020 693d 4e6f 6e65            i=None
+00012830: 293a 0d0a 2020 2020 6966 2069 2069 7320  ):..    if i is 
+00012840: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+00012850: 2020 2069 6e73 7472 756d 656e 7420 3d20     instrument = 
+00012860: 690d 0a20 2020 2069 6620 6973 696e 7374  i..    if isinst
+00012870: 616e 6365 2863 7572 7265 6e74 5f63 686f  ance(current_cho
+00012880: 7264 2c20 6e6f 7465 293a 0d0a 2020 2020  rd, note):..    
+00012890: 2020 2020 6375 7272 656e 745f 6368 6f72      current_chor
+000128a0: 6420 3d20 6368 6f72 6428 5b63 7572 7265  d = chord([curre
+000128b0: 6e74 5f63 686f 7264 5d29 0d0a 2020 2020  nt_chord])..    
+000128c0: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
+000128d0: 6375 7272 656e 745f 6368 6f72 642c 206c  current_chord, l
+000128e0: 6973 7429 3a0d 0a20 2020 2020 2020 2063  ist):..        c
+000128f0: 7572 7265 6e74 5f63 686f 7264 203d 2063  urrent_chord = c
+00012900: 6f6e 6361 7428 6375 7272 656e 745f 6368  oncat(current_ch
+00012910: 6f72 642c 2027 7c27 290d 0a20 2020 2069  ord, '|')..    i
+00012920: 6620 6973 696e 7374 616e 6365 2863 7572  f isinstance(cur
+00012930: 7265 6e74 5f63 686f 7264 2c20 6368 6f72  rent_chord, chor
+00012940: 6429 3a0d 0a20 2020 2020 2020 2069 6620  d):..        if 
+00012950: 696e 7374 7275 6d65 6e74 2069 7320 4e6f  instrument is No
+00012960: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+00012970: 2069 6e73 7472 756d 656e 7420 3d20 310d   instrument = 1.
+00012980: 0a20 2020 2020 2020 2063 7572 7265 6e74  .        current
+00012990: 5f63 686f 7264 203d 2050 280d 0a20 2020  _chord = P(..   
+000129a0: 2020 2020 2020 2020 2074 7261 636b 733d           tracks=
+000129b0: 5b63 7572 7265 6e74 5f63 686f 7264 5d2c  [current_chord],
+000129c0: 0d0a 2020 2020 2020 2020 2020 2020 696e  ..            in
+000129d0: 7374 7275 6d65 6e74 733d 5b69 6e73 7472  struments=[instr
+000129e0: 756d 656e 745d 2c0d 0a20 2020 2020 2020  ument],..       
+000129f0: 2020 2020 2062 706d 3d62 706d 2c0d 0a20       bpm=bpm,.. 
+00012a00: 2020 2020 2020 2020 2020 2063 6861 6e6e             chann
+00012a10: 656c 733d 5b63 6861 6e6e 656c 5d2c 0d0a  els=[channel],..
+00012a20: 2020 2020 2020 2020 2020 2020 7374 6172              star
+00012a30: 745f 7469 6d65 733d 5b0d 0a20 2020 2020  t_times=[..     
+00012a40: 2020 2020 2020 2020 2020 2063 7572 7265             curre
+00012a50: 6e74 5f63 686f 7264 2e73 7461 7274 5f74  nt_chord.start_t
+00012a60: 696d 6520 6966 2073 7461 7274 5f74 696d  ime if start_tim
+00012a70: 6520 6973 204e 6f6e 6520 656c 7365 2073  e is None else s
+00012a80: 7461 7274 5f74 696d 650d 0a20 2020 2020  tart_time..     
+00012a90: 2020 2020 2020 205d 2c0d 0a20 2020 2020         ],..     
+00012aa0: 2020 2020 2020 206f 7468 6572 5f6d 6573         other_mes
+00012ab0: 7361 6765 733d 6375 7272 656e 745f 6368  sages=current_ch
+00012ac0: 6f72 642e 6f74 6865 725f 6d65 7373 6167  ord.other_messag
+00012ad0: 6573 290d 0a20 2020 2065 6c69 6620 6973  es)..    elif is
+00012ae0: 696e 7374 616e 6365 2863 7572 7265 6e74  instance(current
+00012af0: 5f63 686f 7264 2c20 7472 6163 6b29 3a0d  _chord, track):.
+00012b00: 0a20 2020 2020 2020 2063 7572 7265 6e74  .        current
+00012b10: 5f63 686f 7264 203d 2062 7569 6c64 2863  _chord = build(c
+00012b20: 7572 7265 6e74 5f63 686f 7264 2c20 6270  urrent_chord, bp
+00012b30: 6d3d 6375 7272 656e 745f 6368 6f72 642e  m=current_chord.
+00012b40: 6270 6d29 0d0a 2020 2020 656c 6966 2069  bpm)..    elif i
+00012b50: 7369 6e73 7461 6e63 6528 6375 7272 656e  sinstance(curren
+00012b60: 745f 6368 6f72 642c 2064 7275 6d29 3a0d  t_chord, drum):.
+00012b70: 0a20 2020 2020 2020 2063 7572 7265 6e74  .        current
+00012b80: 5f63 686f 7264 203d 2050 2874 7261 636b  _chord = P(track
+00012b90: 733d 5b63 7572 7265 6e74 5f63 686f 7264  s=[current_chord
+00012ba0: 2e6e 6f74 6573 5d2c 0d0a 2020 2020 2020  .notes],..      
+00012bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012bc0: 2020 2020 696e 7374 7275 6d65 6e74 733d      instruments=
+00012bd0: 5b63 7572 7265 6e74 5f63 686f 7264 2e69  [current_chord.i
+00012be0: 6e73 7472 756d 656e 745d 2c0d 0a20 2020  nstrument],..   
+00012bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012c00: 2020 2020 2020 2062 706d 3d62 706d 2c0d         bpm=bpm,.
+00012c10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012c20: 2020 2020 2020 2020 2020 2073 7461 7274             start
+00012c30: 5f74 696d 6573 3d5b 0d0a 2020 2020 2020  _times=[..      
+00012c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012c50: 2020 2020 2020 2020 6375 7272 656e 745f          current_
+00012c60: 6368 6f72 642e 6e6f 7465 732e 7374 6172  chord.notes.star
+00012c70: 745f 7469 6d65 0d0a 2020 2020 2020 2020  t_time..        
+00012c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012c90: 2020 2020 2020 6966 2073 7461 7274 5f74        if start_t
+00012ca0: 696d 6520 6973 204e 6f6e 6520 656c 7365  ime is None else
+00012cb0: 2073 7461 7274 5f74 696d 650d 0a20 2020   start_time..   
+00012cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012cd0: 2020 2020 2020 205d 2c0d 0a20 2020 2020         ],..     
+00012ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012cf0: 2020 2020 2063 6861 6e6e 656c 733d 5b39       channels=[9
+00012d00: 5d29 0d0a 2020 2020 656c 7365 3a0d 0a20  ])..    else:.. 
+00012d10: 2020 2020 2020 2063 7572 7265 6e74 5f63         current_c
+00012d20: 686f 7264 203d 2063 6f70 7928 6375 7272  hord = copy(curr
+00012d30: 656e 745f 6368 6f72 6429 0d0a 2020 2020  ent_chord)..    
+00012d40: 7265 7375 6c74 203d 2063 7572 7265 6e74  result = current
+00012d50: 5f63 686f 7264 2e5f 5f64 6963 745f 5f0d  _chord.__dict__.
+00012d60: 0a20 2020 2072 6573 756c 745b 2774 7261  .    result['tra
+00012d70: 636b 7327 5d20 3d20 5b69 2e5f 5f64 6963  cks'] = [i.__dic
+00012d80: 745f 5f20 666f 7220 6920 696e 2072 6573  t__ for i in res
+00012d90: 756c 745b 2774 7261 636b 7327 5d5d 0d0a  ult['tracks']]..
+00012da0: 2020 2020 666f 7220 6a20 696e 2072 6573      for j in res
+00012db0: 756c 745b 2774 7261 636b 7327 5d3a 0d0a  ult['tracks']:..
+00012dc0: 2020 2020 2020 2020 666f 7220 692c 2065          for i, e
+00012dd0: 6163 6820 696e 2065 6e75 6d65 7261 7465  ach in enumerate
+00012de0: 286a 5b27 6e6f 7465 7327 5d29 3a0d 0a20  (j['notes']):.. 
+00012df0: 2020 2020 2020 2020 2020 2063 7572 7265             curre
+00012e00: 6e74 5f64 6963 7420 3d20 7b27 7479 7065  nt_dict = {'type
+00012e10: 273a 2065 6163 682e 5f5f 636c 6173 735f  ': each.__class_
+00012e20: 5f2e 5f5f 6e61 6d65 5f5f 7d0d 0a20 2020  _.__name__}..   
+00012e30: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+00012e40: 5f64 6963 742e 7570 6461 7465 287b 0d0a  _dict.update({..
+00012e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e60: 6b31 3a20 6b32 0d0a 2020 2020 2020 2020  k1: k2..        
+00012e70: 2020 2020 2020 2020 666f 7220 6b31 2c20          for k1, 
+00012e80: 6b32 2069 6e20 6561 6368 2e5f 5f64 6963  k2 in each.__dic
+00012e90: 745f 5f2e 6974 656d 7328 2920 6966 206b  t__.items() if k
+00012ea0: 3120 6e6f 7420 696e 205b 2764 6567 7265  1 not in ['degre
+00012eb0: 6527 5d0d 0a20 2020 2020 2020 2020 2020  e']..           
+00012ec0: 207d 290d 0a20 2020 2020 2020 2020 2020   })..           
+00012ed0: 206a 5b27 6e6f 7465 7327 5d5b 695d 203d   j['notes'][i] =
+00012ee0: 2063 7572 7265 6e74 5f64 6963 740d 0a20   current_dict.. 
+00012ef0: 2020 2020 2020 2066 6f72 2065 6163 6820         for each 
+00012f00: 696e 206a 5b27 7069 7463 685f 6265 6e64  in j['pitch_bend
+00012f10: 7327 5d3a 0d0a 2020 2020 2020 2020 2020  s']:..          
+00012f20: 2020 6375 7272 656e 745f 6469 6374 2e75    current_dict.u
+00012f30: 7064 6174 6528 7b0d 0a20 2020 2020 2020  pdate({..       
+00012f40: 2020 2020 2020 2020 206b 313a 206b 320d           k1: k2.
+00012f50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012f60: 2066 6f72 206b 312c 206b 3220 696e 2065   for k1, k2 in e
+00012f70: 6163 682e 5f5f 6469 6374 5f5f 2e69 7465  ach.__dict__.ite
+00012f80: 6d73 2829 0d0a 2020 2020 2020 2020 2020  ms()..          
+00012f90: 2020 2020 2020 6966 206b 3120 6e6f 7420        if k1 not 
+00012fa0: 696e 205b 2764 6567 7265 6527 2c20 2776  in ['degree', 'v
+00012fb0: 6f6c 756d 6527 2c20 2764 7572 6174 696f  olume', 'duratio
+00012fc0: 6e27 5d0d 0a20 2020 2020 2020 2020 2020  n']..           
+00012fd0: 207d 290d 0a20 2020 2020 2020 2020 2020   })..           
+00012fe0: 2063 7572 7265 6e74 5f64 6963 745b 276d   current_dict['m
+00012ff0: 6f64 6527 5d20 3d20 2776 616c 7565 270d  ode'] = 'value'.
+00013000: 0a20 2020 2020 2020 2066 6f72 2065 6163  .        for eac
+00013010: 6820 696e 206a 5b27 7465 6d70 6f73 275d  h in j['tempos']
+00013020: 3a0d 0a20 2020 2020 2020 2020 2020 2063  :..            c
+00013030: 7572 7265 6e74 5f64 6963 742e 7570 6461  urrent_dict.upda
+00013040: 7465 287b 0d0a 2020 2020 2020 2020 2020  te({..          
+00013050: 2020 2020 2020 6b31 3a20 6b32 0d0a 2020        k1: k2..  
+00013060: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00013070: 7220 6b31 2c20 6b32 2069 6e20 6561 6368  r k1, k2 in each
+00013080: 2e5f 5f64 6963 745f 5f2e 6974 656d 7328  .__dict__.items(
+00013090: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000130a0: 2020 2069 6620 6b31 206e 6f74 2069 6e20     if k1 not in 
+000130b0: 5b27 6465 6772 6565 272c 2027 766f 6c75  ['degree', 'volu
+000130c0: 6d65 272c 2027 6475 7261 7469 6f6e 275d  me', 'duration']
+000130d0: 0d0a 2020 2020 2020 2020 2020 2020 7d29  ..            })
+000130e0: 0d0a 2020 2020 2020 2020 6a5b 276f 7468  ..        j['oth
+000130f0: 6572 5f6d 6573 7361 6765 7327 5d20 3d20  er_messages'] = 
+00013100: 5b6b 2e5f 5f64 6963 745f 5f20 666f 7220  [k.__dict__ for 
+00013110: 6b20 696e 206a 5b27 6f74 6865 725f 6d65  k in j['other_me
+00013120: 7373 6167 6573 275d 5d0d 0a20 2020 2020  ssages']]..     
+00013130: 2020 2066 6f72 2069 2c20 6561 6368 2069     for i, each i
+00013140: 6e20 656e 756d 6572 6174 6528 6a5b 276e  n enumerate(j['n
+00013150: 6f74 6573 275d 293a 0d0a 2020 2020 2020  otes']):..      
+00013160: 2020 2020 2020 6561 6368 5b27 696e 7465        each['inte
+00013170: 7276 616c 275d 203d 206a 5b27 696e 7465  rval'] = j['inte
+00013180: 7276 616c 275d 5b69 5d0d 0a20 2020 2020  rval'][i]..     
+00013190: 2020 2064 656c 206a 5b27 696e 7465 7276     del j['interv
+000131a0: 616c 275d 0d0a 2020 2020 7265 7375 6c74  al']..    result
+000131b0: 5b27 6f74 6865 725f 6d65 7373 6167 6573  ['other_messages
+000131c0: 275d 203d 205b 692e 5f5f 6469 6374 5f5f  '] = [i.__dict__
+000131d0: 2066 6f72 2069 2069 6e20 7265 7375 6c74   for i in result
+000131e0: 5b27 6f74 6865 725f 6d65 7373 6167 6573  ['other_messages
+000131f0: 275d 5d0d 0a20 2020 2072 6573 756c 745b  ']]..    result[
+00013200: 2770 616e 275d 203d 205b 5b69 2e5f 5f64  'pan'] = [[i.__d
+00013210: 6963 745f 5f20 666f 7220 6920 696e 206a  ict__ for i in j
+00013220: 5d20 666f 7220 6a20 696e 2072 6573 756c  ] for j in resul
+00013230: 745b 2770 616e 275d 5d0d 0a20 2020 2072  t['pan']]..    r
+00013240: 6573 756c 745b 2776 6f6c 756d 6527 5d20  esult['volume'] 
+00013250: 3d20 5b5b 692e 5f5f 6469 6374 5f5f 2066  = [[i.__dict__ f
+00013260: 6f72 2069 2069 6e20 6a5d 2066 6f72 206a  or i in j] for j
+00013270: 2069 6e20 7265 7375 6c74 5b27 766f 6c75   in result['volu
+00013280: 6d65 275d 5d0d 0a20 2020 2066 6f72 2069  me']]..    for i
+00013290: 2069 6e20 7265 7375 6c74 5b27 7061 6e27   in result['pan'
+000132a0: 5d3a 0d0a 2020 2020 2020 2020 666f 7220  ]:..        for 
+000132b0: 6a20 696e 2069 3a0d 0a20 2020 2020 2020  j in i:..       
+000132c0: 2020 2020 206a 5b27 6d6f 6465 275d 203d       j['mode'] =
+000132d0: 2027 7661 6c75 6527 0d0a 2020 2020 2020   'value'..      
+000132e0: 2020 2020 2020 6465 6c20 6a5b 2776 616c        del j['val
+000132f0: 7565 5f70 6572 6365 6e74 6167 6527 5d0d  ue_percentage'].
+00013300: 0a20 2020 2066 6f72 2069 2069 6e20 7265  .    for i in re
+00013310: 7375 6c74 5b27 766f 6c75 6d65 275d 3a0d  sult['volume']:.
+00013320: 0a20 2020 2020 2020 2066 6f72 206a 2069  .        for j i
+00013330: 6e20 693a 0d0a 2020 2020 2020 2020 2020  n i:..          
+00013340: 2020 6a5b 276d 6f64 6527 5d20 3d20 2776    j['mode'] = 'v
+00013350: 616c 7565 270d 0a20 2020 2020 2020 2020  alue'..         
+00013360: 2020 2064 656c 206a 5b27 7661 6c75 655f     del j['value_
+00013370: 7065 7263 656e 7461 6765 275d 0d0a 2020  percentage']..  
+00013380: 2020 6465 6c20 7265 7375 6c74 5b27 7472    del result['tr
+00013390: 6163 6b5f 6e75 6d62 6572 275d 0d0a 2020  ack_number']..  
+000133a0: 2020 7769 7468 206f 7065 6e28 6669 6c65    with open(file
+000133b0: 6e61 6d65 2c20 2777 272c 2065 6e63 6f64  name, 'w', encod
+000133c0: 696e 673d 2775 7466 2d38 2729 2061 7320  ing='utf-8') as 
+000133d0: 663a 0d0a 2020 2020 2020 2020 6a73 6f6e  f:..        json
+000133e0: 2e64 756d 7028 7265 7375 6c74 2c0d 0a20  .dump(result,.. 
+000133f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013400: 2066 2c0d 0a20 2020 2020 2020 2020 2020   f,..           
+00013410: 2020 2020 2020 2069 6e64 656e 743d 342c         indent=4,
+00013420: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00013430: 2020 2020 7365 7061 7261 746f 7273 3d28      separators=(
+00013440: 272c 272c 2027 3a20 2729 2c0d 0a20 2020  ',', ': '),..   
+00013450: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00013460: 6e73 7572 655f 6173 6369 693d 4661 6c73  nsure_ascii=Fals
+00013470: 6529 0d0a 0d0a 0d0a 6465 6620 6261 725f  e)......def bar_
+00013480: 746f 5f72 6561 6c5f 7469 6d65 2862 6172  to_real_time(bar
+00013490: 2c20 6270 6d2c 206d 6f64 653d 3029 3a0d  , bpm, mode=0):.
+000134a0: 0a20 2020 2023 2063 6f6e 7665 7274 2062  .    # convert b
+000134b0: 6172 2074 6f20 7469 6d65 2069 6e20 6d73  ar to time in ms
+000134c0: 0d0a 2020 2020 7265 7475 726e 2069 6e74  ..    return int
+000134d0: 280d 0a20 2020 2020 2020 2028 3630 3030  (..        (6000
+000134e0: 3020 2f20 6270 6d29 202a 2028 6261 7220  0 / bpm) * (bar 
+000134f0: 2a20 3429 2920 6966 206d 6f64 6520 3d3d  * 4)) if mode ==
+00013500: 2030 2065 6c73 6520 2836 3030 3030 202f   0 else (60000 /
+00013510: 2062 706d 2920 2a20 2862 6172 202a 2034   bpm) * (bar * 4
+00013520: 290d 0a0d 0a0d 0a64 6566 2072 6561 6c5f  )......def real_
+00013530: 7469 6d65 5f74 6f5f 6261 7228 7469 6d65  time_to_bar(time
+00013540: 2c20 6270 6d29 3a0d 0a20 2020 2023 2063  , bpm):..    # c
+00013550: 6f6e 7665 7274 2074 696d 6520 696e 206d  onvert time in m
+00013560: 7320 746f 2062 6172 0d0a 2020 2020 7265  s to bar..    re
+00013570: 7475 726e 2028 7469 6d65 202f 2028 3630  turn (time / (60
+00013580: 3030 3020 2f20 6270 6d29 2920 2f20 340d  000 / bpm)) / 4.
+00013590: 0a0d 0a0d 0a43 203d 2074 7261 6e73 0d0a  .....C = trans..
+000135a0: 4e20 3d20 746f 5f6e 6f74 650d 0a53 203d  N = to_note..S =
+000135b0: 2074 6f5f 7363 616c 650d 0a50 203d 2070   to_scale..P = p
+000135c0: 6965 6365 0d0a 6172 7020 3d20 6172 7065  iece..arp = arpe
+000135d0: 6767 696f 0d0a 0d0a 666f 7220 6561 6368  ggio....for each
+000135e0: 2069 6e20 5b0d 0a20 2020 2020 2020 206e   in [..        n
+000135f0: 6f74 652c 2063 686f 7264 2c20 7069 6563  ote, chord, piec
+00013600: 652c 2074 7261 636b 2c20 7363 616c 652c  e, track, scale,
+00013610: 2064 7275 6d2c 2072 6573 742c 2074 656d   drum, rest, tem
+00013620: 706f 2c20 7069 7463 685f 6265 6e64 2c20  po, pitch_bend, 
+00013630: 7061 6e2c 0d0a 2020 2020 2020 2020 766f  pan,..        vo
+00013640: 6c75 6d65 2c20 6576 656e 742c 2062 6561  lume, event, bea
+00013650: 742c 2072 6573 745f 7379 6d62 6f6c 2c20  t, rest_symbol, 
+00013660: 636f 6e74 696e 7565 5f73 796d 626f 6c2c  continue_symbol,
+00013670: 2072 6879 7468 6d0d 0a5d 3a0d 0a20 2020   rhythm..]:..   
+00013680: 2065 6163 682e 7265 7365 7420 3d20 7265   each.reset = re
+00013690: 7365 740d 0a20 2020 2065 6163 682e 5f5f  set..    each.__
+000136a0: 6861 7368 5f5f 203d 206c 616d 6264 6120  hash__ = lambda 
+000136b0: 7365 6c66 3a20 6861 7368 2872 6570 7228  self: hash(repr(
+000136c0: 7365 6c66 2929 0d0a 2020 2020 6561 6368  self))..    each
+000136d0: 2e63 6f70 7920 3d20 6c61 6d62 6461 2073  .copy = lambda s
+000136e0: 656c 663a 2063 6f70 7928 7365 6c66 290d  elf: copy(self).
+000136f0: 0a20 2020 2069 6620 6561 6368 2e5f 5f65  .    if each.__e
+00013700: 715f 5f20 3d3d 206f 626a 6563 742e 5f5f  q__ == object.__
+00013710: 6571 5f5f 3a0d 0a20 2020 2020 2020 2065  eq__:..        e
+00013720: 6163 682e 5f5f 6571 5f5f 203d 206c 616d  ach.__eq__ = lam
+00013730: 6264 6120 7365 6c66 2c20 6f74 6865 723a  bda self, other:
+00013740: 2074 7970 6528 6f74 6865 7229 2069 7320   type(other) is 
+00013750: 7479 7065 280d 0a20 2020 2020 2020 2020  type(..         
+00013760: 2020 2073 656c 6629 2061 6e64 2073 656c     self) and sel
+00013770: 662e 5f5f 6469 6374 5f5f 203d 3d20 6f74  f.__dict__ == ot
+00013780: 6865 722e 5f5f 6469 6374 5f5f 0d0a 0d0a  her.__dict__....
+00013790: 6966 205f 5f6e 616d 655f 5f20 3d3d 2027  if __name__ == '
+000137a0: 5f5f 6d61 696e 5f5f 2720 6f72 205f 5f6e  __main__' or __n
+000137b0: 616d 655f 5f20 3d3d 2027 6d75 7369 6370  ame__ == 'musicp
+000137c0: 7927 3a0d 0a20 2020 2069 6d70 6f72 7420  y':..    import 
+000137d0: 616c 676f 7269 7468 6d73 2061 7320 616c  algorithms as al
+000137e0: 670d 0a65 6c73 653a 0d0a 2020 2020 6672  g..else:..    fr
+000137f0: 6f6d 202e 2069 6d70 6f72 7420 616c 676f  om . import algo
+00013800: 7269 7468 6d73 2061 7320 616c 670d 0a    rithms as alg..
```

### Comparing `musicpy-6.65/musicpy/structures.py` & `musicpy-6.67/musicpy/structures.py`

 * *Files 0% similar despite different names*

```diff
@@ -1034,33 +1034,39 @@
             return result
         return [
             database.INTERVAL.get(i % (database.octave * 2),
                                   database.INTERVAL[i % database.octave])
             for i in result
         ]
 
-    def add(self, note1=None, mode='after', start=0, duration=1 / 4):
-        if not self.notes and not self.tempos and not self.pitch_bends:
+    def add(self,
+            note1=None,
+            mode='after',
+            start=0,
+            duration=1 / 4,
+            adjust_msg=True):
+        if self.is_empty():
             result = copy(note1)
             result.start_time += start
             return result
         temp = copy(self)
-        if not note1.notes and not note1.tempos and not note1.pitch_bends:
+        if note1.is_empty():
             return temp
         if mode == 'tail':
             note1 = copy(note1)
             adjust_interval = sum(temp.interval)
             temp.notes += note1.notes
             temp.interval += note1.interval
-            for each in note1.other_messages:
-                each.start_time += adjust_interval
-            for each in note1.tempos:
-                each.start_time += adjust_interval
-            for each in note1.pitch_bends:
-                each.start_time += adjust_interval
+            if adjust_msg:
+                for each in note1.other_messages:
+                    each.start_time += adjust_interval
+                for each in note1.tempos:
+                    each.start_time += adjust_interval
+                for each in note1.pitch_bends:
+                    each.start_time += adjust_interval
             temp.other_messages += note1.other_messages
             temp.tempos += note1.tempos
             temp.pitch_bends += note1.pitch_bends
             return temp
         elif mode == 'head':
             note1 = copy(note1)
             if isinstance(note1, str):
@@ -1068,22 +1074,31 @@
             elif isinstance(note1, note):
                 note1 = chord([note1])
             elif isinstance(note1, list):
                 note1 = chord(note1)
             # calculate the absolute distances of all of the notes of the chord to add and self,
             # and then sort them, make differences between each two distances
             if temp.notes:
+                note1_start_time = note1.start_time + start
+                if note1_start_time < 0:
+                    start = temp.start_time - note1_start_time
+                    note1.start_time = temp.start_time + note1_start_time
+                    temp, note1 = note1, temp
+                else:
+                    if note1_start_time < temp.start_time:
+                        start = temp.start_time - note1_start_time
+                        note1.start_time = note1_start_time
+                        temp, note1 = note1, temp
+                    else:
+                        start = note1_start_time - temp.start_time
                 distance = []
                 intervals1 = temp.interval
                 intervals2 = note1.interval
-                current_start_time = min(temp.start_time,
-                                         note1.start_time + start)
-                start += (note1.start_time - temp.start_time)
-                if start < 0:
-                    raise ValueError('shift time must be non-negative')
+                current_start_time = temp.start_time
+
                 if start != 0:
                     note1.notes.insert(0, temp.notes[0])
                     intervals2.insert(0, start)
                 counter = 0
                 for i in range(len(intervals1)):
                     distance.append([counter, temp.notes[i]])
                     counter += intervals1[i]
@@ -1096,27 +1111,24 @@
                 new_notes = [each[1] for each in distance]
                 new_interval = [each[0] for each in distance]
                 new_interval = [
                     new_interval[i] - new_interval[i - 1]
                     for i in range(1, len(new_interval))
                 ] + [distance[-1][1].duration]
             else:
-                if start < 0:
-                    raise ValueError('shift time must be non-negative')
                 new_notes = note1.notes
                 new_interval = note1.interval
-                temp.start_time += start
-                current_start_time = min(temp.start_time,
-                                         note1.start_time + start)
-            for each in note1.other_messages:
-                each.start_time += start
-            for each in note1.tempos:
-                each.start_time += start
-            for each in note1.pitch_bends:
-                each.start_time += start
+                current_start_time = note1.start_time + start
+            if adjust_msg:
+                for each in note1.other_messages:
+                    each.start_time += start
+                for each in note1.tempos:
+                    each.start_time += start
+                for each in note1.pitch_bends:
+                    each.start_time += start
             return chord(new_notes,
                          interval=new_interval,
                          start_time=current_start_time,
                          other_messages=temp.other_messages +
                          note1.other_messages,
                          tempos=temp.tempos + note1.tempos,
                          pitch_bends=temp.pitch_bends + note1.pitch_bends)
@@ -3034,17 +3046,22 @@
             return
         if i is None:
             for k in range(len(self.tracks)):
                 self.tracks[k].set_volume(self.muted_msg[k])
         else:
             self.tracks[i].set_volume(self.muted_msg[i])
 
+    def update_msg(self):
+        self.other_messages = mp.concat(
+            [i.other_messages for i in self.tracks], start=[])
+
     def append(self, new_track):
         if not isinstance(new_track, track):
             raise ValueError('must be a track type to be appended')
+        new_track = copy(new_track)
         self.tracks.append(new_track.content)
         self.instruments.append(new_track.instrument)
         self.start_times.append(new_track.start_time)
         if self.channels:
             if new_track.channel:
                 self.channels.append(new_track.channel)
             else:
@@ -3059,40 +3076,46 @@
         self.pan.append(new_track.pan if new_track.pan else [])
         self.volume.append(new_track.volume if new_track.volume else [])
         if self.daw_channels:
             if new_track.daw_channel:
                 self.daw_channels.append(new_track.daw_channel)
             else:
                 self.daw_channels.append(0)
+        self.tracks[-1].reset_track(len(self.tracks) - 1)
+        self.update_msg()
 
-    def insert(self, i, new_track):
+    def insert(self, ind, new_track):
         if not isinstance(new_track, track):
             raise ValueError('must be a track type to be inserted')
-        self.tracks.insert(i, new_track.content)
-        self.instruments.insert(i, new_track.instrument)
-        self.start_times.insert(i, new_track.start_time)
+        new_track = copy(new_track)
+        self.tracks.insert(ind, new_track.content)
+        self.instruments.insert(ind, new_track.instrument)
+        self.start_times.insert(ind, new_track.start_time)
         if self.channels:
             if new_track.channel:
-                self.channels.insert(i, new_track.channel)
+                self.channels.insert(ind, new_track.channel)
             else:
-                self.channels.insert(i, max(self.channels) + 1)
+                self.channels.insert(ind, max(self.channels) + 1)
         if self.track_names:
             if new_track.track_name:
-                self.track_names.insert(i, new_track.track_name)
+                self.track_names.insert(ind, new_track.track_name)
             else:
                 self.track_names.insert(
-                    i, new_track.name if new_track.name is not None else
+                    ind, new_track.name if new_track.name is not None else
                     f'track {self.track_number}')
-        self.pan.insert(i, new_track.pan if new_track.pan else [])
-        self.volume.insert(i, new_track.volume if new_track.volume else [])
+        self.pan.insert(ind, new_track.pan if new_track.pan else [])
+        self.volume.insert(ind, new_track.volume if new_track.volume else [])
         if self.daw_channels:
             if new_track.daw_channel:
-                self.daw_channels.insert(i, new_track.daw_channel)
+                self.daw_channels.insert(ind, new_track.daw_channel)
             else:
-                self.daw_channels.insert(i, 0)
+                self.daw_channels.insert(ind, 0)
+        for k in range(ind, len(self.tracks)):
+            self.tracks[k].reset_track(k)
+        self.update_msg()
 
     def up(self, n=1, mode=0):
         temp = copy(self)
         for i in range(temp.track_number):
             if mode == 0 or (mode == 1 and
                              not (temp.channels and temp.channels[i] == 9)):
                 temp.tracks[i] += n
@@ -3194,15 +3217,19 @@
                 current_track = temp2.tracks[i]
                 for each in current_track.tempos:
                     each.start_time += start_time
                 for each in current_track.pitch_bends:
                     each.start_time += start_time
                 current_start_time = temp2.start_times[
                     i] + start_time - temp.start_times[current_ind]
-                temp.tracks[current_ind] &= (current_track, current_start_time)
+                temp.tracks[current_ind] = temp.tracks[current_ind].add(
+                    current_track,
+                    start=current_start_time,
+                    mode='head',
+                    adjust_msg=False)
                 if current_start_time < 0:
                     temp.start_times[current_ind] += current_start_time
             else:
                 temp.instruments.append(current_instrument_number)
                 current_start_time = temp2.start_times[i]
                 current_start_time += start_time
                 current_track = temp2.tracks[i]
@@ -3441,15 +3468,21 @@
         start_time_ls = temp.start_times
         sort_tracks_inds = [[i, start_time_ls[i]] for i in range(length)]
         sort_tracks_inds.sort(key=lambda s: s[1])
         first_track_start_time = sort_tracks_inds[0][1]
         first_track_ind = sort_tracks_inds[0][0]
         first_track = all_tracks[first_track_ind]
         for i in sort_tracks_inds[1:]:
-            first_track &= (all_tracks[i[0]], i[1] - first_track_start_time)
+            current_track = all_tracks[i[0]]
+            current_start_time = i[1]
+            current_shift = current_start_time - first_track_start_time
+            first_track = first_track.add(current_track,
+                                          start=current_shift,
+                                          mode='head',
+                                          adjust_msg=False)
         first_track.other_messages = temp.other_messages
         if add_pan_volume:
             whole_pan = mp.concat(temp.pan)
             whole_volume = mp.concat(temp.volume)
             pan_msg = [
                 event('control_change',
                       channel=i.channel,
@@ -6124,16 +6157,21 @@
     first_track_ind = start_time_ls.index(first_track_start_time)
     start_time_ls.insert(0, start_time_ls.pop(first_track_ind))
 
     all_tracks.insert(0, all_tracks.pop(first_track_ind))
     first_track = all_tracks[0]
 
     for i in range(1, length):
-        first_track &= (all_tracks[i],
-                        start_time_ls[i] - first_track_start_time)
+        current_track = all_tracks[i]
+        current_start_time = start_time_ls[i]
+        current_shift = current_start_time - first_track_start_time
+        first_track = first_track.add(current_track,
+                                      start=current_shift,
+                                      mode='head',
+                                      adjust_msg=False)
     first_track.other_messages = other_messages
     if self.pan:
         for k in range(len(self.pan)):
             current_pan = self.pan[k]
             for each in current_pan:
                 each.track = k
     if self.volume:
```

### Comparing `musicpy-6.65/musicpy.egg-info/PKG-INFO` & `musicpy-6.67/musicpy.egg-info/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,16 +1,16 @@
 Metadata-Version: 2.1
 Name: musicpy
-Version: 6.65
+Version: 6.67
 Summary: Musicpy is a music programming language in Python designed to write music in very handy syntax through music theory and algorithms.
 Home-page: https://github.com/Rainbow-Dreamer/musicpy.git
 Author: Rainbow-Dreamer
 Author-email: 1036889495@qq.com
 License: LGPLv2.1
-Download-URL: https://github.com/Rainbow-Dreamer/musicpy/archive/6.65.tar.gz
+Download-URL: https://github.com/Rainbow-Dreamer/musicpy/archive/6.67.tar.gz
 Description: musicpy
         =======
         [中文](https://github.com/Rainbow-Dreamer/musicpy/blob/master/README_cn.md)
         
         Have you ever thought about writing music with codes in a very concise, human-readable syntax?
         
         Musicpy is a music programming language in Python designed to write music in very handy syntax through music theory and algorithms. It is easy to learn and write, easy to read, and incorporates a fully computerized music theory system.
```

### Comparing `musicpy-6.65/setup.py` & `musicpy-6.67/setup.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,22 +1,22 @@
 from setuptools import setup, find_packages
 
 setup(
     name='musicpy',
     packages=find_packages(),
     package_data={'musicpy': ['./*']},
-    version='6.65',
+    version='6.67',
     license='LGPLv2.1',
     description=
     'Musicpy is a music programming language in Python designed to write music in very handy syntax through music theory and algorithms.',
     author='Rainbow-Dreamer',
     author_email='1036889495@qq.com',
     url='https://github.com/Rainbow-Dreamer/musicpy.git',
     download_url=
-    'https://github.com/Rainbow-Dreamer/musicpy/archive/6.65.tar.gz',
+    'https://github.com/Rainbow-Dreamer/musicpy/archive/6.67.tar.gz',
     keywords=[
         'music language', 'use codes to write music', 'music language for AI'
     ],
     install_requires=['mido-fix', 'pygame', 'dataclasses'],
     classifiers=[
         'Development Status :: 3 - Alpha',
         'Intended Audience :: Developers',
```

